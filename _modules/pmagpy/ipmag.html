
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pmagpy.ipmag &#8212; PmagPy Documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/pmagpy_logo_notext.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">PmagPy Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    PmagPy: An open source package for paleomagnetic data analysis
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../installation/PmagPy_install.html">
   Installing
   <strong>
    PmagPy
   </strong>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/osx_pip.html">
     OSX pip install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/osx_developer.html">
     OSX developer install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/windows_pip.html">
     Windows pip install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/windows_developer.html">
     Windows developer install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/linux_pip.html">
     Linux pip install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/linux_developer.html">
     Linux developer install
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../installation/troubleshooting.html">
     Troubleshooting installation issues
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../programs/command_line_programs.html">
     Command line programs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../programs/pmag_gui.html">
   Installing and Getting Started with Pmag GUI
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../programs/demag_gui.html">
     Demag GUI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../programs/thellier_gui.html">
     Thellier GUI
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resources/survival_skills.html">
   Survival computer skills
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Documentation notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../documentation_notebooks/Jupyter.html">
   Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../documentation_notebooks/PmagPy_introduction.html">
   Introduction to PmagPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../documentation_notebooks/PmagPy_calculations.html">
   Calculations with PmagPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../documentation_notebooks/PmagPy_plots_analysis.html">
   Visualizations and more analysis with PmagPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../documentation_notebooks/PmagPy_MagIC.html">
   Working with the MagIC database using PmagPy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Example notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../example_notebooks/example_notebooks.html">
   Example notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../example_notebooks/Tauxe_etal_2016.html">
     Tauxe et al. 2016 example notebook
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MagIC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../MagIC/MagIC.html">
   MagIC database and file formats
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Function docstrings
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../api/api.html">
   API Reference
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/pmagpy/pmagpy-docs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/pmagpy/pmagpy-docs/issues/new?title=Issue%20on%20page%20%2F_modules/pmagpy/ipmag.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <h1>Source code for pmagpy.ipmag</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env/pythonw</span>
<span class="c1"># -*- coding: cp1252 -*-</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">wget</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fminbound</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">matplotlib.pylab</span> <span class="kn">import</span> <span class="n">polyfit</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mtick</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">requests</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">requests</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;ISO-8859-1&quot;</span>
<span class="kn">from</span> <span class="nn">.mapping</span> <span class="kn">import</span> <span class="n">map_magic</span>
<span class="kn">from</span> <span class="nn">pmagpy</span> <span class="kn">import</span> <span class="n">contribution_builder</span> <span class="k">as</span> <span class="n">cb</span>
<span class="kn">from</span> <span class="nn">pmagpy</span> <span class="kn">import</span> <span class="n">spline</span>
<span class="kn">from</span> <span class="nn">pmagpy</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">pmag_env</span> <span class="kn">import</span> <span class="n">set_env</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">pmag</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">pmagplotlib</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">data_model3</span> <span class="k">as</span> <span class="n">data_model</span>
<span class="kn">from</span> <span class="nn">.contribution_builder</span> <span class="kn">import</span> <span class="n">Contribution</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">validate_upload3</span> <span class="k">as</span> <span class="n">val_up3</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span><span class="p">,</span> <span class="n">eig</span>
<span class="n">has_basemap</span><span class="p">,</span> <span class="n">Basemap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">import_basemap</span><span class="p">()</span>
<span class="n">has_cartopy</span><span class="p">,</span> <span class="n">cartopy</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">import_cartopy</span><span class="p">()</span>

<span class="k">if</span> <span class="n">has_cartopy</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>


<div class="viewcode-block" id="igrf"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.igrf">[docs]</a><span class="k">def</span> <span class="nf">igrf</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ghfile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine declination, inclination and intensity from a geomagnetic</span>
<span class="sd">    field model. The default model used is the IGRF model </span>
<span class="sd">    (http://www.ngdc.noaa.gov/IAGA/vmod/igrf.html) with other</span>
<span class="sd">    models available for selection with the available options detailed</span>
<span class="sd">    in the mod parameter below.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        input_list : list with format [Date, Altitude, Latitude, Longitude]</span>
<span class="sd">            date must be in decimal year format XXXX.XXXX (Common Era)</span>
<span class="sd">            altitude is in kilometers</span>
<span class="sd">        mod :  desired model</span>
<span class="sd">            &quot;&quot; : Use the IGRF13 model by default</span>
<span class="sd">            &#39;custom&#39; : use values supplied in ghfile</span>
<span class="sd">            or choose from this list</span>
<span class="sd">            [&#39;arch3k&#39;,&#39;cals3k&#39;,&#39;pfm9k&#39;,&#39;hfm10k&#39;,&#39;cals10k.2&#39;,&#39;cals10k.1b&#39;,&#39;shadif14&#39;,&#39;shawq2k&#39;,&#39;shawqIA&#39;,&#39;ggf100k&#39;]</span>
<span class="sd">            where:</span>
<span class="sd">                - arch3k (Korte et al., 2009)</span>
<span class="sd">                - cals3k (Korte and Constable, 2011)</span>
<span class="sd">                - cals10k.1b (Korte et al., 2011)</span>
<span class="sd">                - pfm9k  (Nilsson et al., 2014)</span>
<span class="sd">                - hfm10k is the hfm.OL1.A1 of Constable et al. (2016)</span>
<span class="sd">                - cals10k.2 (Constable et al., 2016)</span>
<span class="sd">                - shadif14 (Pavon-Carrasco et al., 2014)</span>
<span class="sd">                - shawq2k (Campuzano et al., 2019)</span>
<span class="sd">                - shawqIA (Osete et al., 2020)</span>
<span class="sd">                - ggk100k (Panovska et al., 2018)[only models from -99950 in 200 year increments allowed)</span>
<span class="sd">                - the first four of these models, are constrained to agree</span>
<span class="sd">                - with gufm1 (Jackson et al., 2000) for the past four centuries</span>
<span class="sd">        gh : path to file with l m g h data</span>

<span class="sd">    Returns:</span>
<span class="sd">        igrf_array </span>
<span class="sd">            array of magnetic field values (0: dec; 1: inc; 2: intensity (in nT))</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; local_field = ipmag.igrf([2013.6544, .052, 37.87, -122.27])</span>
<span class="sd">        &gt;&gt;&gt; local_field</span>
<span class="sd">        array([1.431355648576314e+01, 6.148304376287219e+01, 4.899264739340517e+04])</span>
<span class="sd">        &gt;&gt;&gt; ipmag.igrf_print(local_field)</span>
<span class="sd">        Declination: 14.314</span>
<span class="sd">        Inclination: 61.483</span>
<span class="sd">        Intensity: 48992.647 nT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ghfile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">lmgh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">ghfile</span><span class="p">)</span>
        <span class="n">gh</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lmgh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">ghfile</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">gh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmgh</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lmgh</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">gh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmgh</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">gh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmgh</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gh</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no valid gh file&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
    <span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doigrf</span><span class="p">(</span>
            <span class="n">input_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">,</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">mod</span> <span class="o">!=</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doigrf</span><span class="p">(</span>
            <span class="n">input_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">,</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">docustom</span><span class="p">(</span>
            <span class="n">input_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">,</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gh</span><span class="p">)</span>

    <span class="n">igrf_array</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">igrf_array</span></div>


<div class="viewcode-block" id="igrf_print"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.igrf_print">[docs]</a><span class="k">def</span> <span class="nf">igrf_print</span><span class="p">(</span><span class="n">igrf_array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print out Declination, Inclination, Intensity from an array returned from</span>
<span class="sd">    the ipmag.igrf() function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        igrf_array : array that is output from ipmag.igrf() function</span>

<span class="sd">    Examples:</span>
<span class="sd">        An array generated by the ``ipmag.igrf()`` function is passed to ``ipmag.igrf_print()``</span>

<span class="sd">        &gt;&gt;&gt; local_field = ipmag.igrf([2013.6544, .052, 37.87, -122.27])</span>
<span class="sd">        &gt;&gt;&gt; ipmag.igrf_print(local_field)</span>
<span class="sd">        Declination: 14.314</span>
<span class="sd">        Inclination: 61.483</span>
<span class="sd">        Intensity: 48992.647 nT</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Declination: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">igrf_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inclination: </span><span class="si">%0.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">igrf_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intensity: </span><span class="si">%0.3f</span><span class="s2"> nT&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">igrf_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span></div>


<div class="viewcode-block" id="dms2dd"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.dms2dd">[docs]</a><span class="k">def</span> <span class="nf">dms2dd</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert latitude/longitude of a location that is in degrees, minutes, seconds to decimal degrees</span>

<span class="sd">    Parameters:</span>
<span class="sd">        degrees : degrees of latitude/longitude</span>
<span class="sd">        minutes : minutes of latitude/longitude</span>
<span class="sd">        seconds : seconds of latitude/longitude</span>

<span class="sd">    Returns:</span>
<span class="sd">        float</span>
<span class="sd">            decimal degrees of location</span>

<span class="sd">    Examples:</span>
<span class="sd">        Convert 180 degrees 4 minutes 23 seconds to decimal degrees:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.dms2dd(180,4,23)</span>
<span class="sd">        180.07305555555556</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dd</span></div>


<div class="viewcode-block" id="fisher_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.fisher_mean">[docs]</a><span class="k">def</span> <span class="nf">fisher_mean</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Fisher mean and associated parameters from either a list of</span>
<span class="sd">    declination values and a separate list of inclination values or from a</span>
<span class="sd">    di_block (a nested list of [dec,inc,1.0]). Returns a dictionary with the </span>
<span class="sd">    Fisher mean and statistical parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : list of declinations or longitudes</span>
<span class="sd">        inc : list of inclinations or latitudes</span>
<span class="sd">            or</span>
<span class="sd">        di_block : a nested list of [dec,inc,1.0]</span>
<span class="sd">            A di_block can be provided instead of dec, inc lists in which case it</span>
<span class="sd">            will be used. Either dec, inc lists or a di_block need to be provided.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictionary </span>
<span class="sd">            Dictionary containing the Fisher mean parameters.</span>
<span class="sd">            This dictionary can be printed in a more readable fashion using the</span>
<span class="sd">            ``ipmag.print_direction_mean()`` function if it is a directional mean or </span>
<span class="sd">            ``ipmag.print_pole_mean()`` function if it is a pole mean.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Use lists of declination and inclination to calculate a Fisher mean:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.fisher_mean(dec=[140,127,142,136],inc=[21,23,19,22])</span>
<span class="sd">        {&#39;alpha95&#39;: 7.292891411309177,</span>
<span class="sd">        &#39;csd&#39;: 6.4097743211340896,</span>
<span class="sd">        &#39;dec&#39;: 136.30838974272072,</span>
<span class="sd">        &#39;inc&#39;: 21.347784026899987,</span>
<span class="sd">        &#39;k&#39;: 159.69251473636305,</span>
<span class="sd">        &#39;n&#39;: 4,</span>
<span class="sd">        &#39;r&#39;: 3.9812138971889026}</span>

<span class="sd">        Use a di_block to calculate a Fisher mean (will give the same output as the</span>
<span class="sd">        example with the lists):</span>

<span class="sd">        &gt;&gt;&gt; ipmag.fisher_mean(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_block</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span></div>


<div class="viewcode-block" id="fisher_angular_deviation"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.fisher_angular_deviation">[docs]</a><span class="k">def</span> <span class="nf">fisher_angular_deviation</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mi">95</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The angle from the true mean within which a chosen percentage of directions</span>
<span class="sd">    lie can be calculated from the Fisher distribution. This function uses the</span>
<span class="sd">    calculated Fisher concentration parameter to estimate this angle from</span>
<span class="sd">    directional data. The 63 percent confidence interval is often called the</span>
<span class="sd">    angular standard deviation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : list of declinations or longitudes</span>
<span class="sd">        inc : list of inclinations or latitudes</span>
<span class="sd">                or</span>
<span class="sd">        di_block : a nested list of [dec,inc,1.0]</span>
<span class="sd">            A di_block can be provided instead of dec, inc lists in which case it</span>
<span class="sd">            will be used. Either dec, inc lists or a di_block need to be provided.</span>
<span class="sd">        confidence : 50 percent, 63 percent or 95 percent (default is 95 percent)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float</span>
<span class="sd">            theta is returned which is the critical angle of interest from the mean which contains the</span>
<span class="sd">            percentage of directions specified by the confidence parameter</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_block</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">confidence</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">67.5</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">confidence</span> <span class="o">==</span> <span class="mi">63</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">81.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">confidence</span> <span class="o">==</span> <span class="mi">95</span><span class="p">:</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">140.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">theta</span></div>


<div class="viewcode-block" id="bingham_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.bingham_mean">[docs]</a><span class="k">def</span> <span class="nf">bingham_mean</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Bingham mean and associated statistical parameters from</span>
<span class="sd">    either a list of declination values and a separate list of inclination</span>
<span class="sd">    values or from a di_block (a nested list of [dec, inc, 1.0]).</span>
<span class="sd">    Returns a dictionary with the Bingham mean and statistical parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec: list of declinations</span>
<span class="sd">        inc: list of inclinations</span>
<span class="sd">                or</span>
<span class="sd">        di_block: a nested list of [dec,inc,1.0]</span>
<span class="sd">            A di_block can be provided instead of dec, inc lists in which case it will</span>
<span class="sd">            be used. Either dec, inc lists or a di_block need to passed to the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictionary containing the Bingham mean and associated statistics.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Use lists of declination and inclination to calculate a Bingham mean:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.bingham_mean(dec=[140,127,142,136],inc=[21,23,19,22])</span>
<span class="sd">        {&#39;Edec&#39;: 220.84075754194598,</span>
<span class="sd">        &#39;Einc&#39;: -13.745780972597291,</span>
<span class="sd">        &#39;Eta&#39;: 9.9111522306938742,</span>
<span class="sd">        &#39;Zdec&#39;: 280.38894136954474,</span>
<span class="sd">        &#39;Zeta&#39;: 9.8653370276451113,</span>
<span class="sd">        &#39;Zinc&#39;: 64.23509410796224,</span>
<span class="sd">        &#39;dec&#39;: 136.32637167111312,</span>
<span class="sd">        &#39;inc&#39;: 21.34518678073179,</span>
<span class="sd">        &#39;n&#39;: 4}</span>

<span class="sd">        Use a di_block to calculate a Bingham mean (will give the same output as the</span>
<span class="sd">        example with the lists):</span>

<span class="sd">        &gt;&gt;&gt; ipmag.bingham_mean(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_block</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dobingham</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dobingham</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span></div>


<div class="viewcode-block" id="kent_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.kent_mean">[docs]</a><span class="k">def</span> <span class="nf">kent_mean</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Kent mean and associated statistical parameters from either</span>
<span class="sd">    a list of declination values and a separate list of inclination values or </span>
<span class="sd">    from a di_block (a nested list a nested list of [dec,inc,1.0]). Returns a</span>
<span class="sd">    dictionary with the Kent mean and statistical parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec: list of declinations</span>
<span class="sd">        inc: list of inclinations</span>
<span class="sd">                or</span>
<span class="sd">        di_block: a nested list of [dec,inc,1.0]</span>
<span class="sd">            A di_block can be provided instead of dec, inc lists in which case it will</span>
<span class="sd">            be used. Either dec, inc lists or a di_block need to passed to the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        kpars : dictionary containing Kent mean and associated statistics.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Use lists of declination and inclination to calculate a Kent mean:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.kent_mean(dec=[140,127,142,136],inc=[21,23,19,22])</span>
<span class="sd">        {&#39;Edec&#39;: 280.38683553668795,</span>
<span class="sd">        &#39;Einc&#39;: 64.236598921744289,</span>
<span class="sd">        &#39;Eta&#39;: 0.72982112760919715,</span>
<span class="sd">        &#39;Zdec&#39;: 40.824690028412761,</span>
<span class="sd">        &#39;Zeta&#39;: 6.7896823241008795,</span>
<span class="sd">        &#39;Zinc&#39;: 13.739412321974067,</span>
<span class="sd">        &#39;dec&#39;: 136.30838974272072,</span>
<span class="sd">        &#39;inc&#39;: 21.347784026899987,</span>
<span class="sd">        &#39;n&#39;: 4}</span>

<span class="sd">        Use a di_block to calculate a Kent mean (will give the same output as the</span>
<span class="sd">        example with the lists):</span>

<span class="sd">        &gt;&gt;&gt; ipmag.kent_mean(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_block</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">di_block</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">di_block</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">))</span></div>
    
    
<div class="viewcode-block" id="kent_distribution_95"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.kent_distribution_95">[docs]</a><span class="k">def</span> <span class="nf">kent_distribution_95</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Kent mean and and provides the parameters associated with</span>
<span class="sd">    the region containing 95% of the directions from either a list of</span>
<span class="sd">    declination values and a separate list of inclination values or from a</span>
<span class="sd">    di_block (a nested list a nested list of [dec,inc,1.0]). Returns a</span>
<span class="sd">    dictionary with the Kent mean and statistical parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    dec: list of declinations</span>
<span class="sd">    inc: list of inclinations</span>
<span class="sd">    di_block: a nested list of [dec,inc,1.0]</span>
<span class="sd">        A di_block can be provided instead of dec, inc lists in which case it will</span>
<span class="sd">        be used. Either dec, inc lists or a di_block need to passed to the function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictionary containing Kent mean and associated statistics.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Use lists of declination and inclination to calculate a Kent mean:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.kent_distribution_95(dec=[140,127,142,136],inc=[21,23,19,22])</span>
<span class="sd">        {&#39;dec&#39;: 136.30838974272072,</span>
<span class="sd">        &#39;inc&#39;: 21.347784026899987,</span>
<span class="sd">        &#39;n&#39;: 4,</span>
<span class="sd">        &#39;Zdec&#39;: 40.82469002841276,</span>
<span class="sd">        &#39;Zinc&#39;: 13.739412321974067,</span>
<span class="sd">        &#39;Edec&#39;: 280.38683553668795,</span>
<span class="sd">        &#39;Einc&#39;: 64.23659892174429,</span>
<span class="sd">        &#39;Zeta&#39;: 13.677129096579478,</span>
<span class="sd">        &#39;Eta&#39;: 1.4597607031196376}</span>
<span class="sd">        Use a di_block to calculate a Kent mean (will give the same output as the</span>
<span class="sd">        example with the lists):</span>

<span class="sd">        &gt;&gt;&gt; ipmag.kent_distribution_95(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_block</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">di_block</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">),</span> <span class="n">distribution_95</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">di_block</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">),</span> <span class="n">distribution_95</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_direction_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.print_direction_mean">[docs]</a><span class="k">def</span> <span class="nf">print_direction_mean</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does a pretty job printing a Fisher mean and associated statistics for</span>
<span class="sd">    directional data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mean_dictionary : output dictionary of pmag.fisher_mean()</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Generate a Fisher mean using ``ipmag.fisher_mean()`` and then print it nicely</span>
<span class="sd">    using ``ipmag.print_direction_mean()``</span>

<span class="sd">    &gt;&gt;&gt; my_mean = ipmag.fisher_mean(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &gt;&gt;&gt; ipmag.print_direction_mean(my_mean)</span>
<span class="sd">    Dec: 136.3  Inc: 21.3</span>
<span class="sd">    Number of directions in mean (n): 4</span>
<span class="sd">    Angular radius of 95% confidence (a_95): 7.3</span>
<span class="sd">    Precision parameter (k) estimate: 159.7</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dec: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
          <span class="s1">&#39;  Inc: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of directions in mean (n): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angular radius of 95</span><span class="si">% c</span><span class="s1">onfidence (a_95): &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision parameter (k) estimate: &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span></div>


<div class="viewcode-block" id="print_pole_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.print_pole_mean">[docs]</a><span class="k">def</span> <span class="nf">print_pole_mean</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does a pretty job printing a Fisher mean and associated statistics for</span>
<span class="sd">    mean paleomagnetic poles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mean_dictionary : output dictionary of pmag.fisher_mean()</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Generate a Fisher mean using ``ipmag.fisher_mean()`` and then print it nicely</span>
<span class="sd">    using ``ipmag.print_pole_mean()``</span>

<span class="sd">    &gt;&gt;&gt; my_mean = ipmag.fisher_mean(di_block=[[140,21],[127,23],[142,19],[136,22]])</span>
<span class="sd">    &gt;&gt;&gt; ipmag.print_pole_mean(my_mean)</span>
<span class="sd">    Plon: 136.3  Plat: 21.3</span>
<span class="sd">    Number of directions in mean (n): 4</span>
<span class="sd">    Angular radius of 95% confidence (A_95): 7.3</span>
<span class="sd">    Precision parameter (k) estimate: 159.7</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
          <span class="s1">&#39;  Plat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of directions in mean (n): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angular radius of 95</span><span class="si">% c</span><span class="s1">onfidence (A_95): &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision parameter (k) estimate: &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span></div>


<div class="viewcode-block" id="print_kent_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.print_kent_mean">[docs]</a><span class="k">def</span> <span class="nf">print_kent_mean</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does a pretty job printing a Kent mean and associated statistics.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mean_dictionary: output dictionary of ipmag.kent_mean</span>

<span class="sd">    Examples:</span>
<span class="sd">        Generate a Kent mean using ``ipmag.kent_mean()`` and then print it nicely</span>
<span class="sd">        using ``ipmag.print_kent_mean()``</span>
<span class="sd">        &gt;&gt;&gt; my_di_block = [[183.2931831390693, 80.70169305002725, 1.0],</span>
<span class="sd">                        [75.50744693411644, 79.57922789535208, 1.0],</span>
<span class="sd">                        [162.32513875820177, 76.51741087479394, 1.0],</span>
<span class="sd">                        [143.8749848879392, 85.79156599168213, 1.0],</span>
<span class="sd">                        [177.12011881027854, 84.02007456929348, 1.0]]</span>
<span class="sd">        &gt;&gt;&gt; my_kent_mean = ipmag.kent_mean(di_block = my_di_block)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.print_kent_mean(my_kent_mean)</span>
<span class="sd">        Plon: 150.4  Plat: 83.3</span>
<span class="sd">        Major axis lon: 31.4  Major axis lat: 3.2</span>
<span class="sd">        Minor axis lon: 301.0  Minor axis lat: 5.8</span>
<span class="sd">        Major axis angle of 95% ellipse (Zeta): 6.5</span>
<span class="sd">        Minor axis angle of 95% ellipse (Eta): 2.8</span>
<span class="sd">        Number of directions in mean (n): 5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
          <span class="s1">&#39;  Plat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Major axis lon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
          <span class="s1">&#39;  Major axis lat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minor axis lon: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
          <span class="s1">&#39;  Minor axis lat: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Major axis angle of 95</span><span class="si">% e</span><span class="s1">llipse (Zeta): &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minor axis angle of 95</span><span class="si">% e</span><span class="s1">llipse (Eta): &#39;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of directions in mean (n): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_dictionary</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="fishrot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.fishrot">[docs]</a><span class="k">def</span> <span class="nf">fishrot</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates Fisher distributed unit vectors from a specified distribution</span>
<span class="sd">    using the pmag.py function pmag.fshdev() and pmag.dodirot() functions.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        k : kappa precision parameter (default is 20)</span>
<span class="sd">        n : number of vectors to determine (default is 100)</span>
<span class="sd">        dec : mean declination of distribution (default is 0)</span>
<span class="sd">        inc : mean inclination of distribution (default is 90)</span>
<span class="sd">        di_block : this function returns a nested list of [dec,inc,1.0] as the default</span>
<span class="sd">        if di_block = False it will return a list of dec and a list of inc</span>

<span class="sd">    Returns:</span>
<span class="sd">        - di_block, a nested list of [dec,inc,1.0] (default)</span>
<span class="sd">        - dec, inc, a list of dec and a list of inc (if di_block = False)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; ipmag.fishrot(k=20, n=5, dec=40, inc=60)</span>
<span class="sd">        [[44.766285502555775, 37.440866867657235, 1.0],</span>
<span class="sd">        [33.866315796883725, 64.732532250463436, 1.0],</span>
<span class="sd">        [47.002912770597163, 54.317853800896977, 1.0],</span>
<span class="sd">        [36.762165614432547, 56.857240672884252, 1.0],</span>
<span class="sd">        [71.43950604474395, 59.825830945715431, 1.0]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">declinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inclinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">drot</span><span class="p">,</span> <span class="n">irot</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dodirot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
            <span class="n">directions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">drot</span><span class="p">,</span> <span class="n">irot</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">directions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">drot</span><span class="p">,</span> <span class="n">irot</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dodirot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
            <span class="n">declinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drot</span><span class="p">)</span>
            <span class="n">inclinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">declinations</span><span class="p">,</span> <span class="n">inclinations</span></div>
    
    
<div class="viewcode-block" id="fisher_mean_resample"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.fisher_mean_resample">[docs]</a><span class="k">def</span> <span class="nf">fisher_mean_resample</span><span class="p">(</span><span class="n">alpha95</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates resamples of directional means from a Fisher mean with a specified</span>
<span class="sd">    alpha95. Equivalent of sampling from the angular standard deviation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        alpha95 : 95% confidence on mean direction (default is 5)</span>
<span class="sd">        n : number of vectors to determine (default is 100)</span>
<span class="sd">        dec : mean declination of distribution (default is 0)</span>
<span class="sd">        inc : mean inclination of distribution (default is 90)</span>
<span class="sd">        di_block : this function returns a nested list of [dec,inc,1.0] as the default</span>
<span class="sd">            if di_block = False it will return a list of dec and a list of inc</span>

<span class="sd">    Returns:</span>
<span class="sd">        - di_block, a nested list of [dec,inc,1.0] (default)</span>
<span class="sd">        - dec, inc, a list of dec and a list of inc (if di_block = False)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; ipmag.fisher_mean_resample(alpha95=5, n=5, dec=40, inc=60)</span>
<span class="sd">        &gt;&gt;&gt; [[41.47587050719005, 62.44682515754436, 1.0],</span>
<span class="sd">            [33.738299775944085, 55.88461662263949, 1.0],</span>
<span class="sd">            [42.98707546462242, 60.21460942319564, 1.0],</span>
<span class="sd">            [28.282076485842992, 59.67015046929257, 1.0],</span>
<span class="sd">            [41.87081053973009, 57.18064045614739, 1.0]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">declinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inclinations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">140.0</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha95</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">drot</span><span class="p">,</span> <span class="n">irot</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dodirot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
            <span class="n">directions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">drot</span><span class="p">,</span> <span class="n">irot</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">directions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">drot</span><span class="p">,</span> <span class="n">irot</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dodirot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
            <span class="n">declinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drot</span><span class="p">)</span>
            <span class="n">inclinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">declinations</span><span class="p">,</span> <span class="n">inclinations</span></div>


<div class="viewcode-block" id="kentrot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.kentrot">[docs]</a><span class="k">def</span> <span class="nf">kentrot</span><span class="p">(</span><span class="n">kent_dict</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates Kent distributed unit vectors from a specified distribution</span>
<span class="sd">    using the pmag.py function pmag.kentdev().</span>

<span class="sd">    Parameters:</span>
<span class="sd">        kent_dict: a dictionary for Kent distribution parameters. It should at least have:</span>
<span class="sd">            dec: mean axis dec,</span>
<span class="sd">            inc: mean axis inc,</span>
<span class="sd">            Zdec: major axis dec,</span>
<span class="sd">            Zinc: major axis inc,</span>
<span class="sd">            Edec: minor axis dec,</span>
<span class="sd">            Einc: minor axis inc,</span>
<span class="sd">            R1: Kent distribution size quantity for calculating kappa and beta,</span>
<span class="sd">            R2: Kent distribution shape quantity for calculating kappa and beta}</span>
<span class="sd">        di_block : this function returns a nested list of [dec,inc,1.0] as the default</span>
<span class="sd">        if di_block = False it will return a list of dec and a list of inc</span>

<span class="sd">    Returns:</span>
<span class="sd">        **di_block**, a nested list of [dec,inc,1.0] (default)</span>
<span class="sd">        **dec, inc**, a list of dec and a list of inc (if di_block = False)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># get kent states from dictionary</span>
    <span class="n">mean_lon</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span>
    <span class="n">mean_lat</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
    <span class="n">major_lon</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">]</span>
    <span class="n">major_lat</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">]</span>
    <span class="n">minor_lon</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">]</span>
    <span class="n">minor_lat</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">]</span>
    <span class="n">R1</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;R1&#39;</span><span class="p">]</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">kent_dict</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span>

    <span class="c1"># calculate kappa and beta</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">R1</span><span class="o">-</span><span class="n">R2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">R1</span><span class="o">+</span><span class="n">R2</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">R1</span><span class="o">-</span><span class="n">R2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">R1</span><span class="o">+</span><span class="n">R2</span><span class="p">))</span>
    
    <span class="c1"># generate unrotated decs and incs</span>
    <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">kentdev</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    
    <span class="c1">#convert to cartesion coordinates</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># new axes:</span>
    <span class="n">new_axes</span>  <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">([[</span><span class="mi">360</span><span class="o">-</span><span class="n">minor_lon</span><span class="p">,</span><span class="o">-</span><span class="n">minor_lat</span><span class="p">],[</span><span class="n">major_lon</span><span class="p">,</span><span class="n">major_lat</span><span class="p">],[</span><span class="n">mean_lon</span><span class="p">,</span><span class="n">mean_lat</span><span class="p">]])</span>

    <span class="c1"># old axes:</span>
    <span class="n">old_axes</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">([[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">]])</span>

    <span class="c1"># construct coordinate rotation matrix</span>
    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">new_axes</span><span class="p">,</span><span class="n">old_axes</span><span class="p">)</span>

    <span class="n">rotated_X</span> <span class="o">=</span> <span class="n">X</span><span class="nd">@rotation_matrix</span>

    <span class="n">rotated_dir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">(</span><span class="n">rotated_X</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">rotated_decs</span><span class="p">,</span> <span class="n">rotated_incs</span> <span class="o">=</span> <span class="n">rotated_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">rotated_dir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">di_block</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">rotated_decs</span><span class="p">,</span> <span class="n">rotated_incs</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rotated_decs</span><span class="p">,</span> <span class="n">rotated_incs</span></div>


<div class="viewcode-block" id="tk03"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.tk03">[docs]</a><span class="k">def</span> <span class="nf">tk03</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">G1</span><span class="o">=-</span><span class="mf">18e3</span><span class="p">,</span> <span class="n">G2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">G3</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">B_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates vectors drawn from the TK03.gad model of secular</span>
<span class="sd">    variation (Tauxe and Kent, 2004) at given latitude and rotated</span>
<span class="sd">    about a vertical axis by the given declination. Returns a nested list of</span>
<span class="sd">    of [dec,inc,intensity].</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : number of vectors to determine (default is 100)</span>
<span class="sd">    dec : mean declination of data set (default is 0)</span>
<span class="sd">    lat : latitude at which secular variation is simulated (default is 0)</span>
<span class="sd">    rev : if reversals are to be included this should be &#39;yes&#39; (default is &#39;no&#39;)</span>
<span class="sd">    G1 : specify average g_1^0 fraction (default is -18e3 in nT, minimum = 1)</span>
<span class="sd">    G2 : specify average g_2^0 fraction (default is 0)</span>
<span class="sd">    G3 : specify average g_3^0 fraction (default is 0)</span>
<span class="sd">    B_threshold : return vectors with B&gt;B_threshold (in nT) (default is 0 which</span>
<span class="sd">        returns all vectors)</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    tk_03_output : a nested list of declination, inclination, and intensity (in nT)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ipmag.tk03(n=5, dec=0, lat=0)</span>
<span class="sd">    [[14.752502674158681, -36.189370642603834, 16584.848620957589],</span>
<span class="sd">     [9.2859465437113311, -10.064247301056071, 17383.950391596223],</span>
<span class="sd">     [2.4278460589582913, 4.8079990844938019, 18243.679003572055],</span>
<span class="sd">     [352.93759572283585, 0.086693343935840397, 18524.551174838372],</span>
<span class="sd">     [352.48366219759953, 11.579098286352332, 24928.412830772766]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tk_03_output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span> 
        <span class="n">gh</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">mktk03</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">G2</span><span class="p">,</span> <span class="n">G3</span><span class="p">,</span> <span class="n">G1</span><span class="o">=</span><span class="n">G1</span><span class="p">)</span>  <span class="c1"># terms and random seed</span>
        <span class="c1"># get a random longitude, between 0 and 359</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">vec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getvec</span><span class="p">(</span><span class="n">gh</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>  <span class="c1"># send field model and lat to getvec</span>
        <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dec</span>
        <span class="k">if</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">360.</span><span class="p">:</span>
            <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">360.</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rev</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">180.</span>
            <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">B_threshold</span><span class="p">:</span>
            <span class="n">tk_03_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1">#else: # do more </span>
        <span class="c1">#    k-=1</span>
    <span class="k">return</span> <span class="n">tk_03_output</span></div>


<div class="viewcode-block" id="unsquish"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.unsquish">[docs]</a><span class="k">def</span> <span class="nf">unsquish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function applies a flattening factor (f) to unflatten inclination</span>
<span class="sd">    data (incs) and returns &#39;unsquished&#39; values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    incs : list of inclination values or a single value</span>
<span class="sd">    f : flattening factor</span>
<span class="sd">        A value greater than 0.0 and less than or equal to 1.0 that is used </span>
<span class="sd">        to unflatten inclination values. 1.0 implies no flatting and will </span>
<span class="sd">        result in no change.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    incs_unsquished : List of unflattened inclinations (in degrees)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Take a list of inclinations, flatten them using ``ipmag.squish`` and then</span>
<span class="sd">    use ``ipmag.squish`` and the flattening factor to unflatten (i.e. </span>
<span class="sd">    &quot;unsquish&quot;) them:</span>

<span class="sd">    &gt;&gt;&gt; inclinations = [43,47,41]</span>
<span class="sd">    &gt;&gt;&gt; squished_incs = ipmag.squish(inclinations,0.4)</span>
<span class="sd">    &gt;&gt;&gt; ipmag.unsquish(squished_incs,0.4)</span>
<span class="sd">    [43.0, 47.0, 41.0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">incs</span><span class="p">)</span>
        <span class="n">incs_unsquished</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">inc_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">incs</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>  <span class="c1"># convert to radians</span>
            <span class="n">inc_new_rad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_rad</span><span class="p">)</span>
            <span class="c1"># convert back to degrees</span>
            <span class="n">inc_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">inc_new_rad</span><span class="p">))</span>
            <span class="n">incs_unsquished</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inc_new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">incs_unsquished</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">inc_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">incs</span><span class="p">)</span>  <span class="c1"># convert to radians</span>
        <span class="n">inc_new_rad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_rad</span><span class="p">)</span>
        <span class="n">inc_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">inc_new_rad</span><span class="p">))</span>  <span class="c1"># convert back to degrees</span>
        <span class="k">return</span> <span class="n">inc_new</span></div>


<div class="viewcode-block" id="squish"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.squish">[docs]</a><span class="k">def</span> <span class="nf">squish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function applies an flattening factor (f) to inclination data</span>
<span class="sd">    (incs) and returns &#39;squished&#39; values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    incs : list of inclination values or a single value</span>
<span class="sd">    f : flattening factor</span>
<span class="sd">        A value between 0.0 and 1.0 where 1.0 is no flattening and 0.0 is</span>
<span class="sd">        complete flattening.</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    incs_squished : List of flattened directions (in degrees)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Take a list of inclinations and flatten (i.e. &quot;squish&quot;) them:</span>

<span class="sd">    &gt;&gt;&gt; inclinations = [43,47,41]</span>
<span class="sd">    &gt;&gt;&gt; ipmag.squish(inclinations,0.4)</span>
<span class="sd">    [20.455818908027187, 23.216791019112204, 19.173314360172309]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">incs</span><span class="p">)</span>
        <span class="n">incs_squished</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">inc_rad</span> <span class="o">=</span> <span class="n">incs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>  <span class="c1"># convert to radians</span>
            <span class="n">inc_new_rad</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_rad</span><span class="p">)</span>
            <span class="n">inc_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">inc_new_rad</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># convert back to degrees</span>
            <span class="n">incs_squished</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inc_new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">incs_squished</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">inc_rad</span> <span class="o">=</span> <span class="n">incs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>  <span class="c1"># convert to radians</span>
        <span class="n">inc_new_rad</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_rad</span><span class="p">)</span>
        <span class="n">inc_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">inc_new_rad</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># convert back to degrees</span>
        <span class="k">return</span> <span class="n">inc_new</span></div>


<div class="viewcode-block" id="f_factor_calc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.f_factor_calc">[docs]</a><span class="k">def</span> <span class="nf">f_factor_calc</span><span class="p">(</span><span class="n">inc_observed</span><span class="p">,</span> <span class="n">inc_field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the flattening factor (f) from an observed inclination in</span>
<span class="sd">    comparison to the expected inclination.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        inc_observed : the observed inclination (e.g. magnetization of sediment)</span>
<span class="sd">        inc_field : inclination of field in which magnetization was acquired</span>

<span class="sd">    Returns:</span>
<span class="sd">        f_factor : the flattening factor</span>

<span class="sd">    Examples:</span>
<span class="sd">        Calculate the f factor for an inclination that was shallowed from 40 degrees</span>
<span class="sd">        to 25 degrees:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.f_factor_calc(25,40)</span>
<span class="sd">        0.5557238268604126</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inc_observed_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">inc_observed</span><span class="p">)</span>
    <span class="n">inc_field_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">inc_field</span><span class="p">)</span>
    <span class="n">f_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_observed_rad</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc_field_rad</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f_factor</span></div>


<div class="viewcode-block" id="do_flip"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.do_flip">[docs]</a><span class="k">def</span> <span class="nf">do_flip</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit_vector</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns the antipode (i.e. it flips) of directions.</span>

<span class="sd">    The function can take dec and inc as separate lists if they are of equal</span>
<span class="sd">    length and explicitly specified or are the first two arguments. It will then</span>
<span class="sd">    return a list of flipped decs and a list of flipped incs. If a di_block (a</span>
<span class="sd">    nested list of [dec, inc, 1.0]) is specified then it is used and the function</span>
<span class="sd">    returns a di_block with the flipped directions.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : list of declinations</span>
<span class="sd">        inc : list of inclinations</span>
<span class="sd">        di_block : a nested list of [dec, inc, 1.0]</span>
<span class="sd">            A di_block can be provided instead of dec, inc lists in which case it will</span>
<span class="sd">            be used. Either dec, inc lists or a di_block need to passed to the function.</span>
<span class="sd">        unit_vector : if True will return [dec,inc,1.]; if False will return [dec,inc]</span>
<span class="sd">        (default is True)</span>

<span class="sd">    Returns:</span>
<span class="sd">        either **dec_flip, inc_flip** as lists of flipped declinations and inclinations</span>
<span class="sd">        or **dflip** as a nested list of [dec, inc, 1.0] or [dec, inc]</span>

<span class="sd">    Examples</span>
<span class="sd">    ----------</span>
<span class="sd">    Lists of declination and inclination can be flipped to their antipodes:</span>

<span class="sd">    &gt;&gt;&gt; decs = [1.0, 358.0, 2.0]</span>
<span class="sd">    &gt;&gt;&gt; incs = [10.0, 12.0, 8.0]</span>
<span class="sd">    &gt;&gt;&gt; ipmag.do_flip(decs, incs)</span>
<span class="sd">    ([181.0, 178.0, 182.0], [-10.0, -12.0, -8.0])</span>

<span class="sd">    The function can also take a di_block and returns a flipped di_block:</span>

<span class="sd">    &gt;&gt;&gt; directions = [[1.0,10.0],[358.0,12.0,],[2.0,8.0]]</span>
<span class="sd">    &gt;&gt;&gt; ipmag.do_flip(di_block=directions)</span>
<span class="sd">    [[181.0, -10.0, 1.0], [178.0, -12.0, 1.0], [182.0, -8.0, 1.0]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dec_flip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">inc_flip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)):</span>
            <span class="n">dec_flip</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dec</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span><span class="p">)</span>
            <span class="n">inc_flip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dec_flip</span><span class="p">,</span> <span class="n">inc_flip</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dflip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">di_block</span><span class="p">:</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">,</span> <span class="o">-</span><span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">unit_vector</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="n">dflip</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">unit_vector</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="n">dflip</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dflip</span></div>


<div class="viewcode-block" id="bootstrap_fold_test"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.bootstrap_fold_test">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_fold_test</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">num_sims</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">min_untilt</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_untilt</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">bedding_error</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">ninety_nine</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct a bootstrap fold test (Tauxe and Watson, 1994)</span>

<span class="sd">    Three plots are generated: 1) equal area plot of uncorrected data;</span>
<span class="sd">    2) tilt-corrected equal area plot; 3) bootstrap results showing the trend</span>
<span class="sd">    of the largest eigenvalues for a selection of the pseudo-samples (red</span>
<span class="sd">    dashed lines), the cumulative distribution of the eigenvalue maximum (green</span>
<span class="sd">    line) and the confidence bounds that enclose 95% of the pseudo-sample</span>
<span class="sd">    maxima. If the confidence bounds enclose 100% unfolding, the data &quot;pass&quot;</span>
<span class="sd">    the fold test.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        Data : a numpy array of directional data [dec, inc, dip_direction, dip]</span>
<span class="sd">            dec, inc are the declination and inclination of the paleomagnetic directions</span>
<span class="sd">            dip_direction, dip are the orientation of the bedding</span>
<span class="sd">        num_sims : number of bootstrap samples (default is 1000)</span>
<span class="sd">        min_untilt : minimum percent untilting applied to the data (default is -10%)</span>
<span class="sd">        max_untilt : maximum percent untilting applied to the data (default is 120%)</span>
<span class="sd">        bedding_error : (circular standard deviation) for uncertainty on bedding poles</span>
<span class="sd">        save : optional save of plots (default is False)</span>
<span class="sd">        save_folder : path to directory where plots should be saved</span>
<span class="sd">        fmt : format of figures to be saved (default is &#39;svg&#39;)</span>
<span class="sd">        ninety_nine : changes confidence bounds from 95 percent to 99 if True</span>

<span class="sd">    Returns:</span>
<span class="sd">        - uncorrected data equal area plot</span>
<span class="sd">        - tilt-corrected data equal area plot</span>
<span class="sd">        - bootstrap results and CDF of the eigenvalue maximum</span>

<span class="sd">    Examples:</span>
<span class="sd">        Data in separate lists of dec, inc, dip_direction, dip data can be made into</span>
<span class="sd">        the needed array using the ``ipmag.make_diddd_array`` function.</span>

<span class="sd">        &gt;&gt;&gt; dec = [132.5,124.3,142.7,130.3,163.2]</span>
<span class="sd">        &gt;&gt;&gt; inc = [12.1,23.2,34.2,37.7,32.6]</span>
<span class="sd">        &gt;&gt;&gt; dip_direction = [265.0,265.0,265.0,164.0,164.0]</span>
<span class="sd">        &gt;&gt;&gt; dip = [20.0,20.0,20.0,72.0,72.0]</span>
<span class="sd">        &gt;&gt;&gt; data_array = ipmag.make_diddd_array(dec,inc,dip_direction,dip)</span>
<span class="sd">        &gt;&gt;&gt; data_array</span>
<span class="sd">        array([[ 132.5,   12.1,  265. ,   20. ],</span>
<span class="sd">        [ 124.3,   23.2,  265. ,   20. ],</span>
<span class="sd">        [ 142.7,   34.2,  265. ,   20. ],</span>
<span class="sd">        [ 130.3,   37.7,  164. ,   72. ],</span>
<span class="sd">        [ 163.2,   32.6,  164. ,   72. ]])</span>

<span class="sd">        This array can then be passed to the function:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.bootstrap_fold_test(data_array)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bedding_error</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">81.0</span><span class="o">/</span><span class="n">bedding_error</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">plot_net</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_di</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Data</span><span class="p">)</span>  <span class="c1"># plot directions</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s1">&#39;Geographic&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;eq_geo&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>

    <span class="n">D</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dotilt_V</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
    <span class="n">TCs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">plot_net</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_di</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">TCs</span><span class="p">)</span>  <span class="c1"># plot directions</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s1">&#39;Tilt-corrected&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;eq_tc&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;doing &#39;</span><span class="p">,</span> <span class="n">num_sims</span><span class="p">,</span> <span class="s1">&#39; iterations...please be patient.....&#39;</span><span class="p">)</span>

    <span class="n">Percs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_untilt</span><span class="p">,</span> <span class="n">max_untilt</span><span class="p">))</span>
    <span class="n">Cdf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Untilt</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sims</span><span class="p">):</span>  <span class="c1"># do bootstrap data sets - plot first 25 as dashed red line</span>
            <span class="c1"># if n%50==0:print n</span>
        <span class="n">Taus</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># set up lists for taus</span>
        <span class="n">PDs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">pseudo</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kappa</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">PDs</span><span class="p">)):</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
                <span class="n">dipdir</span><span class="p">,</span> <span class="n">dip</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dodirot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">PDs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">PDs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">PDs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dipdir</span>
                <span class="n">PDs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dip</span>
        <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="n">Percs</span><span class="p">:</span>
            <span class="n">tilt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">perc</span><span class="p">])</span>
            <span class="n">D</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dotilt_V</span><span class="p">(</span><span class="n">PDs</span> <span class="o">*</span> <span class="n">tilt</span><span class="p">)</span>
            <span class="n">TCs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">TCs</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
            <span class="n">Taus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;tau1&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Percs</span><span class="p">,</span> <span class="n">Taus</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
        <span class="c1"># tilt that gives maximum tau</span>
        <span class="n">Untilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Percs</span><span class="p">[</span><span class="n">Taus</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Taus</span><span class="p">))])</span>
        <span class="n">Cdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">num_sims</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Percs</span><span class="p">,</span> <span class="n">Taus</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;% Untilting&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;tau_1 (red), CDF (green)&#39;</span><span class="p">)</span>
    <span class="n">Untilt</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># now for CDF of tilt of maximum tau</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Untilt</span><span class="p">,</span> <span class="n">Cdf</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">.025</span> <span class="o">*</span> <span class="n">num_sims</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">.975</span> <span class="o">*</span> <span class="n">num_sims</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Untilt</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Untilt</span><span class="p">[</span><span class="n">upper</span><span class="p">],</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> - </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Untilt</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">Untilt</span><span class="p">[</span><span class="n">upper</span><span class="p">],</span> <span class="s1">&#39;percent unfolding&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ninety_nine</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tightest grouping of vectors obtained at (99</span><span class="si">% c</span><span class="s1">onfidence bounds):&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">.005</span> <span class="o">*</span> <span class="n">num_sims</span><span class="p">),</span> <span class="s1">&#39; - &#39;</span><span class="p">,</span>
              <span class="nb">int</span><span class="p">(</span><span class="mf">.995</span> <span class="o">*</span> <span class="n">num_sims</span><span class="p">),</span> <span class="s1">&#39;percent unfolding&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tightest grouping of vectors obtained at (95</span><span class="si">% c</span><span class="s1">onfidence bounds):&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range of all bootstrap samples: &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Untilt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="n">Untilt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;percent unfolding&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;bootstrap_CDF&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="common_mean_bootstrap"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.common_mean_bootstrap">[docs]</a><span class="k">def</span> <span class="nf">common_mean_bootstrap</span><span class="p">(</span><span class="n">Data1</span><span class="p">,</span> <span class="n">Data2</span><span class="p">,</span> <span class="n">NumSims</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
                          <span class="n">color1</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">color2</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                          <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> 
                          <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">),</span> <span class="n">x_tick_bins</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct a bootstrap test (Tauxe, 2010) for a common mean on two declination,</span>
<span class="sd">    inclination data sets. Plots are generated of the cumulative distributions</span>
<span class="sd">    of the Cartesian coordinates of the means of the pseudo-samples (one for x,</span>
<span class="sd">    one for y and one for z). If the 95 percent confidence bounds for each</span>
<span class="sd">    component overlap, the two set of directions &quot;pass&quot; the test and are</span>
<span class="sd">    consistent with sharing a common mean.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        Data1 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">        Data2 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">                if Data2 is length of 1, treat as single direction</span>
<span class="sd">        NumSims : number of bootstrap samples (default is 1000)</span>
<span class="sd">        save : optional save of plots (default is False)</span>
<span class="sd">        save_folder : path to directory where plots should be saved</span>
<span class="sd">        fmt : format of figures to be saved (default is &#39;svg&#39;)</span>
<span class="sd">        figsize : optionally adjust figure size (default is (7, 2.3))</span>
<span class="sd">        x_tick_bins : because they occasionally overlap depending on the data, this</span>
<span class="sd">            argument allows you adjust number of tick marks on the x axis of graphs</span>
<span class="sd">            (default is 4)</span>

<span class="sd">    Returns:</span>
<span class="sd">        **three plots** (cumulative distributions of the X, Y, Z of bootstrapped means, </span>
<span class="sd">        **result** (a boolean where 0 is fail and 1 is pass)</span>

<span class="sd">    Examples:</span>
<span class="sd">        Develop two populations of directions using ``ipmag.fishrot()``. Use the</span>
<span class="sd">        function to determine if they share a common mean.</span>

<span class="sd">        &gt;&gt;&gt; directions_A = ipmag.fishrot(k=20, n=30, dec=40, inc=60)</span>
<span class="sd">        &gt;&gt;&gt; directions_B = ipmag.fishrot(k=35, n=25, dec=42, inc=57)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.common_mean_bootstrap(directions_A, directions_B)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BDI1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">Data1</span><span class="p">)</span>
    <span class="n">cart1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">BDI1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">Z1</span> <span class="o">=</span> <span class="n">cart1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cart1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cart1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">BDI2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span>
        <span class="n">cart2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">BDI2</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">Z2</span> <span class="o">=</span> <span class="n">cart2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cart2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cart2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cart</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    
    <span class="n">minimum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.025</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X1</span><span class="p">))</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.975</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X1</span><span class="p">))</span>
    
    <span class="n">fignum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">X1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="s2">&quot;X component&quot;</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">bounds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">X1</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">X1</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds1</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">X2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="s2">&quot;X component&quot;</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bounds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">X2</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">X2</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds2</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="p">[</span><span class="n">cart</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">x_tick_bins</span><span class="p">)</span>
    <span class="n">x_overlap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">interval_overlap</span><span class="p">(</span><span class="n">bounds1</span><span class="p">,</span><span class="n">bounds2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Y1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="s2">&quot;Y component&quot;</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">bounds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y1</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">Y1</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds1</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">Y2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="s2">&quot;Y component&quot;</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bounds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y2</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">Y2</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds2</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="p">[</span><span class="n">cart</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y_overlap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">interval_overlap</span><span class="p">(</span><span class="n">bounds1</span><span class="p">,</span><span class="n">bounds2</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">Z1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="s2">&quot;Z component&quot;</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">bounds1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Z1</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">Z1</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds1</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">Z2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="s2">&quot;Z component&quot;</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bounds2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Z2</span><span class="p">[</span><span class="n">minimum</span><span class="p">],</span> <span class="n">Z2</span><span class="p">[</span><span class="n">maximum</span><span class="p">]]</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">bounds2</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="p">[</span><span class="n">cart</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">x_tick_bins</span><span class="p">)</span>
    <span class="n">z_overlap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">interval_overlap</span><span class="p">(</span><span class="n">bounds1</span><span class="p">,</span><span class="n">bounds2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;common_mean_bootstrap&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pass&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in x&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in y&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in z&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in x and y&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in x and z&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in y and z&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="p">((</span><span class="n">x_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">z_overlap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fail, distinct in x, y and z&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span></div>
        

<div class="viewcode-block" id="common_mean_watson"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.common_mean_watson">[docs]</a><span class="k">def</span> <span class="nf">common_mean_watson</span><span class="p">(</span><span class="n">Data1</span><span class="p">,</span> <span class="n">Data2</span><span class="p">,</span> <span class="n">NumSims</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">print_result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct a Watson V test for a common mean on two directional data sets.</span>

<span class="sd">    This function calculates Watson&#39;s V statistic from input lists through</span>
<span class="sd">    Monte Carlo simulation in order to test whether two populations of</span>
<span class="sd">    directional data could have been drawn from a common mean. The critical</span>
<span class="sd">    angle between the two sample mean directions and the corresponding</span>
<span class="sd">    McFadden and McElhinny (1990) classification is printed.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        Data1 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">        Data2 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">        NumSims : number of Monte Carlo simulations (default is 5000)</span>
<span class="sd">        print_result : default is to print the test result (True)</span>
<span class="sd">        plot : the default is no plot (&#39;no&#39;). </span>
<span class="sd">            Putting &#39;yes&#39; will the plot the CDF from the Monte Carlo simulations.</span>
<span class="sd">        save : optional save of plots (default is False)</span>
<span class="sd">        save_folder : path to where plots will be saved (default is current)</span>
<span class="sd">        fmt : format of figures to be saved (default is &#39;svg&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        **printed text** (text describing the test result is printed), </span>
<span class="sd">        **result** (a boolean where 0 is fail and 1 is pass), </span>
<span class="sd">        **angle** (angle between the Fisher means of the two data sets), </span>
<span class="sd">        **critical_angle** (critical angle for the test to pass), </span>
<span class="sd">        **classification** (MM1990 classification for a positive test), </span>

<span class="sd">    Examples:</span>
<span class="sd">        Develop two populations of directions using ``ipmag.fishrot``. Use the</span>
<span class="sd">        function to determine if they share a common mean.</span>

<span class="sd">        &gt;&gt;&gt; directions_A = ipmag.fishrot(k=20, n=30, dec=40, inc=60)</span>
<span class="sd">        &gt;&gt;&gt; directions_B = ipmag.fishrot(k=35, n=25, dec=42, inc=57)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.common_mean_watson(directions_A, directions_B)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars_1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">Data1</span><span class="p">)</span>
    <span class="n">pars_2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span>
    <span class="n">cart_1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">([</span><span class="n">pars_1</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">pars_1</span><span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">],</span> <span class="n">pars_1</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]])</span>
    <span class="n">cart_2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">([</span><span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="n">pars_2</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]])</span>
    <span class="n">Sw</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>  <span class="c1"># k1*r1+k2*r2</span>
    <span class="n">xhat_1</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># k1*x1+k2*x2</span>
    <span class="n">xhat_2</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># k1*y1+k2*y2</span>
    <span class="n">xhat_3</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cart_2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># k1*z1+k2*z2</span>
    <span class="n">Rw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xhat_1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xhat_2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xhat_3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Sw</span> <span class="o">-</span> <span class="n">Rw</span><span class="p">)</span>
    <span class="c1"># keep weighted sum for later when determining the &quot;critical angle&quot;</span>
    <span class="c1"># let&#39;s save it as Sr (notation of McFadden and McElhinny, 1990)</span>
    <span class="n">Sr</span> <span class="o">=</span> <span class="n">Sw</span>

    <span class="c1"># do monte carlo simulation of datasets with same kappas as data,</span>
    <span class="c1"># but a common mean</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Vp</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># set of Vs from simulations</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NumSims</span><span class="p">):</span>

        <span class="c1"># get a set of N1 fisher distributed vectors with k1,</span>
        <span class="c1"># calculate fisher stats</span>
        <span class="n">Dirp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]):</span>
            <span class="n">Dirp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]))</span>
        <span class="n">pars_p1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">Dirp</span><span class="p">)</span>
    <span class="c1"># get a set of N2 fisher distributed vectors with k2,</span>
    <span class="c1"># calculate fisher stats</span>
        <span class="n">Dirp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]):</span>
            <span class="n">Dirp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]))</span>
        <span class="n">pars_p2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">Dirp</span><span class="p">)</span>
    <span class="c1"># get the V for these</span>
        <span class="n">Vk</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">vfunc</span><span class="p">(</span><span class="n">pars_p1</span><span class="p">,</span> <span class="n">pars_p2</span><span class="p">)</span>
        <span class="n">Vp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vk</span><span class="p">)</span>

    <span class="c1"># sort the Vs, get Vcrit (95th percentile one)</span>

    <span class="n">Vp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">.95</span> <span class="o">*</span> <span class="n">NumSims</span><span class="p">)</span>
    <span class="n">Vcrit</span> <span class="o">=</span> <span class="n">Vp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="c1"># equation 18 of McFadden and McElhinny, 1990 calculates the critical</span>
    <span class="c1"># value of R (Rwc)</span>

    <span class="n">Rwc</span> <span class="o">=</span> <span class="n">Sr</span> <span class="o">-</span> <span class="p">(</span><span class="n">Vcrit</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># following equation 19 of McFadden and McElhinny (1990) the critical</span>
    <span class="c1"># angle is calculated. If the observed angle (also calculated below)</span>
    <span class="c1"># between the data set means exceeds the critical angle the hypothesis</span>
    <span class="c1"># of a common mean direction may be rejected at the 95% confidence</span>
    <span class="c1"># level. The critical angle is simply a different way to present</span>
    <span class="c1"># Watson&#39;s V parameter so it makes sense to use the Watson V parameter</span>
    <span class="c1"># in comparison with the critical value of V for considering the test</span>
    <span class="c1"># results. What calculating the critical angle allows for is the</span>
    <span class="c1"># classification of McFadden and McElhinny (1990) to be made</span>
    <span class="c1"># for data sets that are consistent with sharing a common mean.</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
    <span class="n">R1</span> <span class="o">=</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="n">critical_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(((</span><span class="n">Rwc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">k1</span> <span class="o">*</span> <span class="n">R1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                                   <span class="o">-</span> <span class="p">((</span><span class="n">k2</span> <span class="o">*</span> <span class="n">R2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span>
                                                  <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">R1</span> <span class="o">*</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">R2</span><span class="p">)))</span>
    <span class="n">D1</span> <span class="o">=</span> <span class="p">(</span><span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">pars_1</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
    <span class="n">D2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">pars_2</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">D1</span><span class="p">,</span> <span class="n">D2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results of Watson V test: &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Watson&#39;s V:           &quot;</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">V</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Critical value of V:  &quot;</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Vcrit</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">V</span> <span class="o">&lt;</span> <span class="n">Vcrit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;Pass&quot;: Since V is less than Vcrit, the null hypothesis&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;that the two populations are drawn from distributions&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;that share a common mean direction can not be rejected.&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">V</span> <span class="o">&gt;</span> <span class="n">Vcrit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;Fail&quot;: Since V is greater than Vcrit, the two means can&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;be distinguished at the 95</span><span class="si">% c</span><span class="s1">onfidence level.&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
    <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;M&amp;M1990 classification:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Angle between data set means: &quot;</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">angle</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Critical angle for M&amp;M1990:   &quot;</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">critical_angle</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">V</span> <span class="o">&gt;</span> <span class="n">Vcrit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">V</span> <span class="o">&lt;</span> <span class="n">Vcrit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">critical_angle</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The McFadden and McElhinny (1990) classification for&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this test is: &#39;A&#39;&quot;</span><span class="p">)</span>
                <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
            <span class="k">elif</span> <span class="n">critical_angle</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The McFadden and McElhinny (1990) classification for&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this test is: &#39;B&#39;&quot;</span><span class="p">)</span>
                <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
            <span class="k">elif</span> <span class="n">critical_angle</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The McFadden and McElhinny (1990) classification for&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this test is: &#39;C&#39;&quot;</span><span class="p">)</span>
                <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The McFadden and McElhinny (1990) classification for&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this test is: &#39;INDETERMINATE;&quot;</span><span class="p">)</span>
                <span class="n">classification</span> <span class="o">=</span> <span class="s1">&#39;indeterminate&#39;</span>

    <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">CDF</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cdf&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="c1"># pmagplotlib.plot_init(CDF[&#39;cdf&#39;],5,5)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">CDF</span><span class="p">[</span><span class="s1">&#39;cdf&#39;</span><span class="p">],</span> <span class="n">Vp</span><span class="p">,</span> <span class="s2">&quot;Watson&#39;s V&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">CDF</span><span class="p">[</span><span class="s1">&#39;cdf&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">CDF</span><span class="p">[</span><span class="s1">&#39;cdf&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">Vp</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="c1"># pmagplotlib.draw_figs(CDF)</span>
        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;common_mean_watson&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">CDF</span><span class="p">[</span><span class="s1">&#39;cdf&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">critical_angle</span><span class="p">,</span> <span class="n">classification</span></div>


<div class="viewcode-block" id="common_mean_bayes"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.common_mean_bayes">[docs]</a><span class="k">def</span> <span class="nf">common_mean_bayes</span><span class="p">(</span><span class="n">Data1</span><span class="p">,</span> <span class="n">Data2</span><span class="p">,</span> <span class="n">reversal_test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;    </span>
<span class="sd">    Estimate the probability that two Fisher-distributed sets of </span>
<span class="sd">    directions originate from populations with a common mean using</span>
<span class="sd">    the Bayesian framework of Heslop and Roberts (2018). This version</span>
<span class="sd">    of the test is the one involving distributions with common precision.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        Data1 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">        Data2 : a nested list of directional data [dec,inc] (a di_block)</span>
<span class="sd">        reversal_test : whether to flip one populations to its antipode</span>
<span class="sd">            (default is False)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        **BF0** (Bayes factor),  </span>
<span class="sd">        **P** (posterior probability of the hypothesis), </span>
<span class="sd">        **support** (category of support based on classification of P)</span>
<span class="sd">    &#39;&#39;&#39;</span>    
    <span class="n">X1</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Data1</span><span class="p">)</span>
    <span class="n">X2</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Data2</span><span class="p">)</span> 
    
    <span class="k">if</span> <span class="n">reversal_test</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">X12</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X1</span><span class="p">,</span><span class="o">-</span><span class="n">X2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#pool site directions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X12</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#pool site directions</span>

    <span class="k">def</span> <span class="nf">log_like</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">R</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> \
                <span class="o">+</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">R</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_sinh</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">700</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">k</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">integrand1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">N</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_like</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">R</span><span class="p">)</span><span class="o">+</span><span class="n">log_prior</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">integrand2</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
        <span class="n">R1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">N1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">R2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">N2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_like</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N1</span><span class="p">,</span><span class="n">R1</span><span class="p">)</span><span class="o">+</span><span class="n">log_like</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N2</span><span class="p">,</span><span class="n">R2</span><span class="p">)</span><span class="o">+</span><span class="n">log_prior</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">val</span>        
    
    <span class="n">mL1</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X12</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#Bayes factor numerator (Eqn 13)</span>
    <span class="n">mL2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#Bayes factor denominator (Eqn 14)</span>
    
    <span class="n">BF0</span><span class="o">=</span><span class="n">mL1</span><span class="o">/</span><span class="n">mL2</span>
    <span class="n">P</span><span class="o">=</span><span class="n">BF0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">BF0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span> 
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Different means: very strong support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">:</span> 
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Different means: strong support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.05</span> <span class="ow">and</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">:</span>
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Different means: positive support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.25</span> <span class="ow">and</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.75</span><span class="p">:</span>
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Ambiguous: weak support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.75</span> <span class="ow">and</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.95</span><span class="p">:</span> 
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Common mean: positive support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.95</span> <span class="ow">and</span> <span class="n">P</span><span class="o">&lt;</span><span class="mf">0.99</span><span class="p">:</span> 
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Common mean: strong support&#39;</span>
    <span class="k">if</span> <span class="n">P</span><span class="o">&gt;=</span><span class="mf">0.99</span><span class="p">:</span>
        <span class="n">support</span> <span class="o">=</span> <span class="s1">&#39;Common mean: very strong support&#39;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">support</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">BF0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">support</span></div>


<div class="viewcode-block" id="reversal_test_bootstrap"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.reversal_test_bootstrap">[docs]</a><span class="k">def</span> <span class="nf">reversal_test_bootstrap</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_stereo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">color1</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">color2</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                            <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct a reversal test using bootstrap statistics (Tauxe, 2010) to</span>
<span class="sd">    determine whether two populations of directions could be from an antipodal</span>
<span class="sd">    common mean.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec: list of declinations</span>
<span class="sd">        inc: list of inclinations</span>
<span class="sd">        di_block: a nested list of [dec,inc]</span>
<span class="sd">            A di_block can be provided in which case it will be used instead of</span>
<span class="sd">            dec, inc lists.</span>
<span class="sd">        plot_stereo : before plotting the CDFs, plot stereonet with the</span>
<span class="sd">            bidirectionally separated data (default is False)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is &#39;svg&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        A boolean where 0 is fail and 1 is pass is returned. </span>
<span class="sd">        Plots of the cumulative distribution of Cartesian components are shown</span>
<span class="sd">        an equal area plot if `plot_stereo = True`. </span>

<span class="sd">    Examples:</span>
<span class="sd">        Populations of roughly antipodal directions are developed here using</span>
<span class="sd">        ``ipmag.fishrot``. These directions are combined into a single di_block</span>
<span class="sd">        given that the function determines the principal component and splits the</span>
<span class="sd">        data accordingly by polarity.</span>

<span class="sd">        &gt;&gt;&gt; directions_n = ipmag.fishrot(k=20, n=30, dec=5, inc=-60)</span>
<span class="sd">        &gt;&gt;&gt; directions_r = ipmag.fishrot(k=35, n=25, dec=182, inc=57)</span>
<span class="sd">        &gt;&gt;&gt; directions = directions_n + directions_r</span>
<span class="sd">        &gt;&gt;&gt; ipmag.reversal_test_bootstrap(di_block=directions, plot_stereo = True)</span>

<span class="sd">        Data can also be input to the function as separate lists of dec and inc.</span>
<span class="sd">        In this example, the di_block from above is split into lists of dec and inc</span>
<span class="sd">        which are then used in the function:</span>

<span class="sd">        &gt;&gt;&gt; direction_dec, direction_inc, direction_moment = ipmag.unpack_di_block(directions)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.reversal_test_bootstrap(dec=direction_dec,inc=direction_inc, plot_stereo = True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">di_block</span>

    <span class="n">directions1</span><span class="p">,</span> <span class="n">directions2</span> <span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">all_dirs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_stereo</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># plot equal area with two modes</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">directions1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">),</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">do_flip</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">directions2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">common_mean_bootstrap</span><span class="p">(</span><span class="n">directions1</span><span class="p">,</span> <span class="n">directions2</span><span class="p">,</span>
                                   <span class="n">color1</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span> <span class="n">color2</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span>
                                   <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="n">save_folder</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="reversal_test_MM1990"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.reversal_test_MM1990">[docs]</a><span class="k">def</span> <span class="nf">reversal_test_MM1990</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_CDF</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                         <span class="n">plot_stereo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Watson&#39;s V statistic from input files through Monte Carlo</span>
<span class="sd">    simulation in order to test whether normal and reversed populations could</span>
<span class="sd">    have been drawn from a common mean. Also provides the critical angle between </span>
<span class="sd">    the two sample mean directions and the corresponding McFadden and McElhinny </span>
<span class="sd">    (1990) classification. This function is a wrapper around the </span>
<span class="sd">    ipmag.common_mean_watson() function with the first step of splitting</span>
<span class="sd">    the data into two polarities using the pmag.flip() function and flipping</span>
<span class="sd">    the reverse direction to their antipode.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec: list of declinations</span>
<span class="sd">        inc: list of inclinations</span>
<span class="sd">            or</span>
<span class="sd">        di_block: a nested list of [dec,inc]</span>
<span class="sd">            *A di_block can be provided in which case it will be used instead of</span>
<span class="sd">            dec, inc lists.*</span>

<span class="sd">        plot_CDF : plot the CDF accompanying the printed results (default is False)</span>
<span class="sd">        plot_stereo : plot stereonet with the bidirectionally separated data</span>
<span class="sd">            (default is False)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved</span>
<span class="sd">            (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is &#39;svg&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        **printed text** (text describing the test result is printed), </span>
<span class="sd">        **result** (a boolean where 0 is fail and 1 is pass),</span>
<span class="sd">        **angle** (angle between the Fisher means of the two data sets),</span>
<span class="sd">        **critical_angle** (critical angle for the test to pass),</span>
<span class="sd">        **classification** (MM1990 classification for a positive test).</span>
<span class="sd">        Plots are shown if plot parameters are set to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Populations of roughly antipodal directions are developed here using</span>
<span class="sd">        ``ipmag.fishrot``. These directions are combined into a single di_block</span>
<span class="sd">        given that the function determines the principal component and splits the</span>
<span class="sd">        data accordingly by polarity.</span>

<span class="sd">        &gt;&gt;&gt; directions_n = ipmag.fishrot(k=20, n=30, dec=5, inc=-60)</span>
<span class="sd">        &gt;&gt;&gt; directions_r = ipmag.fishrot(k=35, n=25, dec=182, inc=57)</span>
<span class="sd">        &gt;&gt;&gt; directions = directions_n + directions_r</span>
<span class="sd">        &gt;&gt;&gt; ipmag.reversal_test_MM1990(di_block=directions, plot_stereo = True)</span>

<span class="sd">        Data can also be input to the function as separate lists of dec and inc.</span>
<span class="sd">        In this example, the di_block from above is split into lists of dec and inc</span>
<span class="sd">        which are then used in the function:</span>

<span class="sd">        &gt;&gt;&gt; direction_dec, direction_inc, direction_moment = ipmag.unpack_di_block(directions)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.reversal_test_MM1990(dec=direction_dec,inc=direction_inc, plot_stereo = True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">di_block</span>

    <span class="n">directions1</span><span class="p">,</span> <span class="n">directions2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">all_dirs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_stereo</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># plot equal area with two modes</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">directions1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">),</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">do_flip</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">directions2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_CDF</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">critical_angle</span><span class="p">,</span> <span class="n">classification</span><span class="o">=</span><span class="n">common_mean_watson</span><span class="p">(</span><span class="n">directions1</span><span class="p">,</span> <span class="n">directions2</span><span class="p">,</span> 
                                                                         <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="n">save_folder</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">critical_angle</span><span class="p">,</span> <span class="n">classification</span><span class="o">=</span><span class="n">common_mean_watson</span><span class="p">(</span><span class="n">directions1</span><span class="p">,</span> <span class="n">directions2</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span>
                                                                         <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="n">save_folder</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">critical_angle</span><span class="p">,</span> <span class="n">classification</span></div>


<div class="viewcode-block" id="conglomerate_test_Watson"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.conglomerate_test_Watson">[docs]</a><span class="k">def</span> <span class="nf">conglomerate_test_Watson</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Watson (1956) test of a directional data set for randomness compares</span>
<span class="sd">    the resultant vector (R) of a group of directions to values of Ro. If R </span>
<span class="sd">    exceeds Ro, the null hypothesis of randomness is rejected. If R is less</span>
<span class="sd">    than Ro, the null hypothesis of randomness is considered to not be rejected.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        R : the resultant vector length of the directions</span>
<span class="sd">        n : the number of directions</span>

<span class="sd">    Returns:</span>
<span class="sd">        **printed text** (text describing test result), </span>
<span class="sd">        **result** (a dictionary with the Watson (1956) R values)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Ro_values</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">4.02</span><span class="p">},</span> <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">3.85</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">4.48</span><span class="p">},</span>
                 <span class="mi">7</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">4.18</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">4.89</span><span class="p">},</span> <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">4.48</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">5.26</span><span class="p">},</span>
                 <span class="mi">9</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">4.76</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">5.61</span><span class="p">},</span> <span class="mi">10</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">5.03</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">5.94</span><span class="p">},</span>
                 <span class="mi">11</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">5.29</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">6.25</span><span class="p">},</span> <span class="mi">12</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">5.52</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">6.55</span><span class="p">},</span>
                 <span class="mi">13</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">5.75</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">6.84</span><span class="p">},</span> <span class="mi">14</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">5.98</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">7.11</span><span class="p">},</span>
                 <span class="mi">15</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">6.19</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">7.36</span><span class="p">},</span> <span class="mi">16</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">6.40</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">7.60</span><span class="p">},</span>
                 <span class="mi">17</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">6.60</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">7.84</span><span class="p">},</span> <span class="mi">18</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">6.79</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">8.08</span><span class="p">},</span>
                 <span class="mi">19</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">6.98</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">8.33</span><span class="p">},</span> <span class="mi">20</span><span class="p">:</span> <span class="p">{</span><span class="mi">95</span><span class="p">:</span> <span class="mf">7.17</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span> <span class="mf">8.55</span><span class="p">}}</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;too few directions for a conglomerate test&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">:</span>
        <span class="n">Ro_95</span> <span class="o">=</span> <span class="n">Ro_values</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">95</span><span class="p">]</span>
        <span class="n">Ro_99</span> <span class="o">=</span> <span class="n">Ro_values</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">99</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ro_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">7.815</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">Ro_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">11.345</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ro_95 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ro_95</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ro_99 = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Ro_99</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">R</span> <span class="o">&lt;</span> <span class="n">Ro_95</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This population &quot;passes&quot; a conglomerate test as the null hypothesis of randomness cannot be rejected at the 95</span><span class="si">% c</span><span class="s1">onfidence level&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">R</span> <span class="o">&gt;</span> <span class="n">Ro_95</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;The null hypothesis of randomness can be rejected at the 95</span><span class="si">% c</span><span class="s1">onfidence level&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">R</span> <span class="o">&gt;</span> <span class="n">Ro_99</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;The null hypothesis of randomness can be rejected at the 99</span><span class="si">% c</span><span class="s1">onfidence level&#39;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> <span class="s1">&#39;Ro_95&#39;</span><span class="p">:</span> <span class="n">Ro_95</span><span class="p">,</span> <span class="s1">&#39;Ro_99&#39;</span><span class="p">:</span> <span class="n">Ro_99</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="fishqq"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.fishqq">[docs]</a><span class="k">def</span> <span class="nf">fishqq</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test whether a distribution is Fisherian and make a corresponding Q-Q plot.</span>
<span class="sd">    The Q-Q plot shows the data plotted against the value expected from a</span>
<span class="sd">    Fisher distribution. The first plot is the uniform plot which is the</span>
<span class="sd">    Fisher model distribution in terms of longitude (declination). The second</span>
<span class="sd">    plot is the exponential plot which is the Fisher model distribution in terms</span>
<span class="sd">    of latitude (inclination). In addition to the plots, the test statistics Mu</span>
<span class="sd">    (uniform) and Me (exponential) are calculated and compared against the</span>
<span class="sd">    critical test values. If Mu or Me are too large in comparison to the test</span>
<span class="sd">    statistics, the hypothesis that the distribution is Fisherian is rejected</span>
<span class="sd">    (see Fisher et al., 1987). These test statistics are returned in a dictionary.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lon : longitude or declination of the data</span>
<span class="sd">        lat : latitude or inclination of the data</span>
<span class="sd">            or</span>
<span class="sd">        di_block: a nested list of [dec,inc]</span>
<span class="sd">            A di_block can be provided in which case it will be used instead of</span>
<span class="sd">            dec, inc lists.</span>
<span class="sd">        plot : boolean to decide whether to make a plot (default is True)</span>
<span class="sd">        save : boolean to decide whether plot is saved (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved</span>
<span class="sd">            (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved plot (default is &#39;png&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictionary </span>
<span class="sd">            - lon, mean longitude (or declination)</span>
<span class="sd">            - lat, mean latitude (or inclination)</span>
<span class="sd">            - N, number of vectors</span>
<span class="sd">            - Mu, Mu test statistic value for the data</span>
<span class="sd">            - Mu_critical, critical value for Mu</span>
<span class="sd">            - Me, Me test statistic value for the data</span>
<span class="sd">            - Me_critical, critical value for Me</span>

<span class="sd">            if the data has two modes with N &gt;=10 (N and R)</span>
<span class="sd">            two of these dictionaries will be returned</span>

<span class="sd">    Examples:</span>
<span class="sd">        In this example, directions are sampled from a Fisher distribution using</span>
<span class="sd">        ``ipmag.fishrot`` and then the ``ipmag.fishqq`` function is used to test</span>
<span class="sd">        whether that distribution is Fisherian:</span>

<span class="sd">        &gt;&gt;&gt; directions = ipmag.fishrot(k=40, n=50, dec=200, inc=50)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.fishqq(di_block = directions)</span>
<span class="sd">        {&#39;Dec&#39;: 199.73564290371894,</span>
<span class="sd">        &#39;Inc&#39;: 49.017612342358298,</span>
<span class="sd">        &#39;Me&#39;: 0.78330310031220352,</span>
<span class="sd">        &#39;Me_critical&#39;: 1.094,</span>
<span class="sd">        &#39;Mode&#39;: &#39;Mode 1&#39;,</span>
<span class="sd">        &#39;Mu&#39;: 0.69915926146177099,</span>
<span class="sd">        &#39;Mu_critical&#39;: 1.207,</span>
<span class="sd">        &#39;N&#39;: 50,</span>
<span class="sd">        &#39;Test_result&#39;: &#39;consistent with Fisherian model&#39;}</span>

<span class="sd">        The above example passed a di_block to the function as an input. Lists of</span>
<span class="sd">        paired declination and inclination can also be used as inputs. Here the</span>
<span class="sd">        directions di_block is unpacked to separate declination and inclination</span>
<span class="sd">        lists using the ``ipmag.unpack_di_block`` functionwhich are then used as</span>
<span class="sd">        input to fishqq:</span>

<span class="sd">        &gt;&gt;&gt; dec_list, inc_list = ipmag.unpack_di_block(directions)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.fishqq(lon=dec_list, lat=inc_list)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_dirs</span> <span class="o">=</span> <span class="n">di_block</span>

    <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">all_dirs</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
    <span class="n">QQ_dict1</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">QQ_dict2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">QQ</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unf&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">di</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_dirs</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">decs</span><span class="o">=</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">incs</span><span class="o">=</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">all_dirs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">decs</span><span class="p">,</span><span class="n">incs</span><span class="p">))</span>
    <span class="n">nDIs</span><span class="p">,</span><span class="n">rDIs</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">separate_directions</span><span class="p">(</span><span class="n">all_dirs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
        <span class="n">Dnbar</span><span class="p">,</span> <span class="n">Inbar</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
        <span class="n">Nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span>
        <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Dnbar</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span>
        <span class="n">pl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nn</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">90.</span><span class="o">-</span><span class="n">Inbar</span><span class="p">)</span>
        <span class="n">Ds</span><span class="o">=</span><span class="n">nDIs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Is</span><span class="o">=</span><span class="n">nDIs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ndata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Ds</span><span class="p">,</span><span class="n">Is</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">pl</span><span class="p">))</span>
        <span class="n">D1</span><span class="p">,</span><span class="n">I1</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dotilt_V</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="n">D1</span><span class="o">=</span><span class="p">(</span><span class="n">D1</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span><span class="o">%</span><span class="mi">360</span> <span class="c1"># Somehow this got lost</span>
        <span class="n">Dtit</span> <span class="o">=</span> <span class="s1">&#39;Mode 1 Declinations&#39;</span>
        <span class="n">Itit</span> <span class="o">=</span> <span class="s1">&#39;Mode 1 Inclinations&#39;</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">fignum</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">Mu_n</span><span class="p">,</span> <span class="n">Mu_ncr</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_qq_unf</span><span class="p">(</span>
                <span class="n">QQ</span><span class="p">[</span><span class="s1">&#39;unf&#39;</span><span class="p">],</span> <span class="n">D1</span><span class="p">,</span> <span class="n">Dtit</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make plot</span>
            <span class="n">Me_n</span><span class="p">,</span> <span class="n">Me_ncr</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_qq_exp</span><span class="p">(</span>
                <span class="n">QQ</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">],</span> <span class="n">I1</span><span class="p">,</span> <span class="n">Itit</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;QQ_mode1&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Mu_n</span> <span class="o">&lt;=</span> <span class="n">Mu_ncr</span> <span class="ow">and</span> <span class="n">Me_n</span> <span class="o">&lt;=</span> <span class="n">Me_ncr</span><span class="p">:</span>
            <span class="n">F_n</span> <span class="o">=</span> <span class="s1">&#39;Consistent with Fisher distribution&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F_n</span> <span class="o">=</span> <span class="s1">&#39;Fisher distribution rejected&#39;</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mode 1&#39;</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Dec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dnbar</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inbar</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nn</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mu_n</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Mu_critical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mu_ncr</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Me&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Me_n</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Me_critical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Me_ncr</span>
        <span class="n">QQ_dict1</span><span class="p">[</span><span class="s1">&#39;Test_result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_n</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="c1">#D1, I1 = [], []</span>
        <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
        <span class="n">Drbar</span><span class="p">,</span> <span class="n">Irbar</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
        <span class="n">Nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>
        <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Drbar</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span>
        <span class="n">pl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">90.</span><span class="o">-</span><span class="n">Irbar</span><span class="p">)</span>
        <span class="n">Ds</span><span class="o">=</span><span class="n">rDIs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Is</span><span class="o">=</span><span class="n">rDIs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rdata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">Ds</span><span class="p">,</span><span class="n">Is</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">pl</span><span class="p">))</span>
        <span class="n">D2</span><span class="p">,</span><span class="n">I2</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dotilt_V</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>
        <span class="n">D2</span><span class="o">=</span><span class="p">(</span><span class="n">D2</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span><span class="o">%</span><span class="mi">360</span> <span class="c1"># Somehow this got lost</span>
        <span class="n">Dtit</span> <span class="o">=</span> <span class="s1">&#39;Mode 2 Declinations&#39;</span>
        <span class="n">Itit</span> <span class="o">=</span> <span class="s1">&#39;Mode 2 Inclinations&#39;</span>
        <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
        <span class="k">if</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">270</span><span class="p">:</span>
            <span class="n">Drbar</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span>
        <span class="k">if</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">Irbar</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span><span class="o">=-</span><span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">Mu_r</span><span class="p">,</span> <span class="n">Mu_rcr</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_qq_unf</span><span class="p">(</span>
                <span class="n">QQ</span><span class="p">[</span><span class="s1">&#39;unf&#39;</span><span class="p">],</span> <span class="n">D2</span><span class="p">,</span> <span class="n">Dtit</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make plot</span>
            <span class="n">Me_r</span><span class="p">,</span> <span class="n">Me_rcr</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_qq_exp</span><span class="p">(</span>
                <span class="n">QQ</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">],</span> <span class="n">I2</span><span class="p">,</span> <span class="n">Itit</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;QQ_mode2&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Mu_r</span> <span class="o">&lt;=</span> <span class="n">Mu_rcr</span> <span class="ow">and</span> <span class="n">Me_r</span> <span class="o">&lt;=</span> <span class="n">Me_rcr</span><span class="p">:</span>
            <span class="n">F_r</span> <span class="o">=</span> <span class="s1">&#39;Consistent with Fisher distribution&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F_r</span> <span class="o">=</span> <span class="s1">&#39;Fisher distribution rejected&#39;</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mode 2&#39;</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Dec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Drbar</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Irbar</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nr</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mu_r</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Mu_critical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mu_rcr</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Me&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Me_r</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Me_critical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Me_rcr</span>
        <span class="n">QQ_dict2</span><span class="p">[</span><span class="s1">&#39;Test_result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_r</span>

    <span class="k">if</span> <span class="n">QQ_dict2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">QQ_dict1</span><span class="p">,</span> <span class="n">QQ_dict2</span>
    <span class="k">elif</span> <span class="n">QQ_dict1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">QQ_dict1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you need N&gt; 10 for at least one mode&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="lat_from_inc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.lat_from_inc">[docs]</a><span class="k">def</span> <span class="nf">lat_from_inc</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="n">a95</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate paleolatitude from inclination using the dipole equation.</span>

<span class="sd">    Parameter:</span>
<span class="sd">        inc: (paleo)magnetic inclination in degrees</span>
<span class="sd">        a95: 95% confidence interval from Fisher mean</span>

<span class="sd">    Returns:</span>
<span class="sd">        if a95 is provided paleo_lat, paleo_lat_max, paleo_lat_min are returned</span>
<span class="sd">        otherwise, it just returns paleo_lat</span>

<span class="sd">    Examples:</span>
<span class="sd">        Calculate the paleolatitude implied by an inclination of 45 degrees:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.lat_from_inc(45)</span>
<span class="sd">        26.56505117707799</span>

<span class="sd">        Calculate the paleolatitude and the maximum and minimum paleolatitude</span>
<span class="sd">        implied by an inclination of 20 degrees with an uncertainty on the</span>
<span class="sd">        mean (a95) of 5:</span>

<span class="sd">        &gt;&gt;&gt; ipmag.lat_from_inc(20, a95=5)</span>
<span class="sd">        (10.314104815618196, 13.12426812279171, 7.630740212430057)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="n">paleo_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">inc</span> <span class="o">*</span> <span class="n">rad</span><span class="p">))</span><span class="o">/</span><span class="n">rad</span>
    <span class="k">if</span> <span class="n">a95</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">paleo_lat_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">inc</span> <span class="o">+</span> <span class="n">a95</span><span class="p">)</span> <span class="o">*</span> <span class="n">rad</span><span class="p">))</span><span class="o">/</span><span class="n">rad</span>
        <span class="n">paleo_lat_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">inc</span> <span class="o">-</span> <span class="n">a95</span><span class="p">)</span> <span class="o">*</span> <span class="n">rad</span><span class="p">))</span><span class="o">/</span><span class="n">rad</span>
        <span class="k">return</span> <span class="n">paleo_lat</span><span class="p">,</span> <span class="n">paleo_lat_max</span><span class="p">,</span> <span class="n">paleo_lat_min</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">paleo_lat</span></div>


<div class="viewcode-block" id="lat_from_pole"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.lat_from_pole">[docs]</a><span class="k">def</span> <span class="nf">lat_from_pole</span><span class="p">(</span><span class="n">ref_loc_lon</span><span class="p">,</span> <span class="n">ref_loc_lat</span><span class="p">,</span> <span class="n">pole_plon</span><span class="p">,</span> <span class="n">pole_plat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate paleolatitude for a reference location based on a paleomagnetic pole.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ref_loc_lon: longitude of reference location in degrees E</span>
<span class="sd">        ref_loc_lat: latitude of reference location in degrees N</span>
<span class="sd">        pole_plon: paleopole longitude in degrees in degrees E</span>
<span class="sd">        pole_plat: paleopole latitude in degrees in degrees N</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        paleolatitude for location based on pole</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_loc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ref_loc_lon</span><span class="p">,</span> <span class="n">ref_loc_lat</span><span class="p">)</span>
    <span class="n">pole</span> <span class="o">=</span> <span class="p">(</span><span class="n">pole_plon</span><span class="p">,</span> <span class="n">pole_plat</span><span class="p">)</span>
    <span class="n">paleo_lat</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">pole</span><span class="p">,</span> <span class="n">ref_loc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">paleo_lat</span><span class="p">)</span></div>


<div class="viewcode-block" id="inc_from_lat"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.inc_from_lat">[docs]</a><span class="k">def</span> <span class="nf">inc_from_lat</span><span class="p">(</span><span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate inclination predicted from latitude using the dipole equation.</span>

<span class="sd">    Parameter:</span>
<span class="sd">        lat : latitude in degrees</span>

<span class="sd">    Returns:</span>
<span class="sd">        inclination calculated from latitude using the dipole equation</span>

<span class="sd">    Examples:</span>
<span class="sd">        Calculate the inclination implied by an latitude of 45 degrees:</span>
<span class="sd">        &gt;&gt;&gt; ipmag.inc_from_lat(45)</span>
<span class="sd">        63.434948822922</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">lat</span> <span class="o">*</span> <span class="n">rad</span><span class="p">))</span><span class="o">/</span><span class="n">rad</span>
    <span class="k">return</span> <span class="n">inc</span></div>


<div class="viewcode-block" id="plot_net"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_net">[docs]</a><span class="k">def</span> <span class="nf">plot_net</span><span class="p">(</span><span class="n">fignum</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draws circle and tick marks for equal area projection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fignum</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">Dcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">361.</span><span class="p">)</span>
    <span class="n">Icirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">361</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">Xcirc</span><span class="p">,</span> <span class="n">Ycirc</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">361</span><span class="p">):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">Dcirc</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Icirc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">Xcirc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ycirc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xcirc</span><span class="p">,</span> <span class="n">Ycirc</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># put on the tick marks</span>
    <span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">Xsym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ysym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span><span class="p">,</span> <span class="s1">&#39;k+&#39;</span><span class="p">)</span>
    <span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="mf">90.</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">Xsym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ysym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span><span class="p">,</span> <span class="s1">&#39;k+&#39;</span><span class="p">)</span>
    <span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="mf">180.</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">Xsym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ysym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span><span class="p">,</span> <span class="s1">&#39;k+&#39;</span><span class="p">)</span>
    <span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="mf">270.</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">Xsym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ysym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xsym</span><span class="p">,</span> <span class="n">Ysym</span><span class="p">,</span> <span class="s1">&#39;k+&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">D</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">Xtick</span><span class="p">,</span> <span class="n">Ytick</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="n">Xtick</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Ytick</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xtick</span><span class="p">,</span> <span class="n">Ytick</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">))</span></div>


<div class="viewcode-block" id="plot_di"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_di">[docs]</a><span class="k">def</span> <span class="nf">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot declination, inclination data on an equal area plot.</span>

<span class="sd">    Before this function is called a plot needs to be initialized with code that looks</span>
<span class="sd">    something like:</span>
<span class="sd">    &gt;fignum = 1</span>
<span class="sd">    &gt;plt.figure(num=fignum,figsize=(10,10),dpi=160)</span>
<span class="sd">    &gt;ipmag.plot_net(fignum)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : declination being plotted</span>
<span class="sd">        inc : inclination being plotted</span>
<span class="sd">        di_block: a nested list of [dec,inc,1.0] (di_block can be provided instead of dec, inc in which case it will be used)</span>
<span class="sd">        color : the default color is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">        marker : the default marker is a circle (&#39;o&#39;)</span>
<span class="sd">        markersize : default size is 20</span>
<span class="sd">        label : the default label is blank (&#39;&#39;)</span>
<span class="sd">        legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">        edge : marker edge color - if blank, is color of marker</span>
<span class="sd">        alpha : opacity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X_down</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X_up</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y_down</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y_up</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">color_down</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">color_up</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">di_block</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_lists</span> <span class="o">=</span> <span class="n">unpack_di_block</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">di_lists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)):</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">dec</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">Y_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">color_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">Y_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">color_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Y_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">color_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Y_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">color_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_up</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_up</span><span class="p">,</span> <span class="n">Y_up</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color_up</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_down</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_down</span><span class="p">,</span> <span class="n">Y_down</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">color_down</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_di_mean"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_di_mean">[docs]</a><span class="k">def</span> <span class="nf">plot_di_mean</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">a95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a mean direction (declination, inclination) with alpha_95 ellipse on</span>
<span class="sd">    an equal area plot.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    that looks something like:</span>
<span class="sd">    &gt;fignum = 1</span>
<span class="sd">    &gt;plt.figure(num=fignum,figsize=(10,10),dpi=160)</span>
<span class="sd">    &gt;ipmag.plot_net(fignum)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : declination of mean being plotted</span>
<span class="sd">        inc : inclination of mean being plotted</span>
<span class="sd">        a95 : a95 confidence ellipse of mean being plotted</span>
<span class="sd">        color : the default color is black. Other colors can be chosen (e.g. &#39;r&#39;).</span>
<span class="sd">        marker : the default is a circle. Other symbols can be chosen (e.g. &#39;s&#39;).</span>
<span class="sd">        markersize : the default is 20. Other sizes can be chosen.</span>
<span class="sd">        label : the default is no label. Labels can be assigned.</span>
<span class="sd">        legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DI_dimap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">DI_dimap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DI_dimap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">DI_dimap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DI_dimap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">Xcirc</span><span class="p">,</span> <span class="n">Ycirc</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Da95</span><span class="p">,</span> <span class="n">Ia95</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">circ</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">a95</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Da95</span><span class="p">)):</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">Da95</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Ia95</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">Xcirc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ycirc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Xcirc</span><span class="p">,</span> <span class="n">Ycirc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_di_mean_bingham"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_di_mean_bingham">[docs]</a><span class="k">def</span> <span class="nf">plot_di_mean_bingham</span><span class="p">(</span><span class="n">bingham_dictionary</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    see plot_di_mean_ellipse</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_di_mean_ellipse</span><span class="p">(</span><span class="n">bingham_dictionary</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                         <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_di_mean_ellipse"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_di_mean_ellipse">[docs]</a><span class="k">def</span> <span class="nf">plot_di_mean_ellipse</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a mean direction (declination, inclination)  confidence ellipse.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dictionary : a dictionary generated by the pmag.dobingham or pmag.dokent functions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>

    <span class="n">DI_dimap</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dimap</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">DI_dimap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DI_dimap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">DI_dimap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DI_dimap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_orthographic_map"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.make_orthographic_map">[docs]</a><span class="k">def</span> <span class="nf">make_orthographic_map</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                          <span class="n">add_land</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">land_color</span><span class="o">=</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="n">land_edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                          <span class="n">add_ocean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ocean_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">grid_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">lat_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">80.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>
                                    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">80.</span><span class="p">],</span>
                          <span class="n">lon_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">150.</span><span class="p">,</span>  <span class="mf">180.</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function creates and returns an orthographic map projection using cartopy</span>

<span class="sd">    Parameters:</span>
<span class="sd">        central_longitude : central longitude of projection (default is 0)</span>
<span class="sd">        central_latitude : central latitude of projection (default is 0)</span>
<span class="sd">        figsize : size of the figure (default is 8x8)</span>
<span class="sd">        add_land : chose whether land is plotted on map (default is true)</span>
<span class="sd">        land_color : specify land color (default is &#39;tan&#39;)</span>
<span class="sd">        add_ocean : chose whether land is plotted on map (default is False, change to True to plot)</span>
<span class="sd">        ocean_color : specify ocean color (default is &#39;lightblue&#39;)</span>
<span class="sd">        grid_lines : chose whether grid lines are plotted on map (default is true)</span>
<span class="sd">        lat_grid : specify the latitude grid (default is 30 degree spacing)</span>
<span class="sd">        lon_grid : specify the longitude grid (default is 30 degree spacing)</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; map_axis = make_orthographic_map(central_longitude=200,central_latitude=30)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># wrapper class to change the default resolution of the orthographic projection</span>
    <span class="c1"># class LowerThresholdOrthographic(ccrs.Orthographic):</span>
    <span class="c1">#     @property</span>
    <span class="c1">#     def threshold(self):</span>
    <span class="c1">#         return 1e3</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.make_orthographic_map&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">map_projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span>
        <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">map_projection</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">add_ocean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_land</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">land_edge_color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">grid_lines</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">xlocs</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span> <span class="n">ylocs</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="make_mollweide_map"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.make_mollweide_map">[docs]</a><span class="k">def</span> <span class="nf">make_mollweide_map</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                       <span class="n">add_land</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">land_color</span><span class="o">=</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="n">land_edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                       <span class="n">add_ocean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ocean_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">grid_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">lat_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>
                                 <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">150.</span><span class="p">,</span>  <span class="mf">180.</span><span class="p">],</span>
                       <span class="n">lon_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">150.</span><span class="p">,</span>  <span class="mf">180.</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function creates and returns a Mollweide map projection using cartopy</span>

<span class="sd">    Parameters:</span>
<span class="sd">        central_longitude : central longitude of projection (default is 0)</span>
<span class="sd">        central_latitude : central latitude of projection (default is 0)</span>
<span class="sd">        figsize : size of the figure (default is 8x8)</span>
<span class="sd">        add_land : chose whether land is plotted on map (default is True)</span>
<span class="sd">        land_color : specify land color (default is &#39;tan&#39;)</span>
<span class="sd">        add_ocean : chose whether land is plotted on map (default is False, change to True to plot)</span>
<span class="sd">        ocean_color : specify ocean color (default is &#39;lightblue&#39;)</span>
<span class="sd">        grid_lines : chose whether grid lines are plotted on map (default is true)</span>
<span class="sd">        lat_grid : specify the latitude grid (default is 30 degree spacing)</span>
<span class="sd">        lon_grid : specify the longitude grid (default is 30 degree spacing)</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; map_axis = make_mollweide_map(central_longitude=200)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.make_molleweide_map&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">map_projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">map_projection</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_ocean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_land</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">land_edge_color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">grid_lines</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">xlocs</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span> <span class="n">ylocs</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="make_robinson_map"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.make_robinson_map">[docs]</a><span class="k">def</span> <span class="nf">make_robinson_map</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                      <span class="n">add_land</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">land_color</span><span class="o">=</span><span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="n">add_ocean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ocean_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">grid_lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">lat_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>
                                <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">150.</span><span class="p">,</span>  <span class="mf">180.</span><span class="p">],</span>
                      <span class="n">lon_grid</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.</span><span class="p">,</span> <span class="o">-</span><span class="mf">120.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">60.</span><span class="p">,</span>  <span class="o">-</span><span class="mf">30.</span><span class="p">,</span>    <span class="mf">0.</span><span class="p">,</span>   <span class="mf">30.</span><span class="p">,</span>   <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span>  <span class="mf">120.</span><span class="p">,</span>  <span class="mf">150.</span><span class="p">,</span>  <span class="mf">180.</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function creates and returns a Robinson map projection using cartopy</span>

<span class="sd">    Parameters:</span>
<span class="sd">        central_longitude : central longitude of projection (default is 0)</span>
<span class="sd">        central_latitude : central latitude of projection (default is 0)</span>
<span class="sd">        figsize : size of the figure (default is 8x8)</span>
<span class="sd">        add_land : chose whether land is plotted on map (default is True)</span>
<span class="sd">        land_color : specify land color (default is &#39;tan&#39;)</span>
<span class="sd">        add_ocean : chose whether land is plotted on map (default is False, change to True to plot)</span>
<span class="sd">        ocean_color : specify ocean color (default is &#39;lightblue&#39;)</span>
<span class="sd">        grid_lines : chose whether grid lines are plotted on map (default is true)</span>
<span class="sd">        lat_grid : specify the latitude grid (default is 30 degree spacing)</span>
<span class="sd">        lon_grid : specify the longitude grid (default is 30 degree spacing)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; map_axis = make_Robinson_map(central_longitude=200)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.make_robinson_map&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">map_projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">map_projection</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_ocean</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_land</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">grid_lines</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">xlocs</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span> <span class="n">ylocs</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_pole"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_pole">[docs]</a><span class="k">def</span> <span class="nf">plot_pole</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
              <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">filled_pole</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
              <span class="n">mean_alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">A95_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots a paleomagnetic pole and A95 error ellipse on a cartopy map axis.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    such as that in the make_orthographic_map function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">        plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">        A95 : the A_95 confidence ellipse of the paleomagnetic pole (in degrees)</span>
<span class="sd">        color : symbol color; the default color is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">        marker : the default marker is a circle. Other symbols can be chosen (e.g. &#39;s&#39;)</span>
<span class="sd">        markersize : the default is 20. Other size can be chosen</span>
<span class="sd">        label : the default is no label. Labels can be assigned.</span>
<span class="sd">        legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">        filled_pole : if True, the A95 ellipse will be filled with color</span>
<span class="sd">        fill_color : color of fill; the default is black.</span>
<span class="sd">        fill_alpha : transparency of filled ellipse (the default is 1.0; no transparency).</span>
<span class="sd">        zorder : plotting order (default is 100; higher will move to top of plot)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; plon = 200</span>
<span class="sd">        &gt;&gt;&gt; plat = 60</span>
<span class="sd">        &gt;&gt;&gt; A95 = 6</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200,central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_pole(map_axis, plon, plat, A95 ,color=&#39;red&#39;,markersize=40, zorder=20)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.plot_pole&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span> <span class="o">*</span> <span class="mf">111.32</span>
    <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">mean_alpha</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filled_pole</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">A95_alpha</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filled_pole</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">fill_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">fill_alpha</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">outline</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_poles"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_poles">[docs]</a><span class="k">def</span> <span class="nf">plot_poles</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
               <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">filled_pole</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots paleomagnetic poles and A95 error ellipses on a cartopy map axis.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    such as that in the make_orthographic_map function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">        plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">        A95 : the A_95 confidence ellipse of the paleomagnetic pole (in degrees)</span>
<span class="sd">        color : the default color is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">                a list of colors can also be given so that each pole has a distinct color</span>
<span class="sd">        edgecolor : the default edgecolor is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">        marker : the default is a circle. Other symbols can be chosen (e.g. &#39;s&#39;)</span>
<span class="sd">        markersize : the default is 20. Other size can be chosen</span>
<span class="sd">        label : the default is no label. Labels can be assigned.</span>
<span class="sd">        legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">        filled_pole : if True, the A95 ellipse will be filled with color</span>
<span class="sd">        fill_color : color of fill; the default is black.</span>
<span class="sd">        fill_alpha : transparency of filled ellipse (the default is 1.0; no transparency).</span>
<span class="sd">        zorder : plotting order (default is 100; higher will move to top of plot) </span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; plons = [200, 180, 210]</span>
<span class="sd">        &gt;&gt;&gt; plats = [60, 40, 35]</span>
<span class="sd">        &gt;&gt;&gt; A95s = [6, 3, 10]</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200, central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_poles(map_axis, plons, plats, A95s, color=&#39;red&#39;, markersize=40)</span>

<span class="sd">        &gt;&gt;&gt; plons = [200, 180, 210]</span>
<span class="sd">        &gt;&gt;&gt; plats = [60, 40, 35]</span>
<span class="sd">        &gt;&gt;&gt; A95s = [6, 3, 10]</span>
<span class="sd">        &gt;&gt;&gt; colors = [&#39;red&#39;,&#39;green&#39;,&#39;blue&#39;]</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200, central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_poles(map_axis, plons, plats, A95s, color=colors, markersize=40)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">filled_pole</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">A95</span><span class="p">)):</span>
                <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="mf">111.32</span>
                <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">plat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">A95</span><span class="p">)):</span>
                <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="mf">111.32</span>
                <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">plat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">color</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">filled_pole</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fill_color</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">A95</span><span class="p">)):</span>
                <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="mf">111.32</span>
                <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">plat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">fill_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">fill_alpha</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">outline</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">A95</span><span class="p">)):</span>
                <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="mf">111.32</span>
                <span class="n">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">plat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">fill_color</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">fill_alpha</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">outline</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_pole_basemap"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_pole_basemap">[docs]</a><span class="k">def</span> <span class="nf">plot_pole_basemap</span><span class="p">(</span><span class="n">mapname</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots a paleomagnetic pole and A95 error ellipse on whatever</span>
<span class="sd">    current map projection has been set using the basemap plotting library.</span>
<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    that looks something like:</span>
<span class="sd">    &gt;from mpl_toolkits.basemap import Basemap</span>
<span class="sd">    &gt;mapname = Basemap(projection=&#39;ortho&#39;,lat_0=35,lon_0=200)</span>
<span class="sd">    &gt;plt.figure(figsize=(6, 6))</span>
<span class="sd">    &gt;mapname.drawcoastlines(linewidth=0.25)</span>
<span class="sd">    &gt;mapname.fillcontinents(color=&#39;bisque&#39;,lake_color=&#39;white&#39;,zorder=1)</span>
<span class="sd">    &gt;mapname.drawmapboundary(fill_color=&#39;white&#39;)</span>
<span class="sd">    &gt;mapname.drawmeridians(np.arange(0,360,30))</span>
<span class="sd">    &gt;mapname.drawparallels(np.arange(-90,90,30))</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    mapname : the name of the current map that has been developed using basemap</span>
<span class="sd">    plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">    plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">    A95 : the A_95 confidence ellipse of the paleomagnetic pole (in degrees)</span>
<span class="sd">    Optional Parameters (defaults are used if not specified)</span>
<span class="sd">    -----------</span>
<span class="sd">    color : the default color is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">    marker : the default is a circle. Other symbols can be chosen (e.g. &#39;s&#39;)</span>
<span class="sd">    markersize : the default is 20. Other size can be chosen</span>
<span class="sd">    label : the default is no label. Labels can be assigned.</span>
<span class="sd">    legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span> <span class="o">=</span> <span class="n">mapname</span><span class="p">(</span><span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">)</span>
    <span class="n">A95_km</span> <span class="o">=</span> <span class="n">A95</span> <span class="o">*</span> <span class="mf">111.32</span>
    <span class="n">mapname</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
    <span class="n">equi_basemap</span><span class="p">(</span><span class="n">mapname</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">A95_km</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="plot_pole_ellipse"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_pole_ellipse">[docs]</a><span class="k">def</span> <span class="nf">plot_pole_ellipse</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> 
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> 
                      <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a mean pole confidence ellipse associated with a Kent distribution</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        dictionary : a dictionary generated by the pmag.dobingham or pmag.dokent functions</span>
<span class="sd">        color : symbol color; the default color is black. Other colors can be chosen (e.g. &#39;r&#39;)</span>
<span class="sd">        marker : the default marker is a circle. Other symbols can be chosen (e.g. &#39;s&#39;)</span>
<span class="sd">        markersize : the default is 20. Other size can be chosen</span>
<span class="sd">        label : the default is no label. Labels can be assigned.</span>
<span class="sd">        legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">        filled_pole : if True, the A95 ellipse will be filled with color</span>
<span class="sd">        fill_color : color of fill; the default is black.</span>
<span class="sd">        fill_alpha : transparency of filled ellipse (the default is 1.0; no transparency).</span>
<span class="sd">        lower : hemisphere to plot the ellipse when calling function pmagplotlib.plot_ell (default is True)</span>
<span class="sd">        zorder : plotting order (default is 100; higher will move to top of plot) </span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; kent_dict = {&#39;dec&#39;: 287.53798364307437,</span>
<span class="sd">                    &#39;inc&#39;: 88.56067392991959,</span>
<span class="sd">                    &#39;n&#39;: 5,</span>
<span class="sd">                    &#39;Zdec&#39;: 54.83073632264832,</span>
<span class="sd">                    &#39;Zinc&#39;: 0.8721861867684042,</span>
<span class="sd">                    &#39;Edec&#39;: 144.84816793561657,</span>
<span class="sd">                    &#39;Einc&#39;: 1.1448791390804505,</span>
<span class="sd">                    &#39;Zeta&#39;: 4.640345964184263,</span>
<span class="sd">                    &#39;Eta&#39;: 6.8378968512569465,</span>
<span class="sd">                    &#39;R1&#39;: 0.9914595207919079,</span>
<span class="sd">                    &#39;R2&#39;: 0.006259515780690272}</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200,central_latitude=90)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_pole_ellipse(map_axis,kent_dict, color=&#39;red&#39;,markersize=40)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>

    <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">dictionary</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

    <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">ellipse_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">map_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ellipse_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ellipse_points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> 
                     <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">map_axis</span></div>


<div class="viewcode-block" id="plot_pole_dp_dm"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_pole_dp_dm">[docs]</a><span class="k">def</span> <span class="nf">plot_pole_dp_dm</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">slon</span><span class="p">,</span> <span class="n">slat</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">pole_label</span><span class="o">=</span><span class="s1">&#39;pole&#39;</span><span class="p">,</span> <span class="n">site_label</span><span class="o">=</span><span class="s1">&#39;site&#39;</span><span class="p">,</span>
                    <span class="n">pole_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">pole_edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">pole_marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                    <span class="n">site_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">site_edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">site_marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots a paleomagnetic pole and a dp/dm confidence ellipse on a cartopy map axis.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    such as that in the make_orthographic_map function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">        plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">        slon : the longitude of the site (in degrees E)</span>
<span class="sd">        slat : the latitude of the site (in degrees)</span>
<span class="sd">        dp : the semi-minor axis of the confidence ellipse (in degrees)</span>
<span class="sd">        dm : the semi-major axis of the confidence ellipse (in degrees)</span>
<span class="sd">        pole_color : the default color is black. Other colors can be chosen (e.g. &#39;g&#39;)</span>
<span class="sd">        site_color : the default color is red. Other colors can be chosen (e.g. &#39;g&#39;)</span>
<span class="sd">        pole_marker : the default is a circle. Other symbols can be chosen (e.g. &#39;s&#39;)</span>
<span class="sd">        site_marker : the default is a square. Other symbols can be chosen (e.g. &#39;^&#39;)</span>
<span class="sd">        markersize : the default is 20. Other size can be chosen</span>
<span class="sd">        pole_label : string that labels the pole.</span>
<span class="sd">        site_label : string that labels the site</span>
<span class="sd">        legend : the default is a legend (True). Putting False will suppress legend plotting.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; dec = 280</span>
<span class="sd">        &gt;&gt;&gt; inc = 45</span>
<span class="sd">        &gt;&gt;&gt; a95 = 5</span>
<span class="sd">        &gt;&gt;&gt; site_lat = 45</span>
<span class="sd">        &gt;&gt;&gt; site_lon = -100</span>
<span class="sd">        &gt;&gt;&gt; pole = pmag.dia_vgp(dec, inc, a95, site_lat, site_lon)</span>
<span class="sd">        &gt;&gt;&gt; pole_lon = pole[0]</span>
<span class="sd">        &gt;&gt;&gt; pole_lat = pole[1]</span>
<span class="sd">        &gt;&gt;&gt; dp = pole[2]</span>
<span class="sd">        &gt;&gt;&gt; dm = pole[3]</span>

<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200,central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_pole_dp_dm(map_axis,pole_lon,pole_lat,site_lon,site_lat,dp,dm)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.plot_pole_dp_dm&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">dp_km</span> <span class="o">=</span> <span class="n">dp</span><span class="o">*</span><span class="mf">111.32</span>
    <span class="n">dm_km</span> <span class="o">=</span> <span class="n">dm</span><span class="o">*</span><span class="mf">111.32</span>
    <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">pole_marker</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">pole_color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">pole_edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">pole_label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">slon</span><span class="p">,</span> <span class="n">slat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">site_marker</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">site_color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">site_edgecolor</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">site_label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="c1"># the orientation of the ellipse needs to be determined using the</span>
    <span class="c1"># two laws of cosines for spherical triangles where the triangle is</span>
    <span class="c1"># A: site, B: north pole, C: paleomagnetic pole (see Fig. A.2 of Butler)</span>

    <span class="n">site_lon_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">slon</span><span class="p">)</span>
    <span class="n">site_lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">slat</span><span class="p">)</span>
    <span class="n">c_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">slat</span><span class="p">)</span>

    <span class="n">pole_lon_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">plon</span><span class="p">)</span>
    <span class="n">pole_lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span>
    <span class="n">a_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">plat</span><span class="p">)</span>

    <span class="n">B_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pole_lon_rad</span><span class="o">-</span><span class="n">site_lon_rad</span><span class="p">)</span>

    <span class="n">cos_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c_rad</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c_rad</span><span class="p">)</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a_rad</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">B_rad</span><span class="p">)</span>
    <span class="n">b_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">cos_b</span><span class="p">)</span>

    <span class="n">sin_C</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">B_rad</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b_rad</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c_rad</span><span class="p">)</span>
    <span class="n">C_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sin_C</span><span class="p">)</span>

    <span class="c1"># need to make the rotation of the ellipse go the right way</span>
    <span class="k">if</span> <span class="n">slon</span><span class="o">-</span><span class="n">plon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plon</span> <span class="o">&gt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&gt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&lt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&gt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&gt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&lt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&lt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&lt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">slon</span><span class="o">-</span><span class="n">plon</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plon</span> <span class="o">&gt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&gt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&lt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&gt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&gt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&lt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plon</span> <span class="o">&lt;=</span> <span class="n">slon</span> <span class="ow">and</span> <span class="n">plat</span> <span class="o">&lt;=</span> <span class="n">slat</span><span class="p">:</span>
            <span class="n">C_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">C_rad</span><span class="p">))</span>

    <span class="c1"># print(C_deg)</span>
    <span class="n">ellipse</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">dp_km</span><span class="p">,</span> <span class="n">dm_km</span><span class="p">,</span> <span class="n">C_deg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">pole_color</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_poles_colorbar"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_poles_colorbar">[docs]</a><span class="k">def</span> <span class="nf">plot_poles_colorbar</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plons</span><span class="p">,</span> <span class="n">plats</span><span class="p">,</span> <span class="n">A95s</span><span class="p">,</span> <span class="n">colorvalues</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span>
                        <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar_label</span><span class="o">=</span><span class="s1">&#39;pole age (Ma)&#39;</span><span class="p">,</span>
                        <span class="n">outline</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="n">filled_pole</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots multiple paleomagnetic pole and A95 error ellipse on a cartopy map axis.</span>
<span class="sd">    The poles are colored by the defined colormap.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    such as that in the make_orthographic_map function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        plons : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">        plats : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">        A95s : the A_95 confidence ellipse of the paleomagnetic pole (in degrees)</span>
<span class="sd">        colorvalues : what attribute is being used to determine the colors</span>
<span class="sd">        vmin : what is the minimum range for the colormap</span>
<span class="sd">        vmax : what is the maximum range for the colormap</span>
<span class="sd">        colormap : the colormap used (default is &#39;viridis&#39;; others should be put as a string with quotes, e.g. &#39;plasma&#39;)</span>
<span class="sd">        edgecolor : the color desired for the symbol outline</span>
<span class="sd">        marker : the marker shape desired for the pole mean symbol (default is &#39;o&#39; aka a circle)</span>
<span class="sd">        colorbar : the default is to include a colorbar (True). Putting False will make it so no legend is plotted.</span>
<span class="sd">        colorbar_label : label for the colorbar</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; plons = [200, 180, 210]</span>
<span class="sd">        &gt;&gt;&gt; plats = [60, 40, 35]</span>
<span class="sd">        &gt;&gt;&gt; A95s = [6, 3, 10]</span>
<span class="sd">        &gt;&gt;&gt; ages = [100,200,300]</span>
<span class="sd">        &gt;&gt;&gt; vmin = 0</span>
<span class="sd">        &gt;&gt;&gt; vmax = 300</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200, central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_poles_colorbar(map_axis, plons, plats, A95s, ages, vmin, vmax)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.plot_poles_colorbar&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">color_mapping</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">color_mapping</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">colorvalues</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">plot_poles</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">plons</span><span class="p">,</span> <span class="n">plats</span><span class="p">,</span> <span class="n">A95s</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
               <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span><span class="n">filled_pole</span><span class="o">=</span><span class="n">filled_pole</span><span class="p">,</span><span class="n">outline</span><span class="o">=</span><span class="n">outline</span><span class="p">,</span>
               <span class="n">fill_color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="n">fill_alpha</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">))</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                     <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">colorbar_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_vgp"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_vgp">[docs]</a><span class="k">def</span> <span class="nf">plot_vgp</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">vgp_lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
             <span class="n">edge</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots a paleomagnetic pole position on a cartopy map axis.</span>

<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    such as that in the make_orthographic_map function.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : the name of the current map axis that has been developed using cartopy</span>
<span class="sd">        plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">        plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">        color : the color desired for the symbol (default is &#39;k&#39; aka black)</span>
<span class="sd">        marker : the marker shape desired for the pole mean symbol (default is &#39;o&#39; aka a circle)</span>
<span class="sd">        edge : the color of the edge of the marker (default is black); can be set to None to have no edge</span>
<span class="sd">        markersize : size of the marker in pt (default is 20)</span>
<span class="sd">        alpha : the transparency of the points (defaul is 1 which is opaque, 0 is fully transparent)</span>
<span class="sd">        label : the default is no label. Labels can be assigned.</span>
<span class="sd">        legend : the default is no legend (False). Putting True will plot a legend.</span>
<span class="sd">        zorder : plotting order (default is 100; higher will move to top of plot)</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; vgps = ipmag.fishrot(dec=200,inc=30)</span>
<span class="sd">        &gt;&gt;&gt; vgp_lon_list,vgp_lat_list,intensities= ipmag.unpack_di_block(vgps)</span>
<span class="sd">        &gt;&gt;&gt; map_axis = ipmag.make_orthographic_map(central_longitude=200,central_latitude=30)</span>
<span class="sd">        &gt;&gt;&gt; ipmag.plot_vgp(map_axis,vgp_lon=vgp_lon_list,vgp_lat=vgp_lat_list,color=&#39;red&#39;,markersize=40,zorder=20))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.plot_vgp&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_lists</span> <span class="o">=</span> <span class="n">unpack_di_block</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">di_lists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="k">if</span> <span class="n">edge</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> 
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">map_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">[</span><span class="n">edge</span><span class="p">],</span>
                        <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> 
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">map_axis</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_vgp_basemap"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_vgp_basemap">[docs]</a><span class="k">def</span> <span class="nf">plot_vgp_basemap</span><span class="p">(</span><span class="n">mapname</span><span class="p">,</span> <span class="n">vgp_lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots a paleomagnetic pole on whatever current map projection</span>
<span class="sd">    has been set using the basemap plotting library.</span>
<span class="sd">    Before this function is called, a plot needs to be initialized with code</span>
<span class="sd">    that looks something like:</span>
<span class="sd">    &gt;from mpl_toolkits.basemap import Basemap</span>
<span class="sd">    &gt;mapname = Basemap(projection=&#39;ortho&#39;,lat_0=35,lon_0=200)</span>
<span class="sd">    &gt;plt.figure(figsize=(6, 6))</span>
<span class="sd">    &gt;mapname.drawcoastlines(linewidth=0.25)</span>
<span class="sd">    &gt;mapname.fillcontinents(color=&#39;bisque&#39;,lake_color=&#39;white&#39;,zorder=1)</span>
<span class="sd">    &gt;mapname.drawmapboundary(fill_color=&#39;white&#39;)</span>
<span class="sd">    &gt;mapname.drawmeridians(np.arange(0,360,30))</span>
<span class="sd">    &gt;mapname.drawparallels(np.arange(-90,90,30))</span>
<span class="sd">    Required Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    mapname : the name of the current map that has been developed using basemap</span>
<span class="sd">    plon : the longitude of the paleomagnetic pole being plotted (in degrees E)</span>
<span class="sd">    plat : the latitude of the paleomagnetic pole being plotted (in degrees)</span>
<span class="sd">    Optional Parameters (defaults are used if not specified)</span>
<span class="sd">    -----------</span>
<span class="sd">    color : the color desired for the symbol and its A95 ellipse (default is &#39;k&#39; aka black)</span>
<span class="sd">    marker : the marker shape desired for the pole mean symbol (default is &#39;o&#39; aka a circle)</span>
<span class="sd">    label : the default is no label. Labels can be assigned.</span>
<span class="sd">    legend : the default is no legend (&#39;no&#39;). Putting &#39;yes&#39; will plot a legend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">di_block</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">di_lists</span> <span class="o">=</span> <span class="n">unpack_di_block</span><span class="p">(</span><span class="n">di_block</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">di_lists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span> <span class="o">=</span> <span class="n">mapname</span><span class="p">(</span><span class="n">vgp_lon</span><span class="p">,</span> <span class="n">vgp_lat</span><span class="p">)</span>
    <span class="n">mapname</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="vgp_calc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.vgp_calc">[docs]</a><span class="k">def</span> <span class="nf">vgp_calc</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">tilt_correction</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="n">site_lon</span><span class="o">=</span><span class="s1">&#39;site_lon&#39;</span><span class="p">,</span> <span class="n">site_lat</span><span class="o">=</span><span class="s1">&#39;site_lat&#39;</span><span class="p">,</span> <span class="n">dec_is</span><span class="o">=</span><span class="s1">&#39;dec_is&#39;</span><span class="p">,</span> <span class="n">inc_is</span><span class="o">=</span><span class="s1">&#39;inc_is&#39;</span><span class="p">,</span> <span class="n">dec_tc</span><span class="o">=</span><span class="s1">&#39;dec_tc&#39;</span><span class="p">,</span> <span class="n">inc_tc</span><span class="o">=</span><span class="s1">&#39;inc_tc&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates paleomagnetic poles using directional data and site</span>
<span class="sd">    location data within a pandas.DataFrame. The function adds the columns</span>
<span class="sd">    &#39;paleolatitude&#39;, &#39;vgp_lat&#39;, &#39;vgp_lon&#39;, &#39;vgp_lat_rev&#39;, and &#39;vgp_lon_rev&#39;</span>
<span class="sd">    to the dataframe. The &#39;_rev&#39; columns allow for subsequent choice as to which</span>
<span class="sd">    polarity will be used for the VGPs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : the name of the pandas.DataFrame containing the data</span>
<span class="sd">    tilt-correction : &#39;yes&#39; is the default and uses tilt-corrected data (dec_tc, inc_tc), &#39;no&#39; uses data that is not tilt-corrected and is in geographic coordinates</span>
<span class="sd">    dataframe[&#39;site_lat&#39;] : the name of the Dataframe column containing the latitude of the site</span>
<span class="sd">    dataframe[&#39;site_lon&#39;] : the name of the Dataframe column containing the longitude of the site</span>
<span class="sd">    dataframe[&#39;inc_tc&#39;] : the name of the Dataframe column containing the tilt-corrected inclination (used by default tilt-correction=&#39;yes&#39;)</span>
<span class="sd">    dataframe[&#39;dec_tc&#39;] : the name of the Dataframe column containing the tilt-corrected declination (used by default tilt-correction=&#39;yes&#39;)</span>
<span class="sd">    dataframe[&#39;inc_is&#39;] : the name of the Dataframe column containing the insitu inclination (used when tilt-correction=&#39;no&#39;)</span>
<span class="sd">    dataframe[&#39;dec_is&#39;] : the name of the Dataframe column containing the insitu declination (used when tilt-correction=&#39;no&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dataframe[&#39;paleolatitude&#39;]</span>
<span class="sd">    dataframe[&#39;colatitude&#39;]</span>
<span class="sd">    dataframe[&#39;vgp_lat&#39;]</span>
<span class="sd">    dataframe[&#39;vgp_lon&#39;]</span>
<span class="sd">    dataframe[&#39;vgp_lat_rev&#39;]</span>
<span class="sd">    dataframe[&#39;vgp_lon_rev&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">is_copy</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">tilt_correction</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="c1"># calculate the paleolatitude/colatitude</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">inc_tc</span><span class="p">]))))</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]</span>
        <span class="c1"># calculate the latitude of the pole</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">+</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dec_tc</span><span class="p">]))))</span>
        <span class="c1"># calculate the longitudinal difference between the pole and the site</span>
        <span class="c1"># (beta)</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">*</span>
                                                          <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dec_tc</span><span class="p">])))</span><span class="o">/</span>
                                                         <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">])))))</span>
        <span class="c1"># generate a boolean array (mask) to use to distinguish between the two possibilities for pole longitude</span>
        <span class="c1"># and then calculate pole longitude using the site location and</span>
        <span class="c1"># calculated beta</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]))</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lon</span><span class="p">]</span> <span class="o">+</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span> <span class="o">%</span>
                                        <span class="mf">360.</span><span class="p">,</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lon</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">)</span>
        <span class="c1"># calculate the antipode of the poles</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat_rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon_rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span>
        <span class="c1"># the &#39;colatitude&#39; and &#39;beta&#39; columns were created for the purposes of the pole calculations</span>
        <span class="c1"># but aren&#39;t of further use and are deleted</span>
        <span class="k">del</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tilt_correction</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
        <span class="c1"># calculate the paleolatitude/colatitude</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">inc_is</span><span class="p">]))))</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]</span>
        <span class="c1"># calculate the latitude of the pole</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">+</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">*</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dec_is</span><span class="p">]))))</span>
        <span class="c1"># calculate the longitudinal difference between the pole and the site</span>
        <span class="c1"># (beta)</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">*</span>
                                                          <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dec_is</span><span class="p">])))</span><span class="o">/</span>
                                                         <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">])))))</span>
        <span class="c1"># generate a boolean array (mask) to use to distinguish between the two possibilities for pole longitude</span>
        <span class="c1"># and then calculate pole longitude using the site location and</span>
        <span class="c1"># calculated beta</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lat</span><span class="p">]))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]))</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lon</span><span class="p">]</span> <span class="o">+</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span> <span class="o">%</span>
                                        <span class="mf">360.</span><span class="p">,</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">site_lon</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span> <span class="o">%</span> <span class="mf">360.</span><span class="p">)</span>
        <span class="c1"># calculate the antipode of the poles</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat_rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon_rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.</span>
        <span class="c1"># the &#39;colatitude&#39; and &#39;beta&#39; columns were created for the purposes of the pole calculations</span>
        <span class="c1"># but aren&#39;t of further use and are deleted</span>
        <span class="k">del</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;colatitude&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span></div>


<div class="viewcode-block" id="sb_vgp_calc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.sb_vgp_calc">[docs]</a><span class="k">def</span> <span class="nf">sb_vgp_calc</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">site_correction</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="n">dec_tc</span><span class="o">=</span><span class="s1">&#39;dec_tc&#39;</span><span class="p">,</span> <span class="n">inc_tc</span><span class="o">=</span><span class="s1">&#39;inc_tc&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the angular dispersion of VGPs and corrects</span>
<span class="sd">    for within site dispersion (unless site_correction = &#39;no&#39;) to return</span>
<span class="sd">    a value S_b. The input data needs to be within a pandas Dataframe.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : the name of the pandas.DataFrame containing the data</span>

<span class="sd">    the data frame needs to contain these columns:</span>
<span class="sd">    dataframe[&#39;site_lat&#39;] : latitude of the site</span>
<span class="sd">    dataframe[&#39;site_lon&#39;] : longitude of the site</span>
<span class="sd">    dataframe[&#39;k&#39;] : fisher precision parameter for directions</span>
<span class="sd">    dataframe[&#39;vgp_lat&#39;] : VGP latitude</span>
<span class="sd">    dataframe[&#39;vgp_lon&#39;] : VGP longitude</span>
<span class="sd">    ----- the following default parameters can be changes by keyword argument -----</span>
<span class="sd">    dataframe[&#39;inc_tc&#39;] : tilt-corrected inclination</span>
<span class="sd">    dataframe[&#39;dec_tc&#39;] : tilt-corrected declination</span>

<span class="sd">    plot : default is &#39;no&#39;, will make a plot of poles if &#39;yes&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># calculate the mean from the directional data</span>
    <span class="n">dataframe_dirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
        <span class="n">dataframe_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dec_tc</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
                               <span class="n">dataframe</span><span class="p">[</span><span class="n">inc_tc</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">dataframe_dir_mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">dataframe_dirs</span><span class="p">)</span>

    <span class="c1"># calculate the mean from the vgp data</span>
    <span class="n">dataframe_poles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dataframe_pole_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dataframe_pole_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
        <span class="n">dataframe_poles</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
                                <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="n">dataframe_pole_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
        <span class="n">dataframe_pole_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
    <span class="n">dataframe_pole_mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">dataframe_poles</span><span class="p">)</span>

    <span class="c1"># calculate mean paleolatitude from the directional data</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_from_inc</span><span class="p">(</span><span class="n">dataframe_dir_mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>

    <span class="n">angle_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">dataframe_pole_mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">dataframe_pole_mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]])</span>
        <span class="n">angle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;delta_mean_pole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle_list</span>

    <span class="k">if</span> <span class="n">site_correction</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
        <span class="c1"># use eq. 2 of Cox (1970) to translate the directional precision parameter</span>
        <span class="c1"># into pole coordinates using the assumption of a Fisherian distribution in</span>
        <span class="c1"># directional coordinates and the paleolatitude as calculated from mean</span>
        <span class="c1"># inclination using the dipole equation</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">0.125</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">18</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span>
                                                           <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;paleolatitude&#39;</span><span class="p">]))</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Sw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">81</span><span class="o">/</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">summation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;delta_mean_pole&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> \
                <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;Sw&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
            <span class="n">summation</span> <span class="o">+=</span> <span class="n">quantity</span>
            <span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">Sb</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">summation</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">site_correction</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>

        <span class="n">summation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)):</span>
            <span class="n">quantity</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;delta_mean_pole&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">summation</span> <span class="o">+=</span> <span class="n">quantity</span>
            <span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">Sb</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">summation</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">return</span> <span class="n">Sb</span></div>


<div class="viewcode-block" id="bin_trace"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.bin_trace">[docs]</a><span class="k">def</span> <span class="nf">bin_trace</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a trace of samples in longitude and latitude, bin them</span>
<span class="sd">    in latitude and longitude, and normalize the bins so that</span>
<span class="sd">    the integral of probability density over the sphere is one.</span>

<span class="sd">    The resolution keyword gives the number of divisions in latitude.</span>
<span class="sd">    The divisions in longitude is twice that.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lon_samples: a list of longitudes</span>
<span class="sd">        lat_samples: a list of latitudes</span>

<span class="sd">        resolution: The resolution keyword gives the number of divisions in latitude.</span>
<span class="sd">            The divisions in longitude is twice that.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lon_grid</span><span class="p">)</span>

    <span class="n">dlon</span> <span class="o">=</span> <span class="mf">360.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">resolution</span>

    <span class="k">for</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">):</span>

        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="mf">360.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mf">180.</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mf">360.</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.</span> <span class="ow">or</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mf">90.</span><span class="p">:</span>
            <span class="c1"># Just skip invalid latitudes if they happen to arise</span>
            <span class="k">continue</span>

        <span class="n">lon_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">180.</span><span class="p">)</span> <span class="o">/</span> <span class="n">dlon</span><span class="p">))</span>
        <span class="n">lat_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">lat</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">)</span> <span class="o">/</span> <span class="n">dlat</span><span class="p">))</span>
        <span class="n">hist</span><span class="p">[</span><span class="n">lat_index</span><span class="p">,</span> <span class="n">lon_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">lat_grid</span> <span class="o">+=</span> <span class="n">dlat</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">lon_grid</span> <span class="o">+=</span> <span class="n">dlon</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="k">return</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">hist</span></div>


<div class="viewcode-block" id="density_distribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.density_distribution">[docs]</a><span class="k">def</span> <span class="nf">density_distribution</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    calculate density distribution of a given set of vectos on a sphere</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        lon_samples: a list of longitudes</span>
<span class="sd">        lat_samples: a list of latitudes</span>
<span class="sd">        resolution: the resolution at which to calculate the vectors distribution.</span>
<span class="sd">            the higher the number, the finer the resolution (default is 30)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">)</span>
    <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">bin_trace</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">hist</span> <span class="o">/</span> <span class="n">count</span></div>


<div class="viewcode-block" id="cumulative_density_distribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.cumulative_density_distribution">[docs]</a><span class="k">def</span> <span class="nf">cumulative_density_distribution</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    compute cumulative density distribution of a set of vectors on a unit sphere</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lon_samples: a list of longitudes</span>
<span class="sd">        lat_samples: a list of latitudes</span>

<span class="sd">        resolution: the resolution at which to calculate the vectors distribution.</span>
<span class="sd">            the higher the number, the finer the resolution</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple</span>
<span class="sd">            longitude grid, latitude grid, and cumulative densities</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">bin_trace</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="c1"># Compute the cumulative density</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">i_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">hist</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">i_unsort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">i_sort</span><span class="p">)</span>
    <span class="n">hist_cumsum</span> <span class="o">=</span> <span class="n">hist</span><span class="p">[</span><span class="n">i_sort</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">hist_cumsum</span> <span class="o">/=</span> <span class="n">hist_cumsum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">hist_cumsum</span><span class="p">[</span><span class="n">i_unsort</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lat_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_distributions"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_distributions">[docs]</a><span class="k">def</span> <span class="nf">plot_distributions</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">to_plot</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    plot distributions of a group of vectors on a unit sphere</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ax: matplotlib axis</span>
<span class="sd">        lon_samples: a list or array of longitude samples</span>
<span class="sd">        lat_samples: a list or array of latitude samples</span>
<span class="sd">        to_plot: the type of distribution plot to show, can be &#39;d&#39; as colormesh, &#39;e&#39; as contour, &#39;s&#39; as discrete scatter plots</span>
<span class="sd">        resolution: the resolution at which to plot the distributions</span>
<span class="sd">        kwargs: other keyword arguments inherited from matplotlib</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

    <span class="n">artists</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="s1">&#39;d&#39;</span> <span class="ow">in</span> <span class="n">to_plot</span><span class="p">:</span>
        <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="n">density_distribution</span><span class="p">(</span>
            <span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">density</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">density</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                          <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">to_plot</span><span class="p">:</span>
        <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">cumulative_density</span> <span class="o">=</span> <span class="n">cumulative_density_distribution</span><span class="p">(</span>
            <span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">,</span> <span class="n">cumulative_density</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;levels&#39;</span><span class="p">,[</span>
                       <span class="mf">0.95</span><span class="p">]),</span> <span class="n">colors</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> 
                       <span class="n">linewidths</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">zorder</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zorder&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
        <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">to_plot</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon_samples</span><span class="p">,</span> <span class="n">lat_samples</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;C0&#39;</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">edgecolors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">artists</span></div>


<div class="viewcode-block" id="make_di_block"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.make_di_block">[docs]</a><span class="k">def</span> <span class="nf">make_di_block</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">unit_vector</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some pmag.py and ipmag.py functions require or will take a list of unit</span>
<span class="sd">    vectors [dec,inc,1.] as input. This function takes declination and</span>
<span class="sd">    inclination data and make it into such a nested list of lists.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : list of declinations</span>
<span class="sd">        inc : list of inclinations</span>
<span class="sd">        unit_vector : if True will return [dec,inc,1.]; if False will return [dec,inc]</span>

<span class="sd">    Returns:</span>
<span class="sd">        di_block</span>
<span class="sd">            nested list of declination, inclination lists</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; decs = [180.3, 179.2, 177.2]</span>
<span class="sd">        &gt;&gt;&gt; incs = [12.1, 13.7, 11.9]</span>
<span class="sd">        &gt;&gt;&gt; ipmag.make_di_block(decs,incs)</span>
<span class="sd">        [[180.3, 12.1, 1.0], [179.2, 13.7, 1.0], [177.2, 11.9, 1.0]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">di_block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">unit_vector</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)):</span>
            <span class="n">di_block</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dec</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">unit_vector</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)):</span>
            <span class="n">di_block</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dec</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">di_block</span></div>


<div class="viewcode-block" id="unpack_di_block"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.unpack_di_block">[docs]</a><span class="k">def</span> <span class="nf">unpack_di_block</span><span class="p">(</span><span class="n">di_block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function unpacks a nested list of [dec,inc,mag_moment] into a list of</span>
<span class="sd">    declination values, a list of inclination values and a list of magnetic</span>
<span class="sd">    moment values. Mag_moment values are optional, while dec and inc values are</span>
<span class="sd">    required.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    di_block : nested list of declination, inclination lists</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    dec : list of declinations</span>
<span class="sd">    inc : list of inclinations</span>
<span class="sd">    mag_moment : list of magnetic moment (if present in di_block)</span>

<span class="sd">    Example</span>
<span class="sd">    -----------</span>
<span class="sd">    The di_block nested lists of lists can be unpacked using the function</span>

<span class="sd">    &gt;&gt;&gt; directions = [[180.3, 12.1, 1.0], [179.2, 13.7, 1.0], [177.2, 11.9, 1.0]]</span>
<span class="sd">    &gt;&gt;&gt; ipmag.unpack_di_block(directions)</span>
<span class="sd">    ([180.3, 179.2, 177.2], [12.1, 13.7, 11.9], [1.0, 1.0, 1.0])</span>

<span class="sd">    These unpacked values can be assigned to variables:</span>

<span class="sd">    &gt;&gt;&gt; dec, inc, moment = ipmag.unpack_di_block(directions)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dec_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">inc_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">moment_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">)):</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">di_block</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">di_block</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">inc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_block</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">moment</span> <span class="o">=</span> <span class="n">di_block</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">moment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moment</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dec_list</span><span class="p">,</span> <span class="n">inc_list</span><span class="p">,</span> <span class="n">moment_list</span></div>


<div class="viewcode-block" id="make_diddd_array"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.make_diddd_array">[docs]</a><span class="k">def</span> <span class="nf">make_diddd_array</span><span class="p">(</span><span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">dip_direction</span><span class="p">,</span> <span class="n">dip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some pmag.py functions such as the bootstrap fold test require a numpy array</span>
<span class="sd">     of dec, inc, dip direction, dip [dec, inc, dd, dip] as input. This function</span>
<span class="sd">     makes such an array.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dec : paleomagnetic declination in degrees</span>
<span class="sd">        inc : paleomagnetic inclination in degrees</span>
<span class="sd">        dip_direction : the dip direction of bedding (in degrees between 0 and 360)</span>
<span class="sd">        dip: dip of bedding (in degrees)</span>

<span class="sd">    Returns:</span>
<span class="sd">        array </span>
<span class="sd">            an array of [dec, inc, dip_direction, dip]</span>

<span class="sd">    Examples:</span>
<span class="sd">        Data in separate lists of dec, inc, dip_direction, dip data can be made into</span>
<span class="sd">        an array.</span>

<span class="sd">        &gt;&gt;&gt; dec = [132.5,124.3,142.7,130.3,163.2]</span>
<span class="sd">        &gt;&gt;&gt; inc = [12.1,23.2,34.2,37.7,32.6]</span>
<span class="sd">        &gt;&gt;&gt; dip_direction = [265.0,265.0,265.0,164.0,164.0]</span>
<span class="sd">        &gt;&gt;&gt; dip = [20.0,20.0,20.0,72.0,72.0]</span>
<span class="sd">        &gt;&gt;&gt; data_array = ipmag.make_diddd_array(dec,inc,dip_direction,dip)</span>
<span class="sd">        &gt;&gt;&gt; data_array</span>
<span class="sd">        array([[ 132.5,   12.1,  265. ,   20. ],</span>
<span class="sd">        [ 124.3,   23.2,  265. ,   20. ],</span>
<span class="sd">        [ 142.7,   34.2,  265. ,   20. ],</span>
<span class="sd">        [ 130.3,   37.7,  164. ,   72. ],</span>
<span class="sd">        [ 163.2,   32.6,  164. ,   72. ]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diddd_block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)):</span>
        <span class="n">diddd_block</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dec</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">dip_direction</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">dip</span><span class="p">[</span><span class="n">n</span><span class="p">]])</span>
    <span class="n">diddd_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diddd_block</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">diddd_array</span></div>


<div class="viewcode-block" id="shoot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.shoot">[docs]</a><span class="k">def</span> <span class="nf">shoot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">maxdist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function enables A95 error ellipses to be drawn around</span>
<span class="sd">    paleomagnetic poles in conjunction with equi</span>
<span class="sd">    (from: http://www.geophysique.be/2011/02/20/matplotlib-basemap-tutorial-09-drawing-circles/)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">glat1</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">glon1</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">maxdist</span><span class="o">/</span><span class="mf">1.852</span>
    <span class="n">faz</span> <span class="o">=</span> <span class="n">azimuth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

    <span class="n">EPS</span> <span class="o">=</span> <span class="mf">0.00000000005</span>
<span class="c1">#    if ((np.abs(np.cos(glat1)) &lt; EPS) and not (np.abs(np.sin(faz)) &lt; EPS)): #why was this ever a thing? it works fine at the north pole</span>
<span class="c1">#        raise ValueError(&quot;Only N-S courses are meaningful, starting at a pole!&quot;)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mf">6378.13</span><span class="o">/</span><span class="mf">1.852</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">298.257223563</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">f</span>
    <span class="n">tu</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">glat1</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">faz</span><span class="p">)</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">faz</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">tu</span><span class="p">,</span> <span class="n">cf</span><span class="p">)</span>

    <span class="n">cu</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">tu</span> <span class="o">*</span> <span class="n">tu</span><span class="p">)</span>
    <span class="n">su</span> <span class="o">=</span> <span class="n">tu</span> <span class="o">*</span> <span class="n">cu</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">cu</span> <span class="o">*</span> <span class="n">sf</span>
    <span class="n">c2a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sa</span> <span class="o">*</span> <span class="n">sa</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c2a</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">/</span> <span class="n">x</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">4.</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span><span class="o">/</span> <span class="n">c</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.375</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">tu</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">tu</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">):</span>

        <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">-</span> <span class="mf">1.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">cy</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="n">e</span> <span class="o">-</span> <span class="mf">1.</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(((</span><span class="n">sy</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="mf">4.</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">cz</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="mf">6.</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span>
             <span class="n">d</span> <span class="o">/</span> <span class="mf">4.</span> <span class="o">-</span> <span class="n">cz</span><span class="p">)</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">tu</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">cu</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">cf</span> <span class="o">-</span> <span class="n">su</span> <span class="o">*</span> <span class="n">sy</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sa</span> <span class="o">*</span> <span class="n">sa</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">su</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">cu</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cf</span>
    <span class="n">glat2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cu</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">su</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">cf</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sy</span> <span class="o">*</span> <span class="n">sf</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">c2a</span> <span class="o">+</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="n">c2a</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="mf">16.</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="n">e</span> <span class="o">*</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">cz</span><span class="p">)</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">sa</span>
    <span class="n">glon2</span> <span class="o">=</span> <span class="p">((</span><span class="n">glon1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">baz</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">glon2</span> <span class="o">*=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">glat2</span> <span class="o">*=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">baz</span> <span class="o">*=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">glon2</span><span class="p">,</span> <span class="n">glat2</span><span class="p">,</span> <span class="n">baz</span><span class="p">)</span></div>


<div class="viewcode-block" id="equi"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.equi">[docs]</a><span class="k">def</span> <span class="nf">equi</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function enables A95 error ellipses to be drawn in cartopy around</span>
<span class="sd">    paleomagnetic poles in conjunction with shoot</span>
<span class="sd">    (modified from: http://www.geophysique.be/2011/02/20/matplotlib-basemap-tutorial-09-drawing-circles/).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        map_axis : cartopy axis</span>
<span class="sd">        centerlon : longitude of the center of the ellipse</span>
<span class="sd">        centerlat : latitude of the center of the ellipse</span>
<span class="sd">        radius : radius of ellipse (in degrees)</span>
<span class="sd">        color : color of ellipse</span>
<span class="sd">        alpha : transparency - if filled, the transparency will only apply</span>
<span class="sd">                to the facecolor of the ellipse</span>
<span class="sd">        outline : boolean specifying if the ellipse should be plotted as a filled polygon or</span>
<span class="sd">                as a set of line segments</span>
<span class="sd">        fill : boolean specifying if the ellipse should be plotted as a filled polygon</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.equi&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">glon1</span> <span class="o">=</span> <span class="n">centerlon</span>
    <span class="n">glat1</span> <span class="o">=</span> <span class="n">centerlat</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">):</span>
        <span class="n">glon2</span><span class="p">,</span> <span class="n">glat2</span><span class="p">,</span> <span class="n">baz</span> <span class="o">=</span> <span class="n">shoot</span><span class="p">(</span><span class="n">glon1</span><span class="p">,</span> <span class="n">glat1</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glon2</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glat2</span><span class="p">)</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># for non-filled ellipses</span>
    <span class="k">if</span> <span class="n">fill</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># for filled ellipses</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outline</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">circle_edge</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">XY</span><span class="p">,</span>
                                  <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                  <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
            <span class="n">map_axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_edge</span><span class="p">)</span>
        <span class="n">circle_face</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">XY</span><span class="p">,</span>
                              <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                              <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
        <span class="n">map_axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_face</span><span class="p">)</span></div>



<div class="viewcode-block" id="equi_basemap"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.equi_basemap">[docs]</a><span class="k">def</span> <span class="nf">equi_basemap</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function enables A95 error ellipses to be drawn in basemap around</span>
<span class="sd">    paleomagnetic poles in conjunction with shoot</span>
<span class="sd">    (from: http://www.geophysique.be/2011/02/20/matplotlib-basemap-tutorial-09-drawing-circles/).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">glon1</span> <span class="o">=</span> <span class="n">centerlon</span>
    <span class="n">glat1</span> <span class="o">=</span> <span class="n">centerlat</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">):</span>
        <span class="n">glon2</span><span class="p">,</span> <span class="n">glat2</span><span class="p">,</span> <span class="n">baz</span> <span class="o">=</span> <span class="n">shoot</span><span class="p">(</span><span class="n">glon1</span><span class="p">,</span> <span class="n">glat1</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glon2</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glat2</span><span class="p">)</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></div>


<div class="viewcode-block" id="ellipse"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.ellipse">[docs]</a><span class="k">def</span> <span class="nf">ellipse</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">centerlon</span><span class="p">,</span> <span class="n">centerlat</span><span class="p">,</span> <span class="n">major_axis</span><span class="p">,</span> <span class="n">minor_axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function enables general error ellipses to be drawn on the cartopy projection of the input map axis</span>
<span class="sd">    using a center and a set of major and minor axes and a rotation angle east of north.</span>
<span class="sd">    (Adapted from equi).</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    map_axis : cartopy axis</span>
<span class="sd">    centerlon : longitude of the center of the ellipse</span>
<span class="sd">    centerlat : latitude of the center of the ellipse</span>
<span class="sd">    major_axis : Major axis of ellipse in km</span>
<span class="sd">    minor_axis : Minor axis of ellipse in km</span>
<span class="sd">    angle : angle of major axis in degrees east of north</span>
<span class="sd">    n : number of points with which to apporximate the ellipse</span>
<span class="sd">    filled : boolean specifying if the ellipse should be plotted as a filled polygon or</span>
<span class="sd">             as a set of line segments (Doesn&#39;t work right now)</span>
<span class="sd">    kwargs : any other key word arguments can be passed for the line</span>

<span class="sd">    Returns:</span>
<span class="sd">        The map object with the ellipse plotted on it</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">transform</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cartopy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- cartopy must be installed to run ipmag.ellipse&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">glon1</span> <span class="o">=</span> <span class="n">centerlon</span>
    <span class="n">glat1</span> <span class="o">=</span> <span class="n">centerlat</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">azimuth</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">az_rad</span> <span class="o">=</span> <span class="n">azimuth</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="p">((</span><span class="n">major_axis</span><span class="o">*</span><span class="n">minor_axis</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="n">minor_axis</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az_rad</span><span class="o">-</span><span class="n">angle</span><span class="p">))</span>
                                            <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">major_axis</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az_rad</span><span class="o">-</span><span class="n">angle</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span><span class="p">))</span>
        <span class="n">glon2</span><span class="p">,</span> <span class="n">glat2</span><span class="p">,</span> <span class="n">baz</span> <span class="o">=</span> <span class="n">shoot</span><span class="p">(</span><span class="n">glon1</span><span class="p">,</span> <span class="n">glat1</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">360</span><span class="o">+</span><span class="n">glon2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glat2</span><span class="p">)</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">ellip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ellip</span> <span class="o">=</span> <span class="n">map_axis</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
            <span class="n">transform</span><span class="p">,</span> <span class="n">ellip</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ellip</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">ellip</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">map_axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;facecolor&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;facecolor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;edgecolor&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;edgecolor&quot;</span><span class="p">)</span>
            <span class="n">map_axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="combine_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.combine_magic">[docs]</a><span class="k">def</span> <span class="nf">combine_magic</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;measurements.txt&#39;</span><span class="p">,</span> <span class="n">data_model</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">magic_table</span><span class="o">=</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span>
                  <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list of magic-formatted files, concatenates them, and creates a</span>
<span class="sd">    single file. Returns output filename if the operation was successful.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        filenames : list of MagIC formatted files</span>
<span class="sd">        outfile : name of output file [e.g., measurements.txt]</span>
<span class="sd">        data_model : data model number (2.5 or 3), default 3</span>
<span class="sd">        magic_table : name of magic table, default &#39;measurements&#39;</span>
<span class="sd">        dir_path : str</span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path : str</span>
<span class="sd">            input file directory (if different from dir_path), default &quot;&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        outfile name if success, False if failure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_model</span><span class="p">)</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
        <span class="n">output_dir_path</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[])</span>
        <span class="c1"># make sure files actually exist</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span>
        <span class="c1">#filenames = [os.path.realpath(f) for f in filenames]</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You have provided no valid file paths, so nothing will be combined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">magic_table</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># figure out file type from first of files to join</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;er_specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;er_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;er_sites&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;er_locations&#39;</span><span class="p">,</span> <span class="s1">&#39;er_ages&#39;</span><span class="p">,</span> <span class="s1">&#39;pmag_specimens&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;pmag_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;pmag_sites&#39;</span><span class="p">,</span> <span class="s1">&#39;pmag_results&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;magic_measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;rmag_anisotropy&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;rmag_results&#39;</span><span class="p">,</span> <span class="s1">&#39;rmag_specimens&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;-W- You are working in MagIC 3 but have provided a MagIC 2.5 file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">table_names</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="n">magic_table</span>
        <span class="n">infiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># drop any fully duplicated rows</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">add_magic_table</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">file_type</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
        <span class="c1"># drop any mostly empty rows IF they have duplicate index</span>
        <span class="n">parent</span><span class="p">,</span> <span class="n">child</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">get_parent_and_child</span><span class="p">(</span><span class="n">file_type</span><span class="p">)</span>
        <span class="n">ignore_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="n">file_type</span><span class="p">,</span> <span class="n">parent</span><span class="p">]</span> <span class="k">if</span> <span class="n">col</span><span class="p">]</span>
        <span class="n">ignore_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span> <span class="s1">&#39;citations&#39;</span><span class="p">])</span>
        <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicate_rows</span><span class="p">(</span><span class="n">ignore_cols</span><span class="p">)</span>
        <span class="c1"># correctly handle measurements.sequence column</span>
        <span class="k">if</span> <span class="s1">&#39;sequence&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># write table to file, use custom name</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">write_table_to_file</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="n">custom_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must provide at least one file&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">infile</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid file name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataset</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Could not get records from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">infile</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Skipping...&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File &quot;</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="s2">&quot; read in with &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s2">&quot; records&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

        <span class="n">Recs</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Recs</span><span class="p">:</span>
            <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">Recs</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All records stored in &quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">outfile</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No file could be created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ani_depthplot2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.ani_depthplot2">[docs]</a><span class="k">def</span> <span class="nf">ani_depthplot2</span><span class="p">(</span><span class="n">ani_file</span><span class="o">=</span><span class="s1">&#39;rmag_anisotropy.txt&#39;</span><span class="p">,</span> <span class="n">meas_file</span><span class="o">=</span><span class="s1">&#39;magic_measurements.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;er_samples.txt&#39;</span><span class="p">,</span> <span class="n">age_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sum_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth_scale</span><span class="o">=</span><span class="s1">&#39;sample_core_depth&#39;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns matplotlib figure with anisotropy data plotted against depth</span>
<span class="sd">    available depth scales: &#39;sample_composite_depth&#39;, &#39;sample_core_depth&#39;, or &#39;age&#39; (you must provide an age file to use this option)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pcol</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">tint</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># format files to use full path</span>
    <span class="c1"># os.path.join(dir_path, ani_file)</span>
    <span class="n">ani_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">ani_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ani_file</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not find rmag_anisotropy type file: </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Please provide a valid file path and try again&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ani_file</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Could not find rmag_anisotropy type file: </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Please provide a valid file path and try again&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ani_file</span><span class="p">)</span>

    <span class="c1"># os.path.join(dir_path, meas_file)</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">age_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">age_file</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;Warning: you have provided an invalid age file.  Attempting to use sample file instead&#39;</span><span class="p">)</span>
            <span class="n">age_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;sample_core_depth&#39;</span>
            <span class="c1"># os.path.join(dir_path, samp_file)</span>
            <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># os.path.join(dir_path, age_file)</span>
            <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
            <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;Warning: you have provided an er_ages format file, which will take precedence over er_samples&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
        <span class="n">sum_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">sum_file</span><span class="p">)</span>

    <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

    <span class="c1"># get data read in</span>
    <span class="n">isbulk</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># tests if there are bulk susceptibility measurements</span>
    <span class="n">AniData</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">ani_file</span><span class="p">)</span>  <span class="c1"># read in tensor elements</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">age_file</span><span class="p">:</span>
        <span class="c1"># read in sample depth info from er_sample.txt format file</span>
        <span class="n">Samps</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># read in sample age info from er_ages.txt format file</span>
        <span class="n">Samps</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
        <span class="n">age_unit</span> <span class="o">=</span> <span class="n">Samps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;age_unit&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">Samps</span><span class="p">:</span>
        <span class="c1"># change to upper case for every sample name</span>
        <span class="n">s</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">Meas</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="c1"># print &#39;meas_file&#39;, meas_file</span>
    <span class="c1"># print &#39;file_type&#39;, file_type</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;magic_measurements&#39;</span><span class="p">:</span>
        <span class="n">isbulk</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Bulks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">BulkDepths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">AniData</span><span class="p">:</span>
        <span class="c1"># look for depth record for this sample</span>
        <span class="n">samprecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Samps</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">,</span>
                                     <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="c1"># see if there are non-blank depth data</span>
        <span class="n">sampdepths</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">samprecs</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># fishes out records within depth bounds</span>
            <span class="n">sampdepths</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">sampdepths</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">)</span>
            <span class="n">sampdepths</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">sampdepths</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">,</span> <span class="n">dmin</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sampdepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if there are any....</span>
            <span class="c1"># set the core depth of this record</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;core_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampdepths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]</span>
            <span class="n">Data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>  <span class="c1"># fish out data with core_depth</span>
            <span class="k">if</span> <span class="n">isbulk</span><span class="p">:</span>  <span class="c1"># if there are bulk data</span>
                <span class="n">chis</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">Meas</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="c1"># get the non-zero values for this specimen</span>
                <span class="n">chis</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">chis</span><span class="p">,</span> <span class="s1">&#39;measurement_chi_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if there are any....</span>
                    <span class="c1"># put in microSI</span>
                    <span class="n">Bulks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="mf">1e6</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">chis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;measurement_chi_volume&#39;</span><span class="p">]))</span>
                    <span class="n">BulkDepths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sampdepths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># set min and max bulk values</span>
        <span class="n">bmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span>
        <span class="n">bmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span>
    <span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Depth (m)&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;no data to plot&#39;</span>
    <span class="c1"># collect the data for plotting tau  V3_inc and V1_dec</span>
    <span class="n">Depths</span><span class="p">,</span> <span class="n">Tau1</span><span class="p">,</span> <span class="n">Tau2</span><span class="p">,</span> <span class="n">Tau3</span><span class="p">,</span> <span class="n">V3Incs</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">V1Decs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">F23s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Axs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collect the plot ids</span>
<span class="c1"># START HERE</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pcol</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># get all the s1 values from Data as floats</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s1&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s2&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s3&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">s4</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s4&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">s5</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s5&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">s6</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_s6&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">nmeas</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_n&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;anisotropy_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">Depths</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="c1"># Ss=np.array([s1,s4,s5,s4,s2,s6,s5,s6,s3]).transpose() # make an array</span>
    <span class="n">Ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s6</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># make an array</span>
    <span class="c1"># Ts=np.reshape(Ss,(len(Ss),3,-1)) # and re-shape to be n-length array of</span>
    <span class="c1"># 3x3 sub-arrays</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)):</span>
        <span class="c1"># tau,Evecs= pmag.tauV(Ts[k]) # get the sorted eigenvalues and eigenvectors</span>
        <span class="c1"># v3=pmag.cart2dir(Evecs[2])[1] # convert to inclination of the minimum</span>
        <span class="c1"># eigenvector</span>
        <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nmeas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span> <span class="n">sigma</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Ss</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">V3Incs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
        <span class="n">V1Decs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
        <span class="n">Tau1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">])</span>
        <span class="n">Tau2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">])</span>
        <span class="n">Tau3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">])</span>
        <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tau1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Tau3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">F23s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F23&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span>
        <span class="n">tau_min</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tau3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tau_min</span><span class="p">:</span>
                <span class="n">tau_min</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">tau_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Tau1</span><span class="p">)</span>
        <span class="c1"># tau_min=min(Tau3)</span>
        <span class="n">P_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="n">P_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="c1"># dmax=dmax+.05*dmax</span>
        <span class="c1"># dmin=dmin-.05*dmax</span>

        <span class="n">main_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># make the figure</span>

        <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">.02</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="n">version_num</span><span class="p">)</span>  <span class="c1"># attach the pmagpy version number</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># make the first column</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau1</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau2</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;b^&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau3</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="n">core_depth_key</span><span class="p">,</span> <span class="n">core_label_key</span><span class="p">,</span> <span class="n">Cores</span> <span class="o">=</span> <span class="n">read_core_csv_file</span><span class="p">(</span>
                <span class="n">sum_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">tau_min</span><span class="p">,</span> <span class="n">tau_max</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Eigenvalues&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;sample_core_depth&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (mbsf)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Age (&#39;</span> <span class="o">+</span> <span class="n">age_unit</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (mcd)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># make the second column</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">P_min</span><span class="p">,</span> <span class="n">P_max</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V3Incs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;V3 Inclination&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pcol</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax4</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V1Decs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;V1 Declination&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pcol</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">360</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="n">tint</span><span class="p">,</span> <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
        <span class="c1"># ax5=plt.subplot(1,np.abs(pcol),5)</span>
        <span class="c1"># Axs.append(ax5)</span>
        <span class="c1"># ax5.plot(F23s,Depths,&#39;rs&#39;)</span>
        <span class="c1"># bounds=ax5.axis()</span>
        <span class="c1"># ax5.axis([bounds[0],bounds[1],dmax,dmin])</span>
        <span class="c1"># ax5.set_xlabel(&#39;F_23&#39;)</span>
        <span class="c1"># ax5.semilogx()</span>
        <span class="c1"># if sum_file:</span>
        <span class="c1">#    for core in Cores:</span>
        <span class="c1">#         depth=float(core[core_depth_key])</span>
        <span class="c1">#         if depth&gt;=dmin and depth&lt;=dmax:</span>
        <span class="c1">#            plt.plot([bounds[0],bounds[1]],[depth,depth],&#39;b--&#39;)</span>
        <span class="c1">#            if pcol==5 and label==1:plt.text(bounds[1],depth+tint,core[core_label_key])</span>
        <span class="c1"># if pcol==6:</span>
        <span class="k">if</span> <span class="n">pcol</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># ax6=plt.subplot(1,pcol,6)</span>
            <span class="n">ax6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax6</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bulks</span><span class="p">,</span> <span class="n">BulkDepths</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">bmin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">bmax</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bulk Susc. (uSI)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">bmax</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.1</span> <span class="o">*</span> <span class="n">bmax</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="n">tint</span><span class="p">,</span>
                                     <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Axs</span><span class="p">:</span>
            <span class="c1"># this makes the x-tick labels more reasonable - they were</span>
            <span class="c1"># overcrowded using the defaults</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">delticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_ani_depthplot.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
        <span class="k">return</span> <span class="n">main_plot</span><span class="p">,</span> <span class="n">fig_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No data to plot&quot;</span></div>


<div class="viewcode-block" id="ani_depthplot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.ani_depthplot">[docs]</a><span class="k">def</span> <span class="nf">ani_depthplot</span><span class="p">(</span><span class="n">spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span>
                  <span class="n">meas_file</span><span class="o">=</span><span class="s1">&#39;measurements.txt&#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span>
                  <span class="n">age_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">sum_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">depth_scale</span><span class="o">=</span><span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns matplotlib figure with anisotropy data plotted against depth</span>
<span class="sd">    available depth scales: &#39;composite_depth&#39;, &#39;core_depth&#39; or &#39;age&#39; (you must provide an age file to use this option).</span>
<span class="sd">    You must provide valid specimens and sites files, and either a samples or an ages file.</span>
<span class="sd">    You may additionally provide measurements and a summary file (csv).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        spec_file (str): default &quot;specimens.txt&quot;</span>
<span class="sd">        samp_file (str): default &quot;samples.txt&quot;</span>
<span class="sd">        meas_file (str): default &quot;measurements.txt&quot;</span>
<span class="sd">        site_file (str): default &quot;sites.txt&quot;</span>
<span class="sd">        age_file (str): default &quot;&quot;</span>
<span class="sd">        sum_file (str): default &quot;&quot;</span>
<span class="sd">        fmt (str): str, default &quot;svg&quot;</span>
<span class="sd">            format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">        dmin (number): default -1</span>
<span class="sd">            minimum depth to plot (if -1, default to plotting all)</span>
<span class="sd">        dmax (number): default -1</span>
<span class="sd">            maximum depth to plot (if -1, default to plotting all)</span>
<span class="sd">        depth_scale (str): default &quot;core_depth&quot;</span>
<span class="sd">            scale to plot, [&#39;composite_depth&#39;, &#39;core_depth&#39;, &#39;age&#39;].</span>
<span class="sd">            if &#39;age&#39; is selected, you must provide an ages file.</span>
<span class="sd">        dir_path (str): default &quot;.&quot;</span>
<span class="sd">            directory for input files</span>
<span class="sd">        contribution : cb.Contribution, default None</span>
<span class="sd">            if provided, use Contribution object instead of reading in</span>
<span class="sd">            data from files</span>

<span class="sd">    Returns:</span>
<span class="sd">        plot </span>
<span class="sd">            matplotlib plot, or False if no plot could be created</span>
<span class="sd">        name </span>
<span class="sd">            figure name, or error message if no plot could be created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;sample_core_depth&#39;</span><span class="p">:</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;core_depth&#39;</span>
    <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;sample_composite_depth&#39;</span><span class="p">:</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;composite_depth&#39;</span>

    <span class="n">pcol</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">tint</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

    <span class="c1"># if contribution object is not provided, read in data from files</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">):</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># format files to use full path</span>
        <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">spec_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">site_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">site_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">age_file</span><span class="p">:</span>
            <span class="n">age_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">age_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">age_file</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Warning: you have provided an invalid age file.  Attempting to use sample file instead&#39;</span><span class="p">)</span>
                <span class="n">age_file</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;core_depth&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">samp_file</span> <span class="o">=</span> <span class="n">age_file</span>
                <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Warning: you have provided an ages format file, which will take precedence over samples&#39;</span><span class="p">)</span>

        <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="n">sum_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">sum_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
            <span class="n">core_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sum_file</span><span class="p">)</span>
            <span class="n">depths</span><span class="o">=</span><span class="n">core_df</span><span class="p">[</span><span class="s1">&#39;Top depth cored CSF (m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># contribution</span>

        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">]</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="n">tables</span><span class="p">,</span>
                              <span class="n">custom_filenames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="n">meas_file</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">spec_file</span><span class="p">,</span>
                                                <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="n">site_file</span><span class="p">})</span>



    <span class="k">for</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ftype</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">):</span>
                    <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
                    <span class="k">continue</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- This function requires a </span><span class="si">{}</span><span class="s2"> file to run.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ftype</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Make sure you include one in your working directory&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;missing required file type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ftype</span><span class="p">)</span>


    <span class="c1"># propagate needed values</span>
    <span class="n">con</span><span class="o">.</span><span class="n">propagate_cols</span><span class="p">([</span><span class="s1">&#39;core_depth&#39;</span><span class="p">],</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>

    <span class="c1"># get data read in</span>
    <span class="n">isbulk</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># tests if there are bulk susceptibility measurements</span>
    <span class="n">ani_file</span> <span class="o">=</span> <span class="n">spec_file</span>

    <span class="n">SampData</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
    <span class="n">AniData</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
    <span class="c1"># add sample into specimens (AniData)</span>
    <span class="n">AniData</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">AniData</span><span class="p">,</span> <span class="n">SampData</span><span class="p">[[</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span>
    <span class="c1"># trim down AniData</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">AniData</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">AniData</span> <span class="o">=</span> <span class="n">AniData</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dmin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">AniData</span> <span class="o">=</span> <span class="n">AniData</span><span class="p">[</span><span class="n">AniData</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dmax</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">AniData</span> <span class="o">=</span> <span class="n">AniData</span><span class="p">[</span><span class="n">AniData</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dmin</span><span class="p">]</span>
    <span class="n">AniData</span><span class="p">[</span><span class="s1">&#39;core_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AniData</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">age_file</span><span class="p">:</span>
        <span class="n">Samps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">add_magic_table</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">age_file</span><span class="p">)</span>
        <span class="n">Samps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
        <span class="c1"># get age unit</span>
        <span class="n">age_unit</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age_unit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># propagate ages down to sample level</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">Samps</span><span class="p">:</span>
        <span class="c1"># change to upper case for every sample name</span>
        <span class="n">s</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;measurements&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="n">isbulk</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Meas</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>  <span class="c1"># convert_to_pmag_data_list()</span>

    <span class="k">if</span> <span class="n">isbulk</span><span class="p">:</span>
        <span class="n">Meas</span> <span class="o">=</span> <span class="n">Meas</span><span class="p">[</span><span class="n">Meas</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)]</span>
        <span class="n">Meas</span> <span class="o">=</span> <span class="n">Meas</span><span class="p">[</span><span class="n">Meas</span><span class="p">[</span><span class="s1">&#39;susc_chi_volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
        <span class="c1"># add core_depth into Measurements dataframe</span>
        <span class="n">Meas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">Meas</span><span class="p">[[</span><span class="s1">&#39;susc_chi_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">]],</span> <span class="n">AniData</span><span class="p">[[</span>
                        <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="s1">&#39;core_depth&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;specimen&#39;</span><span class="p">)</span>
        <span class="n">Bulks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Meas</span><span class="p">[</span><span class="s1">&#39;susc_chi_volume&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">BulkDepths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Meas</span><span class="p">[</span><span class="s1">&#39;core_depth&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Bulks</span><span class="p">,</span> <span class="n">BulkDepths</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="c1"># now turn Data from pandas dataframe to a list of dicts</span>
    <span class="n">Data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">AniData</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">dict</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># set min and max bulk values</span>
        <span class="n">bmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span>
        <span class="n">bmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span>
    <span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Depth (m)&quot;</span>

    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;no data to plot&#39;</span>

    <span class="c1"># collect the data for plotting tau  V3_inc and V1_dec</span>
    <span class="n">Depths</span><span class="p">,</span> <span class="n">Tau1</span><span class="p">,</span> <span class="n">Tau2</span><span class="p">,</span> <span class="n">Tau3</span><span class="p">,</span> <span class="n">V3Incs</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">V1Decs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">F23s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Axs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collect the plot ids</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bulks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pcol</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">Data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;not_null&#39;</span><span class="p">)</span>
    <span class="c1"># get all the s1 values from Data as floats</span>
    <span class="n">aniso_s</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">aniso_s</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="c1">#print(&#39;aniso_s&#39;, aniso_s)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="n">s4</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="n">s5</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="n">s6</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aniso_s</span><span class="p">]</span>
    <span class="c1"># we are good with s1 - s2</span>
    <span class="n">nmeas</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">Depths</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictkey</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="c1"># Ss=np.array([s1,s4,s5,s4,s2,s6,s5,s6,s3]).transpose() # make an array</span>
    <span class="n">Ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s6</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># make an array</span>
    <span class="c1"># Ts=np.reshape(Ss,(len(Ss),3,-1)) # and re-shape to be n-length array of</span>
    <span class="c1"># 3x3 sub-arrays</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)):</span>
        <span class="c1"># tau,Evecs= pmag.tauV(Ts[k]) # get the sorted eigenvalues and eigenvectors</span>
        <span class="c1"># v3=pmag.cart2dir(Evecs[2])[1] # convert to inclination of the minimum</span>
        <span class="c1"># eigenvector</span>
        <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nmeas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span> <span class="n">sigma</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Ss</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">V3Incs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
        <span class="n">V1Decs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
        <span class="n">Tau1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">])</span>
        <span class="n">Tau2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">])</span>
        <span class="n">Tau3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">])</span>
        <span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tau1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Tau3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">F23s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F23&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span>
        <span class="n">tau_min</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tau3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tau_min</span><span class="p">:</span>
                <span class="n">tau_min</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">tau_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Tau1</span><span class="p">)</span>
        <span class="c1"># tau_min=min(Tau3)</span>
        <span class="n">P_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="n">P_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="c1"># dmax=dmax+.05*dmax</span>
        <span class="c1"># dmin=dmin-.05*dmax</span>

        <span class="n">main_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>  <span class="c1"># make the figure</span>
        <span class="c1"># main_plot = plt.figure(1, figsize=(10, 8))  # make the figure</span>

        <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">.02</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="n">version_num</span><span class="p">)</span>  <span class="c1"># attach the pmagpy version number</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># make the first column</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau1</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau2</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;b^&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tau3</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tau_min</span><span class="o">&gt;</span><span class="mf">.3</span><span class="p">:</span> <span class="n">tau_min</span><span class="o">=</span><span class="mf">.3</span>
        <span class="k">if</span> <span class="n">tau_max</span><span class="o">&lt;</span><span class="mf">.36</span><span class="p">:</span> <span class="n">tau_max</span><span class="o">=</span><span class="mf">.36</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">tau_min</span><span class="p">,</span> <span class="n">tau_max</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Eigenvalues&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;core_depth&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (mbsf)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Age (&#39;</span> <span class="o">+</span> <span class="n">age_unit</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (mcd)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># make the second column</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">P_min</span><span class="p">,</span> <span class="n">P_max</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V3Incs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;V3 Inclination&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pcol</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax4</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V1Decs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;rs&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;V1 Declination&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="c1"># ax5=plt.subplot(1,np.abs(pcol),5)</span>
        <span class="c1"># Axs.append(ax5)</span>
        <span class="c1"># ax5.plot(F23s,Depths,&#39;rs&#39;)</span>
        <span class="c1"># bounds=ax5.axis()</span>
        <span class="c1"># ax5.axis([bounds[0],bounds[1],dmax,dmin])</span>
        <span class="c1"># ax5.set_xlabel(&#39;F_23&#39;)</span>
        <span class="c1"># ax5.semilogx()</span>
        <span class="c1"># if sum_file:</span>
        <span class="c1">#    for core in Cores:</span>
        <span class="c1">#         depth=float(core[core_depth_key])</span>
        <span class="c1">#         if depth&gt;=dmin and depth&lt;=dmax:</span>
        <span class="c1">#            plt.plot([bounds[0],bounds[1]],[depth,depth],&#39;b--&#39;)</span>
        <span class="c1">#            if pcol==5 and label==1:plt.text(bounds[1],depth+tint,core[core_label_key])</span>
        <span class="c1"># if pcol==6:</span>
        <span class="k">if</span> <span class="n">pcol</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># ax6=plt.subplot(1,pcol,6)</span>
            <span class="n">ax6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">Axs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax6</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bulks</span><span class="p">,</span> <span class="n">BulkDepths</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">bmin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">bmax</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Bulk Susc. (uSI)&#39;</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depths</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Axs</span><span class="p">:</span>
            <span class="c1"># this makes the x-tick labels more reasonable - they were</span>
            <span class="c1"># overcrowded using the defaults</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">delticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_ani_depthplot.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
        <span class="k">return</span> <span class="n">main_plot</span><span class="p">,</span> <span class="p">[</span><span class="n">fig_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No data to plot&quot;</span></div>

<div class="viewcode-block" id="core_depthplot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.core_depthplot">[docs]</a><span class="k">def</span> <span class="nf">core_depthplot</span><span class="p">(</span><span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">meas_file</span><span class="o">=</span><span class="s1">&#39;measurements.txt&#39;</span><span class="p">,</span> <span class="n">spc_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                   <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">age_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sum_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">wt_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                   <span class="n">depth_scale</span><span class="o">=</span><span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span>
                   <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">spc_sym</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">spc_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">meth</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span>
                   <span class="n">pltDec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pltInc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pltMag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pltLine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pltSus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">logit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltTime</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">amax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_model_num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    depth scale can be &#39;core_depth&#39; or &#39;composite_depth&#39; (for data model=3)</span>
<span class="sd">    if age file is provided, depth_scale will be set to &#39;age&#39; by default.</span>
<span class="sd">    You must provide at least a measurements,specimens and sample file to plot.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        input_dir_path : str, default &quot;.&quot;</span>
<span class="sd">            file input directory</span>
<span class="sd">        meas_file : str, default &quot;measurements.txt&quot;</span>
<span class="sd">            input measurements file</span>
<span class="sd">        spc_file : str, default &quot;&quot;</span>
<span class="sd">            input specimens file</span>
<span class="sd">        samp_file : str, default &quot;&quot;</span>
<span class="sd">            input samples file</span>
<span class="sd">        age_file : str, default &quot;&quot;</span>
<span class="sd">            input ages file</span>
<span class="sd">        sum_file : str, default &quot;&quot;</span>
<span class="sd">            input csv summary file</span>
<span class="sd">        wt_file : str, default &quot;&quot;</span>
<span class="sd">            input file with weights</span>
<span class="sd">        depth_scale : str, default &quot;core_depth&quot;</span>
<span class="sd">            [&#39;core_depth&#39;, &#39;composite_depth&#39;]</span>
<span class="sd">        dmin : number, default -1</span>
<span class="sd">            minimum depth to plot (if -1, default to plotting all)</span>
<span class="sd">        dmax : number, default -1</span>
<span class="sd">            maximum depth to plot (if -1, default to plotting all)</span>
<span class="sd">        sym : str, default &quot;bo&quot;</span>
<span class="sd">            symbol color and shape, default blue circles</span>
<span class="sd">            (see matplotlib documentation for more options)</span>
<span class="sd">        size : int, default 5</span>
<span class="sd">            symbol size</span>
<span class="sd">        spc_sym : str, default &#39;ro&#39;</span>
<span class="sd">            specimen symbol color and shape, default red circles</span>
<span class="sd">            (see matplotlib documentation for more options)</span>
<span class="sd">        meth : str, default &quot;&quot;</span>
<span class="sd">            method codes, [&quot;LT-NO&quot;, &quot;AF&quot;, &quot;T&quot;, &quot;ARM&quot;, &quot;IRM&quot;, &quot;X&quot;]</span>
<span class="sd">        step : int, default 0</span>
<span class="sd">            treatment step for plotting:</span>
<span class="sd">                for AF, in mT, for T, in C</span>
<span class="sd">        fmt : str, default &quot;svg&quot;</span>
<span class="sd">            format for figures, [svg,jpg,png,pdf]</span>
<span class="sd">        pltDec : bool, default True</span>
<span class="sd">            plot declination</span>
<span class="sd">        pltInc : bool, default True</span>
<span class="sd">            plot inclination</span>
<span class="sd">        pltMag : bool, default True</span>
<span class="sd">            plot magnetization</span>
<span class="sd">        pltLine : bool, default True</span>
<span class="sd">            connect dots with a line</span>
<span class="sd">        pltSus : bool, default True</span>
<span class="sd">            plot blanket treatment</span>
<span class="sd">        logit : bool, default False</span>
<span class="sd">            plot magnetization on a log scale</span>
<span class="sd">        amin : int, default -1</span>
<span class="sd">            minimum time to plot (if -1, default to plotting all)</span>
<span class="sd">        amax : int, default -1</span>
<span class="sd">            maximum time to plot (if -1, default to plotting all)</span>
<span class="sd">        norm : bool, default False</span>
<span class="sd">            normalize by weight</span>
<span class="sd">        data_model_num : int, default 3</span>
<span class="sd">            MagIC data model (please, use data model 3)</span>

<span class="sd">    Returns:</span>
<span class="sd">            main_plot, figname </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_model_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_model_num</span><span class="p">)</span>
    <span class="c1"># replace MagIC 3 defaults with MagIC 2.5 defaults if needed</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">meas_file</span> <span class="o">==</span> <span class="s1">&#39;measurements.txt&#39;</span><span class="p">:</span>
        <span class="n">meas_file</span> <span class="o">=</span> <span class="s1">&#39;magic_measurements.txt&#39;</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">samp_file</span> <span class="o">==</span> <span class="s1">&#39;samples.txt&#39;</span><span class="p">:</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="s1">&#39;er_samples.txt&#39;</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">age_file</span> <span class="o">==</span> <span class="s1">&#39;ages.txt&#39;</span><span class="p">:</span>
        <span class="n">age_file</span> <span class="o">=</span> <span class="s1">&#39;er_ages.txt&#39;</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s2">&quot;core_depth&quot;</span><span class="p">:</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s2">&quot;sample_core_depth&quot;</span>
    <span class="c1"># initialize MagIC 3.0 vs 2.5 column names</span>
    <span class="n">loc_col_name</span> <span class="o">=</span> <span class="s2">&quot;location&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;er_location_name&quot;</span>
    <span class="n">site_col_name</span> <span class="o">=</span> <span class="s2">&quot;site&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;er_site_name&quot;</span>
    <span class="n">samp_col_name</span> <span class="o">=</span> <span class="s2">&quot;sample&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;er_sample_name&quot;</span>
    <span class="n">spec_col_name</span> <span class="o">=</span> <span class="s2">&quot;specimen&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;er_specimen_name&quot;</span>
    <span class="n">meth_col_name</span> <span class="o">=</span> <span class="s2">&quot;method_codes&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;magic_method_codes&quot;</span>
    <span class="n">spec_dec_col_name</span> <span class="o">=</span> <span class="s2">&quot;dir_dec&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;specimen_dec&quot;</span>
    <span class="n">spec_inc_col_name</span> <span class="o">=</span> <span class="s2">&quot;dir_inc&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;specimen_inc&quot;</span>
    <span class="n">avg_weight_col_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;average_weight&quot;</span>
    <span class="n">spec_weight_col_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;specimen_weight&quot;</span>
    <span class="n">age_col_name</span> <span class="o">=</span> <span class="s2">&quot;age&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;average_age&quot;</span>
    <span class="n">height_col_name</span> <span class="o">=</span> <span class="s2">&quot;height&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;average_height&quot;</span>
    <span class="n">average_dec_col_name</span> <span class="o">=</span> <span class="s2">&quot;dir_dec&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;average_dec&quot;</span>
    <span class="n">average_inc_col_name</span> <span class="o">=</span> <span class="s2">&quot;dir_inc&quot;</span> <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;average_inc&quot;</span>
    <span class="c1"># initialize other variables</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Ssym</span><span class="p">,</span> <span class="n">Ssize</span> <span class="o">=</span> <span class="s1">&#39;cs&#39;</span><span class="p">,</span> <span class="mi">5</span>
    <span class="n">pcol</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">pel</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">maxInt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
    <span class="n">minInt</span> <span class="o">=</span> <span class="mf">1e10</span>
    <span class="n">maxSuc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
    <span class="n">minSuc</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">main_plot</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spc_size</span><span class="p">:</span>
        <span class="n">spc_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spc_size</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span><span class="p">:</span><span class="n">title</span><span class="o">=</span><span class="n">location</span>

    <span class="c1"># file formats not supported for the moment</span>
    <span class="n">ngr_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># nothing needed, not implemented fully in original script</span>
    <span class="n">suc_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># nothing else needed, also was not implemented in original script</span>
    <span class="n">res_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># need also res_sym, res_size</span>
    <span class="n">wig_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># if wig_file: pcol+=1; width+=2</span>

    <span class="c1"># which plots to make</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pltDec</span><span class="p">:</span>
        <span class="n">pcol</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">pel</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pltInc</span><span class="p">:</span>
        <span class="n">pcol</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">pel</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pltMag</span><span class="p">:</span>
        <span class="n">pcol</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">pel</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>

    <span class="c1"># method and step</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">or</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;LT-NO&#39;</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LT-NO&#39;</span>
    <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s2">&quot;AF&quot;</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LT-AF-Z&#39;</span>
    <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LT-T-Z&#39;</span>
    <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;ARM&#39;</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LT-AF-I&#39;</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;IRM&#39;</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LT-IRM&#39;</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="c1"># not supporting susceptibility at the moment LJ</span>
    <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LP-X&#39;</span>
        <span class="n">pcol</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;-LP&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">suc_key</span> <span class="o">=</span> <span class="s1">&#39;measurement_chi_mass&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">suc_key</span> <span class="o">=</span> <span class="s1">&#39;susc_chi_mass&#39;</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vol&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">suc_key</span> <span class="o">=</span> <span class="s1">&#39;measurement_chi_volume&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">suc_key</span> <span class="o">=</span> <span class="s1">&#39;susc_chi_volume&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error in susceptibility units&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error in susceptibility units&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;method: </span><span class="si">{}</span><span class="s1"> not supported&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;method: &quot;</span><span class="si">{}</span><span class="s1">&quot; not supported&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wt_file</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">dmax</span><span class="p">:</span>
        <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">pltTime</span><span class="p">:</span>
        <span class="n">amin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amin</span><span class="p">)</span>
        <span class="n">amax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amax</span><span class="p">)</span>
        <span class="n">pcol</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">width</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">amax</span> <span class="ow">and</span> <span class="n">timescale</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;To plot time, you must provide amin, amax, and timescale&quot;</span>

    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># read in 3.0 data and translate to 2.5</span>

    <span class="k">if</span> <span class="n">meas_file</span><span class="p">:</span>
        <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spc_file</span><span class="p">:</span>
        <span class="n">spc_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">spc_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">samp_file</span><span class="p">:</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">age_file</span><span class="p">:</span>
        <span class="n">age_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">age_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">spc_file</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span>
                  <span class="s1">&#39;ages&#39;</span><span class="p">:</span> <span class="n">age_file</span><span class="p">,</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="n">meas_file</span><span class="p">}</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fnames</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;-E- You must have a </span><span class="si">{}</span><span class="s1"> file in your input directory (</span><span class="si">{}</span><span class="s1">) to run core_depthplot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    If needed, you can specify your input directory on the command line with &quot;core_depthplot.py -ID dirname ... &quot;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Or with ipmag.core_depthplot(input_dir_path=dirname, ...)&#39;</span><span class="p">)</span>
                <span class="c1"># return False, &#39;-E- You must have a {} file in your input directory ({}) to run core_depthplot&#39;.format(dtype, input_dir_path)</span>
        <span class="c1"># propagate data to measurements</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_name_down</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;measurements&#39;</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_name_down</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;measurements&#39;</span><span class="p">)</span>

        <span class="c1"># propagate depth info from sites --&gt; samples</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_cols</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;composite_depth&#39;</span><span class="p">],</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">)</span>
        <span class="c1"># propagate depth info from samples-&gt; specimens</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_cols</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;composite_depth&#39;</span><span class="p">],</span> <span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">age_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># get sample data straight from the contribution</span>
            <span class="n">Samps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;samples&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">Samps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
            <span class="n">Samps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># get age data from contribution</span>
            <span class="k">if</span> <span class="s1">&#39;ages&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="c1"># we need to get sample in here</span>
                <span class="c1"># this doesn&#39;t do the trick by itself</span>
                <span class="n">con</span><span class="o">.</span><span class="n">propagate_ages</span><span class="p">()</span>
                <span class="n">con</span><span class="o">.</span><span class="n">propagate_cols</span><span class="p">([</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">],</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">)</span>
                <span class="n">Samps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
            <span class="n">age_unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">spc_file</span><span class="p">:</span>
            <span class="n">Specs3</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># get specimen data from contribution</span>
            <span class="n">Specs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;specimens&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">Specs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">res_file</span><span class="p">:</span>
            <span class="n">warn</span> <span class="o">=</span> <span class="s1">&#39;-W- result file option is not currently available for MagIC data model 3&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">warn</span>
            <span class="c1">#Results, file_type = pmag.magic_read(res_file)</span>
        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
            <span class="c1">#warn = &#39;-W- norm option is not currently available for MagIC data model 3&#39;</span>
            <span class="c1"># print(warn)</span>
            <span class="c1"># return False, warn</span>
            <span class="n">Specs3</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">wt_file</span><span class="p">)</span>
            <span class="c1"># translate specimen records to 2.5</span>
            <span class="n">ErSpecs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># for spec in Specs3:</span>
            <span class="c1">#    ErSpecs.append(map_magic.mapping(spec, spec_magic3_2_magic2_map))</span>
            <span class="n">ErSpecs</span> <span class="o">=</span> <span class="n">Specs3</span>

            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ErSpecs</span><span class="p">),</span> <span class="s1">&#39; specimens read in from &#39;</span><span class="p">,</span> <span class="n">wt_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">spc_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">meas_file</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;You must provide either a magic_measurements file or a pmag_specimens file&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">age_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">samp_file</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- You must provide either an age file or a sample file&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;-W- You must provide either an age file or a sample file&#39;</span>

    <span class="c1"># read in 2.5 data</span>
    <span class="k">elif</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">age_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">samp_file</span><span class="p">:</span>
                <span class="n">samp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">)</span>
            <span class="n">Samps</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span>
            <span class="k">if</span> <span class="n">age_file</span><span class="p">:</span>
                <span class="n">age_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">age_file</span><span class="p">)</span>
            <span class="n">Samps</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">age_file</span><span class="p">)</span>
            <span class="n">age_unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">spc_file</span><span class="p">:</span>
            <span class="n">Specs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">spc_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="p">:</span>
            <span class="n">Results</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">res_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
            <span class="n">ErSpecs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">wt_file</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ErSpecs</span><span class="p">),</span> <span class="s1">&#39; specimens read in from &#39;</span><span class="p">,</span> <span class="n">wt_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">spc_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">meas_file</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;You must provide either a magic_measurements file or a pmag_specimens file&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Invalid data model number: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_model_num</span><span class="p">))</span>

    <span class="n">Cores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span>
    <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
        <span class="c1"># os.path.join(input_dir_path, sum_file)</span>
        <span class="n">sum_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">sum_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sum_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="n">indat</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Core Summary&quot;</span> <span class="ow">in</span> <span class="n">indat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">indat</span><span class="p">[</span><span class="n">headline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Core Top (m)&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s2">&quot;Core Top (m)&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_dpeth_key</span> <span class="o">=</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Core Label&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_label_key</span> <span class="o">=</span> <span class="s2">&quot;Core Label&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Core label&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_label_key</span> <span class="o">=</span> <span class="s2">&quot;Core label&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">indat</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="s1">&#39;TOTALS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">CoreRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                    <span class="n">CoreRec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">Cores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CoreRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Cores</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no Core depth information available: import core summary file&#39;</span><span class="p">)</span>
            <span class="n">sum_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">Data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s1">&#39;core_depth&#39;</span> <span class="ow">in</span> <span class="n">depth_scale</span> <span class="ow">or</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;mbsf&#39;</span><span class="p">:</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Depth (mbsf)&quot;</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;core_depth&#39;</span>
    <span class="k">elif</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Age&quot;</span>
    <span class="k">elif</span> <span class="s1">&#39;composite_depth&#39;</span> <span class="ow">in</span> <span class="n">depth_scale</span> <span class="ow">or</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;mcd&#39;</span><span class="p">:</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Depth (mcd)&quot;</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;composite_depth&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: You have provided unsupported depth scale: </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">Using default (mbsf) instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">depth_scale</span><span class="p">))</span>
        <span class="n">depth_scale</span> <span class="o">=</span> <span class="s1">&#39;core_depth&#39;</span>
        <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Depth (mbsf)&quot;</span>
    <span class="c1"># fix depth scale for data model 2 if needed</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">depth_scale</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sample_&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">!=</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span>
            <span class="n">depth_scale</span> <span class="o">=</span> <span class="s2">&quot;sample_&quot;</span> <span class="o">+</span> <span class="n">depth_scale</span>
    <span class="c1"># collect the data for plotting declination</span>
    <span class="n">Depths</span><span class="p">,</span> <span class="n">Decs</span><span class="p">,</span> <span class="n">Incs</span><span class="p">,</span> <span class="n">Ints</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SDepths</span><span class="p">,</span> <span class="n">SDecs</span><span class="p">,</span> <span class="n">SIncs</span><span class="p">,</span> <span class="n">SInts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SSucs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">methods</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">meas_file</span><span class="p">):</span>  <span class="c1"># plot the bulk measurement data</span>
        <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">Meas</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;measurements&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">Meas</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
            <span class="c1"># has measurement_magn_mass ....</span>
            <span class="n">dec_key</span><span class="p">,</span> <span class="n">inc_key</span> <span class="o">=</span> <span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span>
            <span class="n">meth_key</span><span class="p">,</span> <span class="n">temp_key</span><span class="p">,</span> <span class="n">ac_key</span><span class="p">,</span> <span class="n">dc_key</span> <span class="o">=</span> <span class="s1">&#39;method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_ac_field&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_dc_field&#39;</span>
            <span class="n">intlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_mass&#39;</span><span class="p">]</span>
            <span class="n">meas_key</span> <span class="o">=</span> <span class="s2">&quot;magn_moment&quot;</span>
        <span class="k">elif</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">intlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;measurement_magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_magn_moment&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;measurement_magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_magn_mass&#39;</span><span class="p">]</span>
            <span class="n">temp_key</span><span class="p">,</span> <span class="n">ac_key</span><span class="p">,</span> <span class="n">dc_key</span> <span class="o">=</span> <span class="s1">&#39;treatment_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_ac_field&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_dc_field&#39;</span>
            <span class="n">dec_key</span><span class="p">,</span> <span class="n">inc_key</span> <span class="o">=</span> <span class="s1">&#39;measurement_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_inc&#39;</span>
            <span class="n">Meas</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
            <span class="n">meas_key</span> <span class="o">=</span> <span class="s1">&#39;measurement_magn_moment&#39;</span>
        <span class="c1">#</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Meas</span><span class="p">),</span> <span class="s1">&#39; measurements read in from &#39;</span><span class="p">,</span> <span class="n">meas_file</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">intlist</span><span class="p">:</span>  <span class="c1"># find the intensity key with data</span>
            <span class="c1"># get all non-blank data for this specimen</span>
            <span class="n">meas_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Meas</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meas_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using intensity key:&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">meas_key</span> <span class="o">=</span> <span class="n">m</span>
                <span class="k">break</span>
        <span class="c1"># fish out the desired method code</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Meas</span><span class="p">,</span> <span class="n">meth_col_name</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;LT-T-Z&#39;</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">temp_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">step</span><span class="p">),</span> <span class="s1">&#39;eval&#39;</span><span class="p">)</span>  <span class="c1"># fish out the desired step</span>
        <span class="k">elif</span> <span class="s1">&#39;LT-AF&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">ac_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="s1">&#39;eval&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;LT-IRM&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">dc_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="s1">&#39;eval&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;LP-X&#39;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">suc_key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">m2</span><span class="p">:</span>  <span class="c1"># fish out depths and weights</span>
                <span class="n">D</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">Samps</span><span class="p">,</span> <span class="n">samp_col_name</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">samp_col_name</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">D</span><span class="p">:</span>  <span class="c1"># if using an age_file, you may need to sort by site</span>
                    <span class="n">D</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">Samps</span><span class="p">,</span> <span class="n">site_col_name</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">site_col_name</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ylab</span> <span class="o">==</span> <span class="s1">&#39;Age&#39;</span><span class="p">:</span>
                        <span class="c1"># get units of ages - assume they are all the same!</span>
                        <span class="n">ylab</span> <span class="o">=</span> <span class="n">ylab</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">depth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;age_unit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

                    <span class="n">rec</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">depth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">])</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">meth_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">meth_col_name</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">depth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">meth_col_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
                        <span class="n">specrecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">ErSpecs</span><span class="p">,</span> <span class="n">spec_col_name</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">spec_col_name</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                        <span class="n">specwts</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">specrecs</span><span class="p">,</span> <span class="n">spec_weight_col_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specwts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rec</span><span class="p">[</span><span class="n">weight_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">specwts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">spec_weight_col_name</span><span class="p">]</span>
                            <span class="c1"># fish out data with core_depth and (if needed)</span>
                            <span class="c1"># weights</span>
                            <span class="n">Data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># fish out data with core_depth and (if needed) weights</span>
                        <span class="n">Data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">pieces</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">samp_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">loc_col_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">location</span>

        <span class="n">SData</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sort_diclist</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">depth_scale</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SData</span><span class="p">:</span>  <span class="c1"># fish out bulk measurement data from desired depths</span>
            <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dmax</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">dmin</span><span class="p">:</span>
                <span class="n">Depths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="p">[</span><span class="n">depth_scale</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;LP-X&quot;</span><span class="p">:</span>
                    <span class="n">SSucs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">suc_key</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pltDec</span><span class="p">:</span>
                        <span class="n">Decs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dec_key</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">pltInc</span><span class="p">:</span>
                        <span class="n">Incs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">inc_key</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">norm</span> <span class="ow">and</span> <span class="n">pltMag</span><span class="p">:</span>
                        <span class="n">Ints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">meas_key</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">norm</span> <span class="ow">and</span> <span class="n">pltMag</span><span class="p">:</span>
                        <span class="n">Ints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">meas_key</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">spec_weight_col_name</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SSucs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">maxSuc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">SSucs</span><span class="p">)</span>
                <span class="n">minSuc</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">SSucs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">maxInt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span>
                <span class="n">minInt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no bulk measurement data matched your request&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">),</span> <span class="s2">&quot;depths found&quot;</span><span class="p">)</span>
    <span class="n">SpecDepths</span><span class="p">,</span> <span class="n">SpecDecs</span><span class="p">,</span> <span class="n">SpecIncs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">FDepths</span><span class="p">,</span> <span class="n">FDecs</span><span class="p">,</span> <span class="n">FIncs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">spc_file</span><span class="p">:</span>  <span class="c1"># add depths to spec data</span>
        <span class="c1"># get all the discrete data with best fit lines</span>
        <span class="n">BFLs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Specs</span><span class="p">,</span> <span class="n">meth_col_name</span><span class="p">,</span> <span class="s1">&#39;DE-BFL&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">BFLs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">loc_col_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">samp</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">Samps</span><span class="p">,</span> <span class="n">samp_col_name</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="n">samp_col_name</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">depth_scale</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ylab</span> <span class="o">==</span> <span class="s1">&#39;Age&#39;</span><span class="p">:</span>
                    <span class="c1"># get units of ages - assume they are all the same!</span>
                    <span class="n">ylab</span> <span class="o">=</span> <span class="n">ylab</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;age_unit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="c1"># filter for depth</span>
                <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dmax</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">dmin</span><span class="p">:</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">SpecDepths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">SpecDecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">spec_dec_col_name</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">SpecIncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">spec_inc_col_name</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no core_depth found for: &#39;</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="n">spec_col_name</span><span class="p">])</span>
        <span class="c1"># get all the discrete data with best fit lines</span>
        <span class="n">FMs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Specs</span><span class="p">,</span> <span class="n">meth_col_name</span><span class="p">,</span> <span class="s1">&#39;DE-FM&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">FMs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">loc_col_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">samp</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">Samps</span><span class="p">,</span> <span class="n">samp_col_name</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="n">samp_col_name</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">depth_scale</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ylab</span> <span class="o">==</span> <span class="s1">&#39;Age&#39;</span><span class="p">:</span>
                    <span class="c1"># get units of ages - assume they are all the same!</span>
                    <span class="n">ylab</span> <span class="o">=</span> <span class="n">ylab</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;age_unit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="c1"># filter for depth</span>
                <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dmax</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">dmin</span><span class="p">:</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">FDepths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">samp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">depth_scale</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">FDecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">spec_dec_col</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">FIncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">spec_inc_col</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no core_depth found for: &#39;</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="n">spec_col_name</span><span class="p">])</span>
    <span class="n">ResDepths</span><span class="p">,</span> <span class="n">ResDecs</span><span class="p">,</span> <span class="n">ResIncs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">depth_scale</span><span class="p">:</span>  <span class="c1"># set y-key</span>
        <span class="n">res_scale</span> <span class="o">=</span> <span class="n">age_col_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res_scale</span> <span class="o">=</span> <span class="n">height_col_name</span>
    <span class="k">if</span> <span class="n">res_file</span><span class="p">:</span>  <span class="c1"># creates lists of Result Data</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">Results</span><span class="p">:</span>
            <span class="n">meths</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">meth_col_name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;DE-FM&#39;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="c1"># filter for depth</span>
                <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">res_scale</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dmax</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">res_scale</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">dmin</span><span class="p">:</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">ResDepths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">res_scale</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">ResDecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;average_dec&#39;</span><span class="p">]))</span>
                    <span class="c1"># fish out data with core_depth</span>
                    <span class="n">ResIncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;average_inc&#39;</span><span class="p">]))</span>
                    <span class="n">Susc</span><span class="p">,</span> <span class="n">Sus_depths</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="n">Depths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Depths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">FDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span> <span class="o">=</span> <span class="n">FDepths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FDepths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pltSus</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">SDepths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dmin</span><span class="p">:</span>
                <span class="n">dmin</span> <span class="o">=</span> <span class="n">SDepths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">SDepths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dmax</span><span class="p">:</span>
                <span class="n">dmax</span> <span class="o">=</span> <span class="n">SDepths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dmin</span><span class="p">:</span>
                <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dmax</span><span class="p">:</span>
                <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ResDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">ResDepths</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dmin</span><span class="p">:</span>
                <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ResDepths</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">ResDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dmax</span><span class="p">:</span>
                <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ResDepths</span><span class="p">)</span>
    <span class="c1"># wig_file and suc_file not currently supported options</span>
    <span class="c1"># if suc_file:</span>
    <span class="c1">#    with open(suc_file, &#39;r&#39;) as s_file:</span>
    <span class="c1">#        sucdat = s_file.readlines()</span>
    <span class="c1">#    keys = sucdat[0].replace(&#39;\n&#39;, &#39;&#39;).split(&#39;,&#39;)  # splits on underscores</span>
    <span class="c1">#    for line in sucdat[1:]:</span>
    <span class="c1">#        SucRec = {}</span>
    <span class="c1">#        for k in range(len(keys)):</span>
    <span class="c1">#            SucRec[keys[k]] = line.split(&#39;,&#39;)[k]</span>
    <span class="c1">#        if float(SucRec[&#39;Top Depth (m)&#39;]) &lt; dmax and float(SucRec[&#39;Top Depth (m)&#39;]) &gt; dmin and SucRec[&#39;Magnetic Susceptibility (80 mm)&#39;] != &quot;&quot;:</span>
    <span class="c1">#            Susc.append(float(SucRec[&#39;Magnetic Susceptibility (80 mm)&#39;]))</span>
    <span class="c1">#            if Susc[-1] &gt; maxSuc:</span>
    <span class="c1">#                maxSuc = Susc[-1]</span>
    <span class="c1">#            if Susc[-1] &lt; minSuc:</span>
    <span class="c1">#                minSuc = Susc[-1]</span>
    <span class="c1">#            Sus_depths.append(float(SucRec[&#39;Top Depth (m)&#39;]))</span>
    <span class="c1">#WIG, WIG_depths = [], []</span>
    <span class="c1"># if wig_file:</span>
    <span class="c1">#    wigdat, file_type = pmag.magic_read(wig_file)</span>
    <span class="c1">#    swigdat = pmag.sort_diclist(wigdat, depth_scale)</span>
    <span class="c1">#    keys = list(wigdat[0].keys())</span>
    <span class="c1">#    for key in keys:</span>
    <span class="c1">#        if key != depth_scale:</span>
    <span class="c1">#            plt_key = key</span>
    <span class="c1">#            break</span>
    <span class="c1">#    for wig in swigdat:</span>
    <span class="c1">#        if float(wig[depth_scale]) &lt; dmax and float(wig[depth_scale]) &gt; dmin:</span>
    <span class="c1">#            WIG.append(float(wig[plt_key]))</span>
    <span class="c1">#            WIG_depths.append(float(wig[depth_scale]))</span>
    <span class="n">tint</span> <span class="o">=</span> <span class="mf">4.5</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">#print(&#39;Decs&#39;, len(Decs))</span>
    <span class="c1">#print(&#39;Depths&#39;, len(Depths), &#39;SpecDecs&#39;, len(SpecDecs))</span>
    <span class="c1">#print(&#39;SpecDepths&#39;, len(SpecDepths), &#39;ResDecs&#39;, len(ResDecs))</span>
    <span class="c1">#print(&#39;ResDepths&#39;, len(ResDepths), &#39;SDecs&#39;, len(SDecs))</span>
    <span class="c1">#print(&#39;SDepths&#39;, len(SDepths), &#39;SIincs&#39;, len(SIncs))</span>
    <span class="c1">#print(&#39;Incs&#39;, len(Incs))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Decs</span> <span class="ow">and</span> <span class="n">Depths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">SpecDecs</span> <span class="ow">and</span> <span class="n">SpecDepths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ResDecs</span> <span class="ow">and</span> <span class="n">ResDepths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">SDecs</span> <span class="ow">and</span> <span class="n">SDepths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">SInts</span> <span class="ow">and</span> <span class="n">SDepths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">SIncs</span> <span class="ow">and</span> <span class="n">SDepths</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Incs</span> <span class="ow">and</span> <span class="n">Depths</span><span class="p">):</span>
        <span class="n">main_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># this works</span>
        <span class="c1"># pylab.figure(1,figsize=(width,8))</span>
        <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">.02</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="n">version_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pltDec</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pltLine</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Decs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Decs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Decs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Decs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pltLine</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SDecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SDecs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SDecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SDecs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">Ssym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">Ssize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">spc_file</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SpecDecs</span><span class="p">,</span> <span class="n">SpecDepths</span><span class="p">,</span> <span class="n">spc_sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">spc_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">spc_file</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">FDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">FDecs</span><span class="p">,</span> <span class="n">FDepths</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">spc_sym</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">spc_sym</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">spc_size</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res_file</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ResDecs</span><span class="p">,</span> <span class="n">ResDepths</span><span class="p">,</span> <span class="n">res_sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">res_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pel</span> <span class="o">==</span> <span class="n">plt</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">360</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="n">tint</span><span class="p">,</span> <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pel</span> <span class="o">==</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">delticks</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>  <span class="c1"># dec xticks are too crowded otherwise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no data!&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;No data found to plot</span><span class="se">\n</span><span class="s1">Try again with different parameters&#39;</span>
    <span class="k">if</span> <span class="n">pltInc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pltLine</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Incs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Incs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Incs</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Incs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pltLine</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SIncs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SIncs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SIncs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SIncs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">Ssym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">Ssize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spc_file</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SpecIncs</span><span class="p">,</span> <span class="n">SpecDepths</span><span class="p">,</span> <span class="n">spc_sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">spc_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spc_file</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">FDepths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">FIncs</span><span class="p">,</span> <span class="n">FDepths</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">spc_sym</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">spc_sym</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">spc_size</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res_file</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ResIncs</span><span class="p">,</span> <span class="n">ResDepths</span><span class="p">,</span> <span class="n">res_sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">res_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pel</span> <span class="o">==</span> <span class="n">plot</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="n">tint</span><span class="p">,</span> <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pel</span> <span class="o">==</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Inclination&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">plot</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">pltMag</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">pow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">maxInt</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)):</span>
                <span class="n">Ints</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ints</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)):</span>
                <span class="n">SInts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">SInts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span>
            <span class="k">if</span> <span class="n">pltLine</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pltLine</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SInts</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SInts</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">Ssym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">Ssize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxInt</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span> <span class="o">+</span> <span class="mf">.1</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">maxInt</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span> <span class="o">-</span> <span class="mf">.2</span> <span class="o">*</span> <span class="n">maxInt</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span>
                                 <span class="nb">pow</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="n">tint</span><span class="p">,</span> <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxInt</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="nb">pow</span> <span class="o">+</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">norm</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Intensity (10^-&#39;</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="s1">&#39; Am^2)&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Intensity (10^-&#39;</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="s1">&#39; Am^2/kg)&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pltLine</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">Depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pltLine</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">SInts</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pltLine</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">SInts</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">SInts</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">Ssym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">Ssize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">([</span><span class="n">minInt</span><span class="p">,</span> <span class="n">maxInt</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">dmin</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">dmax</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">maxInt</span> <span class="o">-</span> <span class="mf">.2</span> <span class="o">*</span> <span class="n">maxInt</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span>
                                 <span class="n">tint</span><span class="p">,</span> <span class="n">core</span><span class="p">[</span><span class="n">core_label_key</span><span class="p">])</span>
            <span class="n">minInt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">minInt</span><span class="p">,</span> <span class="n">maxInt</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">norm</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Intensity (Am^2)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Intensity (Am^2/kg)&#39;</span><span class="p">)</span>
        <span class="n">plot</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">suc_file</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">SSucs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Susc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pltLine</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Susc</span><span class="p">,</span> <span class="n">Sus_depths</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">logit</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Susc</span><span class="p">,</span> <span class="n">Sus_depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logit</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">Susc</span><span class="p">,</span> <span class="n">Sus_depths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SSucs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">logit</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SSucs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logit</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">SSucs</span><span class="p">,</span> <span class="n">SDepths</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sum_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">Cores</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">core_depth_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">logit</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">minSuc</span><span class="p">,</span> <span class="n">maxSuc</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">logit</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">([</span><span class="n">minSuc</span><span class="p">,</span> <span class="n">maxSuc</span><span class="p">],</span> <span class="p">[</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">minSuc</span><span class="p">,</span> <span class="n">maxSuc</span><span class="p">,</span> <span class="n">dmax</span><span class="p">,</span> <span class="n">dmin</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Susceptibility&#39;</span><span class="p">)</span>
        <span class="n">plot</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># if wig_file:</span>
    <span class="c1">#    plt.subplot(1, pcol, plot)</span>
    <span class="c1">#    plt.plot(WIG, WIG_depths, &#39;k&#39;)</span>
    <span class="c1">#    if sum_file:</span>
    <span class="c1">#        for core in Cores:</span>
    <span class="c1">#            depth = float(core[core_depth_key])</span>
    <span class="c1">#            plt.plot([WIG[0], WIG[-1]], [depth, depth], &#39;b--&#39;)</span>
    <span class="c1">#    plt.axis([min(WIG), max(WIG), dmax, dmin])</span>
    <span class="c1">#    plt.xlabel(plt_key)</span>
    <span class="c1">#    plot += 1</span>
    <span class="k">if</span> <span class="n">pltTime</span><span class="p">:</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="n">amin</span><span class="p">])</span>
        <span class="n">plot</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">TS</span><span class="p">,</span> <span class="n">Chrons</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_ts</span><span class="p">(</span><span class="n">timescale</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">amin</span> <span class="o">&lt;</span> <span class="n">TS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># in the Brunhes</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">amin</span><span class="p">,</span> <span class="n">amin</span><span class="p">]</span>  <span class="c1"># minimum age</span>
            <span class="n">Y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">TS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TS</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># age of the B/M boundary</span>
            <span class="c1"># color in Brunhes, black</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">TS</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">pol</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">%</span> <span class="mi">2</span>
            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">amax</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">amin</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">TS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">TS</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">TS</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">TS</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">TS</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">pol</span><span class="p">:</span>
                    <span class="c1"># fill in every other time</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">amin</span><span class="p">,</span> <span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="n">amin</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Age (Ma): &quot;</span> <span class="o">+</span> <span class="n">timescale</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Chrons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Chrons</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">cnext</span> <span class="o">=</span> <span class="n">Chrons</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">cnext</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">cnext</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">3.0</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">amin</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">amax</span><span class="p">:</span>
                <span class="c1"># make the Chron boundary tick</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="n">amin</span><span class="p">])</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_m:_&#39;</span> <span class="o">+</span> <span class="n">method</span> <span class="o">+</span> <span class="s1">&#39;_core-depthplot.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">main_plot</span><span class="p">,</span> <span class="n">figname</span></div>


<div class="viewcode-block" id="download_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.download_magic">[docs]</a><span class="k">def</span> <span class="nf">download_magic</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                   <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">data_model</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">separate_locs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">excel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    takes the name of a text file downloaded from the MagIC database and</span>
<span class="sd">    unpacks it into magic-formatted files. by default, download_magic assumes</span>
<span class="sd">    that you are doing everything in your current directory. if not, you may</span>
<span class="sd">    provide optional arguments dir_path (where you want the results to go) and</span>
<span class="sd">    input_dir_path (where the downloaded file is IF that location is different from</span>
<span class="sd">    dir_path).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        infile : str</span>
<span class="sd">            MagIC-format file to unpack</span>
<span class="sd">        dir_path : str</span>
<span class="sd">            output directory (default &quot;.&quot;)</span>
<span class="sd">        input_dir_path : str, default &quot;&quot;</span>
<span class="sd">            path for intput file if different from output_dir_path (default is same)</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            overwrite current directory (default False)</span>
<span class="sd">        print_progress: bool</span>
<span class="sd">            verbose output (default True)</span>
<span class="sd">        data_model : float</span>
<span class="sd">            MagIC data model 2.5 or 3 (default 3)</span>
<span class="sd">        separate_locs : bool</span>
<span class="sd">            create a separate directory for each location (Location_*)</span>
<span class="sd">            (default False)</span>
<span class="sd">        txt : str, default &quot;&quot;</span>
<span class="sd">            if infile is not provided, you may provide a string with file contents instead</span>
<span class="sd">            (useful for downloading MagIC file directly from earthref)</span>
<span class="sd">        excel : bool</span>
<span class="sd">            input file is an excel spreadsheet (as downloaded from MagIC)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mf">2.5</span><span class="p">:</span>
        <span class="n">method_col</span> <span class="o">=</span> <span class="s2">&quot;magic_method_codes&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">method_col</span> <span class="o">=</span> <span class="s2">&quot;method_codes&quot;</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">excel</span><span class="p">:</span>
            <span class="n">sheets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">,</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span><span class="s1">&#39;sites&#39;</span><span class="p">,</span><span class="s1">&#39;samples&#39;</span><span class="p">,</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;measurements&#39;</span><span class="p">,</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="s1">&#39;criteria&#39;</span><span class="p">,</span><span class="s1">&#39;images&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">sheets</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">table</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet</span><span class="p">)</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Column: &#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">table_dicts</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>
                    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">sheet</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                    <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">table_dicts</span><span class="p">,</span><span class="n">sheet</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;sheet not found &#39;</span><span class="p">,</span><span class="n">sheet</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># try to deal reasonably with unicode errors</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s2">&quot;Latin-1&quot;</span><span class="p">)</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">File</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># will contain all non-blank lines from downloaded file</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&gt;&gt;&gt;&#39;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># skip blank lines</span>
            <span class="n">File</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">LN</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># tracks our progress iterating through File</span>
    <span class="n">type_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filenum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">LN</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">File</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">File</span><span class="p">[</span><span class="n">LN</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;&gt;&gt;&gt;&gt;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file_type</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;working on: &#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">file_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_list</span><span class="p">:</span>
            <span class="n">type_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filenum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">File</span><span class="p">[</span><span class="n">LN</span><span class="p">]</span>
        <span class="c1"># skip empty tables</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="p">:</span>
            <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;RecNo&#39;</span><span class="p">)</span>  <span class="c1"># cludge for new MagIC download format</span>
        <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">LN</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">File</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">File</span><span class="p">[</span><span class="n">LN</span><span class="p">]</span>
            <span class="c1"># finish up one file type and then break</span>
            <span class="k">if</span> <span class="s2">&quot;&gt;&gt;&gt;&gt;&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Recs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filenum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">file_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">file_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filenum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                <span class="n">NewRecs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Recs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">method_col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">meths</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">method_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                                <span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span> <span class="o">+</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>  <span class="c1"># get rid of nasty spaces!!!!!!</span>
                            <span class="n">rec</span><span class="p">[</span><span class="n">method_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">NewRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">Recs</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot; data put in &quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
                <span class="n">Recs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="c1"># keep adding records of the same file type</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">Rec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)):</span>
                        <span class="n">Rec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">Recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rec</span><span class="p">)</span>
                <span class="c1"># in case of magic_search_results.txt, which has an extra</span>
                <span class="c1"># column:</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">Rec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">Recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rec</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)):</span>
                        <span class="n">Rec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                        <span class="n">Rec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">Recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rec</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING:  problem in file with line: &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping....&#39;</span><span class="p">)</span>
                <span class="n">LN</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Recs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filenum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">file_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">file_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filenum</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="n">NewRecs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Recs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method_col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">meths</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">method_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                        <span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span> <span class="o">+</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>  <span class="c1"># get rid of nasty spaces!!!!!!</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">method_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">NewRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">Recs</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot; data put in &quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="c1"># look through locations table and create separate directories for each</span>
    <span class="c1"># location</span>
    <span class="k">if</span> <span class="n">separate_locs</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_samples</span><span class="p">()</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">write_table_to_file</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">locnum</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;locations&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># at least one location</span>
            <span class="c1"># go through unique location names</span>
            <span class="k">for</span> <span class="n">loc_name</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">location_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">locnum</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">loc_name</span><span class="p">)</span>
                <span class="n">lpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Location_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">locnum</span><span class="p">))</span>
                <span class="n">locnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">lpath</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;directory &#39;</span><span class="p">,</span> <span class="n">lpath</span><span class="p">,</span>
                          <span class="s1">&#39; already exists - overwriting everything: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overwrite</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- download_magic encountered a duplicate subdirectory (</span><span class="si">{}</span><span class="s2">) and could not finish.</span><span class="se">\n</span><span class="s2">Rerun with overwrite=True, or unpack this file in a different directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lpath</span><span class="p">))</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                    <span class="n">recs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_pmag_data_list</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recs</span><span class="p">),</span> <span class="s1">&#39; read in&#39;</span><span class="p">)</span>
                    <span class="n">lrecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">recs</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">loc_name</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lrecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">outfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lpath</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span>
                        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">outfile_name</span><span class="p">,</span> <span class="n">lrecs</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">print_progress</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lrecs</span><span class="p">),</span> <span class="s1">&#39; stored in &#39;</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="download_magic_from_id"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.download_magic_from_id">[docs]</a><span class="k">def</span> <span class="nf">download_magic_from_id</span><span class="p">(</span><span class="n">con_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a public contribution matching the provided</span>
<span class="sd">    contribution ID from earthref.org/MagIC.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        doi : str</span>
<span class="sd">            DOI for a MagIC</span>

<span class="sd">    Returns:</span>
<span class="sd">        result : bool</span>
<span class="sd">        message : str</span>
<span class="sd">            Error message if download didn&#39;t succeed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">magic_url</span> <span class="o">=</span> <span class="s1">&#39;https://earthref.org/MagIC/download/</span><span class="si">{}</span><span class="s1">/magic_contribution_</span><span class="si">{}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">con_id</span><span class="p">,</span> <span class="n">con_id</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">magic_url</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;wget module is not available, cannot download from MagIC&quot;</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Looks like you didn&#39;t provide a valid contribution id, please try again...&quot;</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t connect to MagIC site, please check your internet connection&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unexpected problem downloading from MagIC:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">res</span></div>


<div class="viewcode-block" id="download_magic_from_doi"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.download_magic_from_doi">[docs]</a><span class="k">def</span> <span class="nf">download_magic_from_doi</span><span class="p">(</span><span class="n">doi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a public contribution matching the provided DOI</span>
<span class="sd">    from earthref.org/MagIC.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        doi : str</span>
<span class="sd">            DOI for a MagIC</span>

<span class="sd">    Returns:</span>
<span class="sd">        result : bool</span>
<span class="sd">        message : str</span>
<span class="sd">            Error message if download didn&#39;t succeed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;download&#39;</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;doi&#39;</span><span class="p">:</span> <span class="n">doi</span><span class="p">,</span> <span class="s1">&#39;n_max_contributions&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Looks like you didn&#39;t provide a valid DOI, please try again...&quot;</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t connect to MagIC site, please check your internet connection&quot;</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t connect to MagIC site, please check your internet connection&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unexpected problem downloading from MagIC:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">):</span>
        <span class="n">contribution_zip</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">contribution_zip</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d+\/magic_contribution_\d+\.txt&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)):</span>
                <span class="n">contribution_text</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">contribution_zip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;magic_contribution.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contribution_text</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;extracted to magic_contribution.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">204</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Public contribution with a reference DOI = </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1"> not found in MagIC&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;err&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="validate_with_public_endpoint"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.validate_with_public_endpoint">[docs]</a><span class="k">def</span> <span class="nf">validate_with_public_endpoint</span><span class="p">(</span><span class="n">contribution_file</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    validate contribution to MagIC using public endpoint</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    contribution_file: str</span>
<span class="sd">        file to validate</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        if True, print error messages</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    response: API requests.models.Response</span>
<span class="sd">        response.status_code: bool</span>
<span class="sd">            True : successful validation of private workspace</span>
<span class="sd">        response[&#39;errors&#39;] : None or &#39;trouble validating&#39;</span>
<span class="sd">        response[&#39;validation_results&#39;] : dictionary of validation errors</span>
<span class="sd">        response[&#39;warnings&#39;] : list of warnings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="n">validation_results</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">contribution_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">validation_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">),</span>
                                          <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span><span class="s1">&#39;text/plain&#39;</span><span class="p">},</span>
                                          <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;status_code=&#39;</span><span class="p">,</span><span class="n">validation_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">validation_response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">200</span><span class="p">:</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">validation_results</span> <span class="o">=</span> <span class="n">validation_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">validation_results</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span><span class="s1">&#39;in rows: &#39;</span><span class="p">)</span>
                <span class="nb">print</span> <span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;rows&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">validation_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Status code 500&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">validation_results</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;unable to validate contribution&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="upload_magic2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.upload_magic2">[docs]</a><span class="k">def</span> <span class="nf">upload_magic2</span><span class="p">(</span><span class="n">concat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">data_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds all magic files in a given directory, and compiles them into an</span>
<span class="sd">    upload.txt file which can be uploaded into the MagIC database. Returns a</span>
<span class="sd">    tuple of either: (False, error_message, errors) if there was a problem</span>
<span class="sd">    creating/validating the upload file or: (filename, &#39;&#39;, None) if the upload</span>
<span class="sd">    was fully successful.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SpecDone</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">concat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>
    <span class="n">files_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;er_expeditions.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_locations.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_samples.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_specimens.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_sites.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_ages.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_citations.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;er_mailinglist.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;magic_measurements.txt&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;rmag_hysteresis.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rmag_anisotropy.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rmag_remanence.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rmag_results.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pmag_specimens.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pmag_samples.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pmag_sites.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pmag_results.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;pmag_criteria.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;magic_instruments.txt&quot;</span><span class="p">]</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_list</span><span class="p">]</span>

    <span class="c1"># begin the upload process</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;upload.txt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">up</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
    <span class="n">RmKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citation_label&#39;</span><span class="p">,</span> <span class="s1">&#39;compilation&#39;</span><span class="p">,</span> <span class="s1">&#39;calculation_type&#39;</span><span class="p">,</span> <span class="s1">&#39;average_n_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;average_n_planes&#39;</span><span class="p">,</span>
              <span class="s1">&#39;specimen_grade&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vgp_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vgp_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;direction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_Z&#39;</span><span class="p">,</span>
              <span class="s1">&#39;magic_instrument_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_rate_corr&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_rate_mcd&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_atrm_alt&#39;</span><span class="p">,</span>
              <span class="s1">&#39;anisotropy_apar_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_F&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_F_crit&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_scat&#39;</span><span class="p">,</span>
              <span class="s1">&#39;specimen_gmax&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vadm&#39;</span><span class="p">,</span> <span class="s1">&#39;site_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vdm&#39;</span><span class="p">,</span> <span class="s1">&#39;site_lat&#39;</span><span class="p">,</span>
              <span class="s1">&#39;measurement_chi&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_k_prime&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_k_prime_sse&#39;</span><span class="p">,</span> <span class="s1">&#39;external_database_names&#39;</span><span class="p">,</span>
              <span class="s1">&#39;external_database_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;Further Notes&#39;</span><span class="p">,</span> <span class="s1">&#39;Typology&#39;</span><span class="p">,</span> <span class="s1">&#39;Notes (Year/Area/Locus/Level)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Site&#39;</span><span class="p">,</span> <span class="s1">&#39;Object Number&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_n_specimens&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-I- Removing: &quot;</span><span class="p">,</span> <span class="n">RmKeys</span><span class="p">)</span>
    <span class="n">CheckDec</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;dip_direction&#39;</span><span class="p">]</span>
    <span class="n">CheckSign</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">]</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">file_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">methods</span><span class="p">,</span> <span class="n">first_file</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">File</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
        <span class="c1"># read in the data</span>
        <span class="n">Data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">File</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">file_type</span> <span class="o">!=</span> <span class="s2">&quot;bad_file&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">file_type</span> <span class="o">!=</span> <span class="s2">&quot;empty_file&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-I- file&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="s2">&quot; successfully read in&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">RmKeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="c1"># remove unwanted keys</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">RmKeys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;specimen_Z&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="c1"># change  # change this to lower case</span>
                            <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;specimen_z&#39;</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">del</span> <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># get rid of unwanted keys</span>
                    <span class="c1"># make sure b_beta is positive</span>
                    <span class="c1"># ignore blanks</span>
                    <span class="k">if</span> <span class="s1">&#39;specimen_b_beta&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># make sure value is positive</span>
                            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                                <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">]))</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-I- adjusted to positive: &#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">])</span>
                    <span class="c1"># make all declinations/azimuths/longitudes in range</span>
                    <span class="c1"># 0=&gt;360.</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">adjust_all_to_360</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;er_locations&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pmag_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;pmag_sites&#39;</span><span class="p">,</span> <span class="s1">&#39;pmag_specimens&#39;</span><span class="p">]:</span>
                <span class="c1"># if there is NO pmag data for specimens (samples/sites),</span>
                <span class="c1"># do not try to write it to file</span>
                <span class="c1"># (this causes validation errors, elsewise)</span>
                <span class="n">ignore</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ignore</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">exclude_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;er_citation_names&#39;</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;er_location_name&#39;</span><span class="p">,</span> <span class="s1">&#39;er_specimen_names&#39;</span><span class="p">,</span> <span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                            <span class="n">keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">ignore</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;er_samples&#39;</span><span class="p">:</span>  <span class="c1"># check to only upload top priority orientation record!</span>
                <span class="n">NewSamps</span><span class="p">,</span> <span class="n">Done</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Done</span><span class="p">:</span>
                        <span class="n">orient</span><span class="p">,</span> <span class="n">az_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_orient</span><span class="p">(</span>
                            <span class="n">Data</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">])</span>
                        <span class="n">NewSamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orient</span><span class="p">)</span>
                        <span class="n">Done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">])</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">NewSamps</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;only highest priority orientation record from er_samples.txt read in &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;er_specimens&#39;</span><span class="p">:</span>  <span class="c1"># only specimens that have sample names</span>
                <span class="n">NewData</span><span class="p">,</span> <span class="n">SpecDone</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Done</span><span class="p">:</span>
                        <span class="n">NewData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                        <span class="n">SpecDone</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no valid sample record found for: &#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">NewData</span>
                <span class="c1"># print &#39;only measurements that have specimen/sample info&#39;</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;magic_measurements&#39;</span><span class="p">:</span>  <span class="c1"># only measurements that have specimen names</span>
                <span class="n">no_specs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">NewData</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">SpecDone</span><span class="p">:</span>
                        <span class="n">NewData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no valid specimen record found for: &#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                        <span class="n">no_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="c1"># print set([record[&#39;er_specimen_name&#39;] for record in</span>
                <span class="c1"># no_specs])</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">NewData</span>
    <span class="c1"># write out the data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">first_file</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">keystring</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">first_rec</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_type</span><span class="p">)</span>
                    <span class="n">first_file</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keystring</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">first_up</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_type</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>
                    <span class="c1"># collect the method codes</span>
                    <span class="k">if</span> <span class="s2">&quot;magic_method_codes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">meths</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;LP-DIR-&quot;</span><span class="p">:</span>
                                    <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pmag</span><span class="o">.</span><span class="n">putout</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">keystring</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- File input error: slowing down&#39;</span><span class="p">)</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">pmag</span><span class="o">.</span><span class="n">putout</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">keystring</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

    <span class="c1"># write out the file separator</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s1">&#39;written to &#39;</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File:&#39;</span><span class="p">,</span> <span class="n">File</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s1">&#39;is bad or non-existent - skipping &#39;</span><span class="p">)</span>

    <span class="c1"># write out the methods table</span>
    <span class="n">first_rec</span><span class="p">,</span> <span class="n">MethRec</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="n">MethRec</span><span class="p">[</span><span class="s2">&quot;magic_method_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meth</span>
        <span class="k">if</span> <span class="n">first_rec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">meth_keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">first_up</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">MethRec</span><span class="p">,</span> <span class="s2">&quot;magic_methods&quot;</span><span class="p">)</span>
        <span class="n">first_rec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pmag</span><span class="o">.</span><span class="n">putout</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">meth_keys</span><span class="p">,</span> <span class="n">MethRec</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- File input error: slowing down&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pmag</span><span class="o">.</span><span class="n">putout</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">meth_keys</span><span class="p">,</span> <span class="n">MethRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">concat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">up</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">validate_upload2</span> <span class="k">as</span> <span class="n">validate_upload</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">validated</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_upload</span><span class="o">.</span><span class="n">read_upload</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">data_model</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no data found, upload file not created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;no data found, upload file not created&quot;</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># rename upload.txt according to location + timestamp</span>
    <span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%b.%Y&quot;</span>
    <span class="k">if</span> <span class="n">locations</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">new_up</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_up</span> <span class="o">=</span> <span class="s1">&#39;unknown_location_&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>

    <span class="n">new_up</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">new_up</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_up</span><span class="p">):</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">new_up</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">extension</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_up</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">extension</span>
                <span class="k">break</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">new_up</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished preparing upload file: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_up</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">validated</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- validation of upload file has failed.</span><span class="se">\n</span><span class="s2">You can still upload </span><span class="si">{}</span><span class="s2"> to MagIC,</span><span class="se">\n</span><span class="s2">but you will need to fix the above errors before your contribution can be published.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_up</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Validation of your upload file has failed.</span><span class="se">\n</span><span class="s2">You can still upload </span><span class="si">{}</span><span class="s2"> to MagIC,</span><span class="se">\n</span><span class="s2">but you will need to fix the above errors before your contribution can be published.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_up</span><span class="p">),</span> <span class="n">errors</span>
    <span class="k">return</span> <span class="n">new_up</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span></div>


<span class="k">def</span> <span class="nf">upload_magic3</span><span class="p">(</span><span class="n">concat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">dmodel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- ipmag.upload_magic3 is deprecated, please switch to using ipmag.upload_magic&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">upload_magic</span><span class="p">(</span><span class="n">concat</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">dmodel</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">contribution</span><span class="p">)</span>


<div class="viewcode-block" id="upload_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.upload_magic">[docs]</a><span class="k">def</span> <span class="nf">upload_magic</span><span class="p">(</span><span class="n">concat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds all magic files in a given directory, and compiles them into an</span>
<span class="sd">    upload.txt file which can be uploaded into the MagIC database.</span>
<span class="sd">    If username/password set, then data will be uploaded to private workspace, otherwise</span>
<span class="sd">    validation will be done on this computer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    concat : boolean where True means do concatenate to upload.txt file in dir_path,</span>
<span class="sd">        False means write a new file (default is False)</span>
<span class="sd">    dir_path : string for output directory (default &quot;.&quot;)</span>
<span class="sd">    input_dir_path : str, default &quot;.&quot;</span>
<span class="sd">    validate : boolean</span>
<span class="sd">        validate upload file on MagIC&#39;s public endpoint</span>
<span class="sd">    verbose : boolean</span>
<span class="sd">        if True print progress and validation results</span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    tuple of either: True/False or (False, error_message, validation dictionary val_response[&#39;validation&#39;])</span>
<span class="sd">    if there was a problem creating/validating the upload file</span>
<span class="sd">    or: (filename, &#39;&#39;, None) if the file creation was fully successful.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">concat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>
    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;locations&quot;</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">,</span> <span class="s2">&quot;specimens&quot;</span><span class="p">,</span> <span class="s2">&quot;sites&quot;</span><span class="p">,</span> <span class="s2">&quot;ages&quot;</span><span class="p">,</span> <span class="s2">&quot;measurements&quot;</span><span class="p">,</span>
              <span class="s2">&quot;criteria&quot;</span><span class="p">,</span><span class="s2">&quot;images&quot;</span><span class="p">]</span> <span class="c1"># don&#39;t upload the contribution.txt file!</span>
    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">)]</span>
    <span class="n">first_file</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_names</span><span class="p">:</span>
        <span class="c1"># if no contribution is provided and no contribution could be created,</span>
        <span class="c1"># you are out of luck</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No 3.0 files found in your directory: </span><span class="si">{}</span><span class="s2">, upload file not created&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;no 3.0 files found, upload file not created&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">last_file_type</span><span class="o">=</span><span class="n">file_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># begin the upload file preparation</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;upload.txt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">up</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
    <span class="n">RmKeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;citation_label&#39;</span><span class="p">,</span> <span class="s1">&#39;compilation&#39;</span><span class="p">,</span> <span class="s1">&#39;calculation_type&#39;</span><span class="p">,</span> <span class="s1">&#39;average_n_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;average_n_planes&#39;</span><span class="p">,</span>
              <span class="s1">&#39;specimen_grade&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vgp_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vgp_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;direction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_Z&#39;</span><span class="p">,</span>
              <span class="s1">&#39;magic_instrument_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_rate_corr&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_rate_mcd&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_atrm_alt&#39;</span><span class="p">,</span>
              <span class="s1">&#39;anisotropy_apar_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_F&#39;</span><span class="p">,</span> <span class="s1">&#39;anisotropy_F_crit&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_scat&#39;</span><span class="p">,</span>
              <span class="s1">&#39;specimen_gmax&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vadm&#39;</span><span class="p">,</span> <span class="s1">&#39;site_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;site_vdm&#39;</span><span class="p">,</span> <span class="s1">&#39;site_lat&#39;</span><span class="p">,</span>
              <span class="s1">&#39;measurement_chi&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_k_prime&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_k_prime_sse&#39;</span><span class="p">,</span> <span class="s1">&#39;external_database_names&#39;</span><span class="p">,</span>
              <span class="s1">&#39;external_database_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;Further Notes&#39;</span><span class="p">,</span> <span class="s1">&#39;Typology&#39;</span><span class="p">,</span> <span class="s1">&#39;Notes (Year/Area/Locus/Level)&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Site&#39;</span><span class="p">,</span> <span class="s1">&#39;Object Number&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;site_definition&#39;</span><span class="p">)</span>
    <span class="c1">#print(&quot;-I- Removing: &quot;, RmKeys)</span>
    <span class="n">extra_RmKeys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span><span class="s1">&#39;treat_mw_energy&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;age_high&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;age_low&#39;</span><span class="p">,</span> <span class="s1">&#39;age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_core_depth&#39;</span><span class="p">,</span><span class="s1">&#39;result_type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;age_high&#39;</span><span class="p">,</span> <span class="s1">&#39;age_low&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;core_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;composite_depth&#39;</span><span class="p">,</span><span class="s1">&#39;result_type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth_dec_correction&#39;</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;orientation_quality&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_alternatives&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;result_type&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;ages&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]}</span>

    <span class="n">dmodel</span> <span class="o">=</span> <span class="n">data_model</span><span class="o">.</span><span class="n">DataModel</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-I- </span><span class="si">{}</span><span class="s2"> file successfully read in&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_type</span><span class="p">))</span>
    <span class="c1"># make some adjustments to clean up data</span>
            <span class="c1"># drop non MagIC keys</span>
            <span class="n">DropKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">RmKeys</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;-I- dropping these columns: </span><span class="si">{}</span><span class="s1"> from the </span><span class="si">{}</span><span class="s1"> table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">),</span> <span class="n">file_type</span><span class="p">))</span>
                <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ftype</span><span class="o">=</span><span class="n">file_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_RmKeys</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">DropKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_RmKeys</span><span class="p">[</span><span class="n">ftype</span><span class="p">])</span>
                <span class="n">DropKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s1">&#39;-I- dropping these columns: </span><span class="si">{}</span><span class="s1"> from the </span><span class="si">{}</span><span class="s1"> table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">),</span> <span class="n">file_type</span><span class="p">))</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">DropKeys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">n_cols</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;_n&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;lat_n&#39;</span> <span class="ow">in</span> <span class="n">n_cols</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">n_cols</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat_n&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#  oops: lat_n was also getting stripped of &#39;0.&#39; below!</span>
            <span class="n">other_int_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;contribution_id&#39;</span><span class="p">,</span><span class="s1">&#39;pole_w_q&#39;</span><span class="p">,</span><span class="s1">&#39;pole_bc_q&#39;</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="s1">&#39;sequence&#39;</span><span class="p">,</span><span class="s1">&#39;hyst_loop&#39;</span><span class="p">,</span><span class="s1">&#39;treat_step_num&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">n_cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;.0&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">other_int_cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;.0&quot;</span><span class="p">)</span>

            <span class="c1"># convert int_scat to True/False</span>
            <span class="k">if</span> <span class="s1">&#39;int_scat&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_scat&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;int_scat&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;True&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_scat&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;int_scat&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;False&#39;</span>
            <span class="c1"># make sure int_md is positive</span>
            <span class="k">if</span> <span class="s1">&#39;int_md&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_md&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_md&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_md&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;int_md&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W-&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
            <span class="c1"># make sure int_b_beta is positive</span>
            <span class="k">if</span> <span class="s1">&#39;int_b_beta&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># get rid of empty strings</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+( +\.)|#&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                                <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_b_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;int_b_beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                        <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">abs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="s2">&quot;-W- Non numeric values found in int_b_beta column.</span><span class="se">\n</span><span class="s2">   Could not apply absolute value.&quot;</span>
            <span class="c1"># make all declinations/azimuths/longitudes in range 0=&gt;360.</span>
            <span class="n">relevant_cols</span> <span class="o">=</span> <span class="n">val_up3</span><span class="o">.</span><span class="n">get_degree_cols</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">relevant_cols</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">adjust_val_to_360</span><span class="p">)</span>
            <span class="c1"># get list of location names</span>
            <span class="k">if</span> <span class="s1">&#39;locations&#39;</span> <span class="ow">in</span> <span class="n">file_type</span><span class="p">:</span>
                <span class="n">locations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="c1"># write out the data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-9999&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#for col in df.columns:</span>
                <span class="c1">#    df.loc[df[col]==&#39;-9999&#39;,col]=&quot;&quot;</span>
                <span class="n">ftype</span><span class="o">=</span><span class="n">file_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#</span>
                <span class="k">if</span> <span class="n">first_file</span><span class="p">:</span>
                    <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">first_file</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># write out the file separator</span>
            <span class="k">if</span> <span class="n">last_file_type</span> <span class="o">!=</span> <span class="n">file_type</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-I-&quot;</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="s1">&#39;written to &#39;</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># last file, no newline at end of file</span>
                 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-I-&quot;</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="s1">&#39;written to &#39;</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span>
    <span class="c1"># if there was no understandable data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s1">&#39;is bad or non-existent - skipping &#39;</span><span class="p">)</span>
    <span class="c1"># add to existing file</span>
    <span class="k">if</span> <span class="n">concat</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">up</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no data found, upload file not created&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;no data found, upload file not created&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># rename upload.txt according to location + timestamp</span>
    <span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%b.%Y&quot;</span>
    <span class="k">if</span> <span class="n">locations</span><span class="p">:</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">locs</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1">#location = locations[0].replace(&#39; &#39;, &#39;_&#39;)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="n">loc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unknown_location&quot;</span><span class="p">]</span>
        <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="n">new_up</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_up</span> <span class="o">=</span> <span class="s1">&#39;unknown_location_&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">format_string</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>

    <span class="n">new_up</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">new_up</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_up</span><span class="p">):</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">new_up</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">extension</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_up</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">extension</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">up</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- Could not create an upload file&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Could not create an upload file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">new_up</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished preparing upload file: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_up</span><span class="p">))</span>
    <span class="n">val_response</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Validating upload file with public endpoint&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val_response</span><span class="o">=</span><span class="n">validate_with_public_endpoint</span><span class="p">(</span><span class="n">new_up</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- Couldn&#39;t connect to MagIC for validation&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Could not create an upload file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">new_up</span><span class="p">,</span> <span class="n">val_response</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="create_private_contribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.create_private_contribution">[docs]</a><span class="k">def</span> <span class="nf">create_private_contribution</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a private contribution on earthref.org/MagIC.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        username : str</span>
<span class="sd">            personal username for MagIC</span>
<span class="sd">        password : str</span>
<span class="sd">            password for username</span>

<span class="sd">    Returns:</span>
<span class="sd">        **response** API requests.models.Response</span>
<span class="sd">            response.status_code: bool</span>
<span class="sd">                True : successful creation of private workspace</span>
<span class="sd">            response[&#39;url&#39;] : str</span>
<span class="sd">                URL of request</span>
<span class="sd">            response[&#39;method&#39;] : str</span>
<span class="sd">                &#39;POST&#39;</span>
<span class="sd">            response[&#39;id&#39;] : str</span>
<span class="sd">                if successful, MagIC ID number created</span>
<span class="sd">            response[&#39;errors&#39;] : str</span>
<span class="sd">                if unsuccessful, error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">response</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Failed to contact database&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">create_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;private&#39;</span><span class="p">),</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">create_response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">201</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="delete_private_contribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.delete_private_contribution">[docs]</a><span class="k">def</span> <span class="nf">delete_private_contribution</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a private contribution on earthref.org/MagIC.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        contribution_id: int</span>
<span class="sd">            ID of MagIC contribution to delete</span>
<span class="sd">        username : str</span>
<span class="sd">            personal username for MagIC</span>
<span class="sd">        password : str</span>
<span class="sd">            password for username</span>

<span class="sd">    Returns:   </span>
<span class="sd">        **response** (API requests.models.Response)</span>
<span class="sd">            response.status_code: bool</span>
<span class="sd">                True : successful creation of private workspace</span>
<span class="sd">            response[&#39;url&#39;] : str</span>
<span class="sd">                URL of request</span>
<span class="sd">            response[&#39;method&#39;] : </span>
<span class="sd">                &#39;DELETE&#39;</span>
<span class="sd">            response[&#39;id&#39;] : str</span>
<span class="sd">                if successful, MagIC ID contribution deleted</span>
<span class="sd">            response[&#39;errors&#39;] : str</span>
<span class="sd">                if unsuccessful, error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">response</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Failed to contact database&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">delete_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;private&#39;</span><span class="p">),</span>
                                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">contribution_id</span><span class="p">},</span>
                                          <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">delete_response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">200</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">delete_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">contribution_id</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">delete_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">delete_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="upload_to_private_contribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.upload_to_private_contribution">[docs]</a><span class="k">def</span> <span class="nf">upload_to_private_contribution</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">,</span> <span class="n">upload_file</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload to a private contribution on earthref.org/MagIC.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    contribution_id: int</span>
<span class="sd">        ID of MagIC contribution to delete</span>
<span class="sd">    upload_file: str</span>
<span class="sd">        file to upload (complete path)</span>
<span class="sd">    username : str</span>
<span class="sd">        personal username for MagIC</span>
<span class="sd">    password : str</span>
<span class="sd">        password for username</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    response: API requests.models.Response</span>
<span class="sd">        response.status_code: bool</span>
<span class="sd">            True : successful creation of private workspace</span>
<span class="sd">        response[&#39;url&#39;] : str</span>
<span class="sd">            URL of request</span>
<span class="sd">        response[&#39;method&#39;]=&#39;PUT&#39;</span>
<span class="sd">        response[&#39;errors&#39;] : str</span>
<span class="sd">            if unsuccessful, error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">response</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Failed to contact database&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PUT&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;upload_file&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">upload_file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">upload_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">upload_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;private&#39;</span><span class="p">),</span>
                                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">contribution_id</span><span class="p">},</span>
                                          <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">),</span>
                                          <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">},</span>
                                          <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upload_response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">202</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">upload_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">upload_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="c1">#response[&#39;errors&#39;]=upload_response.json()[&#39;errors&#39;][0][&#39;message&#39;]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;trouble uploading:&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">upload_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="validate_private_contribution"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.validate_private_contribution">[docs]</a><span class="k">def</span> <span class="nf">validate_private_contribution</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">,</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    validate private contribution in MagIC</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    contribution_id: int</span>
<span class="sd">        ID of MagIC contribution to delete</span>
<span class="sd">    username : str</span>
<span class="sd">        personal username for MagIC</span>
<span class="sd">    password : str</span>
<span class="sd">        password for username</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        if True, print error messages</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    response: API requests.models.Response</span>
<span class="sd">        response.status_code: bool</span>
<span class="sd">            True : successful validation of private workspace</span>
<span class="sd">        response[&#39;url&#39;] : str</span>
<span class="sd">            URL of request</span>
<span class="sd">        response[&#39;results&#39;] : dictionary of validation results</span>
<span class="sd">        response[&#39;method&#39;]=&#39;POST&#39;</span>
<span class="sd">        response[&#39;errors&#39;] : str</span>
<span class="sd">            if unsuccessful, error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="s1">&#39;https://api.earthref.org/v1/MagIC/</span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="n">response</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Failed to contact database&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;contribution_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">contribution_id</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">create_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;private/validate&#39;</span><span class="p">),</span>
                                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">contribution_id</span><span class="p">},</span>
                                          <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">create_response</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">200</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="n">errors_dict</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">create_response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">errors_dict</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validated contribution with ID&#39;</span><span class="p">,</span> <span class="n">contribution_id</span><span class="p">,</span> <span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;status_code&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">create_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;validation_results&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A private contribution with ID&#39;</span><span class="p">,</span> <span class="n">contribution_id</span><span class="p">,</span>
                  <span class="s1">&#39; could not be found in your private workspace for validation</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;trouble validating:&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span></div>



<div class="viewcode-block" id="specimens_results_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.specimens_results_magic">[docs]</a><span class="k">def</span> <span class="nf">specimens_results_magic</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s1">&#39;pmag_specimens.txt&#39;</span><span class="p">,</span> <span class="n">measfile</span><span class="o">=</span><span class="s1">&#39;magic_measurements.txt&#39;</span><span class="p">,</span> <span class="n">sampfile</span><span class="o">=</span><span class="s1">&#39;er_samples.txt&#39;</span><span class="p">,</span> <span class="n">sitefile</span><span class="o">=</span><span class="s1">&#39;er_sites.txt&#39;</span><span class="p">,</span> <span class="n">agefile</span><span class="o">=</span><span class="s1">&#39;er_ages.txt&#39;</span><span class="p">,</span> <span class="n">specout</span><span class="o">=</span><span class="s1">&#39;er_specimens.txt&#39;</span><span class="p">,</span> <span class="n">sampout</span><span class="o">=</span><span class="s1">&#39;pmag_samples.txt&#39;</span><span class="p">,</span> <span class="n">siteout</span><span class="o">=</span><span class="s1">&#39;pmag_sites.txt&#39;</span><span class="p">,</span> <span class="n">resout</span><span class="o">=</span><span class="s1">&#39;pmag_results.txt&#39;</span><span class="p">,</span> <span class="n">critout</span><span class="o">=</span><span class="s1">&#39;pmag_criteria.txt&#39;</span><span class="p">,</span> <span class="n">instout</span><span class="o">=</span><span class="s1">&#39;magic_instruments.txt&#39;</span><span class="p">,</span> <span class="n">plotsites</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">cors</span><span class="o">=</span><span class="p">[],</span> <span class="n">priorities</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DA-AC-ARM&#39;</span><span class="p">,</span> <span class="s1">&#39;DA-AC-TRM&#39;</span><span class="p">],</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vgps_level</span><span class="o">=</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">do_site_intensity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">],</span> <span class="n">avg_directions_by_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">avg_intensities_by_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">avg_all_components</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">avg_by_polarity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_directions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_intensities</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_sample_latitude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_paleolatitude</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_criteria</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes magic_instruments, er_specimens, pmag_samples, pmag_sites, pmag_criteria, and pmag_results. The data used to write this is obtained by reading a pmag_speciemns, a magic_measurements, a er_samples, a er_sites, a er_ages.</span>
<span class="sd">    @param -&gt; infile: path from the WD to the pmag speciemns table</span>
<span class="sd">    @param -&gt; measfile: path from the WD to the magic measurement file</span>
<span class="sd">    @param -&gt; sampfile: path from the WD to the er sample file</span>
<span class="sd">    @param -&gt; sitefile: path from the WD to the er sites data file</span>
<span class="sd">    @param -&gt; agefile: path from the WD to the er ages data file</span>
<span class="sd">    @param -&gt; specout: path from the WD to the place to write the er specimens data file</span>
<span class="sd">    @param -&gt; sampout: path from the WD to the place to write the pmag samples data file</span>
<span class="sd">    @param -&gt; siteout: path from the WD to the place to write the pmag sites data file</span>
<span class="sd">    @param -&gt; resout: path from the WD to the place to write the pmag results data file</span>
<span class="sd">    @param -&gt; critout: path from the WD to the place to write the pmag criteria file</span>
<span class="sd">    @param -&gt; instout: path from th WD to the place to write the magic instruments file</span>
<span class="sd">    @param -&gt; documentation incomplete if you know more about the purpose of the parameters in this function and it&#39;s side effects please extend and complete this string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize some variables</span>
    <span class="n">plotsites</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># cannot use draw_figs from within ipmag</span>
    <span class="n">Comps</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of components</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="n">model_lat_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">Dcrit</span><span class="p">,</span> <span class="n">Icrit</span><span class="p">,</span> <span class="n">nocrit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">corrections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nocorrection</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DA-NL&#39;</span><span class="p">,</span> <span class="s1">&#39;DA-AC&#39;</span><span class="p">,</span> <span class="s1">&#39;DA-CR&#39;</span><span class="p">]</span>

    <span class="c1"># do some data adjustments</span>
    <span class="k">for</span> <span class="n">cor</span> <span class="ow">in</span> <span class="n">cors</span><span class="p">:</span>
        <span class="n">nocorrection</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;DA-&#39;</span> <span class="o">+</span> <span class="n">cor</span><span class="p">)</span>
        <span class="n">corrections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DA-&#39;</span> <span class="o">+</span> <span class="n">cor</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">priorities</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DA-AC-&#39;</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;DA-AC-&#39;</span> <span class="o">+</span> <span class="n">p</span>

    <span class="c1"># translate coord into coords</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-1&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">vgps_level</span> <span class="o">==</span> <span class="s1">&#39;sample&#39;</span><span class="p">:</span>
        <span class="n">vgps</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># save sample level VGPS/VADMs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vgps</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># site level</span>

    <span class="k">if</span> <span class="n">do_site_intensity</span><span class="p">:</span>
        <span class="n">nositeints</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nositeints</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># chagne these all to True/False instead of 1/0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_intensities</span><span class="p">:</span>
        <span class="c1"># set model lat and</span>
        <span class="k">if</span> <span class="n">use_sample_latitude</span> <span class="ow">and</span> <span class="n">use_paleolatitude</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;you should set a paleolatitude file OR use present day lat - not both&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">use_sample_latitude</span><span class="p">:</span>
            <span class="n">get_model_lat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">use_paleolatitude</span><span class="p">:</span>
            <span class="n">get_model_lat</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_lat_file</span> <span class="o">=</span> <span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">get_model_lat</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">mlat</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_lat_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ModelLats</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mlat</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                    <span class="n">ModelLat</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">ModelLat</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ModelLat</span><span class="p">[</span><span class="s2">&quot;site_model_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ModelLat</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ModelLat</span><span class="p">[</span><span class="s2">&quot;sample_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ModelLats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ModelLat</span><span class="p">)</span>
                <span class="n">mlat</span><span class="o">.</span><span class="n">clos</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;use_paleolatitude option requires a valid paleolatitude file&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_model_lat</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># skips VADM calculation entirely</span>

    <span class="k">if</span> <span class="n">plotsites</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_directions</span><span class="p">:</span>  <span class="c1"># plot by site - set up plot window</span>
        <span class="n">EQ</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">EQ</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># define figure 1 as equal area projection</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">EQ</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># I don&#39;t know why this has to be here, but otherwise the first plot</span>
        <span class="c1"># never plots...</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_net</span><span class="p">(</span><span class="n">EQ</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">])</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">EQ</span><span class="p">)</span>

    <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
    <span class="n">measfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">measfile</span><span class="p">)</span>
    <span class="n">instout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">instout</span><span class="p">)</span>
    <span class="n">sampfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">sampfile</span><span class="p">)</span>
    <span class="n">sitefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">sitefile</span><span class="p">)</span>
    <span class="n">agefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">agefile</span><span class="p">)</span>
    <span class="n">specout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">specout</span><span class="p">)</span>
    <span class="n">sampout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">sampout</span><span class="p">)</span>
    <span class="n">siteout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">siteout</span><span class="p">)</span>
    <span class="n">resout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">resout</span><span class="p">)</span>
    <span class="n">critout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">critout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_criteria</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">Dcrit</span><span class="p">,</span> <span class="n">Icrit</span><span class="p">,</span> <span class="n">nocrit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># no selection criteria</span>
        <span class="n">crit_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">default_criteria</span><span class="p">(</span><span class="n">nocrit</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">use_criteria</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">crit_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">default_criteria</span><span class="p">(</span><span class="n">nocrit</span><span class="p">)</span>  <span class="c1"># use default criteria</span>
    <span class="k">elif</span> <span class="n">use_criteria</span> <span class="o">==</span> <span class="s1">&#39;existing&#39;</span><span class="p">:</span>
        <span class="n">crit_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span>
            <span class="n">critout</span><span class="p">)</span>  <span class="c1"># use pmag_criteria file</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Acceptance criteria read in from &quot;</span><span class="p">,</span> <span class="n">critout</span><span class="p">)</span>
    <span class="n">accept</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">critrec</span> <span class="ow">in</span> <span class="n">crit_data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">critrec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># need to migrate specimen_dang to specimen_int_dang for intensity</span>
            <span class="c1"># data using old format</span>
            <span class="k">if</span> <span class="s1">&#39;IE-SPEC&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">critrec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="s1">&#39;specimen_dang&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">critrec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="s1">&#39;specimen_int_dang&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">critrec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">critrec</span><span class="p">[</span><span class="s1">&#39;specimen_int_dang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">critrec</span><span class="p">[</span><span class="s1">&#39;specimen_dang&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">critrec</span><span class="p">[</span><span class="s1">&#39;specimen_dang&#39;</span><span class="p">]</span>
<span class="c1"># need to get rid of ron shaars sample_int_sigma_uT</span>
            <span class="k">if</span> <span class="s1">&#39;sample_int_sigma_uT&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">critrec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">critrec</span><span class="p">[</span><span class="s1">&#39;sample_int_sigma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="n">critrec</span><span class="p">[</span><span class="s1">&#39;sample_int_sigma_uT&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">accept</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">critrec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">accept</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">critrec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">use_criteria</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">critout</span><span class="p">,</span> <span class="p">[</span><span class="n">accept</span><span class="p">],</span> <span class="s1">&#39;pmag_criteria&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Pmag Criteria stored in &quot;</span><span class="p">,</span> <span class="n">critout</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># now we&#39;re done slow dancing</span>

    <span class="c1"># read in site data - has the lats and lons</span>
    <span class="n">SiteNFO</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">sitefile</span><span class="p">)</span>
    <span class="c1"># read in site data - has the lats and lons</span>
    <span class="n">SampNFO</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">sampfile</span><span class="p">)</span>
    <span class="c1"># find all the sites with height info.</span>
    <span class="n">height_nfo</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">SiteNFO</span><span class="p">,</span> <span class="s1">&#39;site_height&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">agefile</span><span class="p">:</span>
        <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span>
            <span class="n">agefile</span><span class="p">)</span>  <span class="c1"># read in the age information</span>
    <span class="c1"># read in specimen interpretations</span>
    <span class="n">Data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="c1"># retrieve specimens with intensity data</span>
    <span class="n">IntData</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;specimen_int&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">comment</span><span class="p">,</span> <span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">samples</span><span class="p">,</span> <span class="n">sites</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Data</span><span class="p">:</span>  <span class="c1"># run through the data filling in missing keys and finding all components, coordinates available</span>
        <span class="c1"># fill in missing fields, collect unique sample and site names</span>
        <span class="k">if</span> <span class="s1">&#39;er_sample_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
            <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;er_site_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
            <span class="n">sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;specimen_int&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;specimen_comp_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">or</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Comps</span><span class="p">:</span>
            <span class="n">Comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">])</span>
        <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen_tilt_correction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;specimen_tilt_correction&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>  <span class="c1"># assume sample coordinates</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_tilt_correction&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orient</span><span class="p">:</span>
            <span class="c1"># collect available coordinate systems</span>
            <span class="n">orient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_tilt_correction&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;specimen_direction_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># assume direction is line - not plane</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_direction_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span>
        <span class="k">if</span> <span class="s2">&quot;specimen_dec&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># if no declination, set direction type to blank</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_direction_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s2">&quot;specimen_n&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># put in n</span>
        <span class="k">if</span> <span class="s2">&quot;specimen_alpha95&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;specimen_alpha95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># put in alpha95</span>
        <span class="k">if</span> <span class="s2">&quot;magic_method_codes&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
     <span class="c1"># start parsing data into SpecDirs, SpecPlanes, SpecInts</span>
    <span class="n">SpecInts</span><span class="p">,</span> <span class="n">SpecDirs</span><span class="p">,</span> <span class="n">SpecPlanes</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">samples</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># get sorted list of samples and sites</span>
    <span class="n">sites</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_intensities</span><span class="p">:</span>  <span class="c1"># don&#39;t skip intensities</span>
        <span class="c1"># retrieve specimens with intensity data</span>
        <span class="n">IntData</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;specimen_int&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nocrit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># use selection criteria</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">IntData</span><span class="p">:</span>  <span class="c1"># do selection criteria</span>
                <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;specimen_int&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># intensity record to be included in sample, site</span>
                    <span class="c1"># calculations</span>
                    <span class="n">SpecInts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SpecInts</span> <span class="o">=</span> <span class="n">IntData</span><span class="p">[:]</span>  <span class="c1"># take everything - no selection criteria</span>
<span class="c1"># check for required data adjustments</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">corrections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cor</span> <span class="ow">in</span> <span class="n">corrections</span><span class="p">:</span>
                <span class="c1"># only take specimens with the required corrections</span>
                <span class="n">SpecInts</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">SpecInts</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="n">cor</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nocorrection</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecInts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cor</span> <span class="ow">in</span> <span class="n">nocorrection</span><span class="p">:</span>
                <span class="c1"># exclude the corrections not specified for inclusion</span>
                <span class="n">SpecInts</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">SpecInts</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="n">cor</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">)</span>
<span class="c1"># take top priority specimen of its name in remaining specimens (only one</span>
<span class="c1"># per customer)</span>
        <span class="n">PrioritySpecInts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">specimens</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_specs</span><span class="p">(</span><span class="n">SpecInts</span><span class="p">)</span>  <span class="c1"># get list of uniq specimen names</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specimens</span><span class="p">:</span>
            <span class="c1"># all the records for this specimen</span>
            <span class="n">ThisSpecRecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">SpecInts</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ThisSpecRecs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">PrioritySpecInts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ThisSpecRecs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ThisSpecRecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># more than one</span>
                <span class="n">prec</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">priorities</span><span class="p">:</span>
                    <span class="c1"># all the records for this specimen</span>
                    <span class="n">ThisSpecRecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">SpecInts</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ThisSpecRecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ThisSpecRecs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">PrioritySpecInts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># take the best one</span>
        <span class="n">SpecInts</span> <span class="o">=</span> <span class="n">PrioritySpecInts</span>  <span class="c1"># this has the first specimen record</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_directions</span><span class="p">:</span>  <span class="c1"># don&#39;t skip directions</span>
        <span class="c1"># retrieve specimens with directed lines and planes</span>
        <span class="n">AllDirs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s1">&#39;specimen_direction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="c1"># get all specimens with specimen_n information</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">AllDirs</span><span class="p">,</span> <span class="s1">&#39;specimen_n&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># use selection criteria</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Ns</span><span class="p">:</span>  <span class="c1"># look through everything with specimen_n for &quot;good&quot; data</span>
                <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;specimen_dir&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># nothing killed it</span>
                    <span class="n">SpecDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># no criteria</span>
            <span class="n">SpecDirs</span> <span class="o">=</span> <span class="n">AllDirs</span><span class="p">[:]</span>  <span class="c1"># take them all</span>
<span class="c1"># SpecDirs is now the list of all specimen directions (lines and planes)</span>
<span class="c1"># that pass muster</span>
    <span class="c1"># list of all sample data and list of those that pass the DE-SAMP criteria</span>
    <span class="n">PmagSamps</span><span class="p">,</span> <span class="n">SampDirs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">PmagSites</span><span class="p">,</span> <span class="n">PmagResults</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># list of all site data and selected results</span>
    <span class="n">SampInts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>  <span class="c1"># run through the sample names</span>
        <span class="k">if</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>  <span class="c1"># average by sample if desired</span>
            <span class="c1"># get all the directional data for this sample</span>
            <span class="n">SampDir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">SpecDirs</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SampDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some directions</span>
                <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>  <span class="c1"># step through desired coordinate systems</span>
                    <span class="c1"># get all the directions for this sample</span>
                    <span class="n">CoordDir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">SampDir</span><span class="p">,</span> <span class="s1">&#39;specimen_tilt_correction&#39;</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CoordDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some with this coordinate system</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_all_components</span><span class="p">:</span>  <span class="c1"># look component by component</span>
                            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">Comps</span><span class="p">:</span>
                                <span class="c1"># get all directions from this component</span>
                                <span class="n">CompDir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                                    <span class="n">CoordDir</span><span class="p">,</span> <span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CompDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some</span>
                                    <span class="c1"># get a sample average from all specimens</span>
                                    <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">lnpbykey</span><span class="p">(</span>
                                        <span class="n">CompDir</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">)</span>
                                    <span class="c1"># decorate the sample record</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CompDir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CompDir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samp</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                                    <span class="k">if</span> <span class="n">CompDir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;specimen_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                                        <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                                    <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                                        <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ACCEPT&quot;</span>
                                    <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                        <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                                            <span class="n">PmagSampRec</span><span class="p">,</span> <span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_inferred_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
                                    <span class="n">site_height</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                                        <span class="n">height_nfo</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="c1"># add in height if available</span>
                                        <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_height</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_height&#39;</span><span class="p">]</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                        <span class="n">CompDir</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>  <span class="c1"># get a list of the specimen names used</span>
                                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                        <span class="n">CompDir</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span>  <span class="c1"># get a list of the methods used</span>
                                    <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># apply selection criteria</span>
                                        <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span>
                                            <span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;sample_dir&#39;</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">kill</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="n">SampDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">vgps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if sample level VGP info desired, do that now</span>
                                            <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getsampVGP</span><span class="p">(</span>
                                                <span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">SiteNFO</span><span class="p">)</span>
                                            <span class="k">if</span> <span class="n">PmagResRec</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                                <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
<span class="c1">#                                   print(PmagSampRec)</span>
                                    <span class="n">PmagSamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">avg_all_components</span><span class="p">:</span>  <span class="c1"># average all components together  basically same as above</span>
                            <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">lnpbykey</span><span class="p">(</span>
                                <span class="n">CoordDir</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">)</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CoordDir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CoordDir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samp</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;specimen_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">CoordDir</span><span class="p">):</span>
                                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
                            <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                                    <span class="n">PmagSampRec</span><span class="p">,</span> <span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_inferred_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
                            <span class="n">site_height</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                                <span class="n">height_nfo</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># add in height if available</span>
                                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_height</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_height&#39;</span><span class="p">]</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">CoordDir</span><span class="p">,</span> <span class="s1">&#39;specimen_comp_name&#39;</span><span class="p">)</span>  <span class="c1"># get components used</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">CoordDir</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>  <span class="c1"># get specimne names averaged</span>
                            <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">CoordDir</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span>  <span class="c1"># assemble method codes</span>
                            <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># apply selection criteria</span>
                                <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span>
                                    <span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;sample_dir&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># passes the mustard</span>
                                    <span class="n">SampDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">vgps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                        <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getsampVGP</span><span class="p">(</span>
                                            <span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">SiteNFO</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">PmagResRec</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                            <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>  <span class="c1"># take everything</span>
                                <span class="n">SampDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">vgps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getsampVGP</span><span class="p">(</span>
                                        <span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">SiteNFO</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">PmagResRec</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                                        <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
                            <span class="n">PmagSamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">avg_intensities_by_sample</span><span class="p">:</span>  <span class="c1"># average by sample if desired</span>
            <span class="c1"># get all the intensity data for this sample</span>
            <span class="n">SampI</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">SpecInts</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SampI</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some</span>
                <span class="c1"># get average intensity stuff</span>
                <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">average_int</span><span class="p">(</span><span class="n">SampI</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">)</span>
                <span class="c1"># decorate sample record</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;sample_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sample intensity&quot;</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;sample_direction_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampI</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">samp</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampI</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                        <span class="n">PmagSampRec</span><span class="p">,</span> <span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_inferred_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
                <span class="n">site_height</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">height_nfo</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># add in height if available</span>
                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_height</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_height&#39;</span><span class="p">]</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">SampI</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>
                <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">SampI</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nocrit</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># apply criteria!</span>
                    <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;sample_int&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ACCEPT&quot;</span>
                        <span class="n">SampInts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                        <span class="n">PmagSamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">PmagSampRec</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># sample rejected</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># no criteria</span>
                    <span class="n">SampInts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                    <span class="n">PmagSamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">)</span>
                    <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">vgps</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">get_model_lat</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">PmagSampRec</span> <span class="o">!=</span> <span class="p">{}:</span>
                    <span class="k">if</span> <span class="n">get_model_lat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># use sample latitude</span>
                        <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getsampVDM</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">SampNFO</span><span class="p">)</span>
                        <span class="c1"># get rid of the model lat key</span>
                        <span class="k">del</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;model_lat&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">get_model_lat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># use model latitude</span>
                        <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">getsampVDM</span><span class="p">(</span><span class="n">PmagSampRec</span><span class="p">,</span> <span class="n">ModelLats</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">PmagResRec</span> <span class="o">!=</span> <span class="p">{}:</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:IE-MLAT&quot;</span>
                    <span class="k">if</span> <span class="n">PmagResRec</span> <span class="o">!=</span> <span class="p">{}:</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACCEPT&#39;</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_int_sigma_perc&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_int_sigma&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_int_n&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;vadm_n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSampRec</span><span class="p">[</span><span class="s1">&#39;sample_int_n&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>
                        <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PmagSamps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># fill in missing keys from different types of records</span>
        <span class="n">TmpSamps</span><span class="p">,</span> <span class="n">keylist</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">PmagSamps</span><span class="p">)</span>
        <span class="c1"># save in sample output file</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">sampout</span><span class="p">,</span> <span class="n">TmpSamps</span><span class="p">,</span> <span class="s1">&#39;pmag_samples&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; sample averages written to &#39;</span><span class="p">,</span> <span class="n">sampout</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># create site averages from specimens or samples as specified</span>
<span class="c1">#</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">dirlist</span> <span class="o">=</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">SpecDirs</span>  <span class="c1"># if specimen averages at site level desired</span>
            <span class="k">if</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">dirlist</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">SampDirs</span>  <span class="c1"># if sample averages at site level desired</span>
            <span class="c1"># get all the sites with  directions</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">dirlist</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="c1"># use only the last coordinate if avg_all_components==False</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_tilt_correction&#39;</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="c1"># fish out site information (lat/lon, etc.)</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">SiteNFO</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sitedat</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_all_components</span><span class="p">:</span>  <span class="c1"># do component wise averaging</span>
                    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">Comps</span><span class="p">:</span>
                        <span class="c1"># get all components comp</span>
                        <span class="n">siteD</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">tmp1</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_comp_name&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                        <span class="c1"># remove bad data from means</span>
                        <span class="n">quality_siteD</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="c1"># remove any records for which specimen_flag or sample_flag are &#39;b&#39;</span>
                        <span class="c1"># assume &#39;g&#39; if flag is not provided</span>
                        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">siteD</span><span class="p">:</span>
                            <span class="n">spec_quality</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;specimen_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
                            <span class="n">samp_quality</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sample_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">spec_quality</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">samp_quality</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">):</span>
                                <span class="n">quality_siteD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                        <span class="n">siteD</span> <span class="o">=</span> <span class="n">quality_siteD</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">siteD</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some for this site and component name</span>
                            <span class="c1"># get an average for this site</span>
                            <span class="n">PmagSiteRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">lnpbykey</span><span class="p">(</span><span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                            <span class="c1"># decorate the site record</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">siteD</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">siteD</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">siteD</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_comp_name&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>
                                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                    <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                    <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>
    <span class="c1"># determine the demagnetization code (DC3,4 or 5) for this site</span>
                            <span class="n">AFnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                                <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-DIR-AF&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">))</span>
                            <span class="n">Tnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                                <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-DIR-T&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">))</span>
                            <span class="n">DC</span> <span class="o">=</span> <span class="mi">3</span>
                            <span class="k">if</span> <span class="n">AFnum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">DC</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">Tnum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">DC</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;LP-DC&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">plotsites</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">])</span>
                                <span class="c1"># plot and list the data</span>
                                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_site</span><span class="p">(</span>
                                    <span class="n">EQ</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">PmagSiteRec</span><span class="p">,</span> <span class="n">siteD</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">EQ</span><span class="p">)</span>
                            <span class="n">PmagSites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># last component only</span>
                    <span class="c1"># get the last orientation system specified</span>
                    <span class="n">siteD</span> <span class="o">=</span> <span class="n">tmp1</span><span class="p">[:]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">siteD</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some</span>
                        <span class="c1"># get the average for this site</span>
                        <span class="n">PmagSiteRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">lnpbykey</span><span class="p">(</span><span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                        <span class="c1"># decorate the record</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">siteD</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">siteD</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_comp_name&#39;</span><span class="p">)</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">)</span>
                        <span class="n">AFnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-DIR-AF&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">))</span>
                        <span class="n">Tnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-DIR-T&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">))</span>
                        <span class="n">DC</span> <span class="o">=</span> <span class="mi">3</span>
                        <span class="k">if</span> <span class="n">AFnum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">DC</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">Tnum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">DC</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                            <span class="n">siteD</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;LP-DC&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">DC</span><span class="p">)</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>
                            <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                                <span class="n">siteD</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_comp_name&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">plotsites</span><span class="p">:</span>
                            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_site</span><span class="p">(</span>
                                <span class="n">EQ</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">PmagSiteRec</span><span class="p">,</span> <span class="n">siteD</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">EQ</span><span class="p">)</span>
                        <span class="n">PmagSites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;site information not found in er_sites for site, &#39;</span><span class="p">,</span>
                      <span class="n">site</span><span class="p">,</span> <span class="s1">&#39; site will be skipped&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">PmagSiteRec</span> <span class="ow">in</span> <span class="n">PmagSites</span><span class="p">:</span>  <span class="c1"># now decorate each dictionary some more, and calculate VGPs etc. for results table</span>
        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
        <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">PmagSiteRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                <span class="n">PmagSiteRec</span><span class="p">,</span> <span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;site_inferred_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACCEPT&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;site_n_lines&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="s1">&#39;site_n_planes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_n_lines&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_n_planes&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n_planes&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:DE-FM-LP&quot;</span>
            <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n_lines&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:DE-FM&quot;</span>
            <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;site_dir&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PmagResRec</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># set up dictionary for the pmag_results table entry</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>  <span class="c1"># decorate it a bit</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Site direction included in results table&#39;</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACCEPT&#39;</span>
                <span class="n">dec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_dec&quot;</span><span class="p">])</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_inc&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;site_alpha95&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_alpha95&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">a95</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_alpha95&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">a95</span> <span class="o">=</span> <span class="mf">180.</span>
                <span class="n">sitedat</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">SiteNFO</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span>
                    <span class="mi">0</span><span class="p">]</span>  <span class="c1"># fish out site information (lat/lon, etc.)</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sitedat</span><span class="p">[</span><span class="s1">&#39;site_lat&#39;</span><span class="p">])</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sitedat</span><span class="p">[</span><span class="s1">&#39;site_lon&#39;</span><span class="p">])</span>
                <span class="n">plon</span><span class="p">,</span> <span class="n">plat</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">dm</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dia_vgp</span><span class="p">(</span>
                    <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">a95</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>  <span class="c1"># get the VGP for this site</span>
                <span class="k">if</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                    <span class="n">C</span> <span class="o">=</span> <span class="s1">&#39; (spec coord) &#39;</span>
                <span class="k">if</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="n">C</span> <span class="o">=</span> <span class="s1">&#39; (geog. coord) &#39;</span>
                <span class="k">if</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;100&#39;</span><span class="p">:</span>
                    <span class="n">C</span> <span class="o">=</span> <span class="s1">&#39; (strat. coord) &#39;</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;pmag_result_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;VGP Site: &quot;</span> <span class="o">+</span> \
                    <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span>  <span class="c1"># decorate some more</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;result_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Site VGP, coord system = &quot;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; component: &#39;</span> <span class="o">+</span> <span class="n">comp</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_site_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;pmag_criteria_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACCEPT&#39;</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_citation_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;This study&#39;</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_analyst_mail_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_location_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">avg_directions_by_sample</span><span class="p">:</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_sample_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_sample_names&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_names&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;pole_comp_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_comp_name&#39;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_dec&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_inc&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_alpha95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_alpha95&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_n_lines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n_lines&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_n_planes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n_planes&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vgp_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_n&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_k&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_k&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_r&quot;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.4f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_lon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.4f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                        <span class="n">PmagResRec</span><span class="p">,</span> <span class="s2">&quot;er_site_names&quot;</span><span class="p">,</span> <span class="s2">&quot;average_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
                <span class="n">site_height</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                    <span class="n">height_nfo</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_height</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_height&#39;</span><span class="p">]</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vgp_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plat</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vgp_lon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plon</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vgp_dp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dp</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vgp_dm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dm</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;DA-DIR-GEO&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]:</span>
                    <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:DA-DIR-GEO&quot;</span>
                <span class="k">if</span> <span class="s1">&#39;100&#39;</span> <span class="ow">in</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;DA-DIR-TILT&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]:</span>
                    <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:DA-DIR-TILT&quot;</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;site_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">avg_by_polarity</span><span class="p">:</span>  <span class="c1"># assign polarity based on angle of pole lat to spin axis - may want to re-think this sometime</span>
                    <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">plat</span><span class="p">)])</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mf">55.</span><span class="p">:</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mf">55.</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mf">125.</span><span class="p">:</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;=</span> <span class="mf">125.</span><span class="p">:</span>
                        <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;site_polarity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">avg_by_polarity</span><span class="p">:</span>
        <span class="c1"># find the tilt corrected data</span>
        <span class="n">crecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
            <span class="n">PmagSites</span><span class="p">,</span> <span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crecs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># if there aren&#39;t any, find the geographic corrected data</span>
            <span class="n">crecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">PmagSites</span><span class="p">,</span> <span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># if there are some,</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="n">crecs</span><span class="p">,</span> <span class="s1">&#39;site_comp_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span>
                <span class="mi">0</span><span class="p">]</span>  <span class="c1"># find the first component</span>
            <span class="c1"># fish out all of the first component</span>
            <span class="n">crecs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">crecs</span><span class="p">,</span> <span class="s1">&#39;site_comp_name&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="n">precs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">crecs</span><span class="p">:</span>
                <span class="n">precs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;dec&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;site_dec&#39;</span><span class="p">],</span> <span class="s1">&#39;inc&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;site_inc&#39;</span><span class="p">],</span>
                              <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">],</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]})</span>
            <span class="c1"># calculate average by polarity</span>
            <span class="n">polpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_by_pol</span><span class="p">(</span><span class="n">precs</span><span class="p">)</span>
            <span class="c1"># hunt through all the modes (normal=A, reverse=B, all=ALL)</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">polpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">PolRes</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s1">&#39;er_citation_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;This study&#39;</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;pmag_result_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Polarity Average: Polarity &quot;</span> <span class="o">+</span> <span class="n">mode</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;n&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;r&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_k&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%6.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;k&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s2">&quot;average_alpha95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;alpha95&#39;</span><span class="p">])</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s1">&#39;er_site_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s1">&#39;er_location_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polpars</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s1">&#39;locs&#39;</span><span class="p">]</span>
                <span class="n">PolRes</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PolRes</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_intensities</span> <span class="ow">and</span> <span class="n">nositeints</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>  <span class="c1"># now do intensities for each site</span>
            <span class="k">if</span> <span class="n">plotsites</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_intensities_by_sample</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">intlist</span> <span class="o">=</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">SpecInts</span>  <span class="c1"># if using specimen level data</span>
            <span class="k">if</span> <span class="n">avg_intensities_by_sample</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">intlist</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">PmagSamps</span>  <span class="c1"># if using sample level data</span>
            <span class="c1"># get all the intensities  for this site</span>
            <span class="n">Ints</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">intlist</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are some</span>
                <span class="c1"># get average intensity stuff for site table</span>
                <span class="n">PmagSiteRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">average_int</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">)</span>
                <span class="c1"># get average intensity stuff for results table</span>
                <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">average_int</span><span class="p">(</span><span class="n">Ints</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plotsites</span><span class="p">:</span>  <span class="c1"># if site by site examination requested - print this site out to the screen</span>
                    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">Ints</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_name&#39;</span><span class="p">],</span> <span class="s1">&#39; </span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_int&#39;</span><span class="p">])))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average: &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="mf">1e6</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int&#39;</span><span class="p">])),</span> <span class="s1">&#39;N: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ints</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sigma: &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="mf">1e6</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">])),</span> <span class="s1">&#39;Sigma %: &#39;</span><span class="p">,</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma_perc&#39;</span><span class="p">])</span>
                    <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Press any key to continue</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">er_location_name</span> <span class="o">=</span> <span class="n">Ints</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
                <span class="c1"># decorate the records</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">er_location_name</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_location_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">er_location_name</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;er_analyst_mail_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;i&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_intensities_by_sample</span><span class="p">:</span>
                    <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                        <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>  <span class="c1"># list of all specimens used</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_specimen_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                        <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">)</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">)</span>  <span class="c1"># list of all samples used</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">)</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;er_site_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span>
                <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span>
                <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span>
                    <span class="n">Ints</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">)</span>
                <span class="n">kill</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="s1">&#39;site_int&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nocrit</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">kill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">b</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int&#39;</span><span class="p">]),</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">sig</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">])</span>
                    <span class="c1"># fish out site direction</span>
                    <span class="n">sdir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">PmagResults</span><span class="p">,</span> <span class="s1">&#39;er_site_names&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="c1"># get the VDM for this record using last average</span>
                    <span class="c1"># inclination (hope it is the right one!)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sdir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;average_inc&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">inc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sdir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;average_inc&#39;</span><span class="p">])</span>
                        <span class="c1"># get magnetic latitude using dipole formula</span>
                        <span class="n">mlat</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magnetic_lat</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
                        <span class="c1"># get VDM with magnetic latitude</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vdm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">b_vdm</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mlat</span><span class="p">))</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vdm_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_n&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;average_int_sigma&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PmagResRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">vdm_sig</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">b_vdm</span><span class="p">(</span>
                                <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">]),</span> <span class="n">mlat</span><span class="p">)</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vdm_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vdm_sig</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vdm_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">mlat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># define a model latitude</span>
                    <span class="k">if</span> <span class="n">get_model_lat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># use present site latitude</span>
                        <span class="n">mlats</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">SiteNFO</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">mlat</span> <span class="o">=</span> <span class="n">mlats</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_lat&#39;</span><span class="p">]</span>
                    <span class="c1"># use a model latitude from some plate reconstruction model</span>
                    <span class="c1"># (or something)</span>
                    <span class="k">elif</span> <span class="n">get_model_lat</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">mlats</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                            <span class="n">ModelLats</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;model_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mlats</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_model_lat&#39;</span><span class="p">]</span>
                        <span class="n">mlat</span> <span class="o">=</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;model_lat&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">mlat</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="c1"># get the VADM using the desired latitude</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vadm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">pmag</span><span class="o">.</span><span class="n">b_vdm</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mlat</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">sig</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">vdm_sig</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">b_vdm</span><span class="p">(</span>
                                <span class="nb">float</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_sigma&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">mlat</span><span class="p">))</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vadm_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vdm_sig</span><span class="p">)</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vadm_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_int_n&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;vadm_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="c1"># fish out site information (lat/lon, etc.)</span>
                    <span class="n">sitedat</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">SiteNFO</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">PmagSiteRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sitedat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sitedat</span> <span class="o">=</span> <span class="n">sitedat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitedat</span><span class="p">[</span><span class="s1">&#39;site_lat&#39;</span><span class="p">]</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitedat</span><span class="p">[</span><span class="s1">&#39;site_lon&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;UNKNOWN&#39;</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;average_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;UNKNOWN&#39;</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;pmag_result_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;V[A]DM: Site &quot;</span> <span class="o">+</span> <span class="n">site</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;result_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;V[A]DM of site&quot;</span>
                    <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;pmag_criteria_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ACCEPT&quot;</span>
                    <span class="k">if</span> <span class="n">agefile</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">PmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_age</span><span class="p">(</span>
                            <span class="n">PmagResRec</span><span class="p">,</span> <span class="s2">&quot;er_site_names&quot;</span><span class="p">,</span> <span class="s2">&quot;average_&quot;</span><span class="p">,</span> <span class="n">AgeNFO</span><span class="p">,</span> <span class="n">DefaultAge</span><span class="p">)</span>
                    <span class="n">site_height</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">height_nfo</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site_height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">PmagResRec</span><span class="p">[</span><span class="s2">&quot;average_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_height</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;site_height&#39;</span><span class="p">]</span>
                    <span class="n">PmagSites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagSiteRec</span><span class="p">)</span>
                    <span class="n">PmagResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PmagResRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PmagSites</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Tmp</span><span class="p">,</span> <span class="n">keylist</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">PmagSites</span><span class="p">)</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">siteout</span><span class="p">,</span> <span class="n">Tmp</span><span class="p">,</span> <span class="s1">&#39;pmag_sites&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; sites written to &#39;</span><span class="p">,</span> <span class="n">siteout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Site level table&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PmagResults</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">TmpRes</span><span class="p">,</span> <span class="n">keylist</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">PmagResults</span><span class="p">)</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">resout</span><span class="p">,</span> <span class="n">TmpRes</span><span class="p">,</span> <span class="s1">&#39;pmag_results&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; results written to &#39;</span><span class="p">,</span> <span class="n">resout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Results level table&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="orientation_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.orientation_magic">[docs]</a><span class="k">def</span> <span class="nf">orientation_magic</span><span class="p">(</span><span class="n">or_con</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dec_correction_con</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dec_correction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bed_correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">samp_con</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">hours_from_gmt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">method_codes</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">average_bedding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">orient_file</span><span class="o">=</span><span class="s1">&#39;orient.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span>
                      <span class="n">output_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_model</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    use this function to convert tab delimited field notebook information to MagIC formatted tables (er_samples and er_sites)</span>

<span class="sd">    INPUT FORMAT</span>
<span class="sd">        Input files must be tab delimited and have in the first line:</span>
<span class="sd">    tab  location_name</span>
<span class="sd">        Note: The &quot;location_name&quot; will facilitate searching in the MagIC database. Data from different</span>
<span class="sd">            &quot;locations&quot; should be put in separate files.  The definition of a &quot;location&quot; is rather loose.</span>
<span class="sd">             Also this is the word &#39;tab&#39; not a tab, which will be indicated by &#39;\t&#39;.</span>
<span class="sd">        The second line has the names of the columns (tab delimited), e.g.:</span>
<span class="sd">        site_name sample_name mag_azimuth field_dip date lat long sample_lithology sample_type sample_class shadow_angle hhmm stratigraphic_height bedding_dip_direction bedding_dip GPS_baseline image_name image_look image_photographer participants method_codes site_description sample_description GPS_Az, sample_igsn, sample_texture, sample_cooling_rate, cooling_rate_corr, cooling_rate_mcd</span>

<span class="sd">    defaults:</span>
<span class="sd">    orientation_magic(or_con=1, dec_correction_con=1, dec_correction=0, bed_correction=True, samp_con=&#39;1&#39;, hours_from_gmt=0, method_codes=&#39;&#39;, average_bedding=False, orient_file=&#39;orient.txt&#39;, samp_file=&#39;er_samples.txt&#39;, site_file=&#39;er_sites.txt&#39;, output_dir_path=&#39;.&#39;, input_dir_path=&#39;&#39;, append=False):</span>
<span class="sd">    orientation conventions:</span>
<span class="sd">        [1] Standard Pomeroy convention of azimuth and hade (degrees from vertical down)</span>
<span class="sd">             of the drill direction (field arrow).  lab arrow azimuth= sample_azimuth = mag_azimuth;</span>
<span class="sd">             lab arrow dip = sample_dip =-field_dip. i.e. the lab arrow dip is minus the hade.</span>
<span class="sd">        [2] Field arrow is the strike  of the plane orthogonal to the drill direction,</span>
<span class="sd">             Field dip is the hade of the drill direction.  Lab arrow azimuth = mag_azimuth-90</span>
<span class="sd">             Lab arrow dip = -field_dip</span>
<span class="sd">        [3] Lab arrow is the same as the drill direction;</span>
<span class="sd">             hade was measured in the field.</span>
<span class="sd">             Lab arrow azimuth = mag_azimuth; Lab arrow dip = 90-field_dip</span>
<span class="sd">        [4] lab azimuth and dip are same as mag_azimuth, field_dip : use this for unoriented samples too</span>
<span class="sd">        [5] Same as AZDIP convention explained below -</span>
<span class="sd">            azimuth and inclination of the drill direction are mag_azimuth and field_dip;</span>
<span class="sd">            lab arrow is as in [1] above.</span>
<span class="sd">            lab azimuth is same as mag_azimuth,lab arrow dip=field_dip-90</span>
<span class="sd">        [6] Lab arrow azimuth = mag_azimuth-90; Lab arrow dip = 90-field_dip</span>
<span class="sd">        [7] see http://earthref.org/PmagPy/cookbook/#field_info for more information.  You can customize other format yourself, or email ltauxe@ucsd.edu for help.</span>
<span class="sd">        [8] Lab arrow azimuth = mag_azimuth-180; Lab arrow dip = 90-field_dip</span>


<span class="sd">    Magnetic declination convention:</span>
<span class="sd">        [1] Use the IGRF value at the lat/long and date supplied [default]</span>
<span class="sd">        [2] Will supply declination correction</span>
<span class="sd">        [3] mag_az is already corrected in file</span>
<span class="sd">        [4] Correct mag_az but not bedding_dip_dir</span>

<span class="sd">    Sample naming convention:</span>
<span class="sd">        [1] XXXXY: where XXXX is an arbitrary length site designation and Y</span>
<span class="sd">            is the single character sample designation.  e.g., TG001a is the</span>
<span class="sd">            first sample from site TG001.    [default]</span>
<span class="sd">        [2] XXXX-YY: YY sample from site XXXX (XXX, YY of arbitrary length)</span>
<span class="sd">        [3] XXXX.YY: YY sample from site XXXX (XXX, YY of arbitrary length)</span>
<span class="sd">        [4-Z] XXXX[YYY]:  YYY is sample designation with Z characters from site XXX</span>
<span class="sd">        [5] site name = sample name</span>
<span class="sd">        [6] site name entered in site_name column in the orient.txt format input file  -- NOT CURRENTLY SUPPORTED</span>
<span class="sd">        [7-Z] [XXX]YYY:  XXX is site designation with Z characters from samples  XXXYYY</span>
<span class="sd">        NB: all others you will have to either customize your</span>
<span class="sd">            self or e-mail ltauxe@ucsd.edu for help.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        1) column order doesn&#39;t matter but the NAMES do.</span>
<span class="sd">        2) sample_name, sample_lithology, sample_type, sample_class, lat and long are required.  all others are optional.</span>
<span class="sd">        3) If subsequent data are the same (e.g., date, bedding orientation, participants, stratigraphic_height),</span>
<span class="sd">            you can leave the field blank and the program will fill in the last recorded information. BUT if you really want a blank stratigraphic_height, enter a &#39;-1&#39;.    These will not be inherited and must be specified for each entry: image_name, look, photographer or method_codes</span>
<span class="sd">        4) hhmm must be in the format:  hh:mm and the hh must be in 24 hour time.</span>
<span class="sd">    date must be mm/dd/yy (years &lt; 50 will be converted to  20yy and &gt;50 will be assumed 19yy).  hours_from_gmt is the number of hours to SUBTRACT from hh to get to  GMT.</span>
<span class="sd">        5) image_name, image_look and image_photographer are colon delimited lists of file name (e.g., IMG_001.jpg) image look direction and the name of the photographer respectively.  If all images had same look and photographer, just enter info once.  The images will be assigned to the site for which they were taken - not at the sample level.</span>
<span class="sd">        6) participants:  Names of who helped take the samples.  These must be a colon delimited list.</span>
<span class="sd">        7) method_codes:  Special method codes on a sample level, e.g., SO-GT5 which means the orientation is has an uncertainty of &gt;5 degrees</span>
<span class="sd">             for example if it broke off before orienting....</span>
<span class="sd">        8) GPS_Az is the place to put directly determined GPS Azimuths, using, e.g., points along the drill direction.</span>
<span class="sd">        9) sample_cooling_rate is the cooling rate in K per Ma</span>
<span class="sd">        10) int_corr_cooling_rate</span>
<span class="sd">        11) cooling_rate_mcd:  data adjustment method code for cooling rate correction;  DA-CR-EG is educated guess; DA-CR-PS is percent estimated from pilot samples; DA-CR-TRM is comparison between 2 TRMs acquired with slow and rapid cooling rates. is the percent cooling rate factor to apply to specimens from this sample, DA-CR-XX is the method code</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize some variables</span>
    <span class="c1"># bed_correction used to be BedCorr</span>
    <span class="c1"># dec_correction_con used to be corr</span>
    <span class="c1"># dec_correction used to be DecCorr</span>
    <span class="c1"># meths is now method_codes</span>
    <span class="c1"># delta_u is now hours_from_gmt</span>

    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="n">or_con</span><span class="p">,</span> <span class="n">dec_correction_con</span><span class="p">,</span> <span class="n">dec_correction</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
        <span class="n">or_con</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dec_correction_con</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec_correction</span><span class="p">)</span>
    <span class="n">hours_from_gmt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">hours_from_gmt</span><span class="p">)</span>
    <span class="n">stratpos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># date of sampling, latitude (pos North), longitude (pos East)</span>
    <span class="n">date</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">bed_dip</span><span class="p">,</span> <span class="n">bed_dip_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">Lats</span><span class="p">,</span> <span class="n">Lons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># list of latitudes and longitudes</span>
    <span class="c1"># lists of Sample records and Site records</span>
    <span class="n">SampOuts</span><span class="p">,</span> <span class="n">SiteOuts</span><span class="p">,</span> <span class="n">ImageOuts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">samplelist</span><span class="p">,</span> <span class="n">sitelist</span><span class="p">,</span> <span class="n">imagelist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">newbaseline</span><span class="p">,</span> <span class="n">newbeddir</span><span class="p">,</span> <span class="n">newbeddip</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">fpars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sclass</span><span class="p">,</span> <span class="n">lithology</span><span class="p">,</span> <span class="n">sample_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">newclass</span><span class="p">,</span> <span class="n">newlith</span><span class="p">,</span> <span class="n">newtype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    <span class="n">BPs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># bedding pole declinations, bedding pole inclinations</span>
    <span class="n">image_file</span> <span class="o">=</span> <span class="s2">&quot;er_images.txt&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># use 3.0. default filenames when in 3.0.</span>
    <span class="c1"># but, still allow for custom names</span>
    <span class="n">data_model</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_model</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">samp_file</span> <span class="o">==</span> <span class="s2">&quot;er_samples.txt&quot;</span><span class="p">:</span>
            <span class="n">samp_file</span> <span class="o">=</span> <span class="s2">&quot;samples.txt&quot;</span>
        <span class="k">if</span> <span class="n">site_file</span> <span class="o">==</span> <span class="s2">&quot;er_sites.txt&quot;</span><span class="p">:</span>
            <span class="n">site_file</span> <span class="o">=</span> <span class="s2">&quot;sites.txt&quot;</span>
        <span class="n">image_file</span> <span class="o">=</span> <span class="s2">&quot;images.txt&quot;</span>
    <span class="n">orient_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">orient_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">orient_file</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No such file: </span><span class="si">{}</span><span class="s2">.  If the orientation file is not in your current working directory, make sure you have specified the correct input directory.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orient_file</span><span class="p">)</span>
    <span class="n">samp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">)</span>
    <span class="n">site_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">site_file</span><span class="p">)</span>
    <span class="n">image_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span>

    <span class="c1"># validate input</span>
    <span class="k">if</span> <span class="s1">&#39;4&#39;</span> <span class="ow">in</span> <span class="n">samp_con</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[4][-]\d&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">samp_con</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;If using sample naming convention 4, you must provide the number of characters with which to distinguish sample from site. [4-Z] XXXX[YYY]:  YYY is sample designation with Z characters from site XXX)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;7&#39;</span> <span class="ow">in</span> <span class="n">samp_con</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[7][-]\d&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">samp_con</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;If using sample naming convention 7, you must provide the number of characters with which to distinguish sample from site.  [7-Z] [XXX]YYY:  XXX is site designation with Z characters from samples  XXXYYY&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dec_correction_con</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dec_correction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;If using magnetic declination convention 2, you must also provide a declincation correction in degrees&quot;</span><span class="p">)</span>

    <span class="n">SampRecs</span><span class="p">,</span> <span class="n">SiteRecs</span><span class="p">,</span> <span class="n">ImageRecs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SampRecs_sorted</span><span class="p">,</span> <span class="n">SiteRecs_sorted</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">SampRecs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
            <span class="c1"># convert 3.0. sample file to 2.5 format</span>
            <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">SampRecs3</span> <span class="o">=</span> <span class="n">SampRecs</span>
                <span class="n">SampRecs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">samp_rec</span> <span class="ow">in</span> <span class="n">SampRecs3</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                        <span class="n">samp_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">samp_magic3_2_magic2_map</span><span class="p">)</span>
                    <span class="n">SampRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="c1"># magic_data dictionary sorted by sample_name</span>
            <span class="n">SampRecs_sorted</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sort_magic_data</span><span class="p">(</span><span class="n">SampRecs</span><span class="p">,</span> <span class="s1">&#39;er_sample_name&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sample data to be appended to: &#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;problem with existing file: &#39;</span><span class="p">,</span>
                  <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39; will create new.&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">SiteRecs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">site_file</span><span class="p">)</span>
            <span class="c1"># convert 3.0. site file to 2.5 format</span>
            <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">SiteRecs3</span> <span class="o">=</span> <span class="n">SiteRecs</span>
                <span class="n">SiteRecs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">site_rec</span> <span class="ow">in</span> <span class="n">SiteRecs3</span><span class="p">:</span>
                    <span class="n">SiteRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                        <span class="n">site_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">site_magic3_2_magic2_map</span><span class="p">))</span>
            <span class="c1"># magic_data dictionary sorted by site_name</span>
            <span class="n">SiteRecs_sorted</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sort_magic_data</span><span class="p">(</span><span class="n">SiteRecs</span><span class="p">,</span> <span class="s1">&#39;er_site_name&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;site data to be appended to: &#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;problem with existing file: &#39;</span><span class="p">,</span>
                  <span class="n">site_file</span><span class="p">,</span> <span class="s1">&#39; will create new.&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ImageRecs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
            <span class="c1"># convert from 3.0. --&gt; 2.5</span>
            <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ImageRecs3</span> <span class="o">=</span> <span class="n">ImageRecs</span>
                <span class="n">ImageRecs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">image_rec</span> <span class="ow">in</span> <span class="n">ImageRecs3</span><span class="p">:</span>
                    <span class="n">ImageRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                        <span class="n">image_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">image_magic3_2_magic2_map</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;image data to be appended to: &#39;</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;problem with existing file: &#39;</span><span class="p">,</span>
                  <span class="n">image_file</span><span class="p">,</span> <span class="s1">&#39; will create new.&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># read in file to convert</span>
    <span class="c1">#</span>
    <span class="n">OrData</span><span class="p">,</span> <span class="n">location_name</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">orient_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">location_name</span> <span class="o">==</span> <span class="s2">&quot;demag_orient&quot;</span><span class="p">:</span>
        <span class="n">location_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># step through the data sample by sample</span>
    <span class="c1">#</span>
    <span class="c1"># use map_magic in here...</span>

    <span class="k">for</span> <span class="n">OrRec</span> <span class="ow">in</span> <span class="n">OrData</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;mag_azimuth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;mag_azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;field_dip&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;field_dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;mag_azimuth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
            <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;field_dip&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
            <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;field_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;sample_description&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">sample_description</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;sample_description&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sample_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;cooling_rate_corr&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="s1">&#39;cooling_rate_mcd&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;cooling_rate_mcd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DA-CR&#39;</span>
        <span class="n">sample_orientation_flag</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;sample_orientation_flag&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;sample_orientation_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span> <span class="ow">or</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_azimuth&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">sample_orientation_flag</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
        <span class="n">methcodes</span> <span class="o">=</span> <span class="n">method_codes</span>  <span class="c1"># initialize method codes</span>
        <span class="k">if</span> <span class="n">methcodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;method_codes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">methcodes</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> \
                    <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span>  <span class="c1"># add notes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;method_codes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">methcodes</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span>  <span class="c1"># add notes</span>

        <span class="n">codes</span> <span class="o">=</span> <span class="n">methcodes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">sample_name</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;sample_name&quot;</span><span class="p">]</span>
        <span class="c1"># patch added by rshaar 7/2016</span>
        <span class="c1"># if sample_name already exists in er_samples.txt:</span>
        <span class="c1"># merge the new data colmuns calculated by orientation_magic with the existing data colmuns</span>
        <span class="c1"># this is done to make sure no previous data in er_samples.txt and</span>
        <span class="c1"># er_sites.txt is lost.</span>

        <span class="k">if</span> <span class="n">sample_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">SampRecs_sorted</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Prev_MagRec</span> <span class="o">=</span> <span class="n">SampRecs_sorted</span><span class="p">[</span><span class="n">sample_name</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MagRec</span> <span class="o">=</span> <span class="n">Prev_MagRec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Prev_MagRec</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">MagRec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>

        <span class="c1"># the following keys were calculated or defined in the code above:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sample_igsn&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_texture&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_cooling_rate&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;cooling_rate_corr&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_rate_mcd&#39;</span><span class="p">]:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">OrRec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">location_name</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_name</span>
            <span class="k">elif</span> <span class="s2">&quot;er_location_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># the following keys are taken directly from OrRec dictionary:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">,</span> <span class="s2">&quot;er_sample_alternatives&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_orientation_flag&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># the following keys, if blank, used to be defined here as &quot;Not Specified&quot; :</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sample_class&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_lithology&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_type&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Not Specified&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Not Specified&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># &quot;Not Specified&quot;</span>

        <span class="c1"># (rshaar) From here parse new information and replace previous, if exists:</span>
    <span class="c1">#</span>
    <span class="c1"># parse information common to all orientation methods</span>
    <span class="c1">#</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;sample_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;IGSN&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_igsn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;IGSN&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_igsn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># MagRec[&quot;sample_height&quot;],MagRec[&quot;sample_bed_dip_direction&quot;],MagRec[&quot;sample_bed_dip&quot;]=&quot;&quot;,&quot;&quot;,&quot;&quot;</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">],</span> <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># if &quot;er_sample_alternatives&quot; in OrRec.keys():</span>
        <span class="c1">#    MagRec[&quot;er_sample_alternatives&quot;]=OrRec[&quot;sample_alternatives&quot;]</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;sample_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;mag_azimuth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;field_dip&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;mag_azimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;999&#39;</span>
        <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_azimuth&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">labaz</span><span class="p">,</span> <span class="n">labdip</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">orient</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_azimuth&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;field_dip&quot;</span><span class="p">]),</span> <span class="n">or_con</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">labaz</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">labaz</span> <span class="o">+=</span> <span class="mf">360.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labaz</span><span class="p">,</span> <span class="n">labdip</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;mag_azimuth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;999&#39;</span><span class="p">:</span>
            <span class="n">labaz</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;GPS_baseline&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;GPS_baseline&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">newbaseline</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;GPS_baseline&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newbaseline</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">newbaseline</span><span class="p">)</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;er_scientist_mail_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;participants&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">newlat</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newlat</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">newlat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No latitude specified for ! &quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span>
                  <span class="s2">&quot;. Latitude is required for all samples.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No latitude specified for ! &quot;</span> <span class="o">+</span> <span class="n">sample</span> <span class="o">+</span> <span class="s2">&quot;. Latitude is required for all samples.&quot;</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%11.5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">newlon</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newlon</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">newlon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No longitude specified for ! &quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span>
                  <span class="s2">&quot;. Longitude is required for all samples.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;No longitude specified for ! &quot;</span> <span class="o">+</span> <span class="n">sample</span> <span class="o">+</span> <span class="s2">&quot;. Longitude is required for all samples.&quot;</span><span class="p">)</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_lon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%11.5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;bedding_dip_direction&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">newbeddir</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip_direction&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newbeddir</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">bed_dip_dir</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;bedding_dip_direction&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;bedding_dip&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">newbeddip</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newbeddip</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">bed_dip</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;bedding_dip&#39;</span><span class="p">]</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bed_dip</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bed_dip_dir</span>
        <span class="c1"># MagRec[&quot;sample_type&quot;]=sample_type</span>
        <span class="k">if</span> <span class="n">labdip</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">labdip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;date&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">newdate</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">newdate</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">newdate</span>
            <span class="n">mmddyy</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mmddyy</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">yy</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="n">yy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">+</span> <span class="n">yy</span>
            <span class="n">decimal_year</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">mmddyy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">12</span>
            <span class="n">sample_date</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">mmddyy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mmddyy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;hhmm&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
                <span class="n">sample_date</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_date</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">labaz</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">labaz</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;stratigraphic_height&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;stratigraphic_height&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;stratigraphic_height&quot;</span><span class="p">]</span>
                <span class="n">stratpos</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;stratigraphic_height&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;stratigraphic_height&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>   <span class="c1"># make empty</span>
            <span class="k">elif</span> <span class="n">stratpos</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="c1"># keep last record if blank</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stratpos</span>
<span class="c1">#</span>
        <span class="c1"># get magnetic declination (corrected with igrf value)</span>
        <span class="k">if</span> <span class="n">dec_correction_con</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_azimuth&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doigrf</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">decimal_year</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># see issue 617</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Only dates prior to 2020 supported&quot;</span>
            <span class="n">Dir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
            <span class="n">dec_correction</span> <span class="o">=</span> <span class="n">Dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;bedding_dip&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip&quot;</span><span class="p">]</span>
                <span class="n">bed_dip</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bed_dip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">if</span> <span class="s2">&quot;bedding_dip_direction&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip_direction&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">bed_correction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;bedding_dip_direction&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">dec_correction</span>
                <span class="k">if</span> <span class="n">dd</span> <span class="o">&gt;</span> <span class="mf">360.</span><span class="p">:</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">-</span> <span class="mf">360.</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dd</span><span class="p">)</span>
                <span class="n">dip_dir</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;bedding_dip_direction&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">if</span> <span class="n">average_bedding</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]):</span>
                <span class="n">BPs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">90.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_azimuth&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_dip&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">methcodes</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-NO&#39;</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_description</span>
    <span class="c1">#</span>
    <span class="c1"># work on the site stuff too</span>
        <span class="k">if</span> <span class="s1">&#39;site_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;site_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># parse out the site name</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">parse_site</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;sample_name&quot;</span><span class="p">],</span> <span class="n">samp_con</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
        <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span>
        <span class="n">site_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># overwrite any prior description</span>
        <span class="k">if</span> <span class="s1">&#39;site_description&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;site_description&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">site_description</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;site_description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;image_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;image_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;image_look&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">looks</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;image_look&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">looks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s2">&quot;image_photographer&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">photographers</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s1">&#39;image_photographer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">photographers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">image</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">image</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imagelist</span><span class="p">:</span>
                    <span class="n">imagelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                    <span class="n">ImageRec</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_image_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;image_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;outcrop&quot;</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;image_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_date</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_citation_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_name</span>
                    <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">looks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_image_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Look direction: &quot;</span> <span class="o">+</span> <span class="n">looks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">looks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_image_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Look direction: &quot;</span> <span class="o">+</span> <span class="n">looks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_image_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Look direction: unknown&quot;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">photographers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_photographer_mail_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">photographers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">photographers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_photographer_mail_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">photographers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ImageRec</span><span class="p">[</span><span class="s1">&#39;er_photographer_mail_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
                    <span class="n">ImageOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ImageRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">site</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sitelist</span><span class="p">:</span>
            <span class="n">sitelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>  <span class="c1"># collect unique site names</span>
            <span class="c1"># patch added by rshaar 7/2016</span>
            <span class="c1"># if sample_name already exists in er_samples.txt:</span>
            <span class="c1"># merge the new data colmuns calculated by orientation_magic with the existing data colmuns</span>
            <span class="c1"># this is done to make sure no previous data in er_samples.txt and</span>
            <span class="c1"># er_sites.txt is lost.</span>

            <span class="k">if</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">SiteRecs_sorted</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">Prev_MagRec</span> <span class="o">=</span> <span class="n">SiteRecs_sorted</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">SiteRec</span> <span class="o">=</span> <span class="n">Prev_MagRec</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Prev_MagRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">SiteRec</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
            <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span>
            <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;er_location_name&quot;</span> <span class="ow">in</span> <span class="n">SiteRec</span> <span class="ow">and</span> <span class="n">SiteRec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">SiteRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;setting location name to &quot;&quot;&#39;</span><span class="p">)</span>
                <span class="n">SiteRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>

            <span class="c1"># SiteRec[&quot;site_lat&quot;]=MagRec[&quot;sample_lat&quot;]</span>
            <span class="c1"># SiteRec[&quot;site_lon&quot;]=MagRec[&quot;sample_lon&quot;]</span>
            <span class="c1"># SiteRec[&quot;site_height&quot;]=MagRec[&quot;sample_height&quot;]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;lithology&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Prev_MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Not Specified&quot;</span><span class="p">:</span>
                    <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Prev_MagRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span>

            <span class="c1"># SiteRec[&quot;site_class&quot;]=MagRec[&quot;sample_class&quot;]</span>
            <span class="c1"># SiteRec[&quot;site_lithology&quot;]=MagRec[&quot;sample_lithology&quot;]</span>
            <span class="c1"># SiteRec[&quot;site_type&quot;]=MagRec[&quot;sample_type&quot;]</span>

            <span class="k">if</span> <span class="n">site_description</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># overwrite only if site_description has something</span>
                <span class="n">SiteRec</span><span class="p">[</span><span class="s2">&quot;site_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_description</span>
            <span class="n">SiteOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SiteRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sample</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samplelist</span><span class="p">:</span>
            <span class="n">samplelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_azimuth&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># assume magnetic compass only</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:SO-MAG&#39;</span>
                <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                    <span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MagRec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;sample_azimuth&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">dec_correction_con</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">az</span> <span class="o">=</span> <span class="n">labaz</span> <span class="o">+</span> <span class="n">dec_correction</span>
                <span class="k">if</span> <span class="n">az</span> <span class="o">&gt;</span> <span class="mf">360.</span><span class="p">:</span>
                    <span class="n">az</span> <span class="o">=</span> <span class="n">az</span> <span class="o">-</span> <span class="mf">360.</span>
                <span class="n">CMDRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">CMDRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                <span class="n">CMDRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">az</span><span class="p">)</span>
                <span class="n">CMDRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-CMD-NORTH&#39;</span>
                <span class="n">CMDRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CMDRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                    <span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">CMDRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">dec_correction</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dec_correction_con</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">CMDRec</span><span class="p">[</span><span class="s1">&#39;sample_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_description</span> <span class="o">+</span> \
                        <span class="s1">&#39;:Declination correction calculated from IGRF&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CMDRec</span><span class="p">[</span><span class="s1">&#39;sample_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_description</span> <span class="o">+</span> \
                        <span class="s1">&#39;:Declination correction supplied by user&#39;</span>
                <span class="n">CMDRec</span><span class="p">[</span><span class="s2">&quot;sample_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CMDRec</span><span class="p">[</span><span class="s1">&#39;sample_description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                    <span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CMDRec</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;mag_az_bs&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_az_bs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_az_bs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="n">SRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">SRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                <span class="n">labaz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;mag_az_bs&quot;</span><span class="p">])</span>
                <span class="n">az</span> <span class="o">=</span> <span class="n">labaz</span> <span class="o">+</span> <span class="n">dec_correction</span>
                <span class="k">if</span> <span class="n">az</span> <span class="o">&gt;</span> <span class="mf">360.</span><span class="p">:</span>
                    <span class="n">az</span> <span class="o">=</span> <span class="n">az</span> <span class="o">-</span> <span class="mf">360.</span>
                <span class="n">SRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">az</span><span class="p">)</span>
                <span class="n">SRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">dec_correction</span><span class="p">)</span>
                <span class="n">SRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> \
                    <span class="s1">&#39;:SO-SIGHT-BACK:SO-CMD-NORTH&#39;</span>
                <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SRec</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># check for suncompass data</span>
    <span class="c1">#</span>
            <span class="c1"># there are sun compass data</span>
            <span class="k">if</span> <span class="s2">&quot;shadow_angle&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hours_from_gmt</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="c1">#hours_from_gmt=raw_input(&quot;Enter hours to subtract from time for  GMT: [0] &quot;)</span>
                    <span class="n">hours_from_gmt</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">SunRec</span><span class="p">,</span> <span class="n">sundata</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
                <span class="n">shad_az</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;hhmm&quot;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If using the column shadow_angle for sun compass data, you must also provide the time for each sample.  Sample &#39;</span><span class="p">,</span>
                          <span class="n">sample</span><span class="p">,</span> <span class="s1">&#39; has shadow_angle but is missing the &quot;hh:mm&quot; column.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># calculate sun declination</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">yy</span><span class="p">,</span> <span class="n">mmddyy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mmddyy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;hhmm&quot;</span><span class="p">])</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;delta_u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hours_from_gmt</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span>  <span class="c1"># do not truncate!</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span>  <span class="c1"># do not truncate!</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">]</span>
                    <span class="c1"># now you can truncate</span>
                    <span class="n">sundec</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">dosundec</span><span class="p">(</span><span class="n">sundata</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">SunRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sundec</span>  <span class="c1"># do not truncate!</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-SUN&#39;</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SunRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                        <span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SunRec</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># check for differential GPS data</span>
    <span class="c1">#</span>
            <span class="c1"># there are diff GPS data</span>
            <span class="k">if</span> <span class="s2">&quot;prism_angle&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;prism_angle&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">GPSRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">GPSRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                    <span class="n">prism_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;prism_angle&quot;</span><span class="p">])</span>
                    <span class="n">sundata</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;shadow_angle&quot;</span><span class="p">]</span>
                    <span class="n">sundec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dosundec</span><span class="p">(</span><span class="n">sundata</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">SunRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sundec</span><span class="p">)</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-SUN&#39;</span>
                    <span class="n">SunRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SunRec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span>
                        <span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SunRec</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># check for differential GPS data</span>
    <span class="c1">#</span>
            <span class="c1"># there are diff GPS data</span>
            <span class="k">if</span> <span class="s2">&quot;prism_angle&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;prism_angle&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">GPSRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">GPSRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                <span class="n">prism_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;prism_angle&quot;</span><span class="p">])</span>
                <span class="n">laser_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;laser_angle&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;GPS_baseline&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;GPS_baseline&quot;</span><span class="p">])</span>  <span class="c1"># new baseline</span>
                <span class="n">gps_dec</span> <span class="o">=</span> <span class="n">baseline</span> <span class="o">+</span> <span class="n">laser_angle</span> <span class="o">+</span> <span class="n">prism_angle</span> <span class="o">-</span> <span class="mf">90.</span>
                <span class="k">while</span> <span class="n">gps_dec</span> <span class="o">&gt;</span> <span class="mf">360.</span><span class="p">:</span>
                    <span class="n">gps_dec</span> <span class="o">=</span> <span class="n">gps_dec</span> <span class="o">-</span> <span class="mf">360.</span>
                <span class="k">while</span> <span class="n">gps_dec</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gps_dec</span> <span class="o">=</span> <span class="n">gps_dec</span> <span class="o">+</span> <span class="mf">360.</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">GPSRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gps_dec</span><span class="p">)</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-GPS-DIFF&#39;</span>
                <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GPSRec</span><span class="p">)</span>
            <span class="c1"># there are differential GPS Azimuth data</span>
            <span class="k">if</span> <span class="s2">&quot;GPS_Az&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrRec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;GPS_Az&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">GPSRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MagRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">GPSRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># make a copy of MagRec</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">OrRec</span><span class="p">[</span><span class="s2">&quot;GPS_Az&quot;</span><span class="p">]))</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;sample_declination_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">GPSRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methcodes</span> <span class="o">+</span> <span class="s1">&#39;:SO-GPS-DIFF&#39;</span>
                <span class="n">SampOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GPSRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">average_bedding</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">fpars</span><span class="p">:</span>
            <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">BPs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;over-writing all bedding with average &#39;</span><span class="p">)</span>
    <span class="n">Samps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SampOuts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">average_bedding</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">fpars</span><span class="p">:</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;sample_bed_dip_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
            <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;sample_bed_dip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">)</span>
            <span class="n">Samps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Samps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SampRecs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samplelist</span><span class="p">:</span>  <span class="c1"># overwrite prior for this sample</span>
            <span class="n">Samps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SiteRecs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sitelist</span><span class="p">:</span>  <span class="c1"># overwrite prior for this sample</span>
            <span class="n">SiteOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">ImageRecs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_image_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imagelist</span><span class="p">:</span>  <span class="c1"># overwrite prior for this sample</span>
            <span class="n">ImageOuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saving data...&#39;</span><span class="p">)</span>
    <span class="n">SampsOut</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">Samps</span><span class="p">)</span>
    <span class="n">Sites</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">SiteOuts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">SampsOut3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Sites3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">samp_rec</span> <span class="ow">in</span> <span class="n">SampsOut</span><span class="p">:</span>
            <span class="n">new_rec</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                <span class="n">samp_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">samp_magic2_2_magic3_map</span><span class="p">)</span>
            <span class="n">SampsOut3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site_rec</span> <span class="ow">in</span> <span class="n">Sites</span><span class="p">:</span>
            <span class="n">new_rec</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                <span class="n">site_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">site_magic2_2_magic3_map</span><span class="p">)</span>
            <span class="n">Sites3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rec</span><span class="p">)</span>
        <span class="n">wrote_samps</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">SampsOut3</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">)</span>
        <span class="n">wrote_sites</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">site_file</span><span class="p">,</span> <span class="n">Sites3</span><span class="p">,</span> <span class="s2">&quot;sites&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wrote_samps</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">SampsOut</span><span class="p">,</span> <span class="s2">&quot;er_samples&quot;</span><span class="p">)</span>
        <span class="n">wrote_sites</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">site_file</span><span class="p">,</span> <span class="n">Sites</span><span class="p">,</span> <span class="s2">&quot;er_sites&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wrote_samps</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data saved in &quot;</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39; and &#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No data found&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ImageOuts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># need to do conversion here 3.0. --&gt; 2.5</span>
        <span class="n">Images</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">ImageOuts</span><span class="p">)</span>
        <span class="n">image_type</span> <span class="o">=</span> <span class="s2">&quot;er_images&quot;</span>
        <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># convert 2.5 --&gt; 3.0.</span>
            <span class="n">image_type</span> <span class="o">=</span> <span class="s2">&quot;images&quot;</span>
            <span class="n">Images2</span> <span class="o">=</span> <span class="n">Images</span>
            <span class="n">Images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">image_rec</span> <span class="ow">in</span> <span class="n">Images2</span><span class="p">:</span>
                <span class="n">Images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                    <span class="n">image_rec</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">image_magic2_2_magic3_map</span><span class="p">))</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">image_file</span><span class="p">,</span> <span class="n">Images</span><span class="p">,</span> <span class="n">image_type</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image info saved in &quot;</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="azdip_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.azdip_magic">[docs]</a><span class="k">def</span> <span class="nf">azdip_magic</span><span class="p">(</span><span class="n">orient_file</span><span class="o">=</span><span class="s1">&#39;orient.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s2">&quot;samples.txt&quot;</span><span class="p">,</span> <span class="n">samp_con</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method_codes</span><span class="o">=</span><span class="s1">&#39;FS-FD&#39;</span><span class="p">,</span> <span class="n">location_name</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">data_model</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    takes space delimited AzDip file and converts to MagIC formatted tables</span>

<span class="sd">    Parameters:</span>
<span class="sd">        orient_file : name of azdip formatted input file</span>
<span class="sd">        samp_file : name of samples.txt formatted output file</span>
<span class="sd">        samp_con : integer of sample orientation convention</span>

<span class="sd">            - [1] XXXXY: where XXXX is an arbitrary length site designation and Y is the single character sample designation. e.g., TG001a is the first sample from site TG001.    [default]</span>
<span class="sd">            - [2] XXXX-YY: YY sample from site XXXX (XXX, YY of arbitrary length)</span>
<span class="sd">            - [3] XXXX.YY: YY sample from site XXXX (XXX, YY of arbitrary length)</span>
<span class="sd">            - [4-Z] XXXX[YYY]:  YYY is sample designation with Z characters from site XXX</span>
<span class="sd">            - [5] site name same as sample</span>
<span class="sd">            - [6] site name entered in site_name column in the orient.txt format input file  -- NOT CURRENTLY SUPPORTED</span>
<span class="sd">            - [7-Z] [XXXX]YYY:  XXXX is site designation with Z characters with sample name XXXXYYYY</span>

<span class="sd">        method_codes : colon delimited string with the following as desired</span>

<span class="sd">            - FS-FD field sampling done with a drill</span>
<span class="sd">            - FS-H field sampling done with hand samples</span>
<span class="sd">            - FS-LOC-GPS  field location done with GPS</span>
<span class="sd">            - FS-LOC-MAP  field location done with map</span>
<span class="sd">            - SO-POM   a Pomeroy orientation device was used</span>
<span class="sd">            - SO-ASC   an ASC orientation device was used</span>
<span class="sd">            - SO-MAG   orientation with magnetic compass</span>
<span class="sd">        location_name : location of samples</span>
<span class="sd">        append : boolean.  if True, append to the output file</span>
<span class="sd">        output_dir : path to output file directory</span>
<span class="sd">        input_dir : path to input file directory</span>
<span class="sd">        data_model : MagIC data model.</span>

<span class="sd">    INPUT FORMAT</span>
<span class="sd">        Input files must be space delimited:</span>
<span class="sd">            Samp  Az Dip Strike Dip</span>
<span class="sd">        Orientation convention:</span>
<span class="sd">             Lab arrow azimuth = mag_azimuth; Lab arrow dip = 90-field_dip</span>
<span class="sd">                e.g. field_dip is degrees from horizontal of drill direction</span>
<span class="sd">        Magnetic declination convention:</span>
<span class="sd">             Az is already corrected in file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># initialize variables</span>
    <span class="c1">#</span>
    <span class="n">data_model</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data_model</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_model</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">samp_file</span> <span class="o">==</span> <span class="s2">&quot;samples.txt&quot;</span><span class="p">):</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="s2">&quot;er_samples.txt&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_model</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">samp_file</span> <span class="o">==</span> <span class="s2">&quot;er_samples.txt&quot;</span><span class="p">):</span>
        <span class="n">samp_file</span> <span class="o">=</span> <span class="s2">&quot;samples.txt&quot;</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="n">or_con</span><span class="p">,</span> <span class="n">corr</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span>
    <span class="c1"># date of sampling, latitude (pos North), longitude (pos East)</span>
    <span class="n">date</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">bed_dip</span><span class="p">,</span> <span class="n">bed_dip_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">participantlist</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of site names</span>
    <span class="n">Lats</span><span class="p">,</span> <span class="n">Lons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># list of latitudes and longitudes</span>
    <span class="c1"># lists of Sample records and Site records</span>
    <span class="n">SampRecs</span><span class="p">,</span> <span class="n">SiteRecs</span><span class="p">,</span> <span class="n">ImageRecs</span><span class="p">,</span> <span class="n">imagelist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">average_bedding</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">newbaseline</span><span class="p">,</span> <span class="n">newbeddir</span><span class="p">,</span> <span class="n">newbeddip</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">delta_u</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">sclass</span><span class="p">,</span> <span class="n">lithology</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">newclass</span><span class="p">,</span> <span class="n">newlith</span><span class="p">,</span> <span class="n">newtype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">corr</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span>
    <span class="n">DecCorr</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
    <span class="n">orient_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">orient_file</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">)</span>
    <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">orient_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">SampRecs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sample data to be appended to: &quot;</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;problem with existing samp file: &#39;</span><span class="p">,</span>
                  <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39; will create new&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># read in file to convert</span>
    <span class="c1">#</span>
    <span class="n">azfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">orient_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">AzDipDat</span> <span class="o">=</span> <span class="n">azfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">azfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">AzDipDat</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;No data in orientation file, please try again&#39;</span>
    <span class="n">azfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">SampOut</span><span class="p">,</span> <span class="n">samplist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">AzDipDat</span><span class="p">:</span>
        <span class="n">orec</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">labaz</span><span class="p">,</span> <span class="n">labdip</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">orient</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">or_con</span><span class="p">)</span>
            <span class="n">bed_dip</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">bed_dip</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bed_dip_dir</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> \
                    <span class="mf">90.</span>  <span class="c1"># assume dip to right of strike</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bed_dip_dir</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># assume dip to right of strike</span>
            <span class="n">MagRec</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_name</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># parse information common to all orientation methods</span>
    <span class="c1">#</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bed_dip</span><span class="p">)</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_bed_dip_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bed_dip_dir</span><span class="p">)</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">labdip</span><span class="p">)</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">labaz</span><span class="p">)</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="n">method_codes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">OR</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                <span class="n">method_type</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;SO&quot;</span> <span class="ow">in</span> <span class="n">method_type</span><span class="p">:</span>
                    <span class="n">OR</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">OR</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">method_codes</span> <span class="o">=</span> <span class="n">method_codes</span> <span class="o">+</span> <span class="s2">&quot;:SO-NO&quot;</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_codes</span>
            <span class="c1"># parse out the site name</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">parse_site</span><span class="p">(</span><span class="n">orec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">samp_con</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span>
            <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;magic_software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
            <span class="n">SampOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MagRec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samplist</span><span class="p">:</span>
                <span class="n">samplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MagRec</span><span class="p">[</span><span class="s1">&#39;er_sample_name&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="n">SampRecs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">samp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samplist</span><span class="p">:</span>
            <span class="n">SampOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
    <span class="n">Samps</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fillkeys</span><span class="p">(</span><span class="n">SampOut</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># write to file</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">Samps</span><span class="p">,</span> <span class="s2">&quot;er_samples&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># translate sample records to MagIC 3</span>
        <span class="n">Samps3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">samp</span> <span class="ow">in</span> <span class="n">Samps</span><span class="p">:</span>
            <span class="n">Samps3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span>
                <span class="n">samp</span><span class="p">,</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">samp_magic2_2_magic3_map</span><span class="p">))</span>
        <span class="c1"># write to file</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">Samps3</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data saved in &quot;</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span></div>


<span class="k">def</span> <span class="nf">read_core_csv_file</span><span class="p">(</span><span class="n">sum_file</span><span class="p">):</span>
    <span class="n">Cores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sum_file</span><span class="p">):</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sum_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">indat</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Core Summary&quot;</span> <span class="ow">in</span> <span class="n">indat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">indat</span><span class="p">[</span><span class="n">headline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Core Top (m)&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s2">&quot;Core Top (m)&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s2">&quot;Top depth cored CSF (m)&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Top depth cored (m)&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_depth_key</span> <span class="o">=</span> <span class="s1">&#39;Top depth cored (m)&#39;</span>
        <span class="k">if</span> <span class="s2">&quot;Core Label&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_label_key</span> <span class="o">=</span> <span class="s2">&quot;Core Label&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Core label&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_label_key</span> <span class="o">=</span> <span class="s2">&quot;Core label&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Label ID&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">core_label_key</span> <span class="o">=</span> <span class="s2">&quot;Label ID&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">indat</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="s1">&#39;TOTALS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">CoreRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                    <span class="n">CoreRec</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">Cores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CoreRec</span><span class="p">)</span>
        <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Cores</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no Core depth information available: import core summary file&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">core_depth_key</span><span class="p">,</span> <span class="n">core_label_key</span><span class="p">,</span> <span class="n">Cores</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>


<div class="viewcode-block" id="Site"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.Site">[docs]</a><span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; This Site class is for use within Jupyter/IPython notebooks. It reads in</span>
<span class="sd">    MagIC-formatted data (text files) and compiles fits, separates them by type,</span>
<span class="sd">    and plots equal-area projections inline. If means were not taken and output</span>
<span class="sd">    within the Demag GUI, it should automatically compute the Fisher mean for each</span>
<span class="sd">    fit type. Code is still a work in progress, but it is currently useful for</span>
<span class="sd">    succinctly computing/displaying data in notebook format.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_name</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s2">&quot;MagIC&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        site_name: the name of the site</span>
<span class="sd">        data_path: put all MagIC data (text files) in a single directory and</span>
<span class="sd">        provide its path</span>
<span class="sd">        data_format: MagIC-formatted data is necessary in this code, but future</span>
<span class="sd">        compatibility with other formats possible (built-in CIT_magic conversion?)</span>
<span class="sd">        *other keyword arguments not necessary*</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># import necessary functions to be used in the notebook</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="k">global</span> <span class="n">pd</span>
        <span class="k">global</span> <span class="n">plt</span>
        <span class="k">global</span> <span class="n">os</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_file_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;.*txt&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">:</span>
            <span class="n">path_to_open</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_open</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;er_sites&#39;</span> <span class="ow">in</span> <span class="n">first_line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">er_sites_path</span> <span class="o">=</span> <span class="n">path_to_open</span>
            <span class="k">elif</span> <span class="s1">&#39;pmag_sites&#39;</span> <span class="ow">in</span> <span class="n">first_line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mean_path</span> <span class="o">=</span> <span class="n">path_to_open</span>
            <span class="k">elif</span> <span class="s1">&#39;pmag_specimens&#39;</span> <span class="ow">in</span> <span class="n">first_line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">path_to_open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">site_name</span>
        <span class="c1"># self.data_path = data_path # default name of &#39;pmag_specimens&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">data_format</span>  <span class="c1"># default name of &#39;pmag_sites&#39;</span>
        <span class="c1"># self.mean_path = mean_path # default name of &#39;er_sites&#39;</span>
        <span class="c1">#self.er_sites_path = er_sites_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">==</span> <span class="s2">&quot;MagIC&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">er_sites_path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">er_sites_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Please convert data to MagIC format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_all_fits</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">site_lat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">site_lon</span><span class="p">)</span>
        <span class="c1"># the following exception won&#39;t be necessary if parse_all_fits is</span>
        <span class="c1"># working properly</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Make fisher means within the demag GUI - functionality for handling this is in progress&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Site.parse_fits"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.Site.parse_fits">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;USE PARSE_ALL_FITS unless otherwise necessary</span>
<span class="sd">        Isolate fits by the name of the fit; we also set &#39;specimen_tilt_correction&#39; to zero in order</span>
<span class="sd">        to only include data in geographic coordinates - THIS NEEDS TO BE GENERALIZED</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">specimen_comp_name</span> <span class="o">==</span>
                             <span class="n">fit_name</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">specimen_tilt_correction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fits</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">site_comp_name</span> <span class="o">==</span>
                               <span class="n">fit_name</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">site_tilt_correction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mean_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_mean&quot;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">parse_all_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is run upon initialization of the Site class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">specimen_comp_name</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fit_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_fits</span><span class="p">(</span><span class="n">fit_type</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data separated by &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_types</span><span class="p">,</span>
              <span class="s2">&quot;fits and can be accessed by &lt;site_name&gt;.&lt;fit_name&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_fit_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_types</span>

    <span class="k">def</span> <span class="nf">get_fisher_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">):</span>
        <span class="n">mean_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_mean&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fisher_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dec&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                                <span class="s1">&#39;inc&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">),</span>
                                <span class="s1">&#39;alpha95&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_alpha95</span><span class="p">),</span>
                                <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_k</span><span class="p">),</span>
                                <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_r</span><span class="p">),</span>
                                <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_name</span><span class="p">)</span><span class="o">.</span><span class="n">site_n</span><span class="p">)}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_dict</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fit_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_dec</span><span class="p">)[</span><span class="n">fit_num</span><span class="p">],</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_inc</span><span class="p">)[</span><span class="n">fit_num</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
            <span class="c1">#fish_mean = pmag.fisher_mean(directions)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fisher_dict</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directions</span><span class="p">)</span>
            <span class="c1"># setattr(self,fisher_dict,fish_mean)</span>
            <span class="c1">#self.fisher_dict = getattr(self,mean_name)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fisher_dict</span>

    <span class="k">def</span> <span class="nf">get_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span>

    <span class="k">def</span> <span class="nf">get_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span>

    <span class="k">def</span> <span class="nf">get_site_coor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">eq_plot_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fignum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
        <span class="n">clr_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">fits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_types</span><span class="p">:</span>
            <span class="n">mean_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_mean&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">mean_code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_dec</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_inc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clrs</span><span class="p">[</span><span class="n">clr_idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">fits</span> <span class="o">+</span> <span class="s1">&#39; directions&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                      <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">))</span>
                <span class="n">plot_di_mean</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                             <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">),</span>
                             <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_alpha95</span><span class="p">),</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">clrs</span><span class="p">[</span><span class="n">clr_idx</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fits</span> <span class="o">+</span> <span class="s1">&#39; mean&#39;</span><span class="p">)</span>
                <span class="n">clr_idx</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">random_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_dec</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_inc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fits</span> <span class="o">+</span> <span class="s1">&#39; directions&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                      <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">))</span>
                <span class="n">plot_di_mean</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                             <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">),</span>
                             <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_alpha95</span><span class="p">),</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fits</span> <span class="o">+</span> <span class="s1">&#39; mean&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">eq_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fignum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
        <span class="n">mean_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_mean&quot;</span>
        <span class="k">if</span> <span class="n">clr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">random_color</span> <span class="o">=</span> <span class="n">clr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">random_color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_dec</span><span class="p">,</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">)</span><span class="o">.</span><span class="n">specimen_inc</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fit_name</span> <span class="o">+</span> <span class="s1">&#39; directions&#39;</span><span class="p">)</span>
        <span class="n">plot_di_mean</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_dec</span><span class="p">),</span>
                     <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_inc</span><span class="p">),</span>
                     <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean_code</span><span class="p">)</span><span class="o">.</span><span class="n">site_alpha95</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">fit_name</span> <span class="o">+</span> <span class="s1">&#39; mean&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># def eq_plot_sidebyside(self, fit_name):</span>
    <span class="c1">#     fig,ax = plt.subplots(1,2)</span>
    <span class="c1">#     ax[0].plot(self.eq_plot_everything())</span>
    <span class="c1">#     ax[1].plot(self.eq_plot(fit_name))</span>
    <span class="c1">#     plt.show()</span>

    <span class="k">def</span> <span class="nf">get_site_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">fit_name</span><span class="p">,</span> <span class="n">demag_type</span><span class="o">=</span><span class="s1">&#39;Thermal&#39;</span><span class="p">,</span> <span class="n">cong_test_result</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;site_type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">),</span>
                                    <span class="s1">&#39;site_lat&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lat</span><span class="p">(),</span>
                                    <span class="s1">&#39;site_lon&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lon</span><span class="p">(),</span>
                                    <span class="s1">&#39;demag_type&#39;</span><span class="p">:</span> <span class="n">demag_type</span><span class="p">,</span>
                                    <span class="s1">&#39;dec&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;dec&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;inc&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;inc&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;a_95&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;n&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;kappa&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;k&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fisher_mean</span><span class="p">(</span><span class="n">fit_name</span><span class="p">)[</span><span class="s1">&#39;r&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;cong_test_result&#39;</span><span class="p">:</span> <span class="n">cong_test_result</span><span class="p">},</span>
                                   <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_data</span></div>


<div class="viewcode-block" id="dayplot_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.dayplot_magic">[docs]</a><span class="k">def</span> <span class="nf">dayplot_magic</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">hyst_file</span><span class="o">=</span><span class="s2">&quot;specimens.txt&quot;</span><span class="p">,</span> <span class="n">rem_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">data_model</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes &#39;day plots&#39; (Day et al. 1977) and squareness/coercivity plots</span>
<span class="sd">    (Neel, 1955; plots after Tauxe et al., 2002); plots &#39;linear mixing&#39;</span>
<span class="sd">    curve from Dunlop and Carter-Stiglitz (2006).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        path_to_file : path to directory that contains files (default is current directory, &#39;.&#39;)</span>
<span class="sd">        the default input file is &#39;specimens.txt&#39; (data_model=3</span>
<span class="sd">        if data_model = 2, then must these are the defaults:</span>
<span class="sd">            hyst_file : hysteresis file (default is &#39;rmag_hysteresis.txt&#39;)</span>
<span class="sd">            rem_file : remanence file (default is &#39;rmag_remanence.txt&#39;)</span>
<span class="sd">        save : boolean argument to save plots (default is True)</span>
<span class="sd">        save_folder : relative directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is &#39;pdf&#39;)</span>
<span class="sd">        image_records (boolean): generate and return a record for each image in a list of dicts which can be ingested by pmag.magic_write, default is False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hyst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">hyst_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">rem_file</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">rem_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">rem_file</span><span class="p">)</span>
    <span class="c1"># hyst_file,rem_file=&quot;rmag_hysteresis.txt&quot;,&quot;rmag_remanence.txt&quot;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">path_to_file</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span>
    <span class="c1"># initialize some variables</span>
    <span class="c1"># define figure numbers for Day,S-Bc,S-Bcr</span>
    <span class="n">DSC</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bc&#39;</span><span class="p">],</span> <span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bcr&#39;</span><span class="p">],</span> <span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;bcr1-bcr2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">hyst_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">hyst_path</span><span class="p">)</span>
    <span class="n">rem_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">rem_file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">rem_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">rem_path</span><span class="p">)</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">BcrBc</span><span class="p">,</span> <span class="n">Bcr2</span><span class="p">,</span> <span class="n">Bc</span><span class="p">,</span> <span class="n">hsids</span><span class="p">,</span> <span class="n">Bcr</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Ms</span><span class="p">,</span> <span class="n">Bcr1</span><span class="p">,</span> <span class="n">Bcr1Bc</span><span class="p">,</span> <span class="n">S1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">data_model</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">hyst_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;er_location_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
                <span class="n">locations</span> <span class="o">=</span> <span class="n">locations</span> <span class="o">+</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_bcr&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_mr_moment&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_mr_moment&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_ms_moment&#39;</span><span class="p">]))</span>
                <span class="n">Bcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_bcr&#39;</span><span class="p">]))</span>
                <span class="n">Bc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;hysteresis_bc&#39;</span><span class="p">]))</span>
                <span class="n">BcrBc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Bc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;er_synthetic_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span>
                <span class="n">hsids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rem_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">rem_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;remanence_bcr&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;remanence_bcr&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">hsids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">])</span>
                        <span class="n">Bcr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;remanence_bcr&#39;</span><span class="p">]))</span>
                        <span class="n">Bcr1Bc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Bc</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                        <span class="n">S1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                        <span class="n">Bcr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hysteresis data for &#39;</span><span class="p">,</span>
                                  <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">],</span> <span class="s1">&#39; not found&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">hyst_file</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">contribution</span><span class="p">:</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">],</span>
                                  <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;specimens&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-E- No specimen file found in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">spec_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span>
        <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">df</span>

        <span class="c1"># get as much data as possible for naming plots</span>
        <span class="c1">#if pmagplotlib.isServer:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>


        <span class="n">loc_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">loc_list</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">do_rem</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="s1">&#39;rem_bcr&#39;</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_bcr&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_mr_moment&#39;</span><span class="p">]:</span>
                <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_mr_moment&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_ms_moment&#39;</span><span class="p">]))</span>
                <span class="n">Bcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_bcr&#39;</span><span class="p">]))</span>
                <span class="n">Bc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hyst_bc&#39;</span><span class="p">]))</span>
                <span class="n">BcrBc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Bc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">hsids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">do_rem</span> <span class="ow">and</span> <span class="n">Bc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;rem_bcr&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rem_bcr&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">Bcr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rem_bcr&#39;</span><span class="p">]))</span>
                        <span class="n">Bcr1Bc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Bc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">S1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">Bcr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bcr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hysteresis data for &#39;</span><span class="p">,</span>
                                  <span class="n">row</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; not found&#39;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># now plot the day and S-Bc, S-Bcr plots</span>
    <span class="c1">#</span>
    <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loc_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_Day.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">),</span>
          <span class="s1">&#39;S-Bcr&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loc_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_S-Bcr.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">),</span>
          <span class="s1">&#39;S-Bc&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loc_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_S-Bc.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bcr1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="c1">#plt.figure(num=DSC[&#39;S-Bc&#39;], figsize=(5, 5))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bcr&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;bcr1-bcr2&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_day</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">Bcr1Bc</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_s_bcr</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bcr&#39;</span><span class="p">],</span> <span class="n">Bcr1</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
        <span class="c1">#pmagplotlib.plot_init(DSC[&#39;bcr1-bcr2&#39;], 5, 5)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_bcr</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;bcr1-bcr2&#39;</span><span class="p">],</span> <span class="n">Bcr1</span><span class="p">,</span> <span class="n">Bcr2</span><span class="p">)</span>
        <span class="n">fnames</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;S-Bc&#39;</span><span class="p">)</span>
        <span class="n">fnames</span><span class="p">[</span><span class="s1">&#39;bcr1-bcr2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="s1">&#39;bcr1-bcr2.png&#39;</span><span class="p">)</span>
        <span class="n">DSC</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;S-Bc&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSC</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">fnames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loc_list</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;SI:__SA:__SP:__TY:_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">ftype</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loc_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">ftype</span><span class="p">,</span>
                             <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">DSC</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">image_recs</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">DSC</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_or_quit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">DSC</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">image_recs</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bc&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bcr&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="c1">#plt.figure(num=DSC[&#39;bcr1-bcr2&#39;], figsize=(5, 5))</span>
        <span class="k">del</span> <span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;bcr1-bcr2&#39;</span><span class="p">]</span>
        <span class="c1"># do other plots instead</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_day</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span> <span class="n">BcrBc</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="s1">&#39;bs&#39;</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_s_bcr</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bcr&#39;</span><span class="p">],</span> <span class="n">Bcr</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="s1">&#39;bs&#39;</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_s_bc</span><span class="p">(</span><span class="n">DSC</span><span class="p">[</span><span class="s1">&#39;S-Bc&#39;</span><span class="p">],</span> <span class="n">Bc</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="s1">&#39;bs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">DSC</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">fnames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loc_list</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;SI:__SA:__SP:__TY:_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>

    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">ftype</span><span class="p">],</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">loc_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">ftype</span><span class="p">,</span>
                         <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>

            <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">DSC</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">image_recs</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">DSC</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_or_quit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">DSC</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">image_recs</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fnames</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="smooth"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.smooth">[docs]</a><span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;bartlett&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smooth the data using a sliding window with requested size - meant to be</span>
<span class="sd">    used with the ipmag function curie().</span>
<span class="sd">    This method is based on the convolution of a scaled window with the signal.</span>
<span class="sd">    The signal is prepared by padding the beginning and the end of the signal</span>
<span class="sd">    with average of the first (last) ten values of the signal, to evoid jumps</span>
<span class="sd">    at the beginning/end. Output is an array of the smoothed signal.</span>

<span class="sd">    Required Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : the input signal, equally spaced!</span>
<span class="sd">    window_len : the dimension of the smoothing window</span>

<span class="sd">    Optional Parameters (defaults are used if not specified)</span>
<span class="sd">    ----------</span>
<span class="sd">    window : type of window from numpy library [&#39;flat&#39;,&#39;hanning&#39;,&#39;hamming&#39;,&#39;bartlett&#39;,&#39;blackman&#39;]</span>
<span class="sd">        (default is Bartlett)</span>
<span class="sd">        -flat window will produce a moving average smoothing.</span>
<span class="sd">        -Bartlett window is very similar to triangular window,</span>
<span class="sd">            but always ends with zeros at points 1 and n.</span>
<span class="sd">        -hanning,hamming,blackman are used for smoothing the Fourier transform</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;smooth only accepts 1 dimension arrays.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">window_len</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input vector needs to be bigger than window size.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">window_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="c1"># numpy available windows</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">window</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;flat&#39;</span><span class="p">,</span> <span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;bartlett&#39;</span><span class="p">,</span> <span class="s1">&#39;blackman&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Window is on of &#39;flat&#39;, &#39;hanning&#39;, &#39;hamming&#39;, &#39;bartlett&#39;, &#39;blackman&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># padding the beginning and the end of the signal with an average value to</span>
    <span class="c1"># evoid edge effect</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])]</span> <span class="o">*</span> <span class="n">window_len</span>
    <span class="n">end</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])]</span> <span class="o">*</span> <span class="n">window_len</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span>

    <span class="c1"># s=numpy.r_[2*x[0]-x[window_len:1:-1],x,2*x[-1]-x[-1:-window_len:-1]]</span>
    <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span><span class="p">:</span>  <span class="c1"># moving average</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">window_len</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;np.&#39;</span> <span class="o">+</span> <span class="n">window</span> <span class="o">+</span> <span class="s1">&#39;(window_len)&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">window_len</span><span class="p">:</span><span class="o">-</span><span class="n">window_len</span><span class="p">])</span></div>


<div class="viewcode-block" id="curie"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.curie">[docs]</a><span class="k">def</span> <span class="nf">curie</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">magic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">window_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">t_begin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots and interprets curie temperature data.</span>
<span class="sd">    The 1st derivative is calculated from smoothed M-T curve (convolution</span>
<span class="sd">    with triangular window with width= &lt;-w&gt; degrees)</span>
<span class="sd">    The 2nd derivative is calculated from smoothed 1st derivative curve</span>
<span class="sd">    (using the same sliding window width)</span>
<span class="sd">    The estimated curie temperation is the maximum of the 2nd derivative.</span>
<span class="sd">    Temperature steps should be in multiples of 1.0 degrees.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        file_name : name of file to be opened</span>
<span class="sd">        path_to_file : path to directory that contains file (default is current directory, &#39;.&#39;)</span>
<span class="sd">        window_length : dimension of smoothing window (input to smooth() function)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is svg)</span>
<span class="sd">        t_begin: start of truncated window for search (default is beginning of data)</span>
<span class="sd">        t_end: end of truncated window for search (default is end of data)</span>
<span class="sd">        magic : True if MagIC formatted measurements.txt file</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        A plot is shown and saved if save=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">window_len</span> <span class="o">=</span> <span class="n">window_length</span>

    <span class="c1"># read data from file</span>
    <span class="n">complete_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magic</span><span class="p">:</span>
        <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">complete_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;meas_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="mi">273</span>
        <span class="n">magn_key</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_intensity_col</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">magn_key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">complete_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="c1"># cut the data if -t is one of the flags</span>
    <span class="k">if</span> <span class="n">t_begin</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t_begin</span><span class="p">:</span>
            <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t_end</span><span class="p">:</span>
            <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># prepare the signal:</span>
    <span class="c1"># from M(T) array with unequal deltaT</span>
    <span class="c1"># to M(T) array with deltaT=(1 degree).</span>
    <span class="c1"># if delataT is larger, then points are added using linear fit between</span>
    <span class="c1"># consecutive data points.</span>
    <span class="c1"># exit if deltaT is not integer</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delta T should be integer, this program will not work!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;temperature range:&quot;</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">M</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">T</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check data in T=</span><span class="si">%.0f</span><span class="s2"> ,M[T] is ignored&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">slope</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">([</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">M</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">T</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># calculate the smoothed signal</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">M_smooth</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">M_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">window_len</span><span class="p">)</span>

    <span class="c1"># plot the original data and the smooth data</span>
    <span class="n">PLT</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;M_T&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;der1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;der2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Curie&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;M_T&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;M-T (sliding window=</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_len</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;M_T&#39;</span><span class="p">],</span> <span class="n">T</span><span class="p">,</span> <span class="n">M_smooth</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;M_T&#39;</span><span class="p">],</span> <span class="n">T</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Temperature C&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Magnetization&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">string</span><span class="p">)</span>

    <span class="c1"># calculate first derivative</span>
    <span class="n">d1</span><span class="p">,</span> <span class="n">T_d1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_smooth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">M_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">M_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">d1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dy</span><span class="o">/</span><span class="n">Dx</span><span class="p">)</span>
    <span class="n">T_d1</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">d1_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">window_len</span><span class="p">)</span>

    <span class="c1"># plot the first derivative</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;der1&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;1st derivative (sliding window=</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_len</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;der1&#39;</span><span class="p">],</span> <span class="n">T_d1</span><span class="p">,</span> <span class="n">d1_smooth</span><span class="p">,</span>
                        <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Temperature C&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">string</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;der1&#39;</span><span class="p">],</span> <span class="n">T_d1</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>

    <span class="c1"># calculate second derivative</span>
    <span class="n">d2</span><span class="p">,</span> <span class="n">T_d2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d1_smooth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">d1_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d1_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># print Dy/Dx</span>
        <span class="n">d2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dy</span><span class="o">/</span><span class="n">Dx</span><span class="p">)</span>
    <span class="n">T_d2</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="n">d2_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">window_len</span><span class="p">)</span>

    <span class="c1"># plot the second derivative</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;der2&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;2nd derivative (sliding window=</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_len</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;der2&#39;</span><span class="p">],</span> <span class="n">T_d2</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Temperature C&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">string</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;second derivative maximum is at T=</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span>
          <span class="nb">int</span><span class="p">(</span><span class="n">T_d2</span><span class="p">[</span><span class="n">d2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d2</span><span class="p">))]))</span>

    <span class="c1"># calculate Curie temperature for different width of sliding windows</span>
    <span class="n">curie</span><span class="p">,</span> <span class="n">curie_1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">wn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">win</span> <span class="ow">in</span> <span class="n">wn</span><span class="p">:</span>
        <span class="c1"># calculate the smoothed signal</span>
        <span class="n">M_smooth</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">M_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
        <span class="c1"># calculate first derivative</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">T_d1</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_smooth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">Dy</span> <span class="o">=</span> <span class="n">M_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">M_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">Dx</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dy</span><span class="o">/</span><span class="n">Dx</span><span class="p">)</span>
        <span class="n">T_d1</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="n">d1_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
        <span class="c1"># calculate second derivative</span>
        <span class="n">d2</span><span class="p">,</span> <span class="n">T_d2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d1_smooth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">Dy</span> <span class="o">=</span> <span class="n">d1_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d1_smooth</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">Dx</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dy</span><span class="o">/</span><span class="n">Dx</span><span class="p">)</span>
        <span class="n">T_d2</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="n">d2_smooth</span> <span class="o">=</span> <span class="n">smooth</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
        <span class="n">d2_smooth</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d2_smooth</span><span class="p">)</span>
        <span class="n">curie</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T_d2</span><span class="p">[</span><span class="n">d2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d2</span><span class="p">))])</span>
        <span class="n">curie_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T_d2</span><span class="p">[</span><span class="n">d2_smooth</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d2_smooth</span><span class="p">))])</span>

    <span class="c1"># plot Curie temp for different sliding window length</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;Curie&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">PLT</span><span class="p">[</span><span class="s1">&#39;Curie&#39;</span><span class="p">],</span> <span class="n">wn</span><span class="p">,</span> <span class="n">curie</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                        <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Sliding Window Width (degrees)&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Curie Temp&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Curie Statistics&#39;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PLT</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PLT</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLT</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not save: &#39;</span><span class="p">,</span> <span class="n">PLT</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output file format not supported &quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="chi_magic2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.chi_magic2">[docs]</a><span class="k">def</span> <span class="nf">chi_magic2</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;magic_measurements.txt&#39;</span><span class="p">,</span>
              <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates plots that compare susceptibility to temperature at different</span>
<span class="sd">    frequencies.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        (defaults are used if not specified)</span>
<span class="sd">        path_to_file : path to directory that contains file (default is current directory, &#39;.&#39;)</span>
<span class="sd">        file_name : name of file to be opened (default is &#39;magic_measurements.txt&#39;)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cont</span><span class="p">,</span> <span class="n">FTinit</span><span class="p">,</span> <span class="n">BTinit</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">complete_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">Tind</span><span class="p">,</span> <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">EXP</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># get list of unique experiment names</span>
    <span class="c1">#</span>
    <span class="c1"># initialize some variables (a continuation flag, plot initialization</span>
    <span class="c1"># flags and the experiment counter</span>
    <span class="n">experiment_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment_names</span><span class="p">:</span>
            <span class="n">experiment_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">])</span>
    <span class="c1">#</span>
    <span class="c1"># hunt through by experiment name</span>
    <span class="k">if</span> <span class="n">EXP</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">experiment_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">EXP</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bad experiment name&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">experiment_names</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">EXP</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">))</span>
    <span class="c1">#</span>
    <span class="c1"># initialize lists of data, susceptibility, temperature, frequency and</span>
    <span class="c1"># field</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
            <span class="n">methcodes</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span>
            <span class="n">meths</span> <span class="o">=</span> <span class="n">methcodes</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e</span> <span class="ow">and</span> <span class="s2">&quot;LP-X&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>  <span class="c1"># looking for chi measurement</span>
                <span class="k">if</span> <span class="s1">&#39;measurement_temp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;300&#39;</span>  <span class="c1"># set defaults</span>
                <span class="k">if</span> <span class="s1">&#39;measurement_freq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>  <span class="c1"># set defaults</span>
                <span class="k">if</span> <span class="s1">&#39;measurement_lab_field_ac&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_lab_field_ac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>  <span class="c1"># set default</span>
                <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_x&#39;</span><span class="p">]))</span>
                <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_temp&#39;</span><span class="p">]))</span>
                <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_freq&#39;</span><span class="p">]))</span>
                <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_lab_field_ac&#39;</span><span class="p">]))</span>
    <span class="c1">#</span>
    <span class="c1"># get unique list of Ts,Fs, and Bs</span>
    <span class="c1">#</span>
        <span class="n">Ts</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">Bs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>   <span class="c1"># hunt through all the measurements</span>
            <span class="k">if</span> <span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ts</span><span class="p">:</span>
                <span class="n">Ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>  <span class="c1"># append if not in list</span>
            <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Fs</span><span class="p">:</span>
                <span class="n">Fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Bs</span><span class="p">:</span>
                <span class="n">Bs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">Ts</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># sort list of temperatures, frequencies and fields</span>
        <span class="n">Fs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">Bs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;-x&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># just plot the one</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increment experiment number</span>
    <span class="c1">#</span>
    <span class="c1"># plot chi versus T and F holding B constant</span>
    <span class="c1">#</span>
        <span class="n">plotnum</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># initialize plot number to 1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># if there are any data to plot, continue</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">Bs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># keeping field constant and at maximum</span>
            <span class="n">XTF</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># initialize list of chi versus Temp and freq</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Fs</span><span class="p">:</span>   <span class="c1"># step through frequencies sequentially</span>
                <span class="n">XT</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># initialize list of chi versus temp</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>  <span class="c1"># hunt through all the data</span>
                    <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">B</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>  <span class="c1"># select data with given freq and field</span>
                        <span class="n">XT</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">kk</span><span class="p">]])</span>  <span class="c1"># append to list</span>
                <span class="n">XTF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XT</span><span class="p">)</span>  <span class="c1"># append list to list of frequencies</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">XT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if there are any temperature dependent data</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">plotnum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># initialize plot</span>
                <span class="c1"># call the plotting function</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xtf</span><span class="p">(</span><span class="n">plotnum</span><span class="p">,</span> <span class="n">XTF</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)</span>
                <span class="n">plotnum</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increment plot number</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># set frequency to minimum</span>
            <span class="n">XTB</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># initialize list if chi versus Temp and field</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Bs</span><span class="p">:</span>  <span class="c1"># step through field values</span>
                <span class="n">XT</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># initial chi versus temp list for this field</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>  <span class="c1"># hunt through all the data</span>
                    <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">B</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>  <span class="c1"># select data with given freq and field</span>
                        <span class="n">XT</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">kk</span><span class="p">]])</span>  <span class="c1"># append to list</span>
                <span class="n">XTB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XT</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">XT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if there are any temperature dependent data</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">plotnum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># set up plot</span>
                <span class="c1"># call the plotting function</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xtb</span><span class="p">(</span><span class="n">plotnum</span><span class="p">,</span> <span class="n">XTB</span><span class="p">,</span> <span class="n">Bs</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">show_fig</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)</span>
                <span class="n">plotnum</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increment plot number</span>
            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">PLTS</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotnum</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
                    <span class="n">PLTS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PLTS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">PLTS</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not save: &#39;</span><span class="p">,</span> <span class="n">PLTS</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output file format not supported &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="pmag_results_extract"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.pmag_results_extract">[docs]</a><span class="k">def</span> <span class="nf">pmag_results_extract</span><span class="p">(</span><span class="n">res_file</span><span class="o">=</span><span class="s2">&quot;pmag_results.txt&quot;</span><span class="p">,</span> <span class="n">crit_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">spec_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                         <span class="n">age_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">WD</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate tab delimited output file(s) with result data.</span>
<span class="sd">    Save output files and return True if successful.</span>
<span class="sd">    Possible output files: Directions, Intensities, SiteNfo, Criteria,</span>
<span class="sd">                           Specimens</span>

<span class="sd">    Parameters:</span>
<span class="sd">        res_file : name of pmag_results file (default is &quot;pmag_results.txt&quot;)</span>
<span class="sd">        crit_file : name of criteria file (default is &quot;pmag_criteria.txt&quot;)</span>
<span class="sd">        spec_file : name of specimen file (default is &quot;pmag_specimens.txt&quot;)</span>
<span class="sd">        age_file : name of age file (default is &quot;er_ages.txt&quot;)</span>
<span class="sd">        latex : boolean argument to output in LaTeX (default is False)</span>
<span class="sd">        WD : path to directory that contains input files and takes output (default is current directory, &#39;.&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># format outfiles</span>
    <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
        <span class="n">latex</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;.tex&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">latex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">WD</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Directions&#39;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">Ioutfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Intensities&#39;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">Soutfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;SiteNfo&#39;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">Specout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Specimens&#39;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="n">Critout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Criteria&#39;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">)</span>
    <span class="c1"># format infiles</span>
    <span class="n">res_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">res_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="n">crit_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">crit_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="n">spec_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">spec_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grade</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># open output files</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Soutfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fI</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Ioutfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Critout</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># set up column headers</span>
    <span class="n">Sites</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">res_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="n">Crits</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">crit_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Crits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">SiteCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lat. (N)&quot;</span><span class="p">,</span> <span class="s2">&quot;Long. (E)&quot;</span><span class="p">,</span> <span class="s2">&quot;Age &quot;</span><span class="p">,</span> <span class="s2">&quot;Age sigma&quot;</span><span class="p">,</span> <span class="s2">&quot;Units&quot;</span><span class="p">]</span>
    <span class="n">SiteKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;er_site_names&quot;</span><span class="p">,</span> <span class="s2">&quot;average_lat&quot;</span><span class="p">,</span> <span class="s2">&quot;average_lon&quot;</span><span class="p">,</span> <span class="s2">&quot;average_age&quot;</span><span class="p">,</span>
                <span class="s2">&quot;average_age_sigma&quot;</span><span class="p">,</span> <span class="s2">&quot;average_age_unit&quot;</span><span class="p">]</span>
    <span class="n">DirCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">,</span> <span class="s1">&#39;Comp.&#39;</span><span class="p">,</span> <span class="s2">&quot;perc TC&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec.&quot;</span><span class="p">,</span> <span class="s2">&quot;Inc.&quot;</span><span class="p">,</span> <span class="s2">&quot;Nl&quot;</span><span class="p">,</span> <span class="s2">&quot;Np&quot;</span><span class="p">,</span> <span class="s2">&quot;k    &quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;a95&quot;</span><span class="p">,</span>
               <span class="s2">&quot;PLat&quot;</span><span class="p">,</span> <span class="s2">&quot;PLong&quot;</span><span class="p">]</span>
    <span class="n">DirKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;er_site_names&quot;</span><span class="p">,</span> <span class="s2">&quot;pole_comp_name&quot;</span><span class="p">,</span> <span class="s2">&quot;tilt_correction&quot;</span><span class="p">,</span> <span class="s2">&quot;average_dec&quot;</span><span class="p">,</span> <span class="s2">&quot;average_inc&quot;</span><span class="p">,</span>
               <span class="s2">&quot;average_n_lines&quot;</span><span class="p">,</span> <span class="s2">&quot;average_n_planes&quot;</span><span class="p">,</span> <span class="s2">&quot;average_k&quot;</span><span class="p">,</span> <span class="s2">&quot;average_r&quot;</span><span class="p">,</span> <span class="s2">&quot;average_alpha95&quot;</span><span class="p">,</span>
               <span class="s2">&quot;vgp_lat&quot;</span><span class="p">,</span> <span class="s2">&quot;vgp_lon&quot;</span><span class="p">]</span>
    <span class="n">IntCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;B (uT)&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
               <span class="s2">&quot;sigma perc&quot;</span><span class="p">,</span> <span class="s2">&quot;VADM&quot;</span><span class="p">,</span> <span class="s2">&quot;VADM sigma&quot;</span><span class="p">]</span>
    <span class="n">IntKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;er_site_names&quot;</span><span class="p">,</span> <span class="s2">&quot;average_int_n&quot;</span><span class="p">,</span> <span class="s2">&quot;average_int&quot;</span><span class="p">,</span> <span class="s2">&quot;average_int_sigma&quot;</span><span class="p">,</span>
               <span class="s1">&#39;average_int_sigma_perc&#39;</span><span class="p">,</span> <span class="s2">&quot;vadm&quot;</span><span class="p">,</span> <span class="s2">&quot;vadm_sigma&quot;</span><span class="p">]</span>
    <span class="n">AllowedKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;specimen_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_scat&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_gap_max&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_step_min&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;measurement_step_max&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_step_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_polarity&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_nrm&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_direction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_comp_nmb&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_mad&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_alpha95&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_n&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_int_sigma_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_rel_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_int_rel_sigma_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_mad&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_n&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_w&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_q&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_f&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_fvds&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_b_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_g&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_dang&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_md&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_ptrm&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_drat&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_drats&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_rsc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_viscosity_index&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_magn_volume&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_magn_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_ptrm_n&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_delta&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_theta&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;specimen_gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_polarity&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_nrm&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_direction_type&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sample_comp_nmb&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_alpha95&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_n&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sample_n_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_n_planes&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_k&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_r&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sample_tilt_correction&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_int_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_int_sigma_perc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sample_int_rel_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_int_rel_sigma_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_int_n&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sample_magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_magn_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;site_polarity&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;site_nrm&#39;</span><span class="p">,</span> <span class="s1">&#39;site_direction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;site_comp_nmb&#39;</span><span class="p">,</span> <span class="s1">&#39;site_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;site_alpha95&#39;</span><span class="p">,</span> <span class="s1">&#39;site_n&#39;</span><span class="p">,</span> <span class="s1">&#39;site_n_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;site_n_planes&#39;</span><span class="p">,</span> <span class="s1">&#39;site_k&#39;</span><span class="p">,</span> <span class="s1">&#39;site_r&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;site_tilt_correction&#39;</span><span class="p">,</span> <span class="s1">&#39;site_int_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;site_int_sigma_perc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;site_int_rel_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;site_int_rel_sigma_perc&#39;</span><span class="p">,</span> <span class="s1">&#39;site_int_n&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;site_magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;site_magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;site_magn_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;average_age_min&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;average_age_max&#39;</span><span class="p">,</span> <span class="s1">&#39;average_age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;average_age_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;average_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;average_alpha95&#39;</span><span class="p">,</span> <span class="s1">&#39;average_n&#39;</span><span class="p">,</span> <span class="s1">&#39;average_nn&#39;</span><span class="p">,</span> <span class="s1">&#39;average_k&#39;</span><span class="p">,</span> <span class="s1">&#39;average_r&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;average_int_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;average_int_rel_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;average_int_rel_sigma_perc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;average_int_n&#39;</span><span class="p">,</span> <span class="s1">&#39;average_int_nn&#39;</span><span class="p">,</span> <span class="s1">&#39;vgp_dp&#39;</span><span class="p">,</span> <span class="s1">&#39;vgp_dm&#39;</span><span class="p">,</span> <span class="s1">&#39;vgp_sigma&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;vgp_alpha95&#39;</span><span class="p">,</span> <span class="s1">&#39;vgp_n&#39;</span><span class="p">,</span> <span class="s1">&#39;vdm_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;vdm_n&#39;</span><span class="p">,</span> <span class="s1">&#39;vadm_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;vadm_n&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="n">crit</span> <span class="o">=</span> <span class="n">Crits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># get a list of useful keys</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crit</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">AllowedKeys</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">crit</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c1"># get rid of all blank or too big ones or too little ones</span>
                <span class="k">del</span><span class="p">(</span><span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">CritKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">crit</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="n">Specs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)</span>
        <span class="n">fsp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Specout</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>  <span class="c1"># including specimen intensities if desired</span>
        <span class="n">SpecCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">,</span> <span class="s2">&quot;Specimen&quot;</span><span class="p">,</span> <span class="s2">&quot;B (uT)&quot;</span><span class="p">,</span> <span class="s2">&quot;MAD&quot;</span><span class="p">,</span> <span class="s2">&quot;Beta&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;DANG&quot;</span><span class="p">,</span> <span class="s2">&quot;f-vds&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;DRATS&quot;</span><span class="p">,</span> <span class="s2">&quot;T (C)&quot;</span><span class="p">]</span>
        <span class="n">SpecKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;er_site_name&#39;</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_mad&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;specimen_b_beta&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_int_n&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_q&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_dang&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;specimen_fvds&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_drats&#39;</span><span class="p">,</span> <span class="s1">&#39;trange&#39;</span><span class="p">]</span>
        <span class="n">Xtra</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;specimen_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_scat&#39;</span><span class="p">,</span> <span class="s1">&#39;specimen_gmax&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">grade</span><span class="p">:</span>
            <span class="n">SpecCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Grade&#39;</span><span class="p">)</span>
            <span class="n">SpecKeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;specimen_grade&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Xtra</span><span class="p">:</span>  <span class="c1"># put in the new intensity keys if present</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Specs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">SpecKeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">newkey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">newkey</span> <span class="o">=</span> <span class="n">newkey</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                <span class="n">SpecCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newkey</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="n">SpecCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Corrections&#39;</span><span class="p">)</span>
        <span class="n">SpecKeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;corrections&#39;</span><span class="p">)</span>
    <span class="c1"># these should be multiplied by 1e6</span>
    <span class="n">Micro</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;specimen_int&#39;</span><span class="p">,</span> <span class="s1">&#39;average_int&#39;</span><span class="p">,</span> <span class="s1">&#39;average_int_sigma&#39;</span><span class="p">]</span>
    <span class="n">Zeta</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vadm&#39;</span><span class="p">,</span> <span class="s1">&#39;vadm_sigma&#39;</span><span class="p">]</span>  <span class="c1"># these should be multiplied by 1e21</span>
    <span class="c1"># write out the header information for each output file</span>
    <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>  <span class="c1"># write out the latex header stuff</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span>
        <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage[margin=1in]</span><span class="si">{geometry}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">tabstring</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{longtable}</span><span class="s1">{&#39;</span>
        <span class="n">fstring</span> <span class="o">=</span> <span class="n">tabstring</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SiteCols</span><span class="p">)):</span>
            <span class="n">fstring</span> <span class="o">=</span> <span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fstring</span> <span class="o">=</span> <span class="n">tabstring</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DirCols</span><span class="p">)):</span>
            <span class="n">fstring</span> <span class="o">=</span> <span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fstring</span> <span class="o">=</span> <span class="n">tabstring</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">IntCols</span><span class="p">)):</span>
            <span class="n">fstring</span> <span class="o">=</span> <span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fstring</span> <span class="o">=</span> <span class="n">tabstring</span>
        <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CritKeys</span><span class="p">)):</span>
                <span class="n">fstring</span> <span class="o">=</span> <span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
            <span class="n">fstring</span> <span class="o">=</span> <span class="n">tabstring</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SpecCols</span><span class="p">)):</span>
                <span class="n">fstring</span> <span class="o">=</span> <span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;r&#39;</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fstring</span> <span class="o">+</span> <span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>   <span class="c1"># just set the tab and line endings for tab delimited</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="se">\t</span><span class="s1"> &#39;</span>
        <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="c1"># now write out the actual column headers</span>
    <span class="n">Soutstring</span><span class="p">,</span> <span class="n">Doutstring</span><span class="p">,</span> <span class="n">Ioutstring</span><span class="p">,</span> <span class="n">Spoutstring</span><span class="p">,</span> <span class="n">Croutstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SiteCols</span><span class="p">)):</span>
        <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span> <span class="o">+</span> <span class="n">SiteCols</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
    <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Soutstring</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DirCols</span><span class="p">)):</span>
        <span class="n">Doutstring</span> <span class="o">=</span> <span class="n">Doutstring</span> <span class="o">+</span> <span class="n">DirCols</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
    <span class="n">Doutstring</span> <span class="o">=</span> <span class="n">Doutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">Doutstring</span> <span class="o">=</span> <span class="n">Doutstring</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Doutstring</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">IntCols</span><span class="p">)):</span>
        <span class="n">Ioutstring</span> <span class="o">=</span> <span class="n">Ioutstring</span> <span class="o">+</span> <span class="n">IntCols</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
    <span class="n">Ioutstring</span> <span class="o">=</span> <span class="n">Ioutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">Ioutstring</span> <span class="o">=</span> <span class="n">Ioutstring</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Ioutstring</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CritKeys</span><span class="p">)):</span>
            <span class="n">Croutstring</span> <span class="o">=</span> <span class="n">Croutstring</span> <span class="o">+</span> <span class="n">CritKeys</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="n">Croutstring</span> <span class="o">=</span> <span class="n">Croutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">Croutstring</span> <span class="o">=</span> <span class="n">Croutstring</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Croutstring</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SpecCols</span><span class="p">)):</span>
            <span class="n">Spoutstring</span> <span class="o">=</span> <span class="n">Spoutstring</span> <span class="o">+</span> <span class="n">SpecCols</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="n">Spoutstring</span> <span class="o">=</span> <span class="n">Spoutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">Spoutstring</span> <span class="o">=</span> <span class="n">Spoutstring</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Spoutstring</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>  <span class="c1"># put in a horizontal line in latex file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
 <span class="c1"># do criteria</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">crit</span> <span class="ow">in</span> <span class="n">Crits</span><span class="p">:</span>
            <span class="n">Croutstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CritKeys</span><span class="p">:</span>
                <span class="n">Croutstring</span> <span class="o">=</span> <span class="n">Croutstring</span> <span class="o">+</span> <span class="n">crit</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">Croutstring</span> <span class="o">=</span> <span class="n">Croutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Croutstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
 <span class="c1"># do directions</span>
    <span class="c1"># get all results with VGPs</span>
    <span class="n">VGPs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Sites</span><span class="p">,</span> <span class="s1">&#39;vgp_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">VGPs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">VGPs</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># get site level stuff</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">VGPs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s1">&#39;er_site_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;er_sample_names&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;er_sample_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;pole_comp_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;pole_comp_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;average_nn&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="s1">&#39;average_n&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_nn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_n&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;average_n_lines&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_n_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_nn&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;average_n_planes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_n_planes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">Soutstring</span><span class="p">,</span> <span class="n">Doutstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">SiteKeys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span> <span class="o">+</span> <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span>
            <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Soutstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">DirKeys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">Doutstring</span> <span class="o">=</span> <span class="n">Doutstring</span> <span class="o">+</span> <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">Doutstring</span> <span class="o">=</span> <span class="n">Doutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Doutstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># now do intensities</span>
    <span class="n">VADMs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Sites</span><span class="p">,</span> <span class="s1">&#39;vadm&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">VADMs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">VADMs</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">VADMs</span><span class="p">:</span>  <span class="c1"># do results level stuff</span>
        <span class="k">if</span> <span class="n">site</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VGPs</span><span class="p">:</span>
            <span class="n">Soutstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">SiteKeys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span> <span class="o">+</span> <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">Soutstring</span> <span class="o">=</span> <span class="n">Soutstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span>
            <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Soutstring</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s1">&#39;er_site_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">site</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;average_int_sigma_perc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="s1">&#39;average_int_sigma_perc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">if</span> <span class="n">site</span><span class="p">[</span><span class="s2">&quot;average_int_sigma&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="s2">&quot;average_int_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">if</span> <span class="n">site</span><span class="p">[</span><span class="s2">&quot;average_int_sigma_perc&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="s2">&quot;average_int_sigma_perc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">if</span> <span class="n">site</span><span class="p">[</span><span class="s2">&quot;vadm&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="s2">&quot;vadm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">if</span> <span class="n">site</span><span class="p">[</span><span class="s2">&quot;vadm_sigma&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="s2">&quot;vadm_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>  <span class="c1"># reformat vadms, intensities</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Micro</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Zeta</span><span class="p">:</span>
                <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-21</span><span class="p">)</span>
        <span class="n">outstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">IntKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">outstring</span> <span class="o">=</span> <span class="n">outstring</span> <span class="o">+</span> <span class="n">site</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="n">outstring</span> <span class="o">=</span> <span class="n">outstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
<span class="c1">#    VDMs=pmag.get_dictitem(Sites,&#39;vdm&#39;,&#39;&#39;,&#39;F&#39;) # get non-blank VDMs</span>
<span class="c1">#    for site in VDMs: # do results level stuff</span>
<span class="c1">#      if len(site[&#39;er_site_names&#39;].split(&quot;:&quot;))==1:</span>
<span class="c1">#            if &#39;average_int_sigma_perc&#39; not in site.keys():site[&#39;average_int_sigma_perc&#39;]=&quot;0&quot;</span>
<span class="c1">#            if site[&quot;average_int_sigma&quot;]==&quot;&quot;:site[&quot;average_int_sigma&quot;]=&quot;0&quot;</span>
<span class="c1">#            if site[&quot;average_int_sigma_perc&quot;]==&quot;&quot;:site[&quot;average_int_sigma_perc&quot;]=&quot;0&quot;</span>
<span class="c1">#            if site[&quot;vadm&quot;]==&quot;&quot;:site[&quot;vadm&quot;]=&quot;0&quot;</span>
<span class="c1">#            if site[&quot;vadm_sigma&quot;]==&quot;&quot;:site[&quot;vadm_sigma&quot;]=&quot;0&quot;</span>
<span class="c1">#      for key in site.keys(): # reformat vadms, intensities</span>
<span class="c1">#            if key in Micro: site[key]=&#39;%7.1f&#39;%(float(site[key])*1e6)</span>
<span class="c1">#            if key in Zeta: site[key]=&#39;%7.1f&#39;%(float(site[key])*1e-21)</span>
<span class="c1">#      outstring=&quot;&quot;</span>
<span class="c1">#      for key in IntKeys:</span>
<span class="c1">#          outstring=outstring+site[key]+sep</span>
<span class="c1">#      fI.write(outstring.strip(sep)+&#39;\n&#39;)</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="n">SpecsInts</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">Specs</span><span class="p">,</span> <span class="s1">&#39;specimen_int&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">SpecsInts</span><span class="p">:</span>
            <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;trange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;measurement_step_min&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">273</span><span class="p">))</span> <span class="o">+</span> \
                <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;measurement_step_max&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">273</span><span class="p">))</span>
            <span class="n">meths</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">corrections</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;DA&#39;</span> <span class="ow">in</span> <span class="n">meth</span><span class="p">:</span>
                    <span class="n">corrections</span> <span class="o">=</span> <span class="n">corrections</span> <span class="o">+</span> <span class="n">meth</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span>
            <span class="n">corrections</span> <span class="o">=</span> <span class="n">corrections</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">corrections</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">corrections</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
            <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;corrections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrections</span>
            <span class="n">outstring</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">SpecKeys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Micro</span><span class="p">:</span>
                    <span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Zeta</span><span class="p">:</span>
                    <span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-21</span><span class="p">)</span>
                <span class="n">outstring</span> <span class="o">=</span> <span class="n">outstring</span> <span class="o">+</span> <span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>  <span class="c1"># write out the tail stuff</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fI</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fsp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\hline</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">sf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fI</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data saved in: &#39;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">Ioutfile</span><span class="p">,</span> <span class="n">Soutfile</span><span class="p">)</span>
    <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">outfile</span><span class="p">,</span> <span class="n">Ioutfile</span><span class="p">,</span> <span class="n">Soutfile</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="n">fsp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;specimen data saved in: &#39;</span><span class="p">,</span> <span class="n">Specout</span><span class="p">)</span>
        <span class="n">outfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Specout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crit_file</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selection criteria saved in: &#39;</span><span class="p">,</span> <span class="n">Critout</span><span class="p">)</span>
        <span class="n">outfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Critout</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outfiles</span></div>


<div class="viewcode-block" id="demag_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.demag_magic">[docs]</a><span class="k">def</span> <span class="nf">demag_magic</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;magic_measurements.txt&#39;</span><span class="p">,</span>
                <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">plot_by</span><span class="o">=</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span>
                <span class="n">treat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">XLP</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">individual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">average_measurements</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">single_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Takes demagnetization data (from magic_measurements file) and outputs</span>
<span class="sd">    intensity plots (with optional save).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        path_to_file : path to directory that contains files (default is current directory, &#39;.&#39;)</span>
<span class="sd">        file_name : name of measurements file (default is &#39;magic_measurements.txt&#39;)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is &#39;svg&#39;)</span>
<span class="sd">        plot_by : specifies what sampling level you wish to plot the data at</span>
<span class="sd">            (&#39;loc&#39; -- plots all samples of the same location on the same plot</span>
<span class="sd">            &#39;exp&#39; -- plots all samples of the same expedition on the same plot</span>
<span class="sd">            &#39;site&#39; -- plots all samples of the same site on the same plot</span>
<span class="sd">            &#39;sample&#39; -- plots all measurements of the same sample on the same plot</span>
<span class="sd">            &#39;spc&#39; -- plots each specimen individually)</span>
<span class="sd">        treat : treatment step</span>
<span class="sd">            &#39;T&#39; = thermal demagnetization</span>
<span class="sd">            &#39;AF&#39; = alternating field demagnetization</span>
<span class="sd">            &#39;M&#39; = microwave radiation demagnetization</span>
<span class="sd">            (default is &#39;AF&#39;)</span>
<span class="sd">        XLP : filter data by a particular method</span>
<span class="sd">        individual : This function outputs all plots by default. If plotting by sample</span>
<span class="sd">            or specimen, you may not wish to see (or wait for) every single plot. You can</span>
<span class="sd">            therefore specify a particular plot by setting this keyword argument to</span>
<span class="sd">            a string of the site/sample/specimen name.</span>
<span class="sd">        average_measurements : Option to average demagnetization measurements by</span>
<span class="sd">            the grouping specified with the &#39;plot_by&#39; keyword argument (default is False)</span>
<span class="sd">        single_plot : Option to output a single plot with all measurements (default is False)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">FIG</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># plot dictionary</span>
    <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># demag is figure 1</span>
    <span class="n">in_file</span><span class="p">,</span> <span class="n">plot_key</span><span class="p">,</span> <span class="n">LT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">path_to_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s1">&#39;er_location_name&#39;</span><span class="p">,</span> <span class="s2">&quot;LT-AF-Z&quot;</span>
    <span class="n">XLP</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_ac_field&#39;</span>
    <span class="n">plot_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;er_location_name&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;exp&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;er_expedition_name&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;er_site_name&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;sam&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;er_sample_name&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;spc&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;er_specimen_name&#39;</span>

    <span class="k">if</span> <span class="n">treat</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LT</span> <span class="o">=</span> <span class="s1">&#39;LT-&#39;</span> <span class="o">+</span> <span class="n">treat</span> <span class="o">+</span> <span class="s1">&#39;-Z&#39;</span>  <span class="c1"># get lab treatment for plotting</span>
        <span class="k">if</span> <span class="n">LT</span> <span class="o">==</span> <span class="s1">&#39;LT-T-Z&#39;</span><span class="p">:</span>
            <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_temp&#39;</span>
        <span class="k">elif</span> <span class="n">LT</span> <span class="o">==</span> <span class="s1">&#39;LT-AF-Z&#39;</span><span class="p">:</span>
            <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_ac_field&#39;</span>
        <span class="k">elif</span> <span class="n">LT</span> <span class="o">==</span> <span class="s1">&#39;LT-M-Z&#39;</span><span class="p">:</span>
            <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment_mw_energy&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LT</span> <span class="o">=</span> <span class="s1">&#39;LT-AF-Z&#39;</span>

    <span class="n">plot_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
    <span class="n">sids</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_specs</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39; records read from &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># find desired intensity data</span>
    <span class="c1">#</span>
    <span class="c1"># get plotlist</span>
    <span class="c1">#</span>
    <span class="n">plotlist</span><span class="p">,</span> <span class="n">intlist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;measurement_magnitude&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_magn_moment&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;measurement_magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;measurement_magn_mass&#39;</span><span class="p">]</span>
    <span class="n">IntMeths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">FixData</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">meths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">methcodes</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">methcodes</span><span class="p">:</span>
            <span class="n">meths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">intlist</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">IntMeths</span><span class="p">:</span>
                    <span class="n">IntMeths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotlist</span> <span class="ow">and</span> <span class="n">LT</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                    <span class="n">plotlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">plot_key</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;measurement_flag&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
                <span class="n">FixData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="n">plotlist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IntMeths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No intensity information found&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">FixData</span>
    <span class="c1"># plot first intensity method found - normalized to initial value anyway -</span>
    <span class="c1"># doesn&#39;t matter which used</span>
    <span class="n">int_key</span> <span class="o">=</span> <span class="n">IntMeths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># print plotlist</span>
    <span class="k">if</span> <span class="n">individual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">plotlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">plotlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plotlist</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;plotting by: &#39;</span><span class="p">,</span> <span class="n">plot_key</span><span class="p">)</span>
        <span class="c1"># fish out all the data for this type of plot</span>
        <span class="n">PLTblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">plot_key</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="c1"># fish out all the dmag for this experiment type</span>
        <span class="n">PLTblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">PLTblock</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="n">LT</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
        <span class="c1"># get all with this intensity key non-blank</span>
        <span class="n">PLTblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">PLTblock</span><span class="p">,</span> <span class="n">int_key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">XLP</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># reject data with XLP in method_code</span>
            <span class="n">PLTblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">PLTblock</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="n">XLP</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">)</span>
    <span class="c1"># for plot in plotlist:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PLTblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">PLTblock</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">plot_key</span><span class="p">]</span>
            <span class="n">spcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">PLTblock</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spcs</span><span class="p">:</span>
                    <span class="n">spcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">average_measurements</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="n">spcs</span><span class="p">:</span>
                    <span class="c1"># plot specimen by specimen</span>
                    <span class="n">SPCblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">PLTblock</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">spc</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="n">INTblock</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SPCblock</span><span class="p">:</span>
                        <span class="n">INTblock</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">rec</span><span class="p">[</span><span class="n">int_key</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_flag&#39;</span><span class="p">]])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">INTblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_mag</span><span class="p">(</span>
                            <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="n">INTblock</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">AVGblock</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="n">spcs</span><span class="p">:</span>
                    <span class="c1"># plot specimen by specimen</span>
                    <span class="n">SPCblock</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">PLTblock</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">spc</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SPCblock</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">AVGblock</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="n">AVGblock</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">])]</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">int_key</span><span class="p">])]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">AVGblock</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">])]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">int_key</span><span class="p">]))</span>
                <span class="n">INTblock</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">AVGblock</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">INTblock</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">AVGblock</span><span class="p">[</span><span class="n">step</span><span class="p">]))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AVGblock</span><span class="p">[</span><span class="n">step</span><span class="p">])),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">])</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_mag</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="n">INTblock</span><span class="p">,</span>
                                     <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">single_plot</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">single_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="iplot_hys"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.iplot_hys">[docs]</a><span class="k">def</span> <span class="nf">iplot_hys</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function to plot hysteresis data</span>

<span class="sd">    This function has been adapted from pmagplotlib.iplot_hys for specific use</span>
<span class="sd">    within a Jupyter notebook.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        fignum : reference number for matplotlib figure being created</span>
<span class="sd">        B : list of B (flux density) values of hysteresis experiment</span>
<span class="sd">        M : list of M (magnetization) values of hysteresis experiment</span>
<span class="sd">        s : specimen name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fignum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">hpars</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># close up loop</span>
    <span class="n">Npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">B70</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 70 percent of maximum field</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">B70</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">Nint</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">Nint</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">Nint</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="k">if</span> <span class="n">Nint</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">Nint</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Bzero</span><span class="p">,</span> <span class="n">Mzero</span><span class="p">,</span> <span class="n">Mfix</span><span class="p">,</span> <span class="n">Mnorm</span><span class="p">,</span> <span class="n">Madj</span><span class="p">,</span> <span class="n">MadjN</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Mazero</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">m_init</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">m_fin</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">m_fin</span> <span class="o">-</span> <span class="n">m_init</span>
    <span class="n">Bmin</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npts</span><span class="p">):</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Npts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Mfix</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">M</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">frac</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Bzero</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Bzero</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">if</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Bmin</span><span class="p">:</span>
            <span class="n">Bmin</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">kmin</span> <span class="o">=</span> <span class="n">k</span>
    <span class="c1"># adjust slope with first 30 data points (throwing out first 3)</span>
    <span class="n">Bslop</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">Nint</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">Mslop</span> <span class="o">=</span> <span class="n">Mfix</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">Nint</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">polyU</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">Bslop</span><span class="p">,</span> <span class="n">Mslop</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># best fit line to high field points</span>
    <span class="c1"># adjust slope with first 30 points of ascending branch</span>
    <span class="n">Bslop</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">kmin</span><span class="p">:</span><span class="n">kmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">Nint</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">Mslop</span> <span class="o">=</span> <span class="n">Mfix</span><span class="p">[</span><span class="n">kmin</span><span class="p">:</span><span class="n">kmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">Nint</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">polyL</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">Bslop</span><span class="p">,</span> <span class="n">Mslop</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># best fit line to high field points</span>
    <span class="n">xhf</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">polyU</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">polyL</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># mean of two slopes</span>
    <span class="c1"># convert B to A/m, high field slope in m^3</span>
    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_xhf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xhf</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">meanint</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">polyU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">polyL</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># mean of two intercepts</span>
    <span class="n">Msat</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">polyU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">polyL</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># mean of saturation remanence</span>
    <span class="n">Moff</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npts</span><span class="p">):</span>
        <span class="c1"># take out linear slope and offset (makes symmetric about origin)</span>
        <span class="n">Moff</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Mfix</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">xhf</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">meanint</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Mzero</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">Moff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Mzero</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">if</span> <span class="n">Mzero</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">Mazero</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">Moff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Mazero</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_ms_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Msat</span><span class="p">)</span>  <span class="c1"># Ms in Am^2</span>
<span class="c1">#</span>
<span class="c1"># split into upper and lower loops for splining</span>
    <span class="n">Mupper</span><span class="p">,</span> <span class="n">Bupper</span><span class="p">,</span> <span class="n">Mlower</span><span class="p">,</span> <span class="n">Blower</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">deltaM</span><span class="p">,</span> <span class="n">Bdm</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># diff between upper and lower curves at Bdm</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmin</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">Mupper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Moff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">Msat</span><span class="p">)</span>
        <span class="n">Bupper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmin</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Mlower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Moff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">Msat</span><span class="p">)</span>
        <span class="n">Blower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">Iupper</span> <span class="o">=</span> <span class="n">spline</span><span class="o">.</span><span class="n">Spline</span><span class="p">(</span><span class="n">Bupper</span><span class="p">,</span> <span class="n">Mupper</span><span class="p">)</span>  <span class="c1"># get splines for upper up and down</span>
    <span class="n">Ilower</span> <span class="o">=</span> <span class="n">spline</span><span class="o">.</span><span class="n">Spline</span><span class="p">(</span><span class="n">Blower</span><span class="p">,</span> <span class="n">Mlower</span><span class="p">)</span>  <span class="c1"># get splines for lower</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># get range of field values</span>
        <span class="n">Mpos</span> <span class="o">=</span> <span class="p">((</span><span class="n">Iupper</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ilower</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>  <span class="c1"># evaluate on both sides of B</span>
        <span class="n">Mneg</span> <span class="o">=</span> <span class="p">((</span><span class="n">Iupper</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ilower</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)))</span>
        <span class="n">Bdm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">deltaM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Mpos</span> <span class="o">+</span> <span class="n">Mneg</span><span class="p">))</span>  <span class="c1"># take average delta M</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;whew&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npts</span><span class="p">):</span>
        <span class="n">MadjN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Moff</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">Msat</span><span class="p">)</span>
        <span class="n">Mnorm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">Msat</span><span class="p">)</span>
<span class="c1"># find Mr : average of two spline fits evaluated at B=0 (times Msat)</span>
    <span class="n">Mr</span> <span class="o">=</span> <span class="n">Msat</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Iupper</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="o">-</span> <span class="n">Ilower</span><span class="p">(</span><span class="mf">0.</span><span class="p">))</span>
    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_mr_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Mr</span><span class="p">)</span>
<span class="c1"># find Bc (x intercept), interpolate between two bounding points</span>
    <span class="n">Bz</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">Mzero</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mzero</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Mz</span> <span class="o">=</span> <span class="n">Moff</span><span class="p">[</span><span class="n">Mzero</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mzero</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Baz</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">Mazero</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mazero</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Maz</span> <span class="o">=</span> <span class="n">Moff</span><span class="p">[</span><span class="n">Mazero</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mazero</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">Bz</span><span class="p">,</span> <span class="n">Mz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># best fit line through two bounding points</span>
        <span class="n">Bc</span> <span class="o">=</span> <span class="o">-</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x intercept</span>
        <span class="c1"># best fit line through two bounding points</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">Baz</span><span class="p">,</span> <span class="n">Maz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Bac</span> <span class="o">=</span> <span class="o">-</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x intercept</span>
        <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Bc</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Bac</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">return</span> <span class="n">hpars</span><span class="p">,</span> <span class="n">deltaM</span><span class="p">,</span> <span class="n">Bdm</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Mnorm</span><span class="p">,</span> <span class="n">MadjN</span></div>


<div class="viewcode-block" id="hysteresis_magic2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.hysteresis_magic2">[docs]</a><span class="k">def</span> <span class="nf">hysteresis_magic2</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">hyst_file</span><span class="o">=</span><span class="s2">&quot;rmag_hysteresis.txt&quot;</span><span class="p">,</span>
                      <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                      <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates hysteresis parameters, saves them in rmag_hysteresis format file.</span>
<span class="sd">    If selected, this function also plots hysteresis loops, delta M curves,</span>
<span class="sd">    d (Delta M)/dB curves, and IRM backfield curves.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        path_to_file : path to directory that contains files (default is current directory, &#39;.&#39;)</span>
<span class="sd">        hyst_file : hysteresis file (default is &#39;rmag_hysteresis.txt&#39;)</span>
<span class="sd">        save : boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : relative directory where plots will be saved (default is current directory, &#39;.&#39;)</span>
<span class="sd">        fmt : format of saved figures (default is &#39;pdf&#39;)</span>
<span class="sd">        plots: whether or not to display the plots (default is true)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">meas_file</span><span class="p">,</span> <span class="n">rmag_out</span><span class="p">,</span> <span class="n">rmag_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;agm_measurements.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rmag_hysteresis.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="n">pltspec</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">save_folder</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="n">rmag_out</span> <span class="o">=</span> <span class="n">save_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">rmag_out</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">path_to_file</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">hyst_file</span>
    <span class="n">rmag_rem</span> <span class="o">=</span> <span class="n">save_folder</span> <span class="o">+</span> <span class="s2">&quot;/rmag_remanence.txt&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;magic_measurements&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hysteresis_magic</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad file&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># initialize some variables</span>
    <span class="c1"># define figure numbers for hyst,deltaM,DdeltaM curves</span>
    <span class="n">HystRecs</span><span class="p">,</span> <span class="n">RemRecs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">HDD</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">experiment_names</span><span class="p">,</span> <span class="n">sids</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
        <span class="n">meths</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;LP-HYS&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;er_synthetic_name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment_names</span><span class="p">:</span>
                <span class="n">experiment_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">:</span>
                <span class="n">sids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">])</span>
    <span class="c1">#</span>
    <span class="n">fignum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">sample_num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># initialize variables to record some bulk info in first loop</span>
    <span class="n">first_dcd_rec</span><span class="p">,</span> <span class="n">first_rec</span><span class="p">,</span> <span class="n">first_imag_rec</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">sample_num</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[</span><span class="n">sample_num</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">sample_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">))</span>
        <span class="c1"># B,M for hysteresis, Bdcd,Mdcd for irm-dcd data</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Bdcd</span><span class="p">,</span> <span class="n">Mdcd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">Bimag</span><span class="p">,</span> <span class="n">Mimag</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># Bimag,Mimag for initial magnetization curves</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
            <span class="n">methcodes</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">meths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">methcodes</span><span class="p">:</span>
                <span class="n">meths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span> <span class="ow">and</span> <span class="s2">&quot;LP-HYS&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_lab_field_dc&#39;</span><span class="p">]))</span>
                <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_magn_moment&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">first_rec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span>
                    <span class="n">HystRec</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">first_rec</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="s2">&quot;er_location_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
                        <span class="n">locname</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_location_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;er_sample_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;er_site_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;er_synthetic_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;er_synthetic_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_synthetic_name&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span> <span class="ow">and</span> <span class="s2">&quot;LP-IRM-DCD&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">Bdcd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;treatment_dc_field&#39;</span><span class="p">]))</span>
                <span class="n">Mdcd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_magn_moment&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">first_dcd_rec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">RemRec</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">irm_exp</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span>
                    <span class="n">first_dcd_rec</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="s2">&quot;er_location_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">RemRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;er_sample_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">RemRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;er_site_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">RemRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;er_synthetic_name&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_synthetic_name&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">RemRec</span><span class="p">[</span><span class="s2">&quot;er_synthetic_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_synthetic_name&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">RemRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;er_specimen_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sample</span> <span class="ow">and</span> <span class="s2">&quot;LP-IMAG&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">first_imag_rec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">imag_exp</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_experiment_name&#39;</span><span class="p">]</span>
                    <span class="n">first_imag_rec</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Bimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_lab_field_dc&#39;</span><span class="p">]))</span>
                <span class="n">Mimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;measurement_magn_moment&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hmeths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">hmeths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
    <span class="c1">#         fignum = 1</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">hpars</span><span class="p">,</span> <span class="n">deltaM</span><span class="p">,</span> <span class="n">Bdm</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Mnorm</span><span class="p">,</span> <span class="n">MadjN</span> <span class="o">=</span> <span class="n">iplot_hys</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Mnorm</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">MadjN</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;B (T)&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;M/Msat&quot;</span><span class="p">)</span>
    <span class="c1">#         ax1.set_title(sample)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
            <span class="n">n4</span> <span class="o">=</span> <span class="s1">&#39;Ms: &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;</span><span class="si">%8.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_ms_moment&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; Am^2&#39;</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.9</span> <span class="o">*</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">.9</span><span class="p">,</span> <span class="n">n4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="s1">&#39;Mr: &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;</span><span class="si">%8.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_mr_moment&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; Am^2&#39;</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.9</span> <span class="o">*</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">.7</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="s1">&#39;Bc: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%8.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bc&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; T&#39;</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.9</span> <span class="o">*</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;hysteresis_xhf&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">n3</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Xhf: &#39;</span> <span class="o">+</span> \
                    <span class="s1">&#39;</span><span class="si">%8.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_xhf&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39; m^3&#39;</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.9</span> <span class="o">*</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mf">.3</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="c1">#         plt.subplot(1,2,2)</span>
    <span class="c1">#         plt.subplot(1,3,3)</span>
        <span class="n">DdeltaM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Mhalf</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bdm</span><span class="p">)):</span>
            <span class="c1"># differnential</span>
            <span class="n">DdeltaM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">deltaM</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">deltaM</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">Bdm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">Bdm</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deltaM</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">deltaM</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">deltaM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">Mhalf</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">break</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Bhf</span> <span class="o">=</span> <span class="n">Bdm</span><span class="p">[</span><span class="n">Mhalf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mhalf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">Mhf</span> <span class="o">=</span> <span class="n">deltaM</span><span class="p">[</span><span class="n">Mhalf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="n">Mhalf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># best fit line through two bounding points</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">Bhf</span><span class="p">,</span> <span class="n">Mhf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Bcr</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.5</span> <span class="o">*</span> <span class="n">deltaM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bcr</span><span class="p">)</span>
            <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LP-BCR-HDM&quot;</span>
            <span class="k">if</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bdm</span><span class="p">,</span> <span class="n">deltaM</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;B (T)&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Delta M&#39;</span><span class="p">)</span>
                <span class="n">linex</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Bcr</span><span class="p">,</span> <span class="n">Bcr</span><span class="p">]</span>
                <span class="n">liney</span> <span class="o">=</span> <span class="p">[</span><span class="n">deltaM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">deltaM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linex</span><span class="p">,</span> <span class="n">liney</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1">#             ax2.set_title(sample)</span>
                <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bdm</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">Bdm</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">DdeltaM</span><span class="p">)):],</span> <span class="n">DdeltaM</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;B (T)&#39;</span><span class="p">)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;d (Delta M)/dB&#39;</span><span class="p">)</span>
    <span class="c1">#             ax3.set_title(sample)</span>

                <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bdcd</span><span class="p">,</span> <span class="n">Mdcd</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span><span class="p">))</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;B (T)&#39;</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;M/Mr&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;not doing it&quot;</span><span class="p">)</span>
            <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
            <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">sample</span> <span class="o">+</span> <span class="s1">&#39;_hysteresis.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">sample_num</span> <span class="o">+=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="find_ei"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.find_ei">[docs]</a><span class="k">def</span> <span class="nf">find_ei</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nb</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span>
            <span class="n">site_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_new_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figprefix</span><span class="o">=</span><span class="s1">&#39;EI&#39;</span><span class="p">,</span> 
            <span class="n">return_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_resample_to_plot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">data_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">EI_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">resample_EI_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">resample_EI_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">tight_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies series of assumed flattening factors and &quot;unsquishes&quot; inclinations assuming tangent function.</span>
<span class="sd">    Finds flattening factor that gives elongation/inclination pair consistent with TK03;</span>
<span class="sd">    or, if correcting by site instead for study-level secular variation,</span>
<span class="sd">    finds flattening factor that minimizes elongation and most resembles a</span>
<span class="sd">    Fisherian distribution.</span>
<span class="sd">    Finds bootstrap confidence bounds</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data: a nested list of dec/inc pairs</span>
<span class="sd">        nb: number of bootstrapped pseudo-samples (default is 1000)</span>
<span class="sd">        save: Boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder: path to folder in which plots should be saved (default is current directory)</span>
<span class="sd">        fmt: specify format of saved plots (default is &#39;svg&#39;)</span>
<span class="sd">        figfile : name of saved file plus format string</span>
<span class="sd">        site_correction: Boolean argument to specify whether to &quot;unsquish&quot; data to</span>
<span class="sd">            1) the elongation/inclination pair consistent with TK03 secular variation model</span>
<span class="sd">            (site_correction = False)</span>
<span class="sd">            or</span>
<span class="sd">            2) a Fisherian distribution (site_correction = True). Default is FALSE.</span>
<span class="sd">            Note that many directions (~ 100) are needed for this correction to be reliable.</span>
<span class="sd">        return_new_dirs: optional return of newly &quot;unflattened&quot; directions as di_block (default is False)</span>
<span class="sd">        return_values: optional return of all bootstrap result inclinations, elongations, and </span>
<span class="sd">            f factors (default is False)</span>
<span class="sd">        if both return_new_dirs=True and return_values=True, the function will return:</span>
<span class="sd">            di_block of new directions, inclinations, elongations,and f factors</span>
<span class="sd">        num_resample_to_plot: number of bootstrap resample elongation/inclination curves to plot (default to to plot all)</span>
<span class="sd">        data_color: the color of the direction equal area plot data (default is black)</span>
<span class="sd">        EI_color: the color of the EI curve associated with the most frequent f value (rounded to 2 decimal points, default is red)</span>
<span class="sd">        resample_EI_color: the color of the EI curves for all f values except for the most frequent f (default is grey)</span>
<span class="sd">        resample_EI_alpha: the transparency of the EI curves for all f values except for the most frequent f (default is grey)</span>
<span class="sd">        tight_axes: optional argument to tighten up the axes limits for the inclination-elongation figure</span>

<span class="sd">    Returns:</span>
<span class="sd">        - equal area plot of original directions</span>
<span class="sd">        - Elongation/inclination pairs as a function of f,  data plus 25 bootstrap samples</span>
<span class="sd">        - Cumulative distribution of bootstrapped optimal inclinations plus uncertainties.</span>
<span class="sd">            Estimate from original data set plotted as solid line</span>
<span class="sd">        - Orientation of principle direction through unflattening</span>
<span class="sd">     </span>
<span class="sd">    NOTE: </span>
<span class="sd">        If distribution does not have a solution, plot labeled: Pathological.  Some bootstrap samples may have</span>
<span class="sd">        valid solutions and those are plotted in the CDFs and E/I plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bootstrapping.... be patient&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">.975</span> <span class="o">*</span> <span class="n">nb</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">.025</span> <span class="o">*</span> <span class="n">nb</span><span class="p">))</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plot_net</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">data_color</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>

    <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Io</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="n">Es</span><span class="p">,</span> <span class="n">Is</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">V2s</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_f</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">site_correction</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span> <span class="o">=</span> <span class="n">Is</span><span class="p">[</span><span class="n">Es</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Es</span><span class="p">))],</span> <span class="n">Es</span><span class="p">[</span><span class="n">Es</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Es</span><span class="p">))]</span>
        <span class="n">flat_f</span> <span class="o">=</span> <span class="n">Fs</span><span class="p">[</span><span class="n">Es</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Es</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span> <span class="o">=</span> <span class="n">Is</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Es</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">flat_f</span> <span class="o">=</span> <span class="n">Fs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Is</span><span class="p">,</span> <span class="n">Es</span><span class="p">,</span> <span class="n">EI_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;inclination ($^\circ$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;elongation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">.9</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span><span class="p">,</span> <span class="s1">&#39; </span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">flat_f</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="c1">#     plt.text(Is[0] - 2, Es[0], &#39; %s&#39; % (&#39;f=1&#39;), fontsize=12)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">nb</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">pseudo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">Esb</span><span class="p">,</span> <span class="n">Isb</span><span class="p">,</span> <span class="n">Fsb</span><span class="p">,</span> <span class="n">V2sb</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_f</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">num_resample_to_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Isb</span><span class="p">,</span> <span class="n">Esb</span><span class="p">,</span> <span class="n">resample_EI_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">resample_EI_alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Esb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">site_correction</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Isb</span><span class="p">[</span><span class="n">Esb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Esb</span><span class="p">))]))</span>
                <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esb</span><span class="p">[</span><span class="n">Esb</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Esb</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Isb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">I</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">E</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tight_axes</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">Eexp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
        <span class="n">Eexp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">EI</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Eexp</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Inc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Pathological Distribution: &#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;[</span><span class="si">%7.1f</span><span class="s1">, </span><span class="si">%7.1f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> [</span><span class="si">%7.1f</span><span class="s1">, </span><span class="si">%7.1f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_EI_bootstraps&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="n">cdf_fig_num</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">cdf_fig_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="n">cdf_fig_num</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="s1">&#39;inclination ($^\circ$)&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">cdf_fig_num</span><span class="p">,</span> <span class="p">[</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">]],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">cdf_fig_num</span><span class="p">,</span> <span class="p">[</span><span class="n">Inc</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="n">cdf_fig_num</span><span class="p">,</span> <span class="p">[</span><span class="n">Io</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_inc_CDF&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># plot corrected directional data</span>

    <span class="n">di_lists</span> <span class="o">=</span> <span class="n">unpack_di_block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="k">if</span> <span class="n">flat_f</span><span class="p">:</span>
        <span class="n">unsquished_incs</span> <span class="o">=</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">flat_f</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquished_incs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">data_color</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Corrected for flattening&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">data_color</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Corrected for flattening&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_corrected_directions&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span><span class="p">,</span> <span class="n">flat_f</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PATHOLOGICAL DISTRIBUTION&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The original inclination was: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Io</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The corrected inclination is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Inc</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with bootstrapped confidence bounds of: &quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and elongation parameter of: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Elong</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The flattening factor is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">flat_f</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">f_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">]))</span>
    <span class="n">f_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with bootstrapped confidence bounds of: &quot;</span> <span class="o">+</span>
           <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">f_lower</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">f_upper</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">return_new_dirs</span> <span class="ow">and</span> <span class="n">return_values</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquished_incs</span><span class="p">),</span> <span class="n">I</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>
    
    <span class="k">elif</span> <span class="n">return_new_dirs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquished_incs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">return_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="find_ei_kent"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.find_ei_kent">[docs]</a><span class="k">def</span> <span class="nf">find_ei_kent</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">site_latitude</span><span class="p">,</span> <span class="n">site_longitude</span><span class="p">,</span> <span class="n">kent_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">nb</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span>
                <span class="n">return_new_dirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figprefix</span><span class="o">=</span><span class="s1">&#39;EI&#39;</span><span class="p">,</span> 
                <span class="n">num_resample_to_plot</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">EI_color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">resample_EI_color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">resample_EI_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                 <span class="n">vgp_nb</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis_r&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies series of assumed flattening factor and &quot;unsquishes&quot; inclinations assuming tangent function.</span>
<span class="sd">    Finds flattening factor that gives elongation/inclination pair consistent with TK03</span>
<span class="sd">    Finds bootstrap confidence bounds</span>
<span class="sd">    Based on all flattening factors from the E/I bootstrap results find the distribution of paleolatitudes and fit with a normal distribution</span>
<span class="sd">    Based on all flattening factors from the E/I bootstrap results calculate the correspondant VGP pole positions and their mean poles associated with each factor</span>
<span class="sd">    Perform Monte Carlo resample of the mean poles associated with each flattening factor</span>
<span class="sd">    Finds the Kent distribution statistics: mean, major and minor axes and their associated angles of dispersion. </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        data: a nested list of dec/inc pairs</span>
<span class="sd">        site_latitude, site_longitude: location of the paleomagnetic site</span>
<span class="sd">        kent_color : color of the Kent ellipse to plot (default is black)</span>
<span class="sd">        nb : number of bootstrapped pseudo-samples (default is 1000)</span>
<span class="sd">        save : Boolean argument to save plots (default is False)</span>
<span class="sd">        save_folder : path to folder in which plots should be saved (default is current directory)</span>
<span class="sd">        fmt : specify format of saved plots (default is &#39;svg&#39;)</span>
<span class="sd">        return_new_dirs : optional return of newly &quot;unflattened&quot; directions as di_block (default is False)</span>
<span class="sd">        return_values : optional return of all bootstrap result inclinations, elongations, and </span>
<span class="sd">            f factors (default is False)</span>
<span class="sd">                if both return_new_dirs=True and return_values=True, the function will return</span>
<span class="sd">                di_block of new directions, inclinations, elongations,and f factors</span>
<span class="sd">        figprefix : prefix string for the name of the figures to be saved</span>
<span class="sd">        EI_color : color of the most elongation/inclination curve corresponding to the most frequent f value</span>
<span class="sd">        resample_EI_color : color of all other elongation/inclination curves</span>
<span class="sd">        vgp_nb : number of virtual geomagnetic poles to resample for each iteration, the total VGPs resampled will be vgp_nb*nb</span>
<span class="sd">        cmap : matplotlib color map used for plotting corrected paleomagnetic directions</span>
<span class="sd">        central_longitude, central_latitude: central point of pole projection (defaults are 0)</span>
<span class="sd">        num_resample_to_plot : number of bootstrap resample elongation/inclination curves to plot (default to to plot all)</span>
<span class="sd">        vgp_nb : number of vgp to resample using a Monte Carlo approach with each f factor</span>
<span class="sd">        cmap : matplotlib color map for color-coding the directions and mean poles based on the f factor</span>
<span class="sd">        EI_color: the color of the EI curve associated with the most frequent f value (rounded to 2 decimal points, default is red)</span>
<span class="sd">        resample_EI_color: the color of the EI curves for all f values except for the most frequent f (default is grey)</span>
<span class="sd">        resample_EI_alpha: the transparency of the EI curves for all f values except for the most frequent f (default is grey)</span>

<span class="sd">    Returns:</span>
<span class="sd">        four plots :  </span>
<span class="sd">            1) equal area plot of original directions</span>
<span class="sd">            2) Elongation/inclination pairs as a function of f,  data plus 25 bootstrap samples</span>
<span class="sd">            3) Cumulative distribution of bootstrapped optimal inclinations plus uncertainties. Estimate from original data set plotted as solid line</span>
<span class="sd">            4) Orientation of principle direction through unflattening</span>
<span class="sd">     </span>
<span class="sd">    NOTE: </span>
<span class="sd">        If distribution does not have a solution, plot labeled: Pathological.  Some bootstrap samples may have</span>
<span class="sd">        valid solutions and those are plotted in the CDFs and E/I plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bootstrapping.... be patient&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">.975</span> <span class="o">*</span> <span class="n">nb</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">.025</span> <span class="o">*</span> <span class="n">nb</span><span class="p">))</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Io</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ppars</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span>
    <span class="n">Es</span><span class="p">,</span> <span class="n">Is</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">V2s</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_f</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span> <span class="o">=</span> <span class="n">Is</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Es</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">flat_f</span> <span class="o">=</span> <span class="n">Fs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># plot E/I figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Is</span><span class="p">,</span> <span class="n">Es</span><span class="p">,</span> <span class="n">EI_color</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;inclination ($^\circ$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;elongation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span><span class="p">,</span> <span class="s1">&#39; </span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">flat_f</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">nb</span><span class="p">:</span>
        <span class="n">bdata</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">pseudo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">Esb</span><span class="p">,</span> <span class="n">Isb</span><span class="p">,</span> <span class="n">Fsb</span><span class="p">,</span> <span class="n">V2sb</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_f</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">num_resample_to_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Isb</span><span class="p">,</span> <span class="n">Esb</span><span class="p">,</span> <span class="n">resample_EI_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">resample_EI_alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Esb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">bdata</span><span class="p">)</span>

            <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Isb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Esb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">I</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">E</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">Eexp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">:</span>
        <span class="n">Eexp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">EI</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Eexp</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Inc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Pathological Distribution: &#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;[</span><span class="si">%7.1f</span><span class="s1">, </span><span class="si">%7.1f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> [</span><span class="si">%7.1f</span><span class="s1">, </span><span class="si">%7.1f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_bootstraps&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="s1">&#39;inclination ($^\circ$)&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">]],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Inc</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_vs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">Io</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_inc_CDF&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># plot directional data corrected by all f</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plot_net</span><span class="p">()</span>
    <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">F</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">F</span><span class="p">))</span>
    <span class="n">f_scalarMap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    
    <span class="n">di_lists</span> <span class="o">=</span> <span class="n">unpack_di_block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="n">di_lists</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">di_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span> <span class="o">=</span> <span class="n">di_lists</span>
        
    <span class="n">mean_lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_lats</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
        <span class="n">unsquish_incs</span> <span class="o">=</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">unsquish_VGPs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dia_vgp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquish_incs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">),</span> <span class="n">site_latitude</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">),</span><span class="n">site_longitude</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">unsquish_lons</span><span class="p">,</span> <span class="n">unsquish_lats</span> <span class="o">=</span> <span class="n">unsquish_VGPs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unsquish_VGPs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">unsquish_VGPs_mean</span> <span class="o">=</span> <span class="n">fisher_mean</span><span class="p">(</span><span class="n">unsquish_lons</span><span class="p">,</span> <span class="n">unsquish_lats</span><span class="p">)</span>
        <span class="n">resampled_lons</span><span class="p">,</span> <span class="n">resampled_lats</span> <span class="o">=</span> <span class="n">fisher_mean_resample</span><span class="p">(</span><span class="n">alpha95</span><span class="o">=</span><span class="n">unsquish_VGPs_mean</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="n">vgp_nb</span><span class="p">,</span> 
                                                       <span class="n">dec</span><span class="o">=</span><span class="n">unsquish_VGPs_mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">unsquish_VGPs_mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="n">di_block</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mean_lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">resampled_lons</span><span class="p">)</span>
        <span class="n">mean_lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">resampled_lats</span><span class="p">)</span>
        
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">f_scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">hex_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">rgba</span><span class="p">)</span>

        <span class="n">plot_di</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquish_incs</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">hex_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">f_scalarMap</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f$ values&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_corrected_directions&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># plot paleolatitudes distribution</span>
    <span class="n">EI_plats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">plat_mode</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">,</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plat_lower</span><span class="p">,</span> <span class="n">plat_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">EI_plats</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plat_lower</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plat_upper</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> [</span><span class="si">%7.1f</span><span class="s1">, </span><span class="si">%7.1f</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plat_mode</span><span class="p">,</span> <span class="n">plat_lower</span><span class="p">,</span> <span class="n">plat_upper</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit result: mu=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">std=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;paleolatitude ($^\circ$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">figprefix</span><span class="o">+</span><span class="s1">&#39;_paleolatitudes&#39;</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="c1"># plot resampled mean poles</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">make_orthographic_map</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)</span>
    <span class="n">plot_vgp</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mean_lons</span><span class="p">,</span> <span class="n">mean_lats</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    
    <span class="n">kent_stats</span> <span class="o">=</span> <span class="n">kent_distribution_95</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">mean_lons</span><span class="p">,</span><span class="n">inc</span><span class="o">=</span><span class="n">mean_lats</span><span class="p">)</span> 
    <span class="n">plot_pole_ellipse</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">kent_stats</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">kent_color</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Inc</span><span class="p">,</span> <span class="n">Elong</span><span class="p">,</span> <span class="n">flat_f</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PATHOLOGICAL DISTRIBUTION&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The original inclination was: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Io</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The corrected inclination is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Inc</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with bootstrapped confidence bounds of: &quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">],</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and elongation parameter of: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Elong</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The flattening factor is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">flat_f</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">f_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">lower</span><span class="p">]))</span>
    <span class="n">f_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">Io</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">upper</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with bootstrapped confidence bounds of: &quot;</span> <span class="o">+</span>
           <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">f_lower</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">f_upper</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The Kent mean incorporating inclination flattening uncertainty is:&#39;</span><span class="p">)</span>
    <span class="n">print_kent_mean</span><span class="p">(</span><span class="n">kent_stats</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_new_dirs</span> <span class="ow">and</span> <span class="n">return_values</span> <span class="p">:</span>
        <span class="n">unsquished_incs</span> <span class="o">=</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">flat_f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquished_incs</span><span class="p">),</span> <span class="n">kent_stats</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>
    
    <span class="k">elif</span> <span class="n">return_new_dirs</span><span class="p">:</span>
        <span class="n">unsquished_incs</span> <span class="o">=</span> <span class="n">unsquish</span><span class="p">(</span><span class="n">incs</span><span class="p">,</span> <span class="n">flat_f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">make_di_block</span><span class="p">(</span><span class="n">decs</span><span class="p">,</span> <span class="n">unsquished_incs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">return_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">kent_stats</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">kent_stats</span></div>

<div class="viewcode-block" id="pole_comparison_H2019"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.pole_comparison_H2019">[docs]</a><span class="k">def</span> <span class="nf">pole_comparison_H2019</span><span class="p">(</span><span class="n">lon_1</span><span class="p">,</span><span class="n">lat_1</span><span class="p">,</span><span class="n">k_1</span><span class="p">,</span><span class="n">r_1</span><span class="p">,</span><span class="n">lon_2</span><span class="p">,</span><span class="n">lat_2</span><span class="p">,</span><span class="n">k_2</span><span class="p">,</span><span class="n">r_2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate the Bhattacharyya Coefficient, Bayes error and the</span>
<span class="sd">    Kullback-Leibler divergence associated with the comparison of</span>
<span class="sd">    paleomagnetic poles following Heslop and Roberts (2019). The divergence</span>
<span class="sd">    parameter is asymmetric such that the pole that is the reference pole</span>
<span class="sd">    should be (lon_1, lat_1, k_1, r_1) and the pole of interest being compared</span>
<span class="sd">    to that reference pole should be (lon_2, lat_2, k_2, r_2).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lon_1 : longitude of pole 1 (reference pole)</span>
<span class="sd">        lat_1 : latitude of pole 1</span>
<span class="sd">        k_1 : Fisher concentration parameter of pole 1</span>
<span class="sd">        r_1 : resultant vector length of pole 1</span>
<span class="sd">        lon_2 : longitude of pole 2 (pole of interest)</span>
<span class="sd">        lat_2: latitude of pole 2</span>
<span class="sd">        k_2 : Fisher concentration parameter of pole 2</span>
<span class="sd">        r_2 : resultant vector length of pole 2</span>

<span class="sd">    Returns:</span>
<span class="sd">        - bhattacharyya, Bhattacharyya coefficient</span>
<span class="sd">        - bayes, bayes error</span>
<span class="sd">        - kld, Kullback-Leibler divergence</span>

<span class="sd">    Notes:</span>
<span class="sd">        This function utilizes code developed by D. Heslop</span>
<span class="sd">        https://github.com/dave-heslop74/kld</span>
<span class="sd">        https://github.com/dave-heslop74/bhattacharyya</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">I1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat_1</span><span class="p">)</span>
    <span class="n">D1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lon_1</span><span class="p">)</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat_2</span><span class="p">)</span>
    <span class="n">D2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lon_2</span><span class="p">)</span>

    <span class="n">mu1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">D1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">I1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">D1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">I1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">I1</span><span class="p">)))</span>
    <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">D2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">I2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">D2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">I2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">I2</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">log_sinh</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">700</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">k</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">chernoff_H2019</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">MU1</span><span class="p">,</span><span class="n">K1</span><span class="p">,</span><span class="n">MU2</span><span class="p">,</span><span class="n">K2</span><span class="p">):</span>
        <span class="n">K12</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">MU1</span><span class="o">*</span><span class="n">K1</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">MU2</span><span class="o">*</span><span class="n">K2</span><span class="p">)</span>
        <span class="n">JF</span><span class="o">=</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K1</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">K2</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K2</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">K12</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K12</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">JF</span><span class="p">)</span>

    <span class="n">bhattacharyya</span> <span class="o">=</span> <span class="n">chernoff_H2019</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">k_1</span><span class="o">*</span><span class="n">r_1</span><span class="p">,</span><span class="n">mu2</span><span class="p">,</span><span class="n">k_2</span><span class="o">*</span><span class="n">r_2</span><span class="p">)</span>

    <span class="n">alpha0</span> <span class="o">=</span> <span class="n">fminbound</span><span class="p">(</span><span class="k">lambda</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">chernoff_H2019</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">k_1</span><span class="o">*</span><span class="n">r_1</span><span class="p">,</span><span class="n">mu2</span><span class="p">,</span><span class="n">k_2</span><span class="o">*</span><span class="n">r_2</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">bayes</span> <span class="o">=</span> <span class="n">chernoff_H2019</span><span class="p">(</span><span class="n">alpha0</span><span class="p">,</span><span class="n">mu1</span><span class="p">,</span><span class="n">k_1</span><span class="o">*</span><span class="n">r_1</span><span class="p">,</span><span class="n">mu2</span><span class="p">,</span><span class="n">k_2</span><span class="o">*</span><span class="n">r_2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1">#Calculate the Kullback-Leibler divergence</span>
    <span class="n">K1</span> <span class="o">=</span> <span class="n">k_1</span><span class="o">*</span><span class="n">r_1</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="n">k_2</span><span class="o">*</span><span class="n">r_2</span>

    <span class="n">term1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">+</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">K2</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K2</span><span class="p">)</span><span class="o">-</span><span class="n">log_sinh</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K1</span>
    <span class="n">term3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mu2</span><span class="p">,(</span><span class="n">K2</span><span class="o">*</span><span class="n">mu1</span> <span class="o">-</span> <span class="n">K1</span><span class="o">*</span><span class="n">mu2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">kld</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">term1</span><span class="o">-</span><span class="n">term2</span><span class="o">*</span><span class="n">term3</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bhattacharyya</span><span class="p">,</span> <span class="n">bayes</span><span class="p">,</span> <span class="n">kld</span></div>


<div class="viewcode-block" id="plate_rate_mc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plate_rate_mc">[docs]</a><span class="k">def</span> <span class="nf">plate_rate_mc</span><span class="p">(</span><span class="n">pole1_plon</span><span class="p">,</span> <span class="n">pole1_plat</span><span class="p">,</span> <span class="n">pole1_kappa</span><span class="p">,</span> <span class="n">pole1_N</span><span class="p">,</span> <span class="n">pole1_age</span><span class="p">,</span> <span class="n">pole1_age_error</span><span class="p">,</span>
                  <span class="n">pole2_plon</span><span class="p">,</span> <span class="n">pole2_plat</span><span class="p">,</span> <span class="n">pole2_kappa</span><span class="p">,</span> <span class="n">pole2_N</span><span class="p">,</span> <span class="n">pole2_age</span><span class="p">,</span> <span class="n">pole2_age_error</span><span class="p">,</span>
                  <span class="n">ref_loc_lon</span><span class="p">,</span> <span class="n">ref_loc_lat</span><span class="p">,</span> <span class="n">samplesize</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">figure_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the latitudinal motion implied by a pair of poles and utilize</span>
<span class="sd">    the Monte Carlo sampling method of Swanson-Hysell (2014) to determine the</span>
<span class="sd">    associated uncertainty.</span>

<span class="sd">    Parameters:=</span>
<span class="sd">        plon : longitude of pole</span>
<span class="sd">        plat : latitude of pole</span>
<span class="sd">        kappa : Fisher precision parameter for VPGs in pole</span>
<span class="sd">        N : number of VGPs in pole</span>
<span class="sd">        age : age assigned to pole in Ma</span>
<span class="sd">        age_error : 1 sigma age uncertainty in million years</span>
<span class="sd">        ref_loc_lon : longitude of reference location</span>
<span class="sd">        ref_loc_lat : latitude of reference location</span>
<span class="sd">        samplesize : number of draws from pole and age distributions (default set to 10000)</span>
<span class="sd">        random_seed : set random seed for reproducible number generation (default is None)</span>
<span class="sd">        plot : whether to make figures (default is True, optional)</span>
<span class="sd">        savefig : whether to save figures (default is True, optional)</span>
<span class="sd">        save_directory = default is local directory (optional)</span>
<span class="sd">        figure_name = prefix for file names (optional)</span>

<span class="sd">    Returns:</span>
<span class="sd">        rate of latitudinal motion in cm/yr along with estimated 2.5 and 97.5</span>
<span class="sd">        </span>
<span class="sd">        percentile rate estimates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_loc_lon</span><span class="p">,</span> <span class="n">ref_loc_lat</span><span class="p">]</span>
    <span class="n">pole1</span> <span class="o">=</span> <span class="p">(</span><span class="n">pole1_plon</span><span class="p">,</span> <span class="n">pole1_plat</span><span class="p">)</span>
    <span class="n">pole1_paleolat</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">pole1</span><span class="p">,</span> <span class="n">ref_loc</span><span class="p">)</span>
    <span class="n">pole2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pole2_plon</span><span class="p">,</span> <span class="n">pole2_plat</span><span class="p">)</span>
    <span class="n">pole2_paleolat</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">pole2</span><span class="p">,</span> <span class="n">ref_loc</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The paleolatitude for ref_loc resulting from pole 1 is:&quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">pole1_paleolat</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The paleolatitude for ref_loc resulting from pole 2 is:&quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="n">pole2_paleolat</span><span class="p">))</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="p">((</span><span class="n">pole1_paleolat</span> <span class="o">-</span> <span class="n">pole2_paleolat</span><span class="p">)</span> <span class="o">*</span> <span class="mi">111</span> <span class="o">*</span>
                    <span class="mi">100000</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">pole1_age</span> <span class="o">-</span> <span class="n">pole2_age</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The rate of paleolatitudinal change implied by the poles pairs in cm/yr is:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rate</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">random_seed</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="n">pole1_MCages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">pole1_age</span><span class="p">,</span> <span class="n">pole1_age_error</span><span class="p">,</span> <span class="n">samplesize</span><span class="p">)</span>
    <span class="n">pole2_MCages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">pole2_age</span><span class="p">,</span> <span class="n">pole2_age_error</span><span class="p">,</span> <span class="n">samplesize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pole1_MCages</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pole 1 ages&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pole2_MCages</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pole 2 ages&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age (Ma)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plot_extension</span> <span class="o">=</span> <span class="s1">&#39;_1.svg&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="n">figure_name</span> <span class="o">+</span> <span class="n">plot_extension</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">pole1_MCpoles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_MCpole_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_MCpole_long</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_MCpaleolat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samplesize</span><span class="p">):</span>
        <span class="n">vgp_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vgp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pole1_N</span><span class="p">):</span>
            <span class="c1"># pmag.dev returns a direction from a fisher distribution with</span>
            <span class="c1"># specified kappa</span>
            <span class="n">direction_atN</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">pole1_kappa</span><span class="p">)</span>
            <span class="c1"># this direction is centered at latitude of 90 degrees and needs to be rotated</span>
            <span class="c1"># to be centered on the mean pole position</span>
            <span class="n">tilt_direction</span> <span class="o">=</span> <span class="n">pole1_plon</span>
            <span class="n">tilt_amount</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pole1_plat</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dotilt</span><span class="p">(</span>
                <span class="n">direction_atN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction_atN</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tilt_direction</span><span class="p">,</span> <span class="n">tilt_amount</span><span class="p">)</span>
            <span class="n">vgp_samples</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">vgp_samples</span><span class="p">)</span>
        <span class="n">mean_pole_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
        <span class="n">pole1_MCpoles</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="n">pole1_MCpole_lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
        <span class="n">pole1_MCpole_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
        <span class="n">paleolat</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">mean_pole_position</span><span class="p">,</span> <span class="n">ref_loc</span><span class="p">)</span>
        <span class="n">pole1_MCpaleolat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paleolat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">pole2_MCpoles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole2_MCpole_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole2_MCpole_long</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole2_MCpaleolat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samplesize</span><span class="p">):</span>
        <span class="n">vgp_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vgp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pole2_N</span><span class="p">):</span>
            <span class="c1"># pmag.dev returns a direction from a fisher distribution with</span>
            <span class="c1"># specified kappa</span>
            <span class="n">direction_atN</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fshdev</span><span class="p">(</span><span class="n">pole2_kappa</span><span class="p">)</span>
            <span class="c1"># this direction is centered at latitude of 90 degrees and needs to be rotated</span>
            <span class="c1"># to be centered on the mean pole position</span>
            <span class="n">tilt_direction</span> <span class="o">=</span> <span class="n">pole2_plon</span>
            <span class="n">tilt_amount</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pole2_plat</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dotilt</span><span class="p">(</span>
                <span class="n">direction_atN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction_atN</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tilt_direction</span><span class="p">,</span> <span class="n">tilt_amount</span><span class="p">)</span>
            <span class="n">vgp_samples</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">vgp_samples</span><span class="p">)</span>
        <span class="n">mean_pole_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
        <span class="n">pole2_MCpoles</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">],</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="n">pole2_MCpole_lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
        <span class="n">pole2_MCpole_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
        <span class="n">paleolat</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">mean_pole_position</span><span class="p">,</span> <span class="n">ref_loc</span><span class="p">)</span>
        <span class="n">pole2_MCpaleolat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paleolat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">map_axis</span> <span class="o">=</span> <span class="n">make_mollweide_map</span><span class="p">()</span>

        <span class="n">plot_vgp</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">pole1_MCpole_long</span><span class="p">,</span> <span class="n">pole1_MCpole_lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plot_vgp</span><span class="p">(</span><span class="n">map_axis</span><span class="p">,</span> <span class="n">pole2_MCpole_long</span><span class="p">,</span> <span class="n">pole2_MCpole_lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">savefig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plot_extension</span> <span class="o">=</span> <span class="s1">&#39;_2.svg&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="n">figure_name</span> <span class="o">+</span> <span class="n">plot_extension</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># calculating the change in paleolatitude between the Monte Carlo pairs</span>
    <span class="n">pole1_pole2_Delta_degrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_pole2_Delta_kilometers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_pole2_Delta_myr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_pole2_degrees_per_myr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pole1_pole2_cm_per_yr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samplesize</span><span class="p">):</span>
        <span class="n">Delta_degrees</span> <span class="o">=</span> <span class="n">pole1_MCpaleolat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">pole2_MCpaleolat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">Delta_Myr</span> <span class="o">=</span> <span class="n">pole1_MCages</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">pole2_MCages</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">pole1_pole2_Delta_degrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Delta_degrees</span><span class="p">)</span>
        <span class="n">degrees_per_myr</span> <span class="o">=</span> <span class="n">Delta_degrees</span><span class="o">/</span><span class="n">Delta_Myr</span>
        <span class="n">cm_per_yr</span> <span class="o">=</span> <span class="p">((</span><span class="n">Delta_degrees</span> <span class="o">*</span> <span class="mi">111</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Delta_Myr</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="n">pole1_pole2_degrees_per_myr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">degrees_per_myr</span><span class="p">)</span>
        <span class="n">pole1_pole2_cm_per_yr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cm_per_yr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">plotnumber</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">plotnumber</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pole1_MCpaleolat</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">pole2_MCpaleolat</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span>
                     <span class="p">[</span><span class="n">pole1_MCages</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">pole2_MCages</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pole1_MCpaleolat</span><span class="p">[:</span><span class="n">plotnumber</span><span class="p">],</span>
                    <span class="n">pole1_MCages</span><span class="p">[:</span><span class="n">plotnumber</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pole1_paleolat</span><span class="p">,</span> <span class="n">pole1_age</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pole2_MCpaleolat</span><span class="p">[:</span><span class="n">plotnumber</span><span class="p">],</span>
                    <span class="n">pole2_MCages</span><span class="p">[:</span><span class="n">plotnumber</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pole2_paleolat</span><span class="p">,</span> <span class="n">pole2_age</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pole1_paleolat</span><span class="p">,</span> <span class="n">pole2_paleolat</span><span class="p">],</span> <span class="p">[</span>
                 <span class="n">pole1_age</span><span class="p">,</span> <span class="n">pole2_age</span><span class="p">],</span> <span class="s1">&#39;w-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;paleolatitude (degrees)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;time (Ma)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pole1_pole2_cm_per_yr</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;latitudinal drift rate (cm/yr)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="c1"># plt.xlim([0,90])</span>
        <span class="k">if</span> <span class="n">savefig</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plot_extension</span> <span class="o">=</span> <span class="s1">&#39;_3.svg&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="n">figure_name</span> <span class="o">+</span> <span class="n">plot_extension</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">twopointfive_percentile</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span>
        <span class="n">pole1_pole2_cm_per_yr</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">fifty_percentile</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">pole1_pole2_cm_per_yr</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">ninetysevenpointfive_percentile</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span>
        <span class="n">pole1_pole2_cm_per_yr</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2.5th percentile is: &quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">twopointfive_percentile</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; cm/yr&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;50th percentile is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">fifty_percentile</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; cm/yr&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;97.5th percentile is: &quot;</span> <span class="o">+</span>
          <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ninetysevenpointfive_percentile</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; cm/yr&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">twopointfive_percentile</span><span class="p">,</span> <span class="n">ninetysevenpointfive_percentile</span></div>


<div class="viewcode-block" id="zeq"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.zeq">[docs]</a><span class="k">def</span> <span class="nf">zeq</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">calculation_type</span><span class="o">=</span><span class="s2">&quot;DE-BFL&quot;</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">begin_pca</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">end_pca</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">make_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME</span>
<span class="sd">       zeq.py</span>

<span class="sd">    DESCRIPTION</span>
<span class="sd">       plots demagnetization data for a single specimen:</span>
<span class="sd">          - The solid (open) symbols in the Zijderveld diagram are X,Y (X,Z) pairs.  The demagnetization diagram plots the</span>
<span class="sd">          fractional remanence remaining after each step. The green line is the fraction of the total remaence removed</span>
<span class="sd">          between each step.  If the principle direction is desired, specify begin_pca and end_pca steps as bounds for calculation.</span>

<span class="sd">          -The equal area projection has the X direction (usually North in geographic coordinates)</span>
<span class="sd">          to the top.  The red line is the X axis of the Zijderveld diagram.  Solid symbols are lower hemisphere.</span>

<span class="sd">          - red dots and blue line is the remanence remaining after each step.  The green line is the partial TRM removed in each interval</span>

<span class="sd">    INPUT FORMAT</span>
<span class="sd">       reads from  file_name or takes a  Pandas DataFrame data with specimen treatment intensity declination inclination   as columns</span>

<span class="sd">    Keywords:</span>
<span class="sd">        file= FILE   a space or tab delimited file with</span>
<span class="sd">            specimen  treatment  declination inclination intensity</span>
<span class="sd">        units= [mT,C] specify units of mT OR C, default is unscaled</span>
<span class="sd">        save=[True,False]  save figure and quit, default is False</span>
<span class="sd">        fmt [svg,jpg,png,pdf] set figure format [default is svg]</span>
<span class="sd">        begin_pca [step number] treatment step for beginning of PCA calculation, default</span>
<span class="sd">        end_pca [step number] treatment step for end of PCA calculation, last step is default</span>
<span class="sd">        calculation_type [DE-BFL,DE-BFP,DE-FM] Calculation Type: best-fit line,  plane or fisher mean; line is default</span>
<span class="sd">        angle=[0-360]: angle to subtract from declination to rotate in horizontal plane, default is 0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
        <span class="n">SIunits</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;mT&quot;</span><span class="p">:</span>
        <span class="n">SIunits</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;U&quot;</span><span class="p">:</span>
        <span class="n">SIunits</span> <span class="o">=</span> <span class="s2">&quot;U&quot;</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
                        <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="s1">&#39;treatment&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;intensity&#39;</span><span class="p">,</span> <span class="s1">&#39;declination&#39;</span><span class="p">,</span> <span class="s1">&#39;inclination&#39;</span><span class="p">]</span>
        <span class="c1"># adjust for angle rotation</span>
        <span class="n">f</span><span class="p">[</span><span class="s1">&#39;declination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;declination&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
<span class="c1">#</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="o">=</span><span class="n">data</span>
    <span class="n">f</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
    <span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mT&#39;</span><span class="p">:</span>
        <span class="n">f</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-3</span>
    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">f</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">273</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[[</span><span class="s1">&#39;treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;declination&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;inclination&#39;</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;quality&#39;</span><span class="p">]]</span>
    <span class="c1">#print(s)</span>
    <span class="n">datablock</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># define figure numbers in a dictionary for equal area, zijderveld,</span>
<span class="c1">#  and intensity vs. demagnetiztion step respectively</span>
    <span class="k">if</span> <span class="n">make_plots</span><span class="p">:</span>
        <span class="n">ZED</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;zijd&#39;</span><span class="p">],</span>  <span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;zijd&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">ZED</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
<span class="c1">#</span>
<span class="c1">#</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_zed</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">SIunits</span><span class="p">)</span>  <span class="c1"># plot the data</span>
<span class="c1">#</span>
<span class="c1"># print out data for this sample to screen</span>
<span class="c1">#</span>
    <span class="n">recnum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">show_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step treat  intensity  dec    inc&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plotrec</span> <span class="ow">in</span> <span class="n">datablock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mT&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">  </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%8.3e</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span>
                      <span class="p">(</span><span class="n">recnum</span><span class="p">,</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">  </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%8.3e</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span>
                      <span class="p">(</span><span class="n">recnum</span><span class="p">,</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">273.</span><span class="p">,</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">  </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%8.3e</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span>
                      <span class="p">(</span><span class="n">recnum</span><span class="p">,</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plotrec</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">recnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#pmagplotlib.draw_figs(ZED)</span>
    <span class="k">if</span> <span class="n">begin_pca</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">end_pca</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">calculation_type</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">make_plots</span><span class="p">:</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_zed</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                             <span class="n">SIunits</span><span class="p">)</span>  <span class="c1"># plot the data</span>
        <span class="c1"># get best-fit direction/great circle</span>
        <span class="n">mpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">domean</span><span class="p">(</span><span class="n">datablock</span><span class="p">,</span> <span class="n">begin_pca</span><span class="p">,</span> <span class="n">end_pca</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">)</span>
        <span class="c1"># plot the best-fit direction/great circle</span>
        <span class="k">if</span> <span class="n">make_plots</span><span class="p">:</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">mpars</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Specimen, calc_type, N, min, max, MAD, dec, inc&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mT&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%i</span><span class="s1">  </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">,</span>
                                                               <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_n&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_min&quot;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_max&quot;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_mad&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_dec&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_inc&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%i</span><span class="s1">  </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">,</span>
                                                               <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_n&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_min&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_max&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">273</span><span class="p">,</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_mad&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_dec&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_inc&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%i</span><span class="s1">  </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.2f</span><span class="s1"> </span><span class="si">%6.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1"> </span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">,</span>
                                                               <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_n&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_min&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;measurement_step_max&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_mad&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_dec&quot;</span><span class="p">],</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_inc&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ZED</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">aniso_magic_old</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span>
                <span class="n">ipar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ihext</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ivec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">iplot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">isite</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">iboot</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">Dir</span><span class="o">=</span><span class="p">[],</span> <span class="n">PDir</span><span class="o">=</span><span class="p">[],</span> <span class="n">comp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">num_bootstraps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ANIS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_TY:_aniso_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_aniso-&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fmt</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvectors&quot;</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvalue Confidence&quot;</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Confidence Ellipses&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
                    <span class="n">titles</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="c1"># initialize some variables</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="n">hpars</span><span class="p">,</span> <span class="n">bpars</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">ResRecs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">crd</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">crd</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># specimen</span>

    <span class="c1">#</span>
    <span class="c1"># set up plots</span>
    <span class="c1">#</span>
    <span class="n">ANIS</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">initcdf</span><span class="p">,</span> <span class="n">inittcdf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">iboot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">inittcdf</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">initcdf</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vxcdf&#39;</span><span class="p">],</span> <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vycdf&#39;</span><span class="p">],</span> <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vzcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vxcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vycdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vzcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1"># read in the data</span>
    <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="n">site_file</span><span class="p">}</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="s1">&#39;contribution&#39;</span><span class="p">],</span>
                          <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">)</span>
    <span class="n">con_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;contribution&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="c1"># try to get contribution id</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">con_id</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

    <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">isite</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">propagate_name_down</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">)</span>
    <span class="n">spec_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span>
    <span class="c1">#spec_df = spec_container.get_records_for_code(&#39;AE-&#39;, strict_match=False)</span>
    <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">df</span>
    <span class="c1"># get only anisotropy records</span>
    <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;aniso_tilt_correction&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># assume specimen coordinates</span>
    <span class="n">orlist</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">CS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="n">orlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;desired coordinate system not available, using available: &quot;</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isite</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;site&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;cannot plot by site -- make sure you have a samples and site table available&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plotting all data instead&quot;</span><span class="p">)</span>
            <span class="n">isite</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sitelist</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">sitelist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sitelist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">site</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">loc_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">sdata</span><span class="p">,</span> <span class="n">Ss</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># list of S format data</span>
        <span class="k">if</span> <span class="n">isite</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sdata</span> <span class="o">=</span> <span class="n">spec_df</span>
            <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">sdata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">loc_name</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">loc_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">sitelist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sdata</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">site</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">sdata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">loc_name</span> <span class="o">=</span> <span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">csrecs</span> <span class="o">=</span> <span class="n">sdata</span><span class="p">[</span><span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CS</span><span class="p">]</span>
        <span class="n">anitypes</span> <span class="o">=</span> <span class="n">csrecs</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csrecs</span><span class="p">:</span>
                <span class="n">csrecs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">Locs</span> <span class="o">=</span> <span class="n">csrecs</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="c1">#Sites = csrecs[&#39;site&#39;].unique()</span>
        <span class="c1">#Samples = csrecs[&#39;sample&#39;].unique()</span>
        <span class="c1">#Specimens = csrecs[&#39;specimen&#39;].unique()</span>
        <span class="c1">#Cits = csrecs[&#39;citations&#39;].unique()</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">csrecs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">Ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># protect against crap</span>
            <span class="n">ResRec</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;analysts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CS</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s2">&quot;aniso_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;aniso_type&quot;</span><span class="p">]</span>
            <span class="c1"># tau,Vdirs=pmag.doseigs(s)</span>
            <span class="k">if</span> <span class="s2">&quot;aniso_s_n_measurements&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;aniso_s_n_measurements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;6&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;aniso_s_sigma&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;aniso_s_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;aniso_s_n_measurements&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;aniso_s_sigma&quot;</span><span class="p">]),</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">aniso_v1</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">]]])</span>
            <span class="n">aniso_v2</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">]]])</span>
            <span class="n">aniso_v3</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">],</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">]]])</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v1</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v2</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v3</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F12&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F23&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;F_crit: &#39;</span><span class="o">+</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F_crit&#39;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="s1">&#39;; F12,F23_crit: &#39;</span><span class="o">+</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;F12_crit&#39;</span><span class="p">]</span>
            <span class="n">ResRec</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">makelist</span><span class="p">(</span><span class="n">anitypes</span><span class="p">)</span>
            <span class="n">ResRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ResRec</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ss</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>  <span class="c1"># use server plot naming convention</span>
                <span class="n">plot_name</span> <span class="o">=</span> <span class="s2">&quot;LO:_&quot;</span> <span class="o">+</span> <span class="n">loc_name</span> <span class="o">+</span> <span class="s1">&#39;_SI:_&#39;</span> <span class="o">+</span> <span class="n">site</span> <span class="o">+</span> <span class="s1">&#39;_SA:__SP:__CO:_&#39;</span> <span class="o">+</span> <span class="n">crd</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">loc_name</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># use more readable plot naming convention</span>
                <span class="n">plot_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_name</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_name</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
            <span class="n">bpars</span><span class="p">,</span> <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_anis</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">Ss</span><span class="p">,</span> <span class="n">iboot</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span>
                                                 <span class="n">title</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">],</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plots</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">ANIS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plots</span><span class="p">:</span>
                <span class="n">save</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">,</span> <span class="n">con_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">hpars</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">ihext</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">HextRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ResRec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">HextRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="c1"># copy over stuff</span>
                <span class="c1"># group these into HextRec[&#39;aniso_v1&#39;]</span>
                <span class="n">anisotropy_t1</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_dec</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_inc</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">]</span>
                <span class="n">eta_zeta</span> <span class="o">=</span> <span class="s2">&quot;eta/zeta&quot;</span>
                <span class="n">anisotropy_v1_eta_dec</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_eta_inc</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_eta_semi_angle</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_zeta_dec</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_zeta_inc</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">]</span>
                <span class="n">anisotropy_v1_zeta_semi_angle</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">]</span>
                <span class="n">aniso_v1_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">anisotropy_t1</span><span class="p">,</span> <span class="n">anisotropy_v1_dec</span><span class="p">,</span> <span class="n">anisotropy_v1_inc</span><span class="p">,</span> <span class="n">eta_zeta</span><span class="p">,</span>
                                 <span class="n">anisotropy_v1_eta_dec</span><span class="p">,</span> <span class="n">anisotropy_v1_eta_inc</span><span class="p">,</span> <span class="n">anisotropy_v1_eta_semi_angle</span><span class="p">,</span>
                                 <span class="n">anisotropy_v1_zeta_dec</span><span class="p">,</span> <span class="n">anisotropy_v1_zeta_inc</span><span class="p">,</span> <span class="n">anisotropy_v1_zeta_semi_angle</span><span class="p">]</span>
                <span class="n">aniso_v1</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aniso_v1_list</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v1</span>

                <span class="c1"># for printing</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>

                <span class="c1"># group these into HextRec[&#39;aniso_v2&#39;]</span>
                <span class="n">aniso_v2</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">]]])</span>
                <span class="n">aniso_v2</span> <span class="o">+=</span> <span class="s2">&quot; : eta/zeta : &quot;</span>
                <span class="n">aniso_v2</span> <span class="o">+=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">]]])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;aniso_v2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v2</span>
                <span class="c1"># for printing</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>

                <span class="c1"># group these into HextRec[&#39;aniso_v3&#39;]</span>
                <span class="n">aniso_v3</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">]]])</span>
                <span class="n">aniso_v3</span> <span class="o">+=</span> <span class="s2">&quot; : eta/zeta : &quot;</span>
                <span class="n">aniso_v3</span> <span class="o">+=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">],</span>
                                                         <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">]]])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;aniso_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v3</span>
                <span class="c1"># for printing</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>

                <span class="c1"># not valid MagIC columns (2.5 or 3)</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F23&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F23&quot;</span><span class="p">])</span>
                <span class="c1">#</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN:AE-H&#39;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hext Statistics: &quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot; tau_i, V_i_D, V_i_I, V_i_zeta, V_i_zeta_D, V_i_zeta_I, V_i_eta, V_i_eta_D, V_i_eta_I&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">])</span>
                    <span class="c1">#</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">])</span>
                    <span class="c1">#</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">HextRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">])</span>
                <span class="n">HextRec</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                <span class="c1"># strip out invalid keys</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">HextRec</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;anisotropy_&#39;</span><span class="p">):</span>  <span class="c1"># and &#39;hext&#39; not in key:</span>
                        <span class="n">HextRec</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">ResRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HextRec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bpars</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">BootRec</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ResRec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">BootRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResRec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="c1"># copy over stuff</span>

                <span class="n">aniso_v1</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">],</span>
                                                        <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">]]])</span>
                <span class="n">aniso_v1</span> <span class="o">+=</span> <span class="s2">&quot; : eta/zeta : &quot;</span>
                <span class="n">aniso_v1</span> <span class="o">+=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_eta_dec&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_eta_inc&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_eta&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_zeta_dec&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_zeta_inc&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v1_zeta&#39;</span><span class="p">]]])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v1</span>
                <span class="c1"># for printing</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%10.8f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta&quot;</span><span class="p">])</span>

                <span class="c1"># group these into aniso_v2</span>
                <span class="n">aniso_v2</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">]]])</span>
                <span class="n">aniso_v2</span> <span class="o">+=</span> <span class="s2">&quot; : eta/zeta : &quot;</span>
                <span class="n">aniso_v2</span> <span class="o">+=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_eta_dec&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_eta_inc&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_eta&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_zeta_dec&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_zeta_inc&#39;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;v2_zeta&#39;</span><span class="p">]]])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v2</span>
                <span class="c1"># for printing</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta&quot;</span><span class="p">])</span>

                <span class="c1"># group into aniso_v3</span>
                <span class="n">aniso_v3</span> <span class="o">=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">]]])</span>
                <span class="n">aniso_v3</span> <span class="o">+=</span> <span class="s2">&quot; : eta/zeta : &quot;</span>
                <span class="n">aniso_v3</span> <span class="o">+=</span> <span class="s2">&quot; : &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_dec&quot;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_inc&quot;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta&quot;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_dec&quot;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_inc&quot;</span><span class="p">],</span>
                                                         <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta&quot;</span><span class="p">]]])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;aniso_v3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aniso_v3</span>

                <span class="c1"># for printing</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_dec&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta&quot;</span><span class="p">])</span>

                <span class="c1"># not valid MagIC columns</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_hext_F23&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1">#</span>
                <span class="c1"># regular bootstrap</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN:AE-H:AE-BS&#39;</span>

                <span class="k">if</span> <span class="n">ipar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># parametric bootstrap</span>
                    <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN:AE-H:AE-BS-P&#39;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bootstrap Statistics: &quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot; tau_i, V_i_D, V_i_I, V_i_zeta, V_i_zeta_D, V_i_zeta_I, V_i_eta, V_i_eta_D, V_i_eta_I&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">])</span>
                    <span class="c1">#</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">],</span> <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">])</span>
                    <span class="c1">#</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">],</span> <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">],</span>
                          <span class="n">BootRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">])</span>
                <span class="n">BootRec</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
                <span class="c1"># strip out invalid keys</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">BootRec</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;anisotropy_&#39;</span><span class="p">):</span>  <span class="c1"># and &#39;hext&#39; not in key:</span>
                        <span class="n">BootRec</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c1"># THESE SHOULD BE AT A DIFFERENT LEVEL??? MAYBE SITE?</span>
                <span class="n">ResRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BootRec</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">goon</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">goon</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iboot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compare with [d]irection &quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot; plot [g]reat circle,  change [c]oord. system, change [e]llipse calculation,  s[a]ve plots, [q]uit &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">isite</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  [p]revious, [s]ite, [q]uit, &lt;return&gt; for next &quot;</span><span class="p">)</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span>
                    <span class="n">iboot</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Do Hext Statistics  1/[0]: &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                        <span class="n">ihext</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Suppress bootstrap 1/[0]: &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                        <span class="n">iboot</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">iboot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Parametric bootstrap 1/[0]: &quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                            <span class="n">ipar</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Plot bootstrap eigenvectors:  1/[0]: &quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
                            <span class="n">ivec</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">iplot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">inittcdf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
                                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                                <span class="n">inittcdf</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">bpars</span><span class="p">,</span> <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_anis</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">Ss</span><span class="p">,</span> <span class="n">iboot</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span>
                                                         <span class="n">comp</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plots</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">ANIS</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Coordinate system is: &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Specimen&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Geographic&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Tilt corrected&quot;</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                        <span class="s2">&quot; Enter desired coordinate system: [s]pecimen, [g]eographic, [t]ilt corrected &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                        <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                        <span class="n">CS</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
                        <span class="n">CS</span> <span class="o">=</span> <span class="mi">100</span>
                    <span class="k">if</span> <span class="n">CS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orlist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">CS</span> <span class="o">=</span> <span class="n">orlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
                        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
                        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;desired coordinate system not available, using available: &quot;</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
                    <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">goon</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">isite</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">goon</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good bye &quot;</span><span class="p">)</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">initcdf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">initcdf</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vxcdf&#39;</span><span class="p">],</span> <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vycdf&#39;</span><span class="p">],</span> <span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vzcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vxcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vycdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;vzcdf&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">Dir</span><span class="p">,</span> <span class="n">comp</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                      Input: Vi D I to  compare  eigenvector Vi with direction D/I</span>
<span class="s2">                             where Vi=1: principal</span>
<span class="s2">                                   Vi=2: major</span>
<span class="s2">                                   Vi=3: minor</span>
<span class="s2">                                   D= declination of comparison direction</span>
<span class="s2">                                   I= inclination of comparison direction</span>
<span class="s2">                             example input: 1 15 20&quot;&quot;&quot;</span><span class="p">)</span>
                    <span class="n">con</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="n">con</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">vdi</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Vi D I: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">vec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vdi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">Dir</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">vdi</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">vdi</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                            <span class="n">con</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Incorrect entry, try again &quot;</span><span class="p">)</span>
                    <span class="n">bpars</span><span class="p">,</span> <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_anis</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">Ss</span><span class="p">,</span> <span class="n">iboot</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                                                         <span class="n">iplot</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">)</span>
                    <span class="n">Dir</span><span class="p">,</span> <span class="n">comp</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plots</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">ANIS</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                    <span class="n">con</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">con</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot; Input:  input pole to great circle ( D I) to  plot a great circle:   &quot;</span><span class="p">)</span>
                            <span class="n">di</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot; D I: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">PDir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="n">PDir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="n">con</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot; enter the dec and inc of the pole on one line &quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;ummm - you are doing something wrong - i give up&quot;</span><span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                        <span class="c1"># if windows, must re-draw everything</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_anis</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">Ss</span><span class="p">,</span> <span class="n">iboot</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span>
                                              <span class="n">title</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">)</span>

                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">ANIS</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">],</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plots</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">ANIS</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">-=</span> <span class="mi">2</span>
                    <span class="n">goon</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">plot</span>
                    <span class="n">goon</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                    <span class="n">keepon</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">site</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot; print site or part of site desired: &quot;</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">keepon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="n">sitelist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
                            <span class="n">keepon</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">tmplist</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">qq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sitelist</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sitelist</span><span class="p">[</span><span class="n">qq</span><span class="p">]:</span>
                                    <span class="n">tmplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sitelist</span><span class="p">[</span><span class="n">qq</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot; not found, but this was: &quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">tmplist</span><span class="p">)</span>
                            <span class="n">site</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select one or try again</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="n">sitelist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
                    <span class="n">goon</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                    <span class="n">locs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">makelist</span><span class="p">(</span><span class="n">Locs</span><span class="p">)</span>
                    <span class="n">site_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>
                    <span class="k">if</span> <span class="n">isite</span><span class="p">:</span>
                        <span class="n">site_name</span> <span class="o">=</span> <span class="n">site</span>
                    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>  <span class="c1"># use server plot naming convention</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;LO:_&quot;</span> <span class="o">+</span> <span class="n">locs</span> <span class="o">+</span> <span class="s1">&#39;_SI:_&#39;</span> <span class="o">+</span> <span class="n">site_name</span> <span class="o">+</span> <span class="s1">&#39;_SA:__SP:__CO:_&#39;</span> <span class="o">+</span> <span class="n">crd</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># use more readable plot naming convention</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">site_name</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
                    <span class="n">save</span><span class="p">(</span><span class="n">ANIS</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
                    <span class="n">goon</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping plot - not enough data points&#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#   put rmag_results stuff here</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ResRecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># for rec in ResRecs:</span>
        <span class="c1">#    con.add_item(&#39;specimens&#39;, rec, rec[&#39;specimen&#39;])</span>
        <span class="c1"># sort records so that they are grouped by specimen ?</span>
        <span class="c1">#con.write_table_to_file(&#39;specimens&#39;, &#39;custom_specimens.txt&#39;)</span>
        <span class="c1"># ResOut,keylist=pmag.fillkeys(ResRecs)</span>
        <span class="c1"># just make a fresh one</span>
        <span class="n">con</span><span class="o">.</span><span class="n">add_magic_table_from_data</span><span class="p">(</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="n">ResRecs</span><span class="p">)</span>
    <span class="c1">#   con.write_table_to_file(&#39;specimens&#39;, &#39;anisotropy_specimens.txt&#39;)</span>

    <span class="c1">#    pmag.magic_write(outfile,ResOut,&#39;rmag_results&#39;)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Good bye &quot;</span><span class="p">)</span>



<div class="viewcode-block" id="aniso_magic_nb"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.aniso_magic_nb">[docs]</a><span class="k">def</span> <span class="nf">aniso_magic_nb</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">ipar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ihext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ivec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">isite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iloc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iboot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">Dir</span><span class="o">=</span><span class="p">[],</span> <span class="n">PDir</span><span class="o">=</span><span class="p">[],</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for aniso_magic</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">aniso_magic</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">samp_file</span><span class="p">,</span> <span class="n">site_file</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="p">,</span>
                       <span class="n">isite</span><span class="p">,</span> <span class="n">iloc</span><span class="p">,</span> <span class="n">iboot</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">PDir</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">,</span>
                       <span class="n">dir_path</span><span class="p">,</span> <span class="n">fignum</span><span class="p">,</span> <span class="n">save_plots</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">contribution</span><span class="p">)</span></div>


<div class="viewcode-block" id="aniso_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.aniso_magic">[docs]</a><span class="k">def</span> <span class="nf">aniso_magic</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">ipar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ihext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ivec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">isite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iboot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">Dir</span><span class="o">=</span><span class="p">[],</span> <span class="n">PDir</span><span class="o">=</span><span class="p">[],</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes plots of anisotropy eigenvectors, eigenvalues and confidence bounds</span>
<span class="sd">    All directions are on the lower hemisphere.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        infile : specimens formatted file with aniso_s data</span>
<span class="sd">        samp_file : samples formatted file with sample =&gt; site relationship</span>
<span class="sd">        site_file : sites formatted file with site =&gt; location relationship</span>
<span class="sd">        verbose : if True, print messages to output</span>
<span class="sd">        ipar (confidence bound parameter): if True - perform parametric bootstrap - requires non-blank aniso_s_sigma</span>
<span class="sd">        ihext (confidence bound parameter): if True - Hext ellipses</span>
<span class="sd">        ivec (confidence bound parameter): if True - plot bootstrapped eigenvectors instead of ellipses</span>
<span class="sd">        isite (confidence bound parameter): if True plot by site, requires non-blank samp_file</span>
<span class="sd">        iboot (confidence bound parameter): if True - bootstrap ellipses</span>
<span class="sd">        vec : eigenvector for comparison with Dir</span>
<span class="sd">        Dir : [Dec,Inc] list for comparison direction</span>
<span class="sd">        PDir : [Pole_dec, Pole_Inc] for pole to plane for comparison</span>
<span class="sd">              green dots are on the lower hemisphere, cyan are on the upper hemisphere</span>
<span class="sd">        crd : [&#39;s&#39;,&#39;g&#39;,&#39;t&#39;], coordinate system for plotting whereby:</span>
<span class="sd">            s : specimen coordinates, aniso_tile_correction = -1, or unspecified</span>
<span class="sd">            g : geographic coordinates, aniso_tile_correction = 0</span>
<span class="sd">            t : tilt corrected coordinates, aniso_tile_correction = 100</span>
<span class="sd">        num_bootstraps : how many bootstraps to do, default 1000</span>
<span class="sd">        dir_path : directory path</span>
<span class="sd">        fignum : matplotlib figure number, default 1</span>
<span class="sd">        save_plots : bool, default True</span>
<span class="sd">            if True, create and save all requested plots</span>
<span class="sd">        interactive : bool, default False</span>
<span class="sd">            interactively plot and display for each specimen</span>
<span class="sd">            (this is best used on the command line only)</span>
<span class="sd">        fmt : str, default &quot;svg&quot;</span>
<span class="sd">            format for figures, [svg, jpg, pdf, png]</span>
<span class="sd">        contribution : pmagpy contribution_builder.Contribution object, if not provided will be created</span>
<span class="sd">            in directory (default None).  (if provided, infile/samp_file/dir_path may be left blank)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># make sure boolean values are in integer form</span>
    <span class="c1"># for backwards compatibility</span>
    <span class="n">ipar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipar</span><span class="p">)</span>
    <span class="n">ihext</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ihext</span><span class="p">)</span>
    <span class="n">ivec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ivec</span><span class="p">)</span>
    <span class="n">isite</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">isite</span><span class="p">)</span>
    <span class="c1">#iloc = int(iloc) # NOT USED</span>
    <span class="n">iboot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iboot</span><span class="p">)</span>
    <span class="c1"># initialize some variables</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="n">hpars</span><span class="p">,</span> <span class="n">bpars</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1"># set aniso_tilt_correction value</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># specimen</span>
    <span class="k">if</span> <span class="n">crd</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">crd</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># read in the data</span>

    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># fix directory</span>
        <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="n">site_file</span><span class="p">}</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="s1">&#39;contribution&#39;</span><span class="p">],</span>
                              <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">directory</span>
    <span class="c1"># get contribution id if available</span>
    <span class="n">con_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;contribution&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">con_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># get other data</span>
    <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
    <span class="n">spec_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span>
    <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">df</span>
    <span class="c1"># use only anisotropy records</span>
    <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;aniso_tilt_correction&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># assume specimen coordinates</span>
    <span class="k">if</span> <span class="s2">&quot;aniso_s_n_measurements&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spec_df</span><span class="p">[</span><span class="s2">&quot;aniso_s_n_measurements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;6&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;aniso_s_sigma&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spec_df</span><span class="p">[</span><span class="s2">&quot;aniso_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">orlist</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">CS</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="n">orlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="k">if</span> <span class="n">CS</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;desired coordinate system not available, using available: &quot;</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
    <span class="n">cs_df</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="n">spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CS</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">isite</span><span class="p">:</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="n">cs_df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sites</span><span class="p">):</span>
            <span class="n">site_df</span> <span class="o">=</span> <span class="n">cs_df</span><span class="p">[</span><span class="n">cs_df</span><span class="o">.</span><span class="n">site</span> <span class="o">==</span> <span class="n">site</span><span class="p">]</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;sites&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">locs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">site</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">locs</span>

            <span class="n">figs</span> <span class="o">=</span> <span class="n">plot_aniso</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">site_df</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="n">Dir</span><span class="p">,</span> <span class="n">PDir</span><span class="o">=</span><span class="n">PDir</span><span class="p">,</span> <span class="n">ipar</span><span class="o">=</span><span class="n">ipar</span><span class="p">,</span>
                              <span class="n">ihext</span><span class="o">=</span><span class="n">ihext</span><span class="p">,</span> <span class="n">ivec</span><span class="o">=</span><span class="n">ivec</span><span class="p">,</span> <span class="n">iboot</span><span class="o">=</span><span class="n">iboot</span><span class="p">,</span>
                              <span class="n">vec</span><span class="o">=</span><span class="n">vec</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="o">=</span><span class="n">num_bootstraps</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">site</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">loc</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">site</span> <span class="o">+</span><span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">crd</span> <span class="o">+</span> <span class="s2">&quot;_aniso-&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LO:_&quot;</span> <span class="o">+</span> <span class="n">loc</span> <span class="o">+</span> <span class="s2">&quot;_SI:_&quot;</span> <span class="o">+</span> <span class="n">site</span> <span class="o">+</span>  <span class="s1">&#39;_TY:_aniso_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
                    <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvectors&quot;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvalue Confidence&quot;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Confidence Ellipses&quot;</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">figs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
                            <span class="n">titles</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">],</span>
                                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">]),</span>
                                 <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                    <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_or_quit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                    <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fignum</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">iboot</span><span class="p">:</span>
                    <span class="n">fignum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fignum</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="n">plot_aniso</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">cs_df</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="n">Dir</span><span class="p">,</span> <span class="n">PDir</span><span class="o">=</span><span class="n">PDir</span><span class="p">,</span> <span class="n">ipar</span><span class="o">=</span><span class="n">ipar</span><span class="p">,</span> <span class="n">ihext</span><span class="o">=</span><span class="n">ihext</span><span class="p">,</span>
                          <span class="n">ivec</span><span class="o">=</span><span class="n">ivec</span><span class="p">,</span> <span class="n">iboot</span><span class="o">=</span><span class="n">iboot</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="n">vec</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="o">=</span><span class="n">num_bootstraps</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="n">cs_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span>  <span class="n">locs</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">crd</span> <span class="o">+</span> <span class="s2">&quot;_aniso-&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">figs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MC:_&#39;</span> <span class="o">+</span> <span class="n">con_id</span> <span class="o">+</span> <span class="s1">&#39;_TY:_aniso_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
                <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvectors&quot;</span>
                <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Eigenvalue Confidence&quot;</span>
                <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Confidence Ellipses&quot;</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">figs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
                        <span class="n">titles</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">locs</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">],</span>
                             <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">]),</span>
                             <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_or_quit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="plot_dmag"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_dmag">[docs]</a><span class="k">def</span> <span class="nf">plot_dmag</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dmag_key</span><span class="o">=</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">,</span><span class="n">intensity</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">quality</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots demagenetization data versus step for all specimens in pandas dataframe datablock</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data : Pandas dataframe with MagIC data model 3 columns:</span>
<span class="sd">        fignum : figure number</span>
<span class="sd">        specimen : specimen name</span>
<span class="sd">        dmag_key : one of these: [&#39;treat_temp&#39;,&#39;treat_ac_field&#39;,&#39;treat_mw_energy&#39;]</span>
<span class="sd">            selected using method_codes : [&#39;LT_T-Z&#39;,&#39;LT-AF-Z&#39;,&#39;LT-M-Z&#39;] respectively</span>
<span class="sd">        intensity  : if blank will choose one of these: [&#39;magn_moment&#39;, &#39;magn_volume&#39;, &#39;magn_mass&#39;]</span>
<span class="sd">        quality : if True use the quality column of the DataFrame</span>
<span class="sd">        title : title for plot</span>
<span class="sd">        norm : if True, normalize data to first step</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      matptlotlib plot</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">fignum</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">intensity</span><span class="p">:</span>
        <span class="n">int_key</span><span class="o">=</span><span class="n">intensity</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">intlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_mass&#39;</span><span class="p">]</span>
    <span class="c1"># get which key we have</span>
        <span class="n">IntMeths</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_name</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">intlist</span><span class="p">]</span>
        <span class="n">int_key</span> <span class="o">=</span> <span class="n">IntMeths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">int_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>  <span class="c1"># fish out all data with this key</span>
    <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;U&quot;</span>  <span class="c1"># this  sets the units for plotting to undefined</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dmag_key</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;treat_temp&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;K&quot;</span>  <span class="c1"># kelvin</span>
        <span class="k">elif</span> <span class="s1">&#39;treat_ac_field&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>  <span class="c1"># tesla</span>
        <span class="k">elif</span> <span class="s1">&#39;treat_mw_energy&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;J&quot;</span>  <span class="c1"># joules</span>
    <span class="k">if</span> <span class="n">dmag_key</span><span class="o">==</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">:</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;K&#39;</span>
    <span class="k">if</span> <span class="n">dmag_key</span><span class="o">==</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">:</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;T&#39;</span>
    <span class="k">if</span> <span class="n">dmag_key</span><span class="o">==</span><span class="s1">&#39;treat_mw_energy&#39;</span><span class="p">:</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;J&#39;</span>
    <span class="n">spcs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># get a list of all specimens in DataFrame data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spcs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no data for plotting&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># step through specimens to put on plot</span>
    <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="n">spcs</span><span class="p">:</span>
        <span class="n">spec_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">spc</span><span class="p">)]</span>
        <span class="n">INTblock</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">INTblock</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">int_key</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">INTblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_mag</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">INTblock</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span></div>


<div class="viewcode-block" id="eigs_s"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.eigs_s">[docs]</a><span class="k">def</span> <span class="nf">eigs_s</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts eigenparamters format data to s format</span>

<span class="sd">    Parameters:</span>
<span class="sd">        Input:</span>
<span class="sd">            file : input file name with eigenvalues (tau) and eigenvectors (V) with  format:</span>
<span class="sd">                tau_1 V1_dec V1_inc tau_2 V2_dec V2_inc tau_3 V3_dec V3_inc</span>
<span class="sd">    Returns:</span>
<span class="sd">         the six tensor elements as a nested array</span>
<span class="sd">          [[x11,x22,x33,x12,x23,x13],....]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
    <span class="n">eigs_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">Ss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">eigs_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">tau</span><span class="p">,</span> <span class="n">Vdirs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">tau</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigs_data</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Vdirs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">eigs_data</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">eigs_data</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">doeigs_s</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">Vdirs</span><span class="p">))</span>
        <span class="n">Ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Ss</span></div>


<div class="viewcode-block" id="plot_gc"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.plot_gc">[docs]</a><span class="k">def</span> <span class="nf">plot_gc</span><span class="p">(</span><span class="n">poles</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots a great circle on an equal area projection</span>

<span class="sd">    Parameters:</span>
<span class="sd">       fignum : number of matplotlib object</span>
<span class="sd">       poles : nested list of [Dec,Inc] pairs of poles</span>
<span class="sd">       color : color of lower hemisphere dots for great circle - must be in form: &#39;g&#39;,&#39;r&#39;,&#39;y&#39;,&#39;k&#39;,etc.</span>
<span class="sd">               upper hemisphere is always cyan</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pole</span> <span class="ow">in</span> <span class="n">poles</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">pole</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">plot_aniso</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span> <span class="n">aniso_df</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="p">[],</span> <span class="n">PDir</span><span class="o">=</span><span class="p">[],</span> <span class="n">ipar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ihext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ivec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">iboot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ipar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipar</span><span class="p">)</span>
    <span class="n">ihext</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ihext</span><span class="p">)</span>
    <span class="n">ivec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ivec</span><span class="p">)</span>
    <span class="n">iboot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iboot</span><span class="p">)</span>
    <span class="n">Ss</span><span class="p">,</span> <span class="n">V1</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">V3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">aniso_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">Ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># protect against crap</span>
            <span class="n">tau</span><span class="p">,</span> <span class="n">Vdir</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doseigs</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">V1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Vdir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Vdir</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">V2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Vdir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Vdir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">V3</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Vdir</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Vdir</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">Ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ss</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># plot the data</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
        <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fignum</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="s1">&#39; V1=squares,V2=triangles,V3=circles&#39;</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">V1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="n">V3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="c1"># plot the confidence</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">avs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sbar</span><span class="p">(</span><span class="n">Ss</span><span class="p">)</span>
        <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">avs</span><span class="p">)</span>  <span class="c1"># get the Hext parameters</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;conf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fignum</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">plot_net</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="s1">&#39;Confidence Ellipses&#39;</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PDir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">PDir</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="c1"># plot the confidence ellipses or vectors as desired</span>
        <span class="k">if</span> <span class="n">ihext</span><span class="p">:</span>  <span class="c1"># plot the Hext ellipses</span>
            <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span>
                       <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">]]</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;r-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span>
                       <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">]]</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;b-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">],</span>
                       <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">]]</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;k-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># plot the comparison direction components</span>
                    <span class="c1"># put in dimap and plot as white symbol with axis color?</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="p">[</span><span class="n">Dir</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iboot</span><span class="p">:</span>  <span class="c1"># put on the bootstrapped confidence bounds</span>
            <span class="n">Tmean</span><span class="p">,</span> <span class="n">Vmean</span><span class="p">,</span> <span class="n">Taus</span><span class="p">,</span> <span class="n">BVs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">s_boot</span><span class="p">(</span>
                <span class="n">Ss</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">num_bootstraps</span><span class="p">)</span>  <span class="c1"># get eigenvectors of mean tensor</span>
            <span class="n">BVs_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">BVs</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ivec</span><span class="p">:</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">plot_di</span><span class="p">(</span><span class="n">dec</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">inc</span><span class="o">=</span><span class="n">BVs_trans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="c1"># put in dimap and plot as white symbol with axis color?</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># plot the comparison direction components</span>
                    <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="p">[</span><span class="n">Dir</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                <span class="c1"># do the eigenvalue cdfs</span>
                <span class="n">Taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Taus</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">]</span>
                <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;solid&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># step through eigenvalues</span>
                    <span class="c1"># get a sorted list of this eigenvalue</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">Taus</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span>
                        <span class="n">fignum</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># plot the CDF</span>
                    <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;tcdf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fignum</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="c1"># minimum 95% conf bound</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">))],</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="c1"># max 95% conf bound</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.975</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">))],</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Eigenvalues&#39;</span><span class="p">)</span>
                <span class="c1"># do cartesian coordinates of selected eigenvectori [using vec] vs Dir</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">V</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">vec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">BVs</span><span class="p">]</span>
                    <span class="n">X</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
                    <span class="n">comp_X</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">X</span><span class="p">]))</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_cdf</span><span class="p">(</span>
                            <span class="n">fignum</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># plot the CDF</span>
                        <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;cdf_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fignum</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span>
                        <span class="c1"># minimum 95% conf bound</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))],</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">vec</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="c1"># max 95% conf bound</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.975</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))],</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">vec</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="c1"># put on the comparison direction</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                            <span class="n">comp_X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sbootpars</span><span class="p">(</span><span class="n">Taus</span><span class="p">,</span> <span class="n">BVs</span><span class="p">)</span>

                <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta_dec&quot;</span><span class="p">],</span>
                           <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_zeta_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta_dec&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v1_eta_inc&quot;</span><span class="p">]]</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;r-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta_dec&quot;</span><span class="p">],</span>
                           <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_zeta_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta_dec&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v2_eta_inc&quot;</span><span class="p">]]</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;b-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ellpars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">],</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_dec&quot;</span><span class="p">],</span>
                           <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_zeta_inc&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_dec&quot;</span><span class="p">],</span> <span class="n">bpars</span><span class="p">[</span><span class="s2">&quot;v3_eta_inc&quot;</span><span class="p">]]</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">fignum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ellpars</span><span class="p">,</span> <span class="s1">&#39;k-,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># plot the comparison direction components</span>
                    <span class="n">plot_di</span><span class="p">(</span><span class="n">di_block</span><span class="o">=</span><span class="p">[</span><span class="n">Dir</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figs</span>


<div class="viewcode-block" id="aarm_magic_dm2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.aarm_magic_dm2">[docs]</a><span class="k">def</span> <span class="nf">aarm_magic_dm2</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s2">&quot;samples.txt&quot;</span><span class="p">,</span> <span class="n">data_model_num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
               <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts AARM  data to best-fit tensor (6 elements plus sigma)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        infile (str): </span>
<span class="sd">            input measurement file</span>
<span class="sd">        dir_path (str): </span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path (str): </span>
<span class="sd">            input file directory IF different from dir_path, default &quot;&quot;</span>
<span class="sd">        spec_file (str): </span>
<span class="sd">            input/output specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">        samp_file (str): </span>
<span class="sd">            input sample file name, default &quot;samples.txt&quot;</span>
<span class="sd">        data_model_num (int): </span>
<span class="sd">            MagIC data model [2, 3], default 3</span>
<span class="sd">        coord (str): </span>
<span class="sd">            coordinate system specimen/geographic/tilt-corrected,</span>
<span class="sd">            [&#39;s&#39;, &#39;g&#39;, &#39;t&#39;], default &#39;s&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple </span>
<span class="sd">            True or False indicating if conversion was successful, output file name written</span>

<span class="sd">    Info:</span>
<span class="sd">        Input for is a series of baseline, ARM pairs.</span>
<span class="sd">        The baseline should be the AF demagnetized state (3 axis demag is</span>
<span class="sd">        preferable) for the following ARM acquisition. The order of the</span>
<span class="sd">        measurements is:</span>
<span class="sd">           positions 1,2,3, 6,7,8, 11,12,13 (for 9 positions)</span>

<span class="sd">           positions 1,2,3,4, 6,7,8,9, 11,12,13,14 (for 12 positions)</span>

<span class="sd">           positions 1-15 (for 15 positions)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_model_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_model_num</span><span class="p">))</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="c1"># get full file names</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">samp_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">samp_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">output_spec_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># get coordinate system</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s1">&#39;100&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coords</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">),</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">meas_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meas_data3</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot;This is not a valid MagIC 3.0. measurements file &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid MagIC 3.0. measurements file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
        <span class="c1"># convert meas_data to 2.5</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data3</span><span class="p">:</span>
            <span class="n">meas_map</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">meas_magic3_2_magic2_map</span>
            <span class="n">meas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">meas_map</span><span class="p">))</span>
        <span class="n">spec_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">spec_data3</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data3</span><span class="p">:</span>
            <span class="n">spec_map</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">spec_magic3_2_magic2_map</span>
            <span class="n">spec_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">spec_map</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># data  model 2</span>
        <span class="n">rmag_anis</span> <span class="o">=</span> <span class="s2">&quot;rmag_anisotropy.txt&quot;</span>
        <span class="n">rmag_res</span> <span class="o">=</span> <span class="s2">&quot;rmag_results.txt&quot;</span>
        <span class="n">rmag_anis</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">rmag_anis</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="n">rmag_res</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">rmag_res</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;magic_measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot;This is not a valid MagIC 2.5 magic_measurements file &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid MagIC 2.5. measurements file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="c1"># fish out relevant data</span>
    <span class="n">meas_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
        <span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-AN-ARM&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coord</span> <span class="o">!=</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>  <span class="c1"># need to read in sample data</span>
        <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">samp_data3</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot;This is not a valid samples file &quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only specimen coordinates will be calculated&quot;</span><span class="p">)</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># translate to 2</span>
                <span class="n">samp_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">samp_map</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">samp_magic3_2_magic2_map</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">samp_data3</span><span class="p">:</span>
                    <span class="n">samp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">samp_map</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">samp_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">samp_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;er_samples&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="s2">&quot;This is not a valid er_samples file &quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only specimen coordinates will be calculated&quot;</span><span class="p">)</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># sort the specimen names</span>
    <span class="c1">#</span>
    <span class="n">ssort</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ssort</span><span class="p">:</span>
            <span class="n">ssort</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ssort</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">sids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ssort</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sids</span> <span class="o">=</span> <span class="n">ssort</span>
    <span class="c1">#</span>
    <span class="c1"># work on each specimen</span>
    <span class="c1">#</span>
    <span class="n">specimen</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">RmagSpecRecs</span><span class="p">,</span> <span class="n">RmagResRecs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SpecRecs</span><span class="p">,</span> <span class="n">SpecRecs3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">specimen</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[</span><span class="n">specimen</span><span class="p">]</span>
        <span class="n">RmagSpecRec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RmagResRec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># get old specrec here if applicable</span>
        <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spec_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">RmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">spec_data</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">RmagSpecRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">spec_data</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">method_codes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#</span>
    <span class="c1"># find the data from the meas_data file for this sample</span>
    <span class="c1">#</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># find out the number of measurements (9, 12 or 15)</span>
    <span class="c1">#</span>
        <span class="n">npos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">npos</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># get dec, inc, int and convert to x,y,z</span>
            <span class="c1">#</span>
            <span class="c1"># B matrix made from design matrix for positions</span>
            <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">tmpH</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">designAARM</span><span class="p">(</span><span class="n">npos</span><span class="p">)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">Dir</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_dec&quot;</span><span class="p">]))</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_inc&quot;</span><span class="p">]))</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_magn_moment&quot;</span><span class="p">]))</span>
                <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Dir</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># subtract baseline and put in a work array</span>
        <span class="c1">#</span>
            <span class="n">work</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npos</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># calculate tensor elements</span>
        <span class="c1"># first put ARM components in w vector</span>
        <span class="c1">#</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">w</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>  <span class="c1"># initialize the s matrix</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)):</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># normalize by the trace</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">trace</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">s2a</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1">#  Calculating dels is different than in the Kappabridge</span>
        <span class="c1">#  routine. Use trace normalized tensor (a) and the applied</span>
        <span class="c1">#  unit field directions (tmpH) to generate model X,Y,Z</span>
        <span class="c1">#  components. Then compare these with the measured values.</span>
        <span class="c1"># ------------------------------------------------------------</span>
            <span class="n">S</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">j</span>
                    <span class="n">compare</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">comp</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">trace</span><span class="p">)</span> <span class="o">-</span> <span class="n">comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># del values</span>
                <span class="n">S</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># number of degrees of freedom</span>
            <span class="k">if</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="n">nf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;er_location_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;er_sample_name&quot;</span> <span class="ow">in</span> <span class="n">RmagSpecRec</span><span class="p">:</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;er_sample_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_experiment_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:AARM&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;rmag_result_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:AARM&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_location_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;er_location_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;er_sample_name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RmagResRec</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_sample_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;er_sample_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_site_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_experiment_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:AARM&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;magic_instrument_codes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AARM&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hext statistics adapted to AARM&quot;</span>
            <span class="k">if</span> <span class="n">coord</span> <span class="o">!=</span> <span class="s1">&#39;-1&#39;</span><span class="p">:</span>  <span class="c1"># need to rotate s</span>
                <span class="c1"># set orientation priorities</span>
                <span class="n">SO_methods</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">samp_data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;magic_method_codes&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">:</span>
                        <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SO-NO&#39;</span>
                    <span class="k">if</span> <span class="s2">&quot;magic_method_codes&quot;</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">:</span>
                        <span class="n">methlist</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">methlist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="s2">&quot;SO&quot;</span> <span class="ow">in</span> <span class="n">meth</span> <span class="ow">and</span> <span class="s2">&quot;SO-POM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SO_methods</span><span class="p">:</span>
                                    <span class="n">SO_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">SO_priorities</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">set_priorities</span><span class="p">(</span><span class="n">SO_methods</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># continue here</span>
                <span class="n">redo</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SO_methods</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">az_type</span> <span class="o">=</span> <span class="n">SO_methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">orient</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_samp_rec</span><span class="p">(</span>
                        <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">],</span> <span class="n">samp_data</span><span class="p">,</span> <span class="n">az_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">orient</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">method_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az_type</span><span class="p">)</span>
                    <span class="n">redo</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">redo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">SO_priorities</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no orientation data for &quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                        <span class="n">orient</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">orient</span><span class="p">[</span><span class="s2">&quot;sample_dip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">method_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SO-NO&quot;</span><span class="p">)</span>
                        <span class="n">redo</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">az_type</span> <span class="o">=</span> <span class="n">SO_methods</span><span class="p">[</span><span class="n">SO_methods</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                            <span class="n">SO_priorities</span><span class="p">[</span><span class="n">p</span><span class="p">])]</span>
                        <span class="n">orient</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_samp_rec</span><span class="p">(</span>
                            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">],</span> <span class="n">samp_data</span><span class="p">,</span> <span class="n">az_type</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">orient</span><span class="p">[</span><span class="s2">&quot;sample_azimuth&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">method_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az_type</span><span class="p">)</span>
                            <span class="n">redo</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">az</span><span class="p">,</span> <span class="n">pl</span> <span class="o">=</span> <span class="n">orient</span><span class="p">[</span><span class="s1">&#39;sample_azimuth&#39;</span><span class="p">],</span> <span class="n">orient</span><span class="p">[</span><span class="s1">&#39;sample_dip&#39;</span><span class="p">]</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dosgeo</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">pl</span><span class="p">)</span>  <span class="c1"># rotate to geographic coordinates</span>
                <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;100&#39;</span><span class="p">:</span>
                    <span class="n">sample_bed_dir</span><span class="p">,</span> <span class="n">sample_bed_dip</span> <span class="o">=</span> <span class="n">orient</span><span class="p">[</span><span class="s1">&#39;sample_bed_dip_direction&#39;</span><span class="p">],</span> <span class="n">orient</span><span class="p">[</span><span class="s1">&#39;sample_bed_dip&#39;</span><span class="p">]</span>
                    <span class="c1"># rotate to geographic coordinates</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dostilt</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sample_bed_dir</span><span class="p">,</span> <span class="n">sample_bed_dip</span><span class="p">)</span>
            <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># prepare for output</span>
        <span class="c1">#</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trace</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Am^2&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npos</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
            <span class="c1"># used by thellier_gui - must be taken out for uploading</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
            <span class="c1"># used by thellier_gui - must be taken out for uploading</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_F_crit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F_crit&quot;</span><span class="p">]</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest23&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F23&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;result_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Critical F: &#39;</span> <span class="o">+</span> \
                <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F_crit&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;;Critical F12/F13: &#39;</span> <span class="o">+</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12_crit&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">]:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">]:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AARM&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN-ARM:AE-H&#39;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN-ARM:AE-H&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_software_packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_software_packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="n">specimen</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">RmagSpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RmagSpecRec</span><span class="p">)</span>
            <span class="n">RmagResRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RmagResRec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">SpecRec</span> <span class="o">=</span> <span class="n">RmagResRec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">SpecRec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">RmagSpecRec</span><span class="p">)</span>
                <span class="n">SpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpecRec</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping specimen &#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                  <span class="s1">&#39; only 9 positions supported&#39;</span><span class="p">,</span> <span class="s1">&#39;; this has &#39;</span><span class="p">,</span> <span class="n">npos</span><span class="p">)</span>
            <span class="n">specimen</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># translate records</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SpecRecs</span><span class="p">:</span>
            <span class="n">rec3</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">convert_aniso</span><span class="p">(</span><span class="s1">&#39;magic3&#39;</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
            <span class="n">SpecRecs3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec3</span><span class="p">)</span>

        <span class="c1"># write output to 3.0 specimens file</span>
        <span class="n">res</span><span class="p">,</span> <span class="n">ofile</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span> <span class="n">SpecRecs3</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen data stored in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Something went wrong and no records were created.  Are you sure your measurement file has the method code &#39;LP-AN-ARM&#39;?&quot;</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">output_spec_file</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rmag_anis</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">rmag_anis</span> <span class="o">=</span> <span class="s2">&quot;rmag_anisotropy.txt&quot;</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">rmag_anis</span><span class="p">,</span> <span class="n">RmagSpecRecs</span><span class="p">,</span> <span class="s1">&#39;rmag_anisotropy&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen tensor elements stored in &quot;</span><span class="p">,</span> <span class="n">rmag_anis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rmag_res</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">rmag_res</span> <span class="o">=</span> <span class="s2">&quot;rmag_results.txt&quot;</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">rmag_res</span><span class="p">,</span> <span class="n">RmagResRecs</span><span class="p">,</span> <span class="s1">&#39;rmag_results&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen statistics and eigenparameters stored in &quot;</span><span class="p">,</span> <span class="n">rmag_res</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rmag_anis</span></div>

<div class="viewcode-block" id="get_matrix"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.get_matrix">[docs]</a><span class="k">def</span> <span class="nf">get_matrix</span><span class="p">(</span><span class="n">n_pos</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns design matrix for anisotropy experiments</span>

<span class="sd">    Parameters:</span>
<span class="sd">        n_pos: anisotropy experiment positions (default is 6, can be 6, 9 or 15)</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix for n_pos of 6,9, or 15</span>

<span class="sd">    Matrices definitions:</span>
<span class="sd">        A design matrix</span>
<span class="sd">        B np.dot(inv(np.dot(A.transpose(),A)),A.transpose())</span>
<span class="sd">        tmpH is used for sigma calculation (9,15 measurements only)</span>
<span class="sd">        </span>
<span class="sd">        Anisotropy tensor:</span>
<span class="sd">        </span>
<span class="sd">        |Mx|   |s1 s4 s6|   |Bx|</span>
<span class="sd">        |My| = |s4 s2 s5| . |By|</span>
<span class="sd">        |Mz|   |s6 s5 s3|   |Bz|</span>
<span class="sd">        </span>
<span class="sd">        A matrix (measurement matrix):</span>
<span class="sd">        Each mesurement yields three lines in &quot;A&quot; matrix</span>
<span class="sd">        </span>
<span class="sd">        |Mi  |   |Bx 0  0   By  0   Bz|   |s1|</span>
<span class="sd">        |Mi+1| = |0  By 0   Bx  Bz  0 | . |s2|</span>
<span class="sd">        |Mi+2|   |0  0  Bz  0   By  Bx|   |s3|</span>
<span class="sd">                                        |s4|</span>
<span class="sd">                                        |s5|</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">15</span><span class="p">]:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;n_pos &#39;</span><span class="p">,</span><span class="n">n_pos</span><span class="p">,</span><span class="s1">&#39; not available&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">Matrices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_pos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_pos</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">n_pos</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">315.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">225.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">135.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">90.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span>
                                                             <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">n_pos</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">315.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">225.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">90.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">270.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">180.</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>

    <span class="n">tmpH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_pos</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>  <span class="c1"># define tmpH</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
            <span class="n">CART</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>

            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>

            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

            <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">CART</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">A</span><span class="p">)),</span> <span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>

    <span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
    <span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span>
    <span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;tmpH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpH</span>
    <span class="k">return</span> <span class="n">Matrices</span></div>

<div class="viewcode-block" id="aarm_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.aarm_magic">[docs]</a><span class="k">def</span> <span class="nf">aarm_magic</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">input_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">output_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts AARM  data to best-fit tensor (6 elements plus sigma)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        meas_file (str): </span>
<span class="sd">            input measurement file</span>
<span class="sd">        dir_path (str): </span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path (str): </span>
<span class="sd">            input file directory IF different from dir_path, default &quot;&quot;</span>
<span class="sd">        input_spec_file (str): </span>
<span class="sd">            input specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">        output_spec_file (str): </span>
<span class="sd">            output specimen file name, default &quot;specimens.txt&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">            True or False indicating if conversion was successful and output file name written</span>

<span class="sd">    Info:</span>
<span class="sd">        Input for is a series of baseline, ARM pairs.</span>
<span class="sd">        The baseline should be the AF demagnetized state (3 axis demag is</span>
<span class="sd">        preferable) for the following ARM acquisition. The order of the</span>
<span class="sd">        measurements is:</span>
<span class="sd">            for 6 positions (AF demag before each step):</span>
<span class="sd">                1) labfield parallel to X</span>
<span class="sd">                2) labfield parallel to Y</span>
<span class="sd">                3) labfield parallel to Z</span>
<span class="sd">                4) labfield anti-parallel to X</span>
<span class="sd">                5) labfield anti-parallel to Y</span>
<span class="sd">                6) labfield anti-parallel to Z</span>
<span class="sd">            for 9 positions (AF demag before each step):</span>
<span class="sd">                positions 1,2,3,6,7,8,11,12,13 (from Figure D.2 in Essentials, earthref.org/MagIC/books/Tauxe/Essentials, Appendix D)</span>
<span class="sd">            for 15  positions (AF demag before each step):</span>
<span class="sd">                positions 1-15 (for 15 positions)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># fix up file names</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">input_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">output_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">aniso_spec_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aniso_alt&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;method_codes&#39;</span><span class="p">,</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span>

    <span class="c1"># read in data</span>
    <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;-E- </span><span class="si">{}</span><span class="s2"> is not a valid measurements file, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">file_type</span><span class="p">))</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;for data model 2.0 please use atrm_magic_dm2&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="n">old_specs</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">old_spec_recs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;specimens&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- </span><span class="si">{}</span><span class="s2"> is not a valid specimens file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">))</span>
            <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">aniso_spec_columns</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;creating new specimens.txt file&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">old_specs</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">old_spec_recs</span><span class="p">)</span>
    <span class="c1"># check format of output specimens table</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aniso_spec_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span><span class="n">old_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">meas_data</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LP-AN-ARM&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- No measurement records found with code LP-AN-ARM&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No measurement records found with code LP-AN-ARM&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># get sorted list of unique specimen names</span>
    <span class="n">sids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="c1">#</span>


    <span class="c1"># work on each specimen</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">:</span>
        <span class="n">meas_df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">]</span>
        <span class="c1"># first determine n_pos</span>
        <span class="n">aarm_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LT-AF-I&#39;</span><span class="p">)]</span>
        <span class="n">n_pos</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">aarm_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_pos</span><span class="o">!=</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">n_pos</span> <span class="o">!=</span> <span class="mi">9</span> <span class="ow">and</span> <span class="n">n_pos</span> <span class="o">!=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;aarm_magic only available for n=6,9,15&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aarm_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LP-AN-ARM&#39;</span><span class="p">)]</span>
            <span class="n">aarm_df</span><span class="p">[</span><span class="s1">&#39;treat_step_num&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aarm_df</span><span class="p">))</span>
            <span class="c1"># subtract baseline</span>
            <span class="n">M</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">aarm_dirs</span><span class="o">=</span><span class="n">aarm_df</span><span class="p">[[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span><span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">M_with_base</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">aarm_dirs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">aarm_df</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_with_base</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">M_with_base</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># subtract baseline</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n_pos</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pos</span><span class="p">):</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">aniso_parameters</span><span class="o">=</span><span class="n">calculate_aniso_parameters</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">n_pos</span><span class="o">=</span><span class="n">n_pos</span><span class="p">)</span>
                <span class="c1">#alt_check_df=meas_df[meas_df[&#39;method_codes&#39;].str.contains(&#39;LT-PTRM-I&#39;)]</span>
                <span class="c1">#if len(alt_check_df)&gt;0:</span>
                <span class="c1">#    anis_alt_phi=alt_check_df[&#39;treat_dc_field_phi&#39;].astype(&#39;float&#39;).values[-1]</span>
                <span class="c1">#    anis_alt_theta=alt_check_df[&#39;treat_dc_field_theta&#39;].astype(&#39;float&#39;).values[-1]</span>
                <span class="c1">#    base1=atrm_df[atrm_df[&#39;treat_dc_field_phi&#39;].astype(&#39;float&#39;)==anis_alt_phi]</span>
                <span class="c1">#    base1=base1[base1[&#39;treat_dc_field_theta&#39;]==anis_alt_theta]</span>
                <span class="c1">#    if len(base1)&gt;0:</span>
                <span class="c1">#        base1_M=base1[[&#39;magn_moment&#39;]].astype(&#39;float&#39;).values[0]</span>
                <span class="c1">#        base2_M=alt_check_df[[&#39;magn_moment&#39;]].astype(&#39;float&#39;).values[0]</span>
                <span class="c1">#        aniso_alt=100*np.abs(base1_M-base2_M)/np.mean([base1_M,base2_M]) # anisotropy alteration percent</span>
                <span class="n">new_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">([</span><span class="n">aniso_parameters</span><span class="p">])</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">spec</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;This study&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;LP-AN-ARM&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;AARM&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;This study&#39;</span>
                <span class="k">if</span> <span class="n">old_specs</span> <span class="ow">and</span> <span class="s1">&#39;aniso_s&#39;</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">)</span><span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;AARM&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">empty</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># there is a previous record of AARM for this specimen</span>
                        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;replacing existing AARM data for &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">]:</span>
                            <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;AARM&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()),</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">new_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># replace existing AARM data for this specimen</span>
                <span class="k">elif</span> <span class="n">old_specs</span> <span class="ow">and</span> <span class="s1">&#39;aniso_s&#39;</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># there is a no previous record of AARM for this specimen</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;adding AARM data for &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">]:</span>
                        <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">new_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># add AARM data for this specimen</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># no record of this specimen, just append to the end of the existing data frame</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;creating new record for specimen &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                    <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">old_spec_df</span><span class="p">,</span><span class="n">new_spec_df</span><span class="p">])</span> <span class="c1"># add in new record</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;something wrong with measurements for: &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">old_spec_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">spec_dicts</span><span class="o">=</span><span class="n">old_spec_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>
    <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span><span class="n">spec_dicts</span><span class="p">,</span><span class="s1">&#39;specimens&#39;</span><span class="p">)</span></div>




<div class="viewcode-block" id="atrm_magic_dm2"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.atrm_magic_dm2">[docs]</a><span class="k">def</span> <span class="nf">atrm_magic_dm2</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">input_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">output_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span>
               <span class="n">data_model_num</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ATRM  data to best-fit tensor (6 elements plus sigma)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    meas_file : str</span>
<span class="sd">        input measurement file</span>
<span class="sd">    dir_path : str</span>
<span class="sd">        output directory, default &quot;.&quot;</span>
<span class="sd">    input_dir_path : str</span>
<span class="sd">        input file directory IF different from dir_path, default &quot;&quot;</span>
<span class="sd">    input_spec_file : str</span>
<span class="sd">        input specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">    output_spec_file : str</span>
<span class="sd">        output specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">    data_model_num : number</span>
<span class="sd">        MagIC data model [2, 3], default 3</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    Tuple : (True or False indicating if conversion was successful, output file name written)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># fix up file names</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">rmag_anis</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;rmag_anisotropy.txt&#39;</span><span class="p">)</span>
    <span class="n">rmag_res</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;rmag_results.txt&#39;</span><span class="p">)</span>
    <span class="n">input_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">output_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>

    <span class="c1"># read in data</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">meas_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meas_data3</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;-E- </span><span class="si">{}</span><span class="s2"> is not a valid measurements file, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">file_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># convert meas_data to 2.5</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data3</span><span class="p">:</span>
            <span class="n">meas_map</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">meas_magic3_2_magic2_map</span>
            <span class="n">meas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">meas_map</span><span class="p">))</span>
        <span class="n">old_spec_recs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;specimens&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- </span><span class="si">{}</span><span class="s2"> is not a valid specimens file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">))</span>
            <span class="n">old_spec_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">spec_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">old_spec_recs</span><span class="p">:</span>
            <span class="n">spec_map</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">spec_magic3_2_magic2_map</span>
            <span class="n">spec_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_magic</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">spec_map</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;magic_measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- </span><span class="si">{}</span><span class="s2"> is is not a valid magic_measurements file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid magic_measurements file, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>

    <span class="n">meas_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
        <span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;magic_method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-AN-TRM&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">meas_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- No measurement records found with code LP-AN-TRM&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No measurement records found with code LP-AN-TRM&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># get sorted list of unique specimen names</span>
    <span class="n">ssort</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ssort</span><span class="p">:</span>
            <span class="n">ssort</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">sids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ssort</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># work on each specimen</span>
    <span class="c1">#</span>
    <span class="n">specimen</span><span class="p">,</span> <span class="n">npos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span>
    <span class="n">RmagSpecRecs</span><span class="p">,</span> <span class="n">RmagResRecs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SpecRecs</span><span class="p">,</span> <span class="n">SpecRecs3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">specimen</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
        <span class="n">nmeas</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[</span><span class="n">specimen</span><span class="p">]</span>
        <span class="n">RmagSpecRec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RmagResRec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># get old specrec here if applicable</span>
        <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spec_recs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">RmagResRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">spec_recs</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">RmagSpecRec</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                        <span class="n">spec_recs</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">BX</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">method_codes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Spec0</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># find the data from the meas_data file for this sample</span>
        <span class="c1"># and get dec, inc, int and convert to x,y,z</span>
        <span class="c1">#</span>
        <span class="c1"># fish out data for this specimen name</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;er_specimen_name&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_location_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;er_location_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;er_sample_name&quot;</span> <span class="ow">in</span> <span class="n">RmagSpecRec</span><span class="p">:</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_sample_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;er_sample_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_experiment_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:ATRM&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;rmag_result_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:ATRM&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_location_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;er_location_names&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_specimen_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;er_specimen_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_sample_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;er_sample_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_site_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;er_site_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_experiment_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;rmag_anisotropy_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;:ATRM&quot;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;er_citation_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ATRM&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;magic_instrument_codes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_instrument_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hext statistics adapted to ATRM&quot;</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">meths</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magic_method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">Dir</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_dec&quot;</span><span class="p">]))</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_inc&quot;</span><span class="p">]))</span>
                <span class="n">Dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;measurement_magn_moment&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s2">&quot;LT-T-Z&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                    <span class="n">BX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Dir</span><span class="p">))</span>  <span class="c1"># append baseline steps</span>
                <span class="k">elif</span> <span class="s2">&quot;LT-T-I&quot;</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">Dir</span><span class="p">))</span>
                    <span class="n">nmeas</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">BX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BX</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># assume first 0 field step as baseline</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># assume baseline is zero</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
                <span class="n">BX</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>  <span class="c1"># assume baseline of 0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>  <span class="c1"># if BX isn&#39;t just one measurement or one in between every infield step, just assume it is zero</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;something odd about the baselines - just assuming zero&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
                <span class="n">BX</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>  <span class="c1"># assume baseline of 0</span>
        <span class="k">if</span> <span class="n">nmeas</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># must have at least 6 measurements right now -</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping specimen &#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39; too few measurements&#39;</span><span class="p">)</span>
            <span class="n">specimen</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># B matrix made from design matrix for positions</span>
            <span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">tmpH</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">designATRM</span><span class="p">(</span><span class="n">npos</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># subtract optional baseline and put in a work array</span>
        <span class="c1">#</span>
            <span class="n">work</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nmeas</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmeas</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="c1"># subtract baseline, if available</span>
                    <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">BX</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># calculate tensor elements</span>
        <span class="c1"># first put ARM components in w vector</span>
        <span class="c1">#</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">w</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>  <span class="c1"># initialize the s matrix</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)):</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># normalize by the trace</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">trace</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">s2a</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1">#  Calculating dels is different than in the Kappabridge</span>
        <span class="c1">#  routine. Use trace normalized tensor (a) and the applied</span>
        <span class="c1">#  unit field directions (tmpH) to generate model X,Y,Z</span>
        <span class="c1">#  components. Then compare these with the measured values.</span>
        <span class="c1"># ------------------------------------------------------------</span>
            <span class="n">S</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">j</span>
                    <span class="n">compare</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">comp</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">trace</span><span class="p">)</span> <span class="o">-</span> <span class="n">comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># del values</span>
                <span class="n">S</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">npos</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">-</span> <span class="mf">6.</span><span class="p">)</span>  <span class="c1"># number of degrees of freedom</span>
            <span class="k">if</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="n">nf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># prepare for output</span>
        <span class="c1">#</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_s6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.3e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trace</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Am^2&quot;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npos</span><span class="p">)</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
            <span class="c1"># used by thellier_gui - must be taken out for uploading</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
            <span class="c1"># used by thellier_gui - must be taken out for uploading</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_F_crit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F_crit&quot;</span><span class="p">]</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_t3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%8.6f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_dec&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v1_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v2_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;v3_inc&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_ftest23&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F23&quot;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;result_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Critical F: &#39;</span> <span class="o">+</span> \
                <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F_crit&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;;Critical F12/F13: &#39;</span> <span class="o">+</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12_crit&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e12&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e13&quot;</span><span class="p">]:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v1_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;e23&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">]:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e12&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v2_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e13&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v3_zeta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v1_inc&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_semi_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;e23&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_dec&#39;</span><span class="p">])</span>
                <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_v2_eta_inc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;v3_inc&#39;</span><span class="p">])</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;anisotropy_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ATRM&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN-TRM:AE-H&#39;</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LP-AN-TRM:AE-H&#39;</span>
            <span class="n">RmagResRec</span><span class="p">[</span><span class="s2">&quot;magic_software_packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="n">RmagSpecRec</span><span class="p">[</span><span class="s2">&quot;magic_software_packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="n">RmagSpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RmagSpecRec</span><span class="p">)</span>
            <span class="n">RmagResRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RmagResRec</span><span class="p">)</span>
            <span class="n">specimen</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">SpecRec</span> <span class="o">=</span> <span class="n">RmagResRec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">SpecRec</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">RmagSpecRec</span><span class="p">)</span>
            <span class="n">SpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpecRec</span><span class="p">)</span>

    <span class="c1"># finished iterating through specimens,</span>
    <span class="c1"># now we need to write out the data to files</span>
    <span class="k">if</span> <span class="n">data_model_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># translate records</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">SpecRecs</span><span class="p">:</span>
            <span class="n">rec3</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">convert_aniso</span><span class="p">(</span><span class="s1">&#39;magic3&#39;</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
            <span class="n">SpecRecs3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec3</span><span class="p">)</span>

        <span class="c1"># write output to 3.0 specimens file</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span> <span class="n">SpecRecs3</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen data stored in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">output_spec_file</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># write output to 2.5 rmag_ files</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">rmag_anis</span><span class="p">,</span> <span class="n">RmagSpecRecs</span><span class="p">,</span> <span class="s1">&#39;rmag_anisotropy&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen tensor elements stored in &quot;</span><span class="p">,</span> <span class="n">rmag_anis</span><span class="p">)</span>
        <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">rmag_res</span><span class="p">,</span> <span class="n">RmagResRecs</span><span class="p">,</span> <span class="s1">&#39;rmag_results&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;specimen statistics and eigenparameters stored in &quot;</span><span class="p">,</span> <span class="n">rmag_res</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rmag_anis</span></div>

<div class="viewcode-block" id="calculate_aniso_parameters"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.calculate_aniso_parameters">[docs]</a><span class="k">def</span> <span class="nf">calculate_aniso_parameters</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">n_pos</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculate anisotropy parameters from n_pos positions plus optional baseline measurements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aniso_parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">Matrices</span><span class="o">=</span><span class="n">get_matrix</span><span class="p">(</span><span class="n">n_pos</span><span class="p">)</span>
    <span class="n">tmpH</span><span class="o">=</span><span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;tmpH&#39;</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">S_bs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>

    <span class="c1"># normalize by trace</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">S_bs</span> <span class="o">=</span> <span class="n">S_bs</span> <span class="o">/</span> <span class="n">trace</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s6</span> <span class="o">=</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">S_bs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">s_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s6</span><span class="p">],</span> <span class="p">[</span><span class="n">s4</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s5</span><span class="p">],</span> <span class="p">[</span><span class="n">s6</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s3</span><span class="p">]]</span>
    <span class="n">s_vec</span><span class="o">=</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">,</span><span class="n">s4</span><span class="p">,</span><span class="n">s5</span><span class="p">,</span><span class="n">s6</span><span class="p">]</span>
    <span class="c1"># calculate eigen vector,</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">evectors</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">s_matrix</span><span class="p">)</span>
    <span class="c1"># sort vectors</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">ix_1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">ix_3</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">!=</span> <span class="n">t1</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">!=</span> <span class="n">t3</span><span class="p">:</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span>
            <span class="n">ix_2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="p">[</span><span class="n">evectors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix_1</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ix_1</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ix_1</span><span class="p">]]</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="p">[</span><span class="n">evectors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix_2</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ix_2</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ix_2</span><span class="p">]]</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="p">[</span><span class="n">evectors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix_3</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ix_3</span><span class="p">],</span> <span class="n">evectors</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ix_3</span><span class="p">]]</span>

    <span class="n">DIR_v1</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">DIR_v2</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="n">DIR_v3</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">cart2dir</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
    <span class="c1"># package up the aniso_s and aniso_tau and aniso_v here:  START HERE</span>
    <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">s1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span> <span class="n">s2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">s3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span>\
                              <span class="n">s4</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span> <span class="n">s5</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span> <span class="n">s6</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
    <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t1</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t2</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t3</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">DIR_v3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t1</span> <span class="o">/</span> <span class="n">t3</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
        <span class="n">n_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="n">tmpH</span> <span class="o">=</span> <span class="n">Matrices</span><span class="p">[</span><span class="s1">&#39;tmpH&#39;</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">s_matrix</span>
        <span class="n">S</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">n_pos</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_pos</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">compare</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpH</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">comp</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_pos</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">trace</span> <span class="o">-</span> <span class="n">comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># del values</span>
            <span class="n">S</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_pos</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># number of degrees of freedom</span>
        <span class="k">if</span> <span class="n">S</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S</span> <span class="o">/</span> <span class="n">nf</span><span class="p">)</span>
        <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dohext</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s6</span><span class="p">])</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F12&quot;</span><span class="p">]</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F23&quot;</span><span class="p">]</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Critical F: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;F_crit&#39;</span><span class="p">])</span>
        <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;F_crit&#39;</span><span class="p">]):</span> <span class="c1"># significant anisotropy</span>
            <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aniso_parameters</span><span class="p">[</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
    <span class="k">return</span> <span class="n">aniso_parameters</span></div>


<div class="viewcode-block" id="atrm_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.atrm_magic">[docs]</a><span class="k">def</span> <span class="nf">atrm_magic</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">input_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">output_spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ATRM  data to best-fit tensor (6 elements plus sigma)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        meas_file (str): </span>
<span class="sd">            input measurement file</span>
<span class="sd">        dir_path (str): </span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path (str): </span>
<span class="sd">            input file directory IF different from dir_path, default &quot;&quot;</span>
<span class="sd">        input_spec_file (str): </span>
<span class="sd">            input specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">        output_spec_file (str): </span>
<span class="sd">            output specimen file name, default &quot;specimens.txt&quot;</span>


<span class="sd">    Returns:</span>
<span class="sd">        Tuple : (True or False indicating if conversion was successful, output file name written)</span>

<span class="sd">    Info:</span>
<span class="sd">        Input for is a series of ATRM measurements with optional alteration check</span>
<span class="sd">        The order of the measurements is:</span>

<span class="sd">           positions:</span>
<span class="sd">               - labfield parallel to X</span>
<span class="sd">               - labfield parallel to Y</span>
<span class="sd">               - labfield parallel to Z</span>
<span class="sd">               - labfield anti-parallel to X</span>
<span class="sd">               - labfield anti-parallel to Y</span>
<span class="sd">               - labfield anti-parallel to Z</span>
<span class="sd">               - optional: labfield parallel to X</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># fix up file names</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">input_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">output_spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">aniso_spec_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aniso_alt&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;method_codes&#39;</span><span class="p">,</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span>

    <span class="c1"># read in data</span>
    <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;-E- </span><span class="si">{}</span><span class="s2"> is not a valid measurements file, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">file_type</span><span class="p">))</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;for data model 2.0 please use atrm_magic_dm2&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="n">old_specs</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">old_spec_recs</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;specimens&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- </span><span class="si">{}</span><span class="s2"> is not a valid specimens file &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_spec_file</span><span class="p">))</span>
            <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">aniso_spec_columns</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;creating new specimens.txt file&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">old_specs</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">old_spec_recs</span><span class="p">)</span>
    <span class="c1"># check format of output specimens table</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aniso_spec_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span><span class="n">old_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">meas_data</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LP-AN-TRM&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- No measurement records found with code LP-AN-TRM&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No measurement records found with code LP-AN-TRM&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># get sorted list of unique specimen names</span>
    <span class="n">sids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="c1"># reorder measurements</span>


    <span class="n">n_pos</span><span class="o">=</span><span class="mi">6</span>


    <span class="c1"># work on each specimen</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">:</span>
        <span class="n">meas_df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">]</span>
        <span class="n">atrm_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LT-T-I&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atrm_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">atrm_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LT-T-I&#39;</span><span class="p">)]</span>
            <span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;original_order&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atrm_df</span><span class="p">))</span>
            <span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">3</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">270</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">4</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">90</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">5</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">atrm_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)):</span>
                <span class="n">atrm_dirs</span><span class="o">=</span><span class="n">atrm_df</span><span class="p">[[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span><span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="n">M</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">dir2cart</span><span class="p">(</span><span class="n">atrm_dirs</span><span class="p">)</span>
                <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n_pos</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pos</span><span class="p">):</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">aniso_parameters</span><span class="o">=</span><span class="n">calculate_aniso_parameters</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">n_pos</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">aniso_alt</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">alt_check_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LT-PTRM-I&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alt_check_df</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">anis_alt_phi</span><span class="o">=</span><span class="n">alt_check_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">anis_alt_theta</span><span class="o">=</span><span class="n">alt_check_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">base1</span><span class="o">=</span><span class="n">atrm_df</span><span class="p">[</span><span class="n">atrm_df</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">==</span><span class="n">anis_alt_phi</span><span class="p">]</span>
                    <span class="n">base1</span><span class="o">=</span><span class="n">base1</span><span class="p">[</span><span class="n">base1</span><span class="p">[</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">anis_alt_theta</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">base1_M</span><span class="o">=</span><span class="n">base1</span><span class="p">[[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">base2_M</span><span class="o">=</span><span class="n">alt_check_df</span><span class="p">[[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">aniso_alt</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">base1_M</span><span class="o">-</span><span class="n">base2_M</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">base1_M</span><span class="p">,</span><span class="n">base2_M</span><span class="p">])</span> <span class="c1"># anisotropy alteration percent</span>
                <span class="n">new_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">([</span><span class="n">aniso_parameters</span><span class="p">])</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">spec</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;This study&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;LP-AN-TRM&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_alt&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%5.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">aniso_alt</span><span class="p">)</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;citations&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;This study&#39;</span>
                <span class="n">new_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;ATRM&#39;</span>
                <span class="k">if</span> <span class="n">old_specs</span> <span class="ow">and</span> <span class="s1">&#39;aniso_s&#39;</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">)</span><span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ATRM&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">empty</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># there is a previous record of ATRM for this specimen</span>
                        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;replacing existing ATRM data for &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aniso_alt&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;method_codes&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">]:</span>
                            <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ATRM&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">old_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()),</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">new_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># replace existing ATRM data for this specimen</span>
                <span class="k">elif</span> <span class="n">old_specs</span> <span class="ow">and</span> <span class="s1">&#39;aniso_s&#39;</span> <span class="ow">in</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># there is a no previous record of ATRM for this specimen</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;adding ATRM data for &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aniso_alt&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest12&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest23&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_p&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_n_measurements&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_s_sigma&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_type&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v1&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v2&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_v3&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_ftest_quality&#39;</span><span class="p">,</span><span class="s1">&#39;aniso_tilt_correction&#39;</span><span class="p">,</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;method_codes&#39;</span><span class="p">,</span><span class="s1">&#39;software_packages&#39;</span><span class="p">,</span><span class="s1">&#39;citations&#39;</span><span class="p">]:</span>
                        <span class="n">old_spec_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">old_spec_df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">spec</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">new_spec_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># add ATRM data for this specimen</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># no record of this specimen, just append to the end of the existing data frame</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;creating new record for specimen &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
                    <span class="n">old_spec_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">old_spec_df</span><span class="p">,</span><span class="n">new_spec_df</span><span class="p">])</span> <span class="c1"># add in new record</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;something wrong with measurements for: &#39;</span><span class="p">,</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">old_spec_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">spec_dicts</span><span class="o">=</span><span class="n">old_spec_df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>
    <span class="n">pmag</span><span class="o">.</span><span class="n">magic_write</span><span class="p">(</span><span class="n">output_spec_file</span><span class="p">,</span><span class="n">spec_dicts</span><span class="p">,</span><span class="s1">&#39;specimens&#39;</span><span class="p">)</span></div>







<div class="viewcode-block" id="zeq_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.zeq_magic">[docs]</a><span class="k">def</span> <span class="nf">zeq_magic</span><span class="p">(</span><span class="n">meas_file</span><span class="o">=</span><span class="s1">&#39;measurements.txt&#39;</span><span class="p">,</span> <span class="n">spec_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">crd</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">n_plots</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">specimen</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="n">samp_file</span><span class="o">=</span><span class="s1">&#39;samples.txt&#39;</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    eeq_magic makes zijderveld and equal area plots for magic formatted measurements files.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    meas_file : str</span>
<span class="sd">        input measurement file</span>
<span class="sd">    spec_file : str</span>
<span class="sd">        input specimen interpretation file</span>
<span class="sd">    samp_file : str</span>
<span class="sd">        input sample orientations file</span>
<span class="sd">    crd : str</span>
<span class="sd">        coordinate system [s,g,t] for specimen, geographic, tilt corrected</span>
<span class="sd">        g,t options require a sample file with specimen and bedding orientation</span>
<span class="sd">    input_dir_path : str</span>
<span class="sd">        input directory of meas_file, default &quot;.&quot;</span>
<span class="sd">    angle : float</span>
<span class="sd">        angle of X direction with respect to specimen X</span>
<span class="sd">    n_plots : int, default 5</span>
<span class="sd">        maximum number of plots to make</span>
<span class="sd">        if you want to make all possible plots, specify &quot;all&quot;</span>
<span class="sd">    save_plots : bool, default True</span>
<span class="sd">        if True, create and save all requested plots</span>
<span class="sd">    fmt : str, default &quot;svg&quot;</span>
<span class="sd">        format for figures, [svg, jpg, pdf, png]</span>
<span class="sd">    interactive : bool, default False</span>
<span class="sd">        interactively plot and display for each specimen</span>
<span class="sd">        (this is best used on the command line only)</span>
<span class="sd">    specimen : str, default &quot;&quot;</span>
<span class="sd">        specimen name to plot</span>
<span class="sd">    samp_file : str, default &#39;samples.txt&#39;</span>
<span class="sd">        name of samples file</span>
<span class="sd">    contribution : cb.Contribution, default None</span>
<span class="sd">        if provided, use Contribution object instead of reading in</span>
<span class="sd">        data from files</span>
<span class="sd">    fignum : matplotlib figure number</span>
<span class="sd">    image_records : generate and return a record for each image in a list of dicts</span>
<span class="sd">        which can be ingested by pmag.magic_write</span>
<span class="sd">        bool, default False</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    if image_records == False:</span>
<span class="sd">        Tuple : (True or False indicating if conversion was successful, output file name written)</span>
<span class="sd">    if image_records == True:</span>
<span class="sd">       Tuple : (True or False indicating if conversion was successful, output file name written, list of image recs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">plot_interpretations</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">spec_container</span><span class="p">,</span> <span class="n">this_specimen</span><span class="p">,</span> <span class="n">this_specimen_measurements</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
        <span class="n">interpretations</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="n">spec_container</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cb</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="n">this_specimen_measurements</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cb</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="n">datablock</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ZED</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;method_codes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ZED</span><span class="p">,</span> <span class="kc">False</span>
        <span class="n">prior_spec_data</span> <span class="o">=</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">get_records_for_code</span><span class="p">(</span>
            <span class="s1">&#39;LP-DIR&#39;</span><span class="p">,</span> <span class="n">strict_match</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># look up all prior directional interpretations</span>
        <span class="k">if</span> <span class="s1">&#39;dir_tilt_correction&#39;</span> <span class="ow">in</span> <span class="n">prior_spec_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">prior_spec_data</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">coord</span>
            <span class="n">cond2</span> <span class="o">=</span> <span class="n">prior_spec_data</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="n">prior_spec_data</span> <span class="o">=</span> <span class="n">prior_spec_data</span><span class="p">[</span><span class="n">cond</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">]</span>
        <span class="n">prior_specimen_interpretations</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;meas_step_min&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prior_spec_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">or</span> \
          <span class="p">(</span><span class="s1">&#39;meas_step_max&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prior_spec_data</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ZED</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_spec_data</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ZED</span><span class="p">,</span> <span class="kc">False</span>
        <span class="n">mpars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;specimen_direction_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Error&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_spec_data</span><span class="p">):</span>
            <span class="n">prior_specimen_interpretations</span> <span class="o">=</span> <span class="n">prior_spec_data</span><span class="p">[</span><span class="n">prior_spec_data</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="n">this_specimen</span><span class="p">]</span>  <span class="c1">#.str.match(this_specimen) == True]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_specimen_interpretations</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_specimen_interpretations</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">beg_pcas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
                    <span class="n">prior_specimen_interpretations</span><span class="o">.</span><span class="n">meas_step_min</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">end_pcas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
                    <span class="n">prior_specimen_interpretations</span><span class="o">.</span><span class="n">meas_step_max</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">spec_methods</span> <span class="o">=</span> <span class="n">prior_specimen_interpretations</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c1"># step through all prior interpretations and plot them</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beg_pcas</span><span class="p">)):</span>
                    <span class="n">interpretations</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">spec_meths</span> <span class="o">=</span> <span class="n">spec_methods</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">spec_meths</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;DE-BFL&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">calculation_type</span> <span class="o">=</span> <span class="s1">&#39;DE-BFL&#39;</span>  <span class="c1"># best fit line</span>
                        <span class="k">if</span> <span class="s1">&#39;DE-BFP&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">calculation_type</span> <span class="o">=</span> <span class="s1">&#39;DE-BFP&#39;</span>  <span class="c1"># best fit plane</span>
                        <span class="k">if</span> <span class="s1">&#39;DE-FM&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">calculation_type</span> <span class="o">=</span> <span class="s1">&#39;DE-FM&#39;</span>  <span class="c1"># fisher mean</span>
                        <span class="k">if</span> <span class="s1">&#39;DE-BFL-A&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">calculation_type</span> <span class="o">=</span> <span class="s1">&#39;DE-BFL-A&#39;</span>  <span class="c1"># anchored best fit line</span>

                    <span class="n">treatments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">this_specimen_measurements</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">beg_pcas</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># getting the starting and ending points</span>
                            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">beg_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">treatments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">end_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                            <span class="n">mpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">domean</span><span class="p">(</span>
                                <span class="n">datablock</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                            <span class="n">mpars</span><span class="p">[</span><span class="s1">&#39;specimen_direction_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Error&quot;</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">beg_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">start</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">beg_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">end_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">end</span> <span class="o">=</span> <span class="n">treatments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">end_pcas</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                                <span class="n">mpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">domean</span><span class="p">(</span>
                                    <span class="n">datablock</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">calculation_type</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="n">mpars</span><span class="p">[</span><span class="s1">&#39;specimen_direction_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Error&quot;</span>
                    <span class="c1"># calculate direction/plane</span>
                        <span class="k">if</span> <span class="n">mpars</span><span class="p">[</span><span class="s2">&quot;specimen_direction_type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Error&quot;</span><span class="p">:</span>
                            <span class="c1"># put it on the plot</span>
                            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">mpars</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                            <span class="n">interpretations</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="c1">#if interactive:</span>
                            <span class="c1">#    pmagplotlib.draw_figs(ZED)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-W- Specimen </span><span class="si">{}</span><span class="s1"> record contains invalid start/stop bounds:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_specimen</span><span class="p">))</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">prior_spec_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">this_specimen</span><span class="p">][[</span><span class="s1">&#39;meas_step_min&#39;</span><span class="p">,</span> <span class="s1">&#39;meas_step_max&#39;</span><span class="p">]])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    Measurement records:&#39;</span><span class="p">)</span>
                            <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_temp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">this_specimen_measurements</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">this_specimen_measurements</span><span class="p">[</span><span class="n">cols</span><span class="p">])</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    Data will be plotted without interpretations</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                            <span class="n">interpretations</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ZED</span><span class="p">,</span> <span class="n">interpretations</span>


    <span class="k">def</span> <span class="nf">make_plots</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">meas_df</span><span class="p">,</span> <span class="n">spec_container</span><span class="p">,</span> <span class="n">samp_container</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># get sample data for orientation</span>
        <span class="k">if</span> <span class="n">spec_container</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">samps</span> <span class="o">=</span> <span class="n">spec_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">spec</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">samps</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">samp_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samps</span><span class="p">):</span>
                    <span class="n">samp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">samp_df</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">samp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">samps</span><span class="p">)</span>
                    <span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                    <span class="n">samp_df</span> <span class="o">=</span> <span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">samp</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
                <span class="n">samp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">samp_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">samps</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samps</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">samp</span> <span class="o">=</span> <span class="n">samps</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">samp</span> <span class="o">=</span> <span class="n">samps</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">samp_df</span> <span class="o">=</span> <span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">samp_container</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">samp</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">samp_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">samp_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># we can make the figure dictionary that pmagplotlib likes:</span>
        <span class="n">ZED</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eqarea&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;zijd&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;demag&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">2</span><span class="p">}</span>  <span class="c1"># make datablock</span>
        <span class="c1"># get the relevant data</span>
        <span class="n">spec_df</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="o">.</span><span class="n">specimen</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span>
        <span class="c1"># remove ARM data</span>
        <span class="n">spec_df</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="o">-</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
            <span class="s1">&#39;LP-*[\w]*-ARM&#39;</span><span class="p">)]</span>
        <span class="c1"># split data into NRM, thermal, and af dataframes</span>
        <span class="n">spec_df_nrm</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="n">spec_df</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
            <span class="s1">&#39;LT-NO&#39;</span><span class="p">)]</span>  <span class="c1"># get the NRM data</span>
        <span class="n">spec_df_th</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="n">spec_df</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
            <span class="s1">&#39;LT-T-Z&#39;</span><span class="p">)]</span>  <span class="c1"># zero field thermal demag steps</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;(^|[\s\:])LT-PTRM&#39;</span><span class="p">)</span>
            <span class="n">spec_df_th</span> <span class="o">=</span> <span class="n">spec_df_th</span><span class="p">[</span><span class="o">-</span><span class="n">cond</span><span class="p">]</span>  <span class="c1"># get rid of some pTRM steps</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">keep_inds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">spec_df_th</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;LT-PTRM&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;ALT-PTRM&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]:</span>
                    <span class="n">keep_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_inds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">spec_df_th</span> <span class="o">=</span> <span class="n">spec_df_th</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">keep_inds</span><span class="p">]</span>
        <span class="n">spec_df_af</span> <span class="o">=</span> <span class="n">spec_df</span><span class="p">[</span><span class="n">spec_df</span><span class="o">.</span><span class="n">method_codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LT-AF-Z&#39;</span><span class="p">)]</span>
        <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">datablock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df_th</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df_af</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df_th</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># this is a thermal run</span>
            <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">spec_df_nrm</span><span class="p">,</span> <span class="n">spec_df_th</span><span class="p">])</span>
            <span class="c1"># make sure all decs/incs are filled in</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">)</span>
            <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_moment&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Some dec/inc/moment data were missing for specimen </span><span class="si">{}</span><span class="s1">, so </span><span class="si">{}</span><span class="s1"> measurement row(s) were excluded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">)))</span>
            <span class="c1"># geographic transformation</span>
            <span class="k">if</span> <span class="n">coord</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">samp_df</span><span class="p">):</span>
                <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">transform_to_geographic</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">,</span> <span class="n">samp_df</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>  <span class="c1"># units are kelvin</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- There are malformed or missing data for specimen </span><span class="si">{}</span><span class="s1">, skipping&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">datablock</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span> <span class="s1">&#39;quality&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">ZED</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_zed</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df_af</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># this is an af run</span>
            <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">spec_df_nrm</span><span class="p">,</span> <span class="n">spec_df_af</span><span class="p">])</span>
            <span class="c1"># make sure all decs/incs are filled in</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">)</span>
            <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_moment&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Some dec/inc/moment data were missing for specimen </span><span class="si">{}</span><span class="s1">, so </span><span class="si">{}</span><span class="s1"> measurement row(s) were excluded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n_rows</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">)))</span>
            <span class="c1"># geographic transformation</span>
            <span class="k">if</span> <span class="n">coord</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">samp_df</span><span class="p">):</span>
                <span class="n">this_spec_meas_df</span> <span class="o">=</span> <span class="n">transform_to_geographic</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">,</span> <span class="n">samp_df</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>  <span class="c1"># these are AF data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- There are malformed or missing data for specimen </span><span class="si">{}</span><span class="s1">, skipping&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
            <span class="n">datablock</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span> <span class="s1">&#39;quality&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">ZED</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_zed</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot_interpretations</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">spec_container</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">this_spec_meas_df</span><span class="p">,</span> <span class="n">datablock</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>

    <span class="c1"># beginning of zeq_magic</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># read in MagIC formatted data if contribution object not provided</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">):</span>
        <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="c1"># read in magic formatted data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No such file:&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">custom_filenames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">:</span> <span class="n">spec_file</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">}</span>
        <span class="n">contribution</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">custom_filenames</span><span class="o">=</span><span class="n">custom_filenames</span><span class="p">,</span>
                                       <span class="n">read_tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">,</span> <span class="s1">&#39;specimens&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;contribution&#39;</span><span class="p">,</span> <span class="s1">&#39;samples&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_samples</span><span class="p">()</span>
            <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
            <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">meas_container</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
    <span class="n">meas_df</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="c1">#</span>
    <span class="c1">#meas_df=pd.read_csv(file_path, sep=&#39;\t&#39;, header=1)</span>
    <span class="n">spec_container</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">samp_container</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1">#if not spec_file:</span>
    <span class="c1">#    spec_file = os.path.join(os.path.split(file_path)[0], &quot;specimens.txt&quot;)</span>
    <span class="c1">#if os.path.exists(spec_file):</span>
    <span class="c1">#    spec_container = cb.MagicDataFrame(spec_file, dtype=&quot;specimens&quot;)</span>
    <span class="c1">#else:</span>
    <span class="c1">#    spec_container = None</span>
    <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;blank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># this is a dummy variable expected by plotZED</span>
    <span class="k">if</span> <span class="s1">&#39;treat_ac_field&#39;</span> <span class="ow">in</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># create &#39;treatment&#39; column.</span>
        <span class="c1"># uses treat_temp if treat_ac_field is missing OR zero.</span>
        <span class="c1"># (have to take this into account for plotting later)</span>
        <span class="k">if</span> <span class="s1">&#39;treat_temp&#39;</span> <span class="ow">in</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">cond</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="n">other</span><span class="o">=</span><span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treat_ac_field&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treatment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">crd</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>
    <span class="k">elif</span> <span class="n">crd</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;100&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

    <span class="n">specimens</span> <span class="o">=</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># list of specimen names</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;there are no data for plotting&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="c1"># check measurement table for req&#39;d fields</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reqd_cols_present</span> <span class="o">=</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">([</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_moment&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_moment&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reqd_cols_present</span><span class="p">:</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Missing required column(s) </span><span class="si">{}</span><span class="s1">, cannot run zeq_magic&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">cnt</span> <span class="o">=</span> <span class="n">fignum</span>
    <span class="k">if</span> <span class="n">n_plots</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_plots</span><span class="p">:</span>
            <span class="n">specimens</span> <span class="o">=</span> <span class="n">specimens</span><span class="p">[:</span><span class="n">n_plots</span><span class="p">]</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">specimen</span><span class="p">:</span>
        <span class="n">specimens</span> <span class="o">=</span> <span class="p">[</span><span class="n">specimen</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">specimens</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">ZED</span><span class="p">,</span> <span class="n">interpretations</span> <span class="o">=</span> <span class="n">make_plots</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">meas_df</span><span class="p">,</span> <span class="n">spec_container</span><span class="p">,</span> <span class="n">samp_container</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ZED</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No plots could be created for specimen:&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fmt</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ZED</span><span class="p">}</span>
        <span class="c1"># try to get the full hierarchy for plot names</span>
        <span class="n">df_slice</span> <span class="o">=</span> <span class="n">meas_container</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">meas_container</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">meas_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="p">))</span>
        <span class="n">site</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">meas_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="p">))</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">meas_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Equal Area Plot&#39;</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;zijd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Zijderveld Plot&#39;</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Demagnetization Plot&#39;</span>
            <span class="n">con_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;contribution&#39;</span> <span class="ow">in</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">con_id</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
                <span class="n">int_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">interpretations</span> <span class="ow">and</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;eqarea&quot;</span><span class="p">:</span>
                    <span class="n">int_str</span> <span class="o">=</span> <span class="s2">&quot;_interpretations&quot;</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span><span class="o">+</span><span class="n">location</span><span class="o">+</span><span class="s1">&#39;_SI:_&#39;</span><span class="o">+</span><span class="n">site</span><span class="o">+</span><span class="s1">&#39;_SA:_&#39;</span><span class="o">+</span><span class="n">sample</span> <span class="o">+</span> \
                    <span class="s1">&#39;_SP:_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_CO:_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_TY:_&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="n">int_str</span><span class="o">+</span><span class="s1">&#39;_.png&#39;</span>
                <span class="n">titles</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">titles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span>
                              <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">title</span><span class="p">],</span>
                              <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">title</span><span class="p">]]),</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                              <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">titles</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">ZED</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_or_quit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">ZED</span><span class="p">,</span> <span class="n">titles</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>

<div class="viewcode-block" id="transform_to_geographic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.transform_to_geographic">[docs]</a><span class="k">def</span> <span class="nf">transform_to_geographic</span><span class="p">(</span><span class="n">this_spec_meas_df</span><span class="p">,</span> <span class="n">samp_df</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform decs/incs to geographic coordinates.</span>
<span class="sd">    Calls pmag.dogeo_V for the heavy lifting</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    this_spec_meas_df : pandas dataframe of measurements for a single specimen</span>
<span class="sd">    samp_df : pandas dataframe of samples</span>
<span class="sd">    samp : samp name</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    this_spec_meas_df : measurements dataframe with transformed coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we could return the type of coordinates ACTUALLY used</span>
    <span class="c1"># transform geographic</span>
    <span class="n">decs</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">incs</span> <span class="o">=</span> <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;dir_inc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">or_info</span><span class="p">,</span> <span class="n">az_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_orient</span><span class="p">(</span><span class="n">samp_df</span><span class="p">,</span><span class="n">samp</span><span class="p">,</span><span class="n">data_model</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;azimuth&#39;</span> <span class="ow">in</span> <span class="n">or_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">cb</span><span class="o">.</span><span class="n">not_null</span><span class="p">(</span><span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">azimuths</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">]]</span>
        <span class="n">dips</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;dip&#39;</span><span class="p">]]</span>
    <span class="c1"># if azimuth/dip is missing, or orientation is bad,</span>
    <span class="c1"># stick with specimen coordinates</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">this_spec_meas_df</span>
    <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">,</span> <span class="n">azimuths</span><span class="p">,</span> <span class="n">dips</span><span class="p">]</span>
    <span class="n">dirs_geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">dirs</span><span class="p">)))))</span>
    <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dogeo_V</span><span class="p">(</span><span class="n">dirs_geo</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;100&#39;</span> <span class="ow">and</span> <span class="s1">&#39;bed_dip_direction&#39;</span> <span class="ow">in</span> <span class="n">or_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;bed_dip_direction&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># need to do tilt correction too</span>
        <span class="n">bed_dip_dirs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;bed_dip_direction&#39;</span><span class="p">]]</span>
        <span class="n">bed_dips</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">decs</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">or_info</span><span class="p">[</span><span class="s1">&#39;bed_dip&#39;</span><span class="p">]]</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">decs</span><span class="p">,</span> <span class="n">incs</span><span class="p">,</span> <span class="n">bed_dip_dirs</span><span class="p">,</span> <span class="n">bed_dips</span><span class="p">]</span>
        <span class="c1">## this transposes the columns and rows of the list of lists</span>
        <span class="n">dirs_tilt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">dirs</span><span class="p">)))))</span>
        <span class="n">decs</span><span class="p">,</span> <span class="n">incs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dotilt_V</span><span class="p">(</span><span class="n">dirs_tilt</span><span class="p">)</span>
    <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">decs</span>
    <span class="n">this_spec_meas_df</span><span class="p">[</span><span class="s1">&#39;dir_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incs</span>
    <span class="k">return</span> <span class="n">this_spec_meas_df</span></div>


<div class="viewcode-block" id="thellier_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.thellier_magic">[docs]</a><span class="k">def</span> <span class="nf">thellier_magic</span><span class="p">(</span><span class="n">meas_file</span><span class="o">=</span><span class="s2">&quot;measurements.txt&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                   <span class="n">spec</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n_specs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    thellier_magic plots arai and other useful plots for Thellier-type experimental data</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    meas_file : str</span>
<span class="sd">        input measurement file, default &quot;measurements.txt&quot;</span>
<span class="sd">    dir_path : str</span>
<span class="sd">        output directory, default &quot;.&quot;</span>
<span class="sd">        Note: if using Windows, all figures will be saved to working directly</span>
<span class="sd">              *not* dir_path</span>
<span class="sd">    input_dir_path : str</span>
<span class="sd">        input file directory IF different from dir_path, default &quot;&quot;</span>
<span class="sd">    spec : str</span>
<span class="sd">        default &quot;&quot;, specimen to plot</span>
<span class="sd">    n_specs : int</span>
<span class="sd">        number of specimens to plot, default 5</span>
<span class="sd">        if you want to make all possible plots, specify &quot;all&quot;</span>
<span class="sd">    save_plots : bool, default True</span>
<span class="sd">         True, create and save all requested plots</span>
<span class="sd">    fmt : str</span>
<span class="sd">        format of saved figures (default is &#39;svg&#39;)</span>
<span class="sd">    interactive : bool, default False</span>
<span class="sd">        interactively plot and display for each specimen</span>
<span class="sd">        (this is best used on the command line only)</span>
<span class="sd">    contribution : cb.Contribution, default None</span>
<span class="sd">        if provided, use Contribution object instead of reading in</span>
<span class="sd">        data from files</span>
<span class="sd">    image_records : generate and return a record for each image in a list of dicts</span>
<span class="sd">        which can be ingested by pmag.magic_write</span>
<span class="sd">        bool, default False</span>


<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    status : True or False</span>
<span class="sd">    saved : list of figures saved</span>
<span class="sd">    if image_records == True:</span>
<span class="sd">        image_recs : list of image records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">make_plots</span><span class="p">(</span><span class="n">this_specimen</span><span class="p">,</span> <span class="n">thel_data</span><span class="p">,</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take specimen name and measurement data</span>
<span class="sd">        and produce plots.</span>
<span class="sd">        Return a dictionary of plots created, or False if</span>
<span class="sd">        no plots could be created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">this_specimen</span><span class="p">)</span>
        <span class="c1"># make the figure dictionary that pmagplotlib likes:</span>
        <span class="c1">#AZD = {&#39;arai&#39;: 1, &#39;zijd&#39;: 2, &#39;eqarea&#39;: 3, &#39;deremag&#39;: 4}  # make datablock</span>
        <span class="c1">#if save_plots:</span>
        <span class="c1">#    AZD = {&#39;arai&#39;: 1, &#39;zijd&#39;: 2, &#39;eqarea&#39;: 3, &#39;deremag&#39;: 4}  # make datablock</span>
        <span class="c1">#else:</span>
        <span class="n">AZD</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;arai&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="p">,</span> <span class="s1">&#39;zijd&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;eqarea&#39;</span><span class="p">:</span> <span class="n">cnt</span> <span class="o">+</span>
                <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;deremag&#39;</span><span class="p">:</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">3</span><span class="p">}</span>  <span class="c1"># make datablock</span>
        <span class="c1">#cnt += 4  # increment the figure counter</span>
        <span class="n">spec_df</span> <span class="o">=</span> <span class="n">thel_data</span><span class="p">[</span><span class="n">thel_data</span><span class="o">.</span><span class="n">specimen</span> <span class="o">==</span>
                            <span class="n">this_specimen</span><span class="p">]</span>  <span class="c1"># get data for this specimen</span>
        <span class="c1"># get the data block for Arai plot</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># just skip specimen if arai data is malformed</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">araiblock</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">sortarai</span><span class="p">(</span><span class="n">spec_df</span><span class="p">,</span> <span class="n">this_specimen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W-&#39;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">zed</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">AZD</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># get the datablock for Zijderveld plot</span>
            <span class="n">zijdblock</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">find_dmag_rec</span><span class="p">(</span>
                <span class="n">this_specimen</span><span class="p">,</span> <span class="n">spec_df</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">):</span>
                <span class="n">unit_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_string</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">zed</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_arai_zij</span><span class="p">(</span>
                <span class="n">AZD</span><span class="p">,</span> <span class="n">araiblock</span><span class="p">,</span> <span class="n">zijdblock</span><span class="p">,</span> <span class="n">this_specimen</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)</span>  <span class="c1"># make the plots</span>
        <span class="k">return</span> <span class="n">zed</span>

    <span class="c1"># format some things</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">):</span>
        <span class="c1"># get proper paths</span>
        <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
        <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># read in magic formatted data</span>
        <span class="n">contribution</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;measurements&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- No measurements table found&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_samples</span><span class="p">()</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">meas_df</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
    <span class="c1"># try to get contribution id for server plotting</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="n">con_id</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">get_con_id</span><span class="p">()</span>
    <span class="c1"># get key for intensity records</span>
    <span class="n">int_key</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_intensity_col</span><span class="p">(</span><span class="n">meas_df</span><span class="p">)</span>
    <span class="c1"># list for saved figs</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># get all the records with measurement data</span>
    <span class="n">meas_data</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="n">meas_df</span><span class="p">[</span><span class="n">int_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
    <span class="c1"># get all the Thellier data</span>
    <span class="n">thel_data</span> <span class="o">=</span> <span class="n">meas_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">])</span>
    <span class="n">thel_data</span> <span class="o">=</span> <span class="n">thel_data</span><span class="p">[</span><span class="n">thel_data</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LP-PI-TRM&#39;</span><span class="p">)]</span>
    <span class="n">specimens</span> <span class="o">=</span> <span class="n">meas_data</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># list of specimen names</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;there are no data for plotting&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">spec</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spec</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specimens</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not find specimen </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">specimens</span> <span class="o">=</span> <span class="p">[</span><span class="n">spec</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">n_specs</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">specimens</span> <span class="o">=</span> <span class="n">specimens</span><span class="p">[:</span><span class="n">n_specs</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set the figure counter to 1</span>
    <span class="k">for</span> <span class="n">this_specimen</span> <span class="ow">in</span> <span class="n">specimens</span><span class="p">:</span>  <span class="c1"># step through the specimens  list</span>
        <span class="n">zed</span> <span class="o">=</span> <span class="n">make_plots</span><span class="p">(</span><span class="n">this_specimen</span><span class="p">,</span> <span class="n">thel_data</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
        <span class="c1"># if plots were produced</span>
        <span class="k">if</span> <span class="n">zed</span><span class="p">:</span>

            <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="c1"># draw and save interactively</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">zed</span><span class="p">)</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;S[a]ve plots, [q]uit, &lt;return&gt; to continue</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">this_specimen</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fmt</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">zed</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="n">incl_directory</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">saved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">zed</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_directory</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="c1"># don&#39;t draw, just save figures</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">this_specimen</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">fmt</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">zed</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">incl_directory</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                    <span class="c1"># not server</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="n">incl_directory</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># isServer, fix plot titles, formatting, and file names for server</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SP:_</span><span class="si">{}</span><span class="s2">_TY:_</span><span class="si">{}</span><span class="s2">_.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_specimen</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
                    <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;deremag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DeReMag Plot&#39;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;zijd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Zijderveld Plot&#39;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;arai&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arai Plot&#39;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;TRM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TRM Acquisition data&#39;</span>
                    <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Equal Area Plot&#39;</span>
                    <span class="n">zed</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span>
                        <span class="n">zed</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>

                <span class="n">saved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">zed</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_directory</span><span class="p">))</span>

            <span class="c1"># just let the plots appear (notebook)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zed</span><span class="p">)</span>
                <span class="c1"># don&#39;t even need to draw &#39;em!  They just appear.</span>
                <span class="c1">#pmagplotlib.draw_figs(zed)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">this_specimen</span><span class="p">,</span>
                                <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">],</span>
                                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">this_specimen</span><span class="p">,</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">]]),</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                    <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
        <span class="c1"># no plots were produced</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;no data for &#39;</span><span class="p">,</span><span class="n">this_specimen</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;skipping&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="hysteresis_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.hysteresis_magic">[docs]</a><span class="k">def</span> <span class="nf">hysteresis_magic</span><span class="p">(</span><span class="n">output_dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">spec_file</span><span class="o">=</span><span class="s2">&quot;specimens.txt&quot;</span><span class="p">,</span>
                     <span class="n">meas_file</span><span class="o">=</span><span class="s2">&quot;measurements.txt&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
                     <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">make_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pltspec</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n_specs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate hysteresis parameters and plot hysteresis data.</span>
<span class="sd">    Plotting may be called interactively with save_plots==False,</span>
<span class="sd">    or be suppressed entirely with make_plots==False.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir_path : str, default &quot;.&quot;</span>
<span class="sd">            Note: if using Windows, all figures will be saved to working directly</span>
<span class="sd">                *not* dir_path</span>
<span class="sd">        input_dir_path : str</span>
<span class="sd">            path for intput file if different from output_dir_path (default is same)</span>
<span class="sd">        spec_file : str, default &quot;specimens.txt&quot;</span>
<span class="sd">            output file to save hysteresis data</span>
<span class="sd">        meas_file : str, default &quot;measurements.txt&quot;</span>
<span class="sd">            input measurement file</span>
<span class="sd">        fmt : str, default &quot;svg&quot;</span>
<span class="sd">            format for figures, [svg, jpg, pdf, png]</span>
<span class="sd">        save_plots : bool, default True</span>
<span class="sd">            if True, generate and save all requested plots</span>
<span class="sd">        make_plots : bool, default True</span>
<span class="sd">            if False, skip making plots and just save hysteresis data</span>
<span class="sd">            (if False, save_plots will be set to False also)</span>
<span class="sd">        pltspec : str, default &quot;&quot;</span>
<span class="sd">            specimen name to plot, otherwise will plot all specimens</span>
<span class="sd">        n_specs : int</span>
<span class="sd">            number of specimens to plot, default 5</span>
<span class="sd">            if you want to make all possible plots, specify &quot;all&quot;</span>
<span class="sd">        interactive : bool, default False</span>
<span class="sd">            interactively plot and display for each specimen</span>
<span class="sd">            (this is best used on the command line or in the Python interpreter)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple </span>
<span class="sd">            (True or False indicating if conversion was successful, output file names written)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># put plots in output_dir_path, unless isServer</span>
    <span class="n">incl_directory</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span> <span class="ow">or</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
        <span class="n">incl_directory</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># figure out directory/file paths</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="n">spec_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="n">meas_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">meas_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="c1"># format and initialize variables</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">make_plots</span><span class="p">:</span>
        <span class="n">irm_init</span><span class="p">,</span> <span class="n">imag_init</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">pltspec</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">SpecRecs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="n">meas_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">meas_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_type</span> <span class="o">!=</span> <span class="s1">&#39;measurements&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad file&#39;</span><span class="p">,</span> <span class="n">meas_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="c1">#</span>
    <span class="c1"># initialize some variables</span>
    <span class="c1"># define figure numbers for hyst,deltaM,DdeltaM curves</span>
    <span class="n">HystRecs</span><span class="p">,</span> <span class="n">RemRecs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">HDD</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plots may be on top of each other - use mouse to place &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">make_plots</span><span class="p">:</span>
        <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">save_plots</span><span class="p">):</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">imag_init</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">irm_init</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">spec_file</span><span class="p">:</span>
        <span class="n">prior_data</span><span class="p">,</span> <span class="n">file_type</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">magic_read</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># get list of unique experiment names and specimen names</span>
    <span class="c1">#</span>
    <span class="n">experiment_names</span><span class="p">,</span> <span class="n">sids</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">hys_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-HYS&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
    <span class="n">dcd_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
        <span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-IRM-DCD&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
    <span class="n">imag_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">meas_data</span><span class="p">,</span> <span class="s1">&#39;method_codes&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-IMAG&#39;</span><span class="p">,</span> <span class="s1">&#39;has&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">hys_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment_names</span><span class="p">:</span>
            <span class="n">experiment_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;experiment&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">:</span>
            <span class="n">sids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">])</span>
    <span class="c1">#</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># if plotting only one specimen, find it</span>
    <span class="k">if</span> <span class="n">pltspec</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">sids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pltspec</span><span class="p">)</span>
    <span class="c1"># if plotting only n specimens, remove others from the list</span>
    <span class="k">elif</span> <span class="n">n_specs</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sids</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[:</span><span class="n">n_specs</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
        <span class="n">specimen</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pltspec</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">specimen</span> <span class="o">!=</span> <span class="n">pltspec</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">HDD</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">HDD</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span>

            <span class="c1">#HDD = {key: value + len(HDD) + k for (key, value) in HDD.items()}</span>
        <span class="c1"># initialize a new specimen hysteresis record</span>
        <span class="n">HystRec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">specimen</span><span class="p">,</span> <span class="s1">&#39;experiments&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">specimen</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">))</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
        <span class="c1"># B,M for hysteresis, Bdcd,Mdcd for irm-dcd data</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Bdcd</span><span class="p">,</span> <span class="n">Mdcd</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">Bimag</span><span class="p">,</span> <span class="n">Mimag</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># Bimag,Mimag for initial magnetization curves</span>
        <span class="c1"># fish out all the LP-HYS data for this specimen</span>
        <span class="n">spec_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">hys_data</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">specimen</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">meths</span> <span class="o">=</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;meas_orient_phi&#39;</span><span class="p">],</span><span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;meas_orient_theta&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;treat_dc_field_phi&#39;</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;meas_orient_phi&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;treat_dc_field_phi&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;treat_dc_field_theta&#39;</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;meas_orient_theta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;treat_dc_field_theta&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="p">:</span>
                <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;meas_field_dc&#39;</span><span class="p">]))</span>
                <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]))</span>
        <span class="c1"># fish out all the data for this specimen</span>
        <span class="n">spec_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">dcd_data</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">specimen</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span>
            <span class="n">irm_exp</span> <span class="o">=</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="p">:</span>
                <span class="n">Bdcd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;treat_dc_field&#39;</span><span class="p">]))</span>
                <span class="n">Mdcd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]))</span>
        <span class="c1"># fish out all the data for this specimen</span>
        <span class="n">spec_data</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span><span class="n">imag_data</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">specimen</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">imag_exp</span> <span class="o">=</span> <span class="n">spec_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="p">:</span>
                <span class="n">Bimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;meas_field_dc&#39;</span><span class="p">]))</span>
                <span class="n">Mimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">]))</span>
    <span class="c1">#</span>
    <span class="c1"># now plot the hysteresis curve</span>
    <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hmeths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">hmeths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>

            <span class="n">hpars</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_hdd</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">HDD</span><span class="p">)</span>
    <span class="c1">#</span>
            <span class="k">if</span> <span class="n">make_plots</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_hpars</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">hpars</span><span class="p">,</span> <span class="s1">&#39;bs&#39;</span><span class="p">)</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;hyst_mr_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_mr_moment&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;hyst_ms_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_ms_moment&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;hyst_bc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bc&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;hyst_bcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_bcr&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;hyst_xhf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_xhf&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;software_packages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_num</span>
            <span class="k">if</span> <span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hmeths</span><span class="p">:</span>
                <span class="n">hmeths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">])</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">hmeths</span><span class="p">:</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span><span class="o">+</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
    <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bdcd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rmeths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">rmeths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting IRM&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">irm_init</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span> <span class="c1">#5 if &#39;imag&#39; in HDD else 4</span>
                <span class="k">if</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">save_plots</span><span class="p">):</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">irm_init</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">rpars</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_irm</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="n">Bdcd</span><span class="p">,</span> <span class="n">Mdcd</span><span class="p">,</span> <span class="n">irm_exp</span><span class="p">)</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;rem_mr_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpars</span><span class="p">[</span><span class="s1">&#39;remanence_mr_moment&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;rem_bcr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpars</span><span class="p">[</span><span class="s1">&#39;remanence_bcr&#39;</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;experiments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specimen</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">irm_exp</span>
            <span class="k">if</span> <span class="n">rpars</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meths</span><span class="p">:</span>
                <span class="n">meths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rpars</span><span class="p">[</span><span class="s2">&quot;magic_method_codes&quot;</span><span class="p">])</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">rmeths</span><span class="p">:</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="n">methods</span><span class="o">+</span><span class="n">meth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;method_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HystRec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="n">methods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">HystRec</span><span class="p">[</span><span class="s2">&quot;citations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;This study&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">irm_init</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">clearFIG</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bimag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting initial magnetization curve&#39;</span><span class="p">)</span>
<span class="c1"># first normalize by Ms</span>
            <span class="n">Mnorm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Mimag</span><span class="p">:</span>
                <span class="n">Mnorm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">hpars</span><span class="p">[</span><span class="s1">&#39;hysteresis_ms_moment&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">imag_init</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">save_plots</span><span class="p">):</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">imag_init</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_imag</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">],</span> <span class="n">Bimag</span><span class="p">,</span> <span class="n">Mnorm</span><span class="p">,</span> <span class="n">imag_exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">imag_init</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">clearFIG</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">HystRec</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">HystRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HystRec</span><span class="p">)</span>
    <span class="c1">#</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">save_plots</span> <span class="ow">and</span> <span class="n">make_plots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pltspec</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">pltspec</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">specimen</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">HDD</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">incl_directory</span><span class="p">:</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">s</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span>
            <span class="k">if</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_directory</span><span class="p">)</span>
            <span class="c1">#if pltspec:</span>
            <span class="c1">#    return True, []</span>
        <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">HDD</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;S[a]ve plots, [s]pecimen name, [q]uit, &lt;return&gt; to continue</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">HDD</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">incl_directory</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">specimen</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">specimen</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_directory</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">HystRecs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good bye&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">keepon</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">specimen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="s1">&#39;Enter desired specimen name (or first part there of): &#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">keepon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">sids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span>
                        <span class="n">keepon</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">tmplist</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">qq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">specimen</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">[</span><span class="n">qq</span><span class="p">]:</span>
                                <span class="n">tmplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sids</span><span class="p">[</span><span class="n">qq</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">specimen</span><span class="p">,</span> <span class="s2">&quot; not found, but this was: &quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">tmplist</span><span class="p">)</span>
                        <span class="n">specimen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select one or try again</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">sids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bdcd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping this one - no hysteresis data&#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
            <span class="c1"># must re-init figs for Windows to keep size</span>
            <span class="k">if</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bimag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Bdcd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">if</span> <span class="s1">&#39;imag&#39;</span> <span class="ow">in</span> <span class="n">HDD</span> <span class="k">else</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">make_plots</span> <span class="ow">and</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;deltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;DdeltaM&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;irm&#39;</span><span class="p">],</span> <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HystRecs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#  go through prior_data, clean out prior results and save combined file as spec_file</span>
        <span class="n">SpecRecs</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">list</span><span class="p">(</span><span class="n">HystRecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prior_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prior_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prior_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">prior_data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;LP-HYS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]:</span>
                <span class="n">SpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">HystRecs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prior_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">prior</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_dictitem</span><span class="p">(</span>
                <span class="n">prior_data</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;sample&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">prior</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="c1"># pull sample name from prior specimens table</span>
                <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prior</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span>
            <span class="n">SpecRecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="c1"># drop unnecessary/duplicate rows</span>
        <span class="c1">#dir_path = os.path.split(spec_file)[0]</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">con</span><span class="o">.</span><span class="n">add_magic_table_from_data</span><span class="p">(</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="n">SpecRecs</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicate_rows</span><span class="p">(</span>
            <span class="n">ignore_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;citations&#39;</span><span class="p">,</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">])</span>
        <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;specimens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">spec_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">con</span><span class="o">.</span><span class="n">write_table_to_file</span><span class="p">(</span><span class="s1">&#39;specimens&#39;</span><span class="p">,</span> <span class="n">custom_name</span><span class="o">=</span><span class="n">spec_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hysteresis parameters saved in &quot;</span><span class="p">,</span> <span class="n">spec_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">spec_file</span><span class="p">]</span></div>


<div class="viewcode-block" id="sites_extract"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.sites_extract">[docs]</a><span class="k">def</span> <span class="nf">sites_extract</span><span class="p">(</span><span class="n">site_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span> <span class="n">directions_file</span><span class="o">=</span><span class="s1">&#39;directions.xls&#39;</span><span class="p">,</span>
                  <span class="n">intensity_file</span><span class="o">=</span><span class="s1">&#39;intensity.xls&#39;</span><span class="p">,</span> <span class="n">info_file</span><span class="o">=</span><span class="s1">&#39;site_info.xls&#39;</span><span class="p">,</span>
                  <span class="n">output_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts directional and/or intensity data from a MagIC 3.0 format sites.txt file.</span>
<span class="sd">    Default output format is an Excel file.</span>
<span class="sd">    Optional latex format longtable file which can be uploaded to Overleaf or</span>
<span class="sd">    typeset with latex on your own computer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    site_file : str</span>
<span class="sd">         input file name</span>
<span class="sd">    directions_file : str</span>
<span class="sd">          output file name for directional data</span>
<span class="sd">    intensity_file : str</span>
<span class="sd">          output file name for intensity data</span>
<span class="sd">    site_info : str</span>
<span class="sd">          output file name for site information (lat, lon, location, age....)</span>
<span class="sd">    output_dir_path : str</span>
<span class="sd">          path for output files</span>
<span class="sd">    input_dir_path : str</span>
<span class="sd">          path for intput file if different from output_dir_path (default is same)</span>
<span class="sd">    latex : boolean</span>
<span class="sd">           if True, output file should be latex formatted table with a .tex ending</span>

<span class="sd">    Return :</span>
<span class="sd">        [True,False], error type : True if successful</span>

<span class="sd">    Effects :</span>
<span class="sd">        writes Excel or LaTeX formatted tables for use in publications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize outfile names</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">site_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad site file name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;bad site file name&quot;</span>
    <span class="n">sites_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dir_df</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">convert_site_dm3_table_directions</span><span class="p">(</span><span class="n">sites_df</span><span class="p">)</span>
    <span class="n">dir_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">directions_file</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_df</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dir_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
                <span class="n">dir_file</span> <span class="o">=</span> <span class="n">dir_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tex&quot;</span>
            <span class="n">directions_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dir_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dir_df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multicolumn</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">directions_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dir_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">dir_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No directional data for output.&quot;</span><span class="p">)</span>
        <span class="n">dir_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">intensity_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">intensity_file</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="n">int_df</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">convert_site_dm3_table_intensity</span><span class="p">(</span><span class="n">sites_df</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_df</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">intensity_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
                <span class="n">intensity_file</span> <span class="o">=</span> <span class="n">intensity_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tex&quot;</span>
            <span class="n">intensities_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">intensity_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span>
                                   <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">int_df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multicolumn</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">intensities_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">int_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">intensity_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No intensity data for output.&quot;</span><span class="p">)</span>
        <span class="n">intensity_file</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># site info</span>
    <span class="n">nfo_df</span> <span class="o">=</span> <span class="n">sites_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>  <span class="c1"># delete blank locations</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfo_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">SiteCols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Site&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat. (N)&quot;</span><span class="p">,</span> <span class="s2">&quot;Long. (E)&quot;</span><span class="p">]</span>
        <span class="n">info_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">info_file</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
        <span class="n">age_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">age_cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nfo_df</span><span class="p">:</span>
                <span class="n">nfo_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">test_age</span> <span class="o">=</span> <span class="n">nfo_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_age</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">SiteCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Age &quot;</span><span class="p">)</span>
            <span class="n">SiteCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Age sigma&quot;</span><span class="p">)</span>
            <span class="n">SiteCols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Units&quot;</span><span class="p">)</span>
            <span class="n">nfo_df</span> <span class="o">=</span> <span class="n">nfo_df</span><span class="p">[[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;age_unit&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfo_df</span> <span class="o">=</span> <span class="n">nfo_df</span><span class="p">[[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]]</span>
        <span class="n">nfo_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">nfo_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">SiteCols</span>
        <span class="n">nfo_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
                <span class="n">info_file</span> <span class="o">=</span> <span class="n">info_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tex&quot;</span>
            <span class="n">info_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">info_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nfo_df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multicolumn</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfo_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">info_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No location information for output.&quot;</span><span class="p">)</span>
        <span class="n">info_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="p">[</span><span class="n">info_file</span><span class="p">,</span> <span class="n">intensity_file</span><span class="p">,</span> <span class="n">dir_file</span><span class="p">]</span> <span class="k">if</span> <span class="n">fname</span><span class="p">]</span></div>


<div class="viewcode-block" id="specimens_extract"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.specimens_extract">[docs]</a><span class="k">def</span> <span class="nf">specimens_extract</span><span class="p">(</span><span class="n">spec_file</span><span class="o">=</span><span class="s1">&#39;specimens.txt&#39;</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;specimens.xls&#39;</span><span class="p">,</span> <span class="n">landscape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">longtable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts specimen results  from a MagIC 3.0 format specimens.txt file.</span>
<span class="sd">    Default output format is an Excel file.</span>
<span class="sd">    typeset with latex on your own computer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ___________</span>
<span class="sd">    spec_file : str, default &quot;specimens.txt&quot;</span>
<span class="sd">         input file name</span>
<span class="sd">    output_file : str, default &quot;specimens.xls&quot;</span>
<span class="sd">         output file name</span>
<span class="sd">    landscape : boolean, default False</span>
<span class="sd">           if True output latex landscape table</span>
<span class="sd">    longtable : boolean</span>
<span class="sd">           if True output latex longtable</span>
<span class="sd">    output_dir_path : str, default &quot;.&quot;</span>
<span class="sd">        output file directory</span>
<span class="sd">    input_dir_path : str, default &quot;&quot;</span>
<span class="sd">          path for intput file if different from output_dir_path (default is same)</span>
<span class="sd">    latex : boolean, default False</span>
<span class="sd">           if True, output file should be latex formatted table with a .tex ending</span>

<span class="sd">    Return :</span>
<span class="sd">        [True,False],  data table error type : True if successful</span>

<span class="sd">    Effects :</span>
<span class="sd">        writes xls or latex formatted tables for use in publications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">spec_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad specimen file name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;bad specimen file name&quot;</span>
    <span class="n">spec_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">spec_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;int_abs&#39;</span> <span class="ow">in</span> <span class="n">spec_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">spec_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int_abs&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">table_df</span> <span class="o">=</span> <span class="n">map_magic</span><span class="o">.</span><span class="n">convert_specimen_dm3_table</span><span class="p">(</span><span class="n">spec_df</span><span class="p">)</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
                <span class="n">out_file</span> <span class="o">=</span> <span class="n">out_file</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tex&quot;</span>
            <span class="n">info_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">landscape</span><span class="p">:</span>
                <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{lscape}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">longtable</span><span class="p">:</span>
                <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{longtable}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">landscape</span><span class="p">:</span>
                <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{landscape}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">table_df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="n">longtable</span><span class="p">,</span>
                                             <span class="n">escape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multicolumn</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">landscape</span><span class="p">:</span>
                <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{landscape}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No specimen data for output.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">out_file</span><span class="p">]</span></div>


<div class="viewcode-block" id="criteria_extract"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.criteria_extract">[docs]</a><span class="k">def</span> <span class="nf">criteria_extract</span><span class="p">(</span><span class="n">crit_file</span><span class="o">=</span><span class="s1">&#39;criteria.txt&#39;</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;criteria.xls&#39;</span><span class="p">,</span>
                     <span class="n">output_dir_path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts criteria  from a MagIC 3.0 format criteria.txt file.</span>
<span class="sd">    Default output format is an Excel file.</span>
<span class="sd">    typeset with latex on your own computer.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        crit_file : str, default &quot;criteria.txt&quot;</span>
<span class="sd">            input file name</span>
<span class="sd">        output_file : str, default &quot;criteria.xls&quot;</span>
<span class="sd">            output file name</span>
<span class="sd">        output_dir_path : str, default &quot;.&quot;</span>
<span class="sd">            output file directory</span>
<span class="sd">        input_dir_path : str, default &quot;&quot;</span>
<span class="sd">            path for intput file if different from output_dir_path (default is same)</span>
<span class="sd">        latex : boolean, default False</span>
<span class="sd">            if True, output file should be latex formatted table with a .tex ending</span>

<span class="sd">    Returns :</span>
<span class="sd">        [True,False],  data table error type : True if successful</span>

<span class="sd">    Effects :</span>
<span class="sd">        writes xls or latex formatted tables for use in publications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">crit_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad criteria file name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;bad criteria file name&quot;</span>
    <span class="n">crit_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crit_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output_dir_path</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;table_column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;column&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">crit_df</span> <span class="o">=</span> <span class="n">crit_df</span><span class="p">[[</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;column&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;criterion_value&#39;</span><span class="p">,</span> <span class="s1">&#39;criterion_operation&#39;</span><span class="p">]]</span>

        <span class="n">crit_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">,</span> <span class="s1">&#39;Statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;Threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Operation&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">latex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">):</span>
                <span class="n">out_file</span> <span class="o">=</span> <span class="n">out_file</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.tex&quot;</span>
            <span class="n">crit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;Operation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
                <span class="s1">&#39;&lt;&#39;</span><span class="p">),</span> <span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;maximum&#39;</span>
            <span class="n">crit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;Operation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span>
                <span class="s1">&#39;&gt;&#39;</span><span class="p">),</span> <span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;minimum&#39;</span>
            <span class="n">crit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">crit_df</span><span class="p">[</span><span class="s1">&#39;Operation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;equal to&#39;</span>
            <span class="n">info_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\documentclass</span><span class="si">{article}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">usepackage</span><span class="si">{booktabs}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># info_out.write(&#39;\\usepackage{longtable}\n&#39;)</span>
            <span class="c1"># T1 will ensure that symbols like &#39;&lt;&#39; are formatted correctly</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">usepackage[T1]</span><span class="si">{fontenc}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">crit_df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                            <span class="n">escape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">multicolumn</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;\end</span><span class="si">{document}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">info_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">crit_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No criteria for output.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">out_file</span><span class="p">]</span></div>


<div class="viewcode-block" id="eqarea_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.eqarea_magic">[docs]</a><span class="k">def</span> <span class="nf">eqarea_magic</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="s1">&#39;sites.txt&#39;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">spec_file</span><span class="o">=</span><span class="s2">&quot;specimens.txt&quot;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s2">&quot;samples.txt&quot;</span><span class="p">,</span>
            <span class="n">site_file</span><span class="o">=</span><span class="s2">&quot;sites.txt&quot;</span><span class="p">,</span> <span class="n">loc_file</span><span class="o">=</span><span class="s2">&quot;locations.txt&quot;</span><span class="p">,</span>
            <span class="n">plot_by</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">ignore_tilt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
            <span class="n">plot_ell</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n_plots</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">source_table</span><span class="o">=</span><span class="s2">&quot;sites&quot;</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes equal area projections from declination/inclination data</span>

<span class="sd">    Parameters:</span>
<span class="sd">        in_file : str, default &quot;sites.txt&quot;</span>
<span class="sd">        dir_path : str</span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path : str</span>
<span class="sd">            input file directory (if different from dir_path), default &quot;&quot;</span>
<span class="sd">        spec_file : str</span>
<span class="sd">            input specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">        samp_file: str</span>
<span class="sd">            input sample file name, default &quot;samples.txt&quot;</span>
<span class="sd">        site_file : str</span>
<span class="sd">            input site file name, default &quot;sites.txt&quot;</span>
<span class="sd">        loc_file : str</span>
<span class="sd">            input location file name, default &quot;locations.txt&quot;</span>
<span class="sd">        plot_by : str</span>
<span class="sd">            [spc, sam, sit, loc, all] (specimen, sample, site, location, all), default &quot;all&quot;</span>
<span class="sd">        crd : [&#39;s&#39;,&#39;g&#39;,&#39;t&#39;], coordinate system for plotting whereby:</span>
<span class="sd">            s : specimen coordinates, aniso_tile_correction = -1</span>
<span class="sd">            g : geographic coordinates, aniso_tile_correction = 0 (default)</span>
<span class="sd">            t : tilt corrected coordinates, aniso_tile_correction = 100</span>
<span class="sd">        ignore_tilt : bool</span>
<span class="sd">            default False.  If True, data are unoriented (allows plotting of measurement dec/inc)</span>
<span class="sd">        save_plots : bool</span>
<span class="sd">            plot and save non-interactively, default True</span>
<span class="sd">        fmt : str</span>
<span class="sd">            [&quot;png&quot;, &quot;svg&quot;, &quot;pdf&quot;, &quot;jpg&quot;], default &quot;svg&quot;</span>
<span class="sd">        contour : bool</span>
<span class="sd">            plot as color contour</span>
<span class="sd">        colormap : str</span>
<span class="sd">            color map for contour plotting, default &quot;coolwarm&quot;</span>
<span class="sd">            see cartopy documentation for more options</span>
<span class="sd">        plot_ell : str</span>
<span class="sd">            [F,K,B,Be,Bv] plot Fisher, Kent, Bingham, Bootstrap ellipses or Bootstrap eigenvectors</span>
<span class="sd">            default &quot;&quot; plots none</span>
<span class="sd">        n_plots : int</span>
<span class="sd">            maximum number of plots to make, default 5</span>
<span class="sd">            if you want to make all possible plots, specify &quot;all&quot;</span>
<span class="sd">        interactive : bool, default False</span>
<span class="sd">            interactively plot and display for each specimen</span>
<span class="sd">            (this is best used on the command line or in the Python interpreter)</span>
<span class="sd">        contribution : cb.Contribution, default None</span>
<span class="sd">            if provided, use Contribution object instead of reading in</span>
<span class="sd">            data from files</span>
<span class="sd">        source_table : table to get plot data from (only needed with contribution argument)</span>
<span class="sd">            for example, you could specify source_table=&quot;measurements&quot; and plot_by=&quot;sites&quot;</span>
<span class="sd">            to plot measurement data by site.</span>
<span class="sd">            default &quot;sites&quot;</span>
<span class="sd">        image_records : generate and return a record for each image in a list of dicts</span>
<span class="sd">            which can be ingested by pmag.magic_write</span>
<span class="sd">            bool, default False</span>


<span class="sd">    Returns:</span>
<span class="sd">        if image_records == False</span>
<span class="sd">            type - Tuple : (True or False indicating if conversion was successful, file name(s) written)</span>
<span class="sd">        if image_records == True</span>
<span class="sd">            True or False indicating if conversion was successful, output file name written, list of image recs</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># parse out input/out directories</span>
    <span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fix_directories</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="c1"># initialize some variables</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">FIG</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># plot dictionary</span>
    <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># eqarea is figure 1</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1"># get coordinate system</span>
    <span class="k">if</span> <span class="n">crd</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span>
    <span class="k">elif</span> <span class="n">crd</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;100&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
    <span class="c1"># get item to plot by</span>
    <span class="k">if</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;sit&#39;</span> <span class="ow">or</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;site&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;sam&#39;</span> <span class="ow">or</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;sample&#39;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
    <span class="k">elif</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s1">&#39;spc&#39;</span> <span class="ow">or</span> <span class="n">plot_by</span> <span class="o">==</span> <span class="s2">&quot;specimen&quot;</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;specimen&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot_by</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
    <span class="c1"># get distribution to plot ellipses/eigenvectors if desired</span>

    <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># set keys</span>
    <span class="n">dec_key</span> <span class="o">=</span> <span class="s1">&#39;dir_dec&#39;</span>
    <span class="n">inc_key</span> <span class="o">=</span> <span class="s1">&#39;dir_inc&#39;</span>
    <span class="n">tilt_key</span> <span class="o">=</span> <span class="s1">&#39;dir_tilt_correction&#39;</span>

    <span class="c1"># create/access contribution</span>

    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># need to get source table</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">source_table</span>
        <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">directory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;specimens&quot;</span><span class="p">:</span> <span class="n">spec_file</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span>
                  <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="n">site_file</span><span class="p">,</span> <span class="s1">&#39;locations&#39;</span><span class="p">:</span> <span class="n">loc_file</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-E- Could not find </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">in_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

        <span class="n">contribution</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">,</span>
                                       <span class="n">single_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">)</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">contribution</span><span class="o">.</span><span class="n">add_magic_table</span><span class="p">(</span><span class="s2">&quot;contribution&quot;</span><span class="p">)</span>

    <span class="c1"># get contribution id if available for server plots</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="n">con_id</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">get_con_id</span><span class="p">()</span>
    <span class="c1"># try to propagate all names to measurement level</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_samples</span><span class="p">()</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_specimens</span><span class="p">()</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># the object that contains the DataFrame + useful helper methods:</span>
    <span class="n">data_container</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
    <span class="c1"># the actual DataFrame:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">df</span>
    <span class="n">plot_type</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">if</span> <span class="n">plot_key</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span> <span class="ow">and</span> <span class="n">plot_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-E- You can&#39;t plot by </span><span class="si">{}</span><span class="s2"> with the data provided&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_key</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># add tilt key into DataFrame columns if it isn&#39;t there already</span>
    <span class="k">if</span> <span class="n">tilt_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">tilt_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> records read in&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_type</span><span class="p">))</span>

    <span class="c1"># find desired dec,inc data:</span>
    <span class="n">dir_type_key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># get plotlist if not plotting all records</span>
    <span class="c1">#</span>
    <span class="n">plotlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">plot_key</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>

        <span class="c1"># return all where plot_key is not blank</span>
        <span class="k">if</span> <span class="n">plot_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-E- Can</span><span class="se">\&#39;</span><span class="s1">t plot by &quot;</span><span class="si">{}</span><span class="s1">&quot;.  That header is not in infile: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">plot_key</span><span class="p">,</span> <span class="n">in_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">plots</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
        <span class="n">plotlist</span> <span class="o">=</span> <span class="n">plots</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># grab unique values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_plots</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plotlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_plots</span><span class="p">:</span>
            <span class="n">plotlist</span> <span class="o">=</span> <span class="n">plotlist</span><span class="p">[:</span><span class="n">n_plots</span><span class="p">]</span>
    <span class="n">fignum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plotlist</span><span class="p">:</span>
        <span class="n">fignum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fignum</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_ell</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">plot_ell</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="c1"># if dist type is unrecognized, use Fisher</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">,</span> <span class="s1">&#39;BV&#39;</span><span class="p">]:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s2">&quot;BV&quot;</span><span class="p">:</span>
                <span class="n">fignum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;bdirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fignum</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;bdirs&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="c1"># plot everything at once</span>
            <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pull out only partial data</span>
            <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">plot</span><span class="p">]</span>

        <span class="c1"># get location names for the data</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

        <span class="n">DIblock</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">GCblock</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># SLblock, SPblock = [], []</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plot</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">dec_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No dec/inc data&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="c1"># get all records where dec &amp; inc values exist</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="n">plot_data</span><span class="p">[</span><span class="n">dec_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
                              <span class="o">&amp;</span> <span class="n">plot_data</span><span class="p">[</span><span class="n">inc_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No dec/inc data&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># get metadata for naming the plot file</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="o">=</span><span class="n">plot_data</span><span class="p">))</span>
        <span class="n">site</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="o">=</span><span class="n">plot_data</span><span class="p">))</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="o">=</span><span class="n">plot_data</span><span class="p">))</span>
        <span class="n">specimen</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_container</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="n">df_slice</span><span class="o">=</span><span class="n">plot_data</span><span class="p">))</span>

        <span class="c1"># make sure method_codes is in plot_data</span>
        <span class="k">if</span> <span class="s1">&#39;method_codes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;method_codes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># get data blocks</span>
        <span class="c1"># would have to ignore tilt to use measurement level data</span>
        <span class="n">DIblock</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">get_di_block</span><span class="p">(</span><span class="n">df_slice</span><span class="o">=</span><span class="n">plot_data</span><span class="p">,</span>
                                              <span class="n">tilt_corr</span><span class="o">=</span><span class="n">coord</span><span class="p">,</span> <span class="n">excl</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DE-BFP&#39;</span><span class="p">],</span> <span class="n">ignore_tilt</span><span class="o">=</span><span class="n">ignore_tilt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;All&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot; ,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; - </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> plotted&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)),</span> <span class="n">plot_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> plotted&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)),</span> <span class="n">plot_type</span><span class="p">)</span>
        <span class="c1">#SLblock = [[ind, row[&#39;method_codes&#39;]] for ind, row in plot_data.iterrows()]</span>
        <span class="c1"># get great circles</span>
        <span class="n">great_circle_data</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">get_records_for_code</span><span class="p">(</span><span class="s1">&#39;DE-BFP&#39;</span><span class="p">,</span> <span class="n">incl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                <span class="n">use_slice</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sli</span><span class="o">=</span><span class="n">plot_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">great_circle_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gc_cond</span> <span class="o">=</span> <span class="n">great_circle_data</span><span class="p">[</span><span class="n">tilt_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">coord</span>
            <span class="n">GCblock</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">dec_key</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">inc_key</span><span class="p">])]</span>
                       <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">great_circle_data</span><span class="p">[</span><span class="n">gc_cond</span><span class="p">]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
            <span class="c1">#SPblock = [[ind, row[&#39;method_codes&#39;]] for ind, row in great_circle_data[gc_cond].iterrows()]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">contour</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_eq</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">DIblock</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_eq_cont</span><span class="p">(</span>
                    <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">DIblock</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_net</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">GCblock</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_circ</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">rec</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="c1">#if len(DIblock) == 0 and len(GCblock) == 0:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">GCblock</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;insufficient records for plotting&quot;</span><span class="p">)</span>
                <span class="n">fignum</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="s1">&#39;bdirs&#39;</span> <span class="ow">in</span> <span class="n">FIG</span><span class="p">:</span>
                    <span class="n">fignum</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">continue</span>
            <span class="c1"># sys.exit()</span>
        <span class="k">if</span> <span class="n">plot_ell</span><span class="p">:</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">doprinc</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)</span>  <span class="c1"># get principal directions</span>
            <span class="n">nDIs</span><span class="p">,</span> <span class="n">rDIs</span><span class="p">,</span> <span class="n">npars</span><span class="p">,</span> <span class="n">rpars</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">DIblock</span><span class="p">:</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rec</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span>
                                   <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">],</span> <span class="n">ppars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mf">90.</span><span class="p">:</span>
                    <span class="n">rDIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nDIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>  <span class="c1"># do on whole dataset</span>
                <span class="n">etitle</span> <span class="o">=</span> <span class="s2">&quot;Bingham confidence ellipse&quot;</span>
                <span class="n">bpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dobingham</span><span class="p">(</span><span class="n">DIblock</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">bpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
                <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpars</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
                <span class="n">etitle</span> <span class="o">=</span> <span class="s2">&quot;Fisher confidence cone&quot;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                    <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">])</span>  <span class="c1"># Beta</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">isign</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">isign</span><span class="o">*</span><span class="mf">90.</span><span class="p">)</span>  <span class="c1"># Beta inc</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">])</span>  <span class="c1"># gamma</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">90.</span><span class="p">)</span>  <span class="c1"># Beta dec</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>  <span class="c1"># Beta inc</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">fisher_mean</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                    <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">])</span>  <span class="c1"># Beta</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">isign</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">isign</span><span class="o">*</span><span class="mf">90.</span><span class="p">)</span>  <span class="c1"># Beta inc</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;alpha95&#39;</span><span class="p">])</span>  <span class="c1"># gamma</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">90.</span><span class="p">)</span>  <span class="c1"># Beta dec</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>  <span class="c1"># Beta inc</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span>
                <span class="n">etitle</span> <span class="o">=</span> <span class="s2">&quot;Kent confidence ellipse&quot;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">kpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">nDIs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                    <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
                    <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">kpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">rDIs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                    <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
                    <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpars</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># assume bootstrap</span>
                <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;BE&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">BnDIs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span>
                        <span class="n">Bkpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">BnDIs</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Bkpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
                        <span class="n">npars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">BrDIs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>
                        <span class="n">Bkpars</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">dokent</span><span class="p">(</span><span class="n">BrDIs</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Bkpars</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%7.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;       </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                        <span class="n">mode</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;inc&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zeta&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zdec&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Zinc&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Eta&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Edec&#39;</span><span class="p">])</span>
                        <span class="n">rpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bkpars</span><span class="p">[</span><span class="s1">&#39;Einc&#39;</span><span class="p">])</span>
                    <span class="n">etitle</span> <span class="o">=</span> <span class="s2">&quot;Bootstrapped confidence ellipse&quot;</span>
                <span class="k">elif</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;BV&#39;</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;face&#39;</span><span class="p">}</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">BnDIs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span>
                        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_eq_sym</span><span class="p">(</span>
                            <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;bdirs&#39;</span><span class="p">],</span> <span class="n">BnDIs</span><span class="p">,</span> <span class="s1">&#39;Bootstrapped Eigenvectors&#39;</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">BrDIs</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">di_boot</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># plot on existing plots</span>
                            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_di_sym</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;bdirs&#39;</span><span class="p">],</span> <span class="n">BrDIs</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_eq</span><span class="p">(</span>
                                <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;bdirs&#39;</span><span class="p">],</span> <span class="n">BrDIs</span><span class="p">,</span> <span class="s1">&#39;Bootstrapped Eigenvectors&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_conf</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">etitle</span><span class="p">,</span> <span class="p">[],</span> <span class="n">npars</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">!=</span> <span class="s1">&#39;BV&#39;</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_conf</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">etitle</span><span class="p">,</span> <span class="p">[],</span> <span class="n">npars</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_conf</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">etitle</span><span class="p">,</span> <span class="p">[],</span> <span class="n">rpars</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rDIs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">!=</span> <span class="s1">&#39;BV&#39;</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_conf</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;eqarea&#39;</span><span class="p">],</span> <span class="n">etitle</span><span class="p">,</span> <span class="p">[],</span> <span class="n">rpars</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FIG</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1">#if filename:  # use provided filename</span>
            <span class="c1">#    filename += &#39;.&#39; + fmt</span>
            <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>  <span class="c1"># use server plot naming convention</span>
                <span class="k">if</span> <span class="n">plot_key</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span><span class="o">+</span><span class="n">locations</span><span class="o">+</span><span class="s1">&#39;_SI:__SA:__SP:__CO:_&#39;</span><span class="o">+</span><span class="n">crd</span><span class="o">+</span><span class="s1">&#39;_TY:_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_.&#39;</span><span class="o">+</span><span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span><span class="o">+</span><span class="n">locations</span><span class="o">+</span><span class="s1">&#39;_SI:_&#39;</span><span class="o">+</span><span class="n">site</span><span class="o">+</span><span class="s1">&#39;_SA:_&#39;</span><span class="o">+</span><span class="n">sample</span> <span class="o">+</span> \
                        <span class="s1">&#39;_SP:_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_CO:_&#39;</span><span class="o">+</span><span class="n">crd</span><span class="o">+</span><span class="s1">&#39;_TY:_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_.&#39;</span><span class="o">+</span><span class="n">fmt</span>
            <span class="k">elif</span> <span class="n">plot_key</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
                <span class="k">if</span> <span class="n">locs</span><span class="p">:</span>
                    <span class="n">loc_string</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">])</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">loc_string</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">crd</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">key</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># use more readable naming convention</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># fix this if plot_by is location , for example</span>
                <span class="n">use_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">locations</span><span class="p">],</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">locations</span><span class="p">,</span> <span class="n">site</span><span class="p">],</span>
                             <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">locations</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">sample</span><span class="p">],</span>
                             <span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">locations</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">specimen</span><span class="p">]}</span>
                <span class="n">use</span> <span class="o">=</span> <span class="n">use_names</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span>
                <span class="n">use</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">crd</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span>
                <span class="c1"># [locations, site, sample, specimen, crd, key]:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">use</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                        <span class="n">filename</span> <span class="o">+=</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">specimen</span> <span class="ow">or</span> <span class="n">sample</span> <span class="ow">or</span> <span class="n">site</span> <span class="ow">or</span> <span class="n">locations</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span>
                            <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">specimen</span><span class="p">,</span>
                            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">file_type</span><span class="p">],</span>
                            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">file_type</span><span class="p">]]),</span>
                            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                            <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>

        <span class="n">saved_figs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
            <span class="n">titles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eqarea&#39;</span><span class="p">:</span> <span class="s1">&#39;Equal Area Plot&#39;</span><span class="p">}</span>
            <span class="n">FIG</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">con_id</span><span class="o">=</span><span class="n">con_id</span><span class="p">)</span>
            <span class="n">saved_figs</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">saved_figs</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1">#continue</span>
        <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot; S[a]ve to save plot, [q]uit, Return to continue:  &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="n">saved_figs</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">saved_figs</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="polemap_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.polemap_magic">[docs]</a><span class="k">def</span> <span class="nf">polemap_magic</span><span class="p">(</span><span class="n">loc_file</span><span class="o">=</span><span class="s2">&quot;locations.txt&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                  <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">symsize</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">rsym</span><span class="o">=</span><span class="s1">&#39;g^&#39;</span><span class="p">,</span> <span class="n">rsymsize</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                  <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;ortho&quot;</span><span class="p">,</span>
                  <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">anti</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fancy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">ell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mf">90.</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use a MagIC format locations table to plot poles.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        loc_file : str, default &quot;locations.txt&quot;</span>
<span class="sd">        dir_path : str, default &quot;.&quot;</span>
<span class="sd">            directory name to find loc_file in (if not included in loc_file)</span>
<span class="sd">        interactive : bool, default False</span>
<span class="sd">        if True, interactively plot and display</span>
<span class="sd">            (this is best used on the command line only)</span>
<span class="sd">        crd : str, default &quot;&quot;</span>
<span class="sd">        coordinate system [g, t] (geographic, tilt_corrected)</span>
<span class="sd">        sym : str, default &quot;ro&quot;</span>
<span class="sd">            symbol color and shape, default red circles</span>
<span class="sd">            (see matplotlib documentation for more options)</span>
<span class="sd">        symsize : int, default 40</span>
<span class="sd">            symbol size</span>
<span class="sd">        rsym : str, default &quot;g^&quot;</span>
<span class="sd">            symbol for plotting reverse poles</span>
<span class="sd">        rsymsize : int, default 40</span>
<span class="sd">            symbol size for reverse poles</span>
<span class="sd">        fmt : str, default &quot;pdf&quot;</span>
<span class="sd">            format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">        res : str, default &quot;c&quot;</span>
<span class="sd">            resolution [c, l, i, h] (crude, low, intermediate, high)</span>
<span class="sd">        proj : str, default &quot;ortho&quot;</span>
<span class="sd">            ortho = orthographic</span>
<span class="sd">            lcc = lambert conformal</span>
<span class="sd">            moll = molweide</span>
<span class="sd">            merc = mercator</span>
<span class="sd">        flip : bool, default False</span>
<span class="sd">            if True, flip reverse poles to normal antipode</span>
<span class="sd">        anti : bool, default False</span>
<span class="sd">            if True, plot antipodes for each pole</span>
<span class="sd">        fancy : bool, default False</span>
<span class="sd">            if True, plot topography (not yet implementedj)</span>
<span class="sd">        ell : bool, default False</span>
<span class="sd">            if True, plot ellipses</span>
<span class="sd">        ages : bool, default False</span>
<span class="sd">            if True, plot ages</span>
<span class="sd">        lat_0 : float, default 90.</span>
<span class="sd">            eyeball latitude</span>
<span class="sd">        lon_0 : float, default 0.</span>
<span class="sd">            eyeball longitude</span>
<span class="sd">        save_plots : bool, default True</span>
<span class="sd">            if True, create and save all requested plots</span>
<span class="sd">        image_records : generate and return a record for each image in a list of dicts</span>
<span class="sd">            which can be ingested by pmag.magic_write</span>
<span class="sd">            bool, default False</span>

<span class="sd">    Returns:</span>
<span class="sd">        if image_records == False</span>
<span class="sd">                True or False indicating if conversion was successful, file name(s) written</span>
<span class="sd">        if image_records == True</span>
<span class="sd">                True or False indicating if conversion was successful, output file name written, list of image recs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">anti</span><span class="p">,</span> <span class="n">ell</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">anti</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ell</span><span class="p">)</span>
    <span class="c1"># initialize and format variables</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dates</span><span class="p">,</span> <span class="n">rlats</span><span class="p">,</span> <span class="n">rlons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">polarities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">full_path</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">loc_file</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
    <span class="n">dir_path</span><span class="p">,</span> <span class="n">loc_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
    <span class="c1"># create or access MagIC contribution</span>
    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">directory</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="n">loc_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W - Couldn&#39;t read in data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t read in data&quot;</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Couldn&#39;t read in data&quot;</span>
    <span class="n">FIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;map&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">pole_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">]</span>
    <span class="n">pole_df</span> <span class="o">=</span> <span class="n">pole_container</span><span class="o">.</span><span class="n">df</span>
    <span class="k">if</span> <span class="s1">&#39;pole_lat&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pole_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;pole_lon&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pole_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- pole_lat and pole_lon are required columns to run polemap_magic.py&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;pole_lat and pole_lon are required columns to run polemap_magic.py&quot;</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;pole_lat and pole_lon are required columns to run polemap_magic.py&quot;</span>
    <span class="c1"># use records with pole_lat and pole_lon</span>
    <span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span> <span class="o">=</span> <span class="n">pole_df</span><span class="p">[</span><span class="s1">&#39;pole_lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="n">pole_df</span><span class="p">[</span><span class="s1">&#39;pole_lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
    <span class="n">Results</span> <span class="o">=</span> <span class="n">pole_df</span><span class="p">[</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">]</span>
    <span class="c1"># don&#39;t plot identical poles twice</span>
    <span class="n">Results</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pole_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;pole_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># use tilt correction if available</span>
    <span class="c1"># prioritize tilt-corrected poles</span>
    <span class="k">if</span> <span class="s1">&#39;dir_tilt_correction&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">crd</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="k">if</span> <span class="mf">100.</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
            <span class="k">elif</span> <span class="mf">0.</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">crd</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">coord_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="n">coord_dict</span><span class="p">[</span><span class="n">crd</span><span class="p">]</span> <span class="k">if</span> <span class="n">crd</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># filter results by dir_tilt_correction if available</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">coord</span> <span class="ow">or</span> <span class="n">coord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;dir_tilt_correction&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">coord</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="n">Results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="n">cond</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">]</span>
    <span class="c1"># get location name and average ages</span>
    <span class="n">loc_list</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;age_low&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;age_high&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age_low&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age_high&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age_low&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">ages</span><span class="p">:</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">Results</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No poles could be plotted&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No poles could be plotted&quot;</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;No poles could be plotted&quot;</span>

    <span class="c1"># go through rows and extract data</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_lat&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_lon&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;dir_polarity&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">polarities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;dir_polarity&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">anti</span><span class="p">:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">180.</span>
            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mf">360.</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">flip</span><span class="p">:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">flip</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rlats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">180.</span>
                <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mi">360</span>
                <span class="n">rlons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">ppars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">ell1</span><span class="p">,</span> <span class="n">ell2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;pole_dm&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_dm&#39;</span><span class="p">]:</span>
            <span class="n">ell1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_dm&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;pole_dp&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_dp&#39;</span><span class="p">]:</span>
            <span class="n">ell2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_dp&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;pole_alpha95&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_alpha95&#39;</span><span class="p">]:</span>
            <span class="n">ell1</span><span class="p">,</span> <span class="n">ell2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_alpha95&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;pole_alpha95&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ell1</span> <span class="ow">and</span> <span class="n">ell2</span> <span class="ow">and</span> <span class="n">lons</span><span class="p">:</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell1</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">isign</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">isign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">isign</span> <span class="o">*</span> <span class="mf">90.</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell2</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">Pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ppars</span><span class="p">)</span>

    <span class="n">locations</span> <span class="o">=</span> <span class="n">locations</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">Opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latmin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;latmax&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;lonmin&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;lonmax&#39;</span><span class="p">:</span> <span class="mf">360.</span><span class="p">,</span>
            <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="n">lat_0</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="n">lon_0</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="n">proj</span><span class="p">,</span> <span class="s1">&#39;sym&#39;</span><span class="p">:</span> <span class="s1">&#39;b+&#39;</span><span class="p">,</span>
            <span class="s1">&#39;symsize&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;pltgrid&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">,</span> <span class="s1">&#39;boundinglat&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
            <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;face&#39;</span><span class="p">}</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coasts&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rivers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span> <span class="n">fancy</span><span class="p">}</span>
    <span class="n">base_Opts</span> <span class="o">=</span> <span class="n">Opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># make the base map with a blue triangle at the pole</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="n">Opts</span><span class="p">)</span>

    <span class="c1">#Opts[&#39;pltgrid&#39;] = -1</span>
    <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;merc&#39;</span><span class="p">:</span><span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;pltgrid&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sym</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">symsize</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pole_lats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pole_lons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">lat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lats</span><span class="p">):</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pole_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">pole_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="c1"># plot the lats and lons of the poles</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">pole_lats</span><span class="p">,</span> <span class="n">pole_lons</span><span class="p">,</span> <span class="n">Opts</span><span class="p">)</span>

    <span class="c1"># do reverse poles</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rlats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">reverse_Opts</span> <span class="o">=</span> <span class="n">Opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">reverse_Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsym</span>
        <span class="n">reverse_Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsymsize</span>
        <span class="n">reverse_Opts</span><span class="p">[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        <span class="c1"># plot the lats and lons of the reverse poles</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">rlats</span><span class="p">,</span> <span class="n">rlons</span><span class="p">,</span> <span class="n">reverse_Opts</span><span class="p">)</span>

    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="c1"># plot each individual pole for the server</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;polarities&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">polarities</span><span class="p">:</span> <span class="c1"># second term is true if not empty</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;polarities=&quot;</span><span class="p">,</span><span class="n">polarities</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ind=&quot;</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span>
                <span class="n">polarity</span> <span class="o">=</span> <span class="n">polarities</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">polarity</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">polarity</span> <span class="k">if</span> <span class="n">polarity</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">loc_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="s2">&quot;nan&quot;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="n">FIG</span><span class="p">[</span><span class="s2">&quot;map_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ind</span><span class="o">+</span><span class="mi">2</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">)],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">)],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="n">base_Opts</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">lat</span><span class="p">],</span> <span class="p">[</span><span class="n">lon</span><span class="p">],</span> <span class="n">Opts</span><span class="p">)</span>
            <span class="n">titles</span><span class="p">[</span><span class="s2">&quot;map_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">location</span>
            <span class="k">if</span> <span class="n">crd</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;LO:_</span><span class="si">{}{}</span><span class="s2">_TY:_POLE_map_</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
                <span class="n">fname_short</span> <span class="o">=</span> <span class="s2">&quot;LO:_</span><span class="si">{}{}</span><span class="s2">_TY:_POLE_map_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="n">crd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;LO:_</span><span class="si">{}{}</span><span class="s2">_TY:_POLE_map.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">polarity</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
                <span class="n">fname_short</span> <span class="o">=</span> <span class="s2">&quot;LO:_</span><span class="si">{}{}</span><span class="s2">_TY:_POLE_map&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">polarity</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Pole Map&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Pole map &#39;</span> <span class="o">+</span> <span class="n">location</span><span class="p">,</span>
                             <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                             <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>


            <span class="c1"># don&#39;t allow identically named files</span>
            <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">file_values</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">file_values_short</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">file_values</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">fname_short</span> <span class="ow">in</span> <span class="n">file_values_short</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]:</span>
                        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname_short</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="n">fmt</span>
                        <span class="k">if</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_values</span><span class="p">:</span>
                            <span class="k">break</span>
            <span class="n">files</span><span class="p">[</span><span class="s2">&quot;map_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fname</span>



    <span class="c1"># truncate location names so that ultra long filenames are not created</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="c1"># use server plot naming convention</span>
        <span class="n">con_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;contribution&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="c1"># try to get contribution id</span>
            <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">con_id</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">files</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MC:_</span><span class="si">{}</span><span class="s1">_TY:_POLE_map_</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">con_id</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no contribution id available</span>
            <span class="n">files</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span> <span class="o">+</span> <span class="n">locations</span> <span class="o">+</span> <span class="s1">&#39;_TY:_POLE_map_</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use readable naming convention for non-database use</span>
        <span class="n">files</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_POLE_map_</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">locations</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">files</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Pole Map&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Pole map &#39;</span> <span class="o">+</span> <span class="n">locations</span><span class="p">,</span>
                     <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                     <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
        <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>


    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">interactive</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">):</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ell</span><span class="p">:</span>  <span class="c1"># add ellipses if desired.</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coasts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rivers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span> <span class="n">fancy</span><span class="p">}</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;pltgrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># turn off meridian replotting</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g-&#39;</span>
        <span class="k">for</span> <span class="n">ppars</span> <span class="ow">in</span> <span class="n">Pars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ppars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PTS</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">ppars</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">elats</span><span class="p">,</span> <span class="n">elons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">PTS</span><span class="p">:</span>
                    <span class="n">elons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">elats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># make the base map with a blue triangle at the pole</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">elats</span><span class="p">,</span> <span class="n">elons</span><span class="p">,</span> <span class="n">Opts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">interactive</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">):</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="n">black</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
        <span class="n">purple</span> <span class="o">=</span> <span class="s1">&#39;#800080&#39;</span>
        <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span> <span class="o">+</span> <span class="n">locations</span> <span class="o">+</span> <span class="s1">&#39;_POLE_map&#39;</span>
        <span class="n">con_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;contribution&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">con_id</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;contribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

            <span class="n">loc_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;locations&#39;</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">num_locs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
                <span class="n">loc_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> location</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_locs</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span> <span class="k">if</span> <span class="n">num_locs</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">num_lats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">lat</span> <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span> <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">num_rlats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rlats</span><span class="p">)</span>
                <span class="n">npole_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">rpole_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">num_lats</span><span class="p">:</span>
                    <span class="n">npole_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> normal &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_lats</span><span class="p">)</span> <span class="c1">#, &#39;s&#39; if num_lats &gt; 1 else &#39;&#39;)</span>
                <span class="k">if</span> <span class="n">num_rlats</span><span class="p">:</span>
                    <span class="n">rpole_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> reverse&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_rlats</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_lats</span> <span class="o">+</span> <span class="n">num_rlats</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">pole_string</span> <span class="o">=</span> <span class="s2">&quot;poles&quot;</span>
                <span class="k">elif</span> <span class="n">num_lats</span> <span class="o">+</span> <span class="n">num_rlats</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pole_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pole_string</span> <span class="o">=</span> <span class="s2">&quot;pole&quot;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MagIC contribution </span><span class="si">{}</span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">con_id</span><span class="p">,</span> <span class="n">loc_string</span><span class="p">,</span> <span class="n">npole_string</span><span class="p">,</span> <span class="n">rpole_string</span><span class="p">,</span> <span class="n">pole_string</span><span class="p">)</span>
            <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">FIG</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">black</span><span class="p">,</span> <span class="n">purple</span><span class="p">,</span> <span class="n">con_id</span><span class="p">)</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot; S[a]ve to save plot, Return to quit:  &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good bye&quot;</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="chi_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.chi_magic">[docs]</a><span class="k">def</span> <span class="nf">chi_magic</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">&quot;measurements.txt&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">experiments</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
              <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>
<span class="sd">        infile : str, default &quot;measurements.txt&quot;</span>
<span class="sd">            measurement infile</span>
<span class="sd">        dir_path : str, default &quot;.&quot;</span>
<span class="sd">            input directory</span>
<span class="sd">        experiments : str, default &quot;&quot;</span>
<span class="sd">            experiment name to plot</span>
<span class="sd">        fmt : str, default &quot;svg&quot;</span>
<span class="sd">            format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">        save_plots : bool, default True</span>
<span class="sd">            save figures</span>
<span class="sd">        interactive : bool, default False</span>
<span class="sd">            if True, interactively plot and display</span>
<span class="sd">            (this is best used on the command line only)</span>
<span class="sd">        contribution : cb.Contribution, default None</span>
<span class="sd">            if provided, use Contribution object instead of reading in</span>
<span class="sd">            data from files</span>

<span class="sd">    Returns:</span>
<span class="sd">        (status, output_files) - Tuple: </span>
<span class="sd">            True or False indicating if conversion was successful, file name(s) written</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">contribution</span><span class="p">:</span>
        <span class="n">chi_data_all</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">)</span>
        <span class="n">chi_data_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">experiments</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">experiments</span> <span class="o">=</span> <span class="n">chi_data_all</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span><span class="n">experiments</span><span class="p">]</span>

    <span class="n">plotnum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fnames</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">experiments</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">chi_data</span> <span class="o">=</span> <span class="n">chi_data_all</span>
        <span class="n">chi_data</span> <span class="o">=</span> <span class="n">chi_data_all</span><span class="p">[</span><span class="n">chi_data_all</span><span class="o">.</span><span class="n">experiment</span> <span class="o">==</span> <span class="n">exp</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not enough data to plot </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="n">plotnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">plotnum</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># set up plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)</span>
        <span class="n">figs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">plotnum</span>
        <span class="n">fnames</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">exp</span> <span class="o">+</span> <span class="s1">&#39;_temperature.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

        <span class="c1"># get arrays of available temps, frequencies and fields</span>
        <span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">meas_temp</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">Fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">meas_freq</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="n">Bs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">chi_data</span><span class="o">.</span><span class="n">meas_field_ac</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

        <span class="c1"># plot chi versus temperature at constant field</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Bs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Fs</span><span class="p">):</span>
            <span class="n">this_f</span> <span class="o">=</span> <span class="n">chi_data</span><span class="p">[</span><span class="n">chi_data</span><span class="o">.</span><span class="n">meas_freq</span> <span class="o">==</span> <span class="n">f</span><span class="p">]</span>
            <span class="n">this_f</span> <span class="o">=</span> <span class="n">this_f</span><span class="p">[</span><span class="n">this_f</span><span class="o">.</span><span class="n">meas_field_ac</span> <span class="o">==</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">this_f</span><span class="o">.</span><span class="n">meas_temp</span><span class="p">,</span> <span class="mf">1e6</span><span class="o">*</span><span class="n">this_f</span><span class="o">.</span><span class="n">susc_chi_volume</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; Hz&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\chi$ ($\mu$SI)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;B = &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%7.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; T&#39;</span><span class="p">)</span>

        <span class="n">plotnum</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">figs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">plotnum</span>
        <span class="n">fnames</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)]</span> <span class="o">=</span> <span class="n">exp</span> <span class="o">+</span> <span class="s1">&#39;_frequency.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">plotnum</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># set up plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">plotnum</span><span class="p">)</span>
        <span class="c1">## plot chi versus frequency at constant B</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Bs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Ts</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">this_t</span> <span class="o">=</span> <span class="n">chi_data</span><span class="p">[</span><span class="n">chi_data</span><span class="o">.</span><span class="n">meas_temp</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
        <span class="n">this_t</span> <span class="o">=</span> <span class="n">this_t</span><span class="p">[</span><span class="n">this_t</span><span class="o">.</span><span class="n">meas_field_ac</span> <span class="o">==</span> <span class="n">b</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">this_t</span><span class="o">.</span><span class="n">meas_freq</span><span class="p">,</span> <span class="mf">1e6</span> <span class="o">*</span>
                     <span class="n">this_t</span><span class="o">.</span><span class="n">susc_chi_volume</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; K&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\chi$ ($\mu$SI)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;B = &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%7.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; T&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
            <span class="s2">&quot;enter s[a]ve to save files,  [return] to quit &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fnames</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fnames</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="quick_hyst"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.quick_hyst">[docs]</a><span class="k">def</span> <span class="nf">quick_hyst</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">meas_file</span><span class="o">=</span><span class="s2">&quot;measurements.txt&quot;</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">specimen</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_plots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
               <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes specimen plots of hysteresis data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dir_path : str, default &quot;.&quot;</span>
<span class="sd">        input directory</span>
<span class="sd">    meas_file : str, default &quot;measurements.txt&quot;</span>
<span class="sd">        name of MagIC measurement file</span>
<span class="sd">    save_plots : bool, default True</span>
<span class="sd">        save figures</span>
<span class="sd">    interactive : bool, default False</span>
<span class="sd">        if True, interactively plot and display</span>
<span class="sd">        (this is best used on the command line only)</span>
<span class="sd">    fmt : str, default &quot;svg&quot;</span>
<span class="sd">        format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">    specimen : str, default &quot;&quot;</span>
<span class="sd">        specific specimen to plot</span>
<span class="sd">    verbose : bool, default True</span>
<span class="sd">        if True, print more verbose output</span>
<span class="sd">    image_records : bool, default False</span>
<span class="sd">        if True, return a list of created images</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    if image_records == False:</span>
<span class="sd">        Tuple : (True or False indicating if conversion was successful, output file name(s) written)</span>
<span class="sd">    if image_records == True:</span>
<span class="sd">        Tuple : (True or False indicating if conversion was successful, output file name(s) written, list of images)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">read_tables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">],</span>
                              <span class="n">custom_filenames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="n">meas_file</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
    <span class="c1"># get as much name data as possible (used for naming plots)</span>
    <span class="k">if</span> <span class="s1">&#39;measurements&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No measurement file found&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">con</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;measurements&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad file&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">meas_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span>
    <span class="c1">#meas_df = meas_container.df</span>

    <span class="c1">#</span>
    <span class="c1"># initialize some variables</span>
    <span class="c1"># define figure numbers for hyst,deltaM,DdeltaM curves</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">HystRecs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">HDD</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># get list of unique experiment names and specimen names</span>
    <span class="c1">#</span>
    <span class="n">sids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hyst_data</span> <span class="o">=</span> <span class="n">meas_container</span><span class="o">.</span><span class="n">get_records_for_code</span><span class="p">(</span><span class="s1">&#39;LP-HYS&#39;</span><span class="p">)</span>
    <span class="c1">#experiment_names = hyst_data[&#39;experiment_name&#39;].unique()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">hyst_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- No hysteresis data found&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s1">&#39;specimen&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hyst_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- No specimen names in measurements data, cannot complete quick_hyst.py&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">sids</span> <span class="o">=</span> <span class="n">hyst_data</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># if &#39;treat_temp&#39; is provided, use that value, otherwise assume 300</span>
    <span class="n">hyst_data</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">hyst_data</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># start at first specimen, or at provided specimen (&#39;-spc&#39;)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">specimen</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sids</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sids</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- No specimen named: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">specimen</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Please provide a valid specimen name&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">intlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_mass&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">n_plots</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_plots</span><span class="p">:</span>
            <span class="n">sids</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[:</span><span class="n">n_plots</span><span class="p">]</span>

    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">):</span>
        <span class="n">locname</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">synth</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sids</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">))</span>
        <span class="c1"># B, M for hysteresis, Bdcd,Mdcd for irm-dcd data</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="c1"># get all measurements for this specimen</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">hyst_data</span><span class="p">[</span><span class="n">hyst_data</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span>
        <span class="c1"># get names</span>
        <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">locname</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;site&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;sample&#39;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># get all records with non-blank values in any intlist column</span>
        <span class="c1"># find intensity data</span>
        <span class="k">for</span> <span class="n">int_column</span> <span class="ow">in</span> <span class="n">intlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">int_column</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">int_col</span> <span class="o">=</span> <span class="n">int_column</span>
                <span class="k">break</span>
        <span class="n">meas_data</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">int_column</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meas_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c1">#</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="s1">&#39;c-&#39;</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="s1">&#39;m-&#39;</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="s1">&#39;y-&#39;</span><span class="p">]</span>
        <span class="n">cnum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Temps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
        <span class="n">Temps</span> <span class="o">=</span> <span class="n">meas_data</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Temps</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;working on t: &#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">t_data</span> <span class="o">=</span> <span class="n">meas_data</span><span class="p">[</span><span class="n">meas_data</span><span class="p">[</span><span class="s1">&#39;treat_temp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">int_col</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">t_data</span><span class="p">[</span><span class="s1">&#39;meas_field_dc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">t_data</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="c1"># now plot the hysteresis curve(s)</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">Temps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;Field (T)&#39;</span>
                    <span class="n">ylab</span> <span class="o">=</span> <span class="n">m</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hysteresis: &#39;</span> <span class="o">+</span> <span class="n">s</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">Temps</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">clearFIG</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">])</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span>
                    <span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">cnum</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="n">ylab</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="p">[</span>
                                    <span class="mf">1.1</span><span class="o">*</span><span class="n">B</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">B</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="n">ylab</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span><span class="n">HDD</span><span class="p">[</span><span class="s1">&#39;hyst&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span>
                                    <span class="mf">1.1</span><span class="o">*</span><span class="n">M</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">M</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">xlab</span><span class="o">=</span><span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="n">ylab</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">HDD</span><span class="p">)</span>
                <span class="n">cnum</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cnum</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
                    <span class="n">cnum</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1">#</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">specimen</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">specimen</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">HDD</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">synth</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LO:_&quot;</span><span class="o">+</span><span class="n">locname</span><span class="o">+</span><span class="s1">&#39;_SI:_&#39;</span><span class="o">+</span><span class="n">site</span> <span class="o">+</span> \
                            <span class="s1">&#39;_SA:_&#39;</span><span class="o">+</span><span class="n">sample</span><span class="o">+</span><span class="s1">&#39;_SP:_&#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;_TY:_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_.&#39;</span><span class="o">+</span><span class="n">fmt</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SY:_&#39;</span><span class="o">+</span><span class="n">synth</span><span class="o">+</span><span class="s1">&#39;_TY:_&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;_.&#39;</span><span class="o">+</span><span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">synth</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="n">locname</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                                <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">filename</span> <span class="o">+=</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">synth</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
            <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
            <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">locname</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span>
                                 <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">],</span> <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Hysteresis&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">]),</span>
                                 <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                    <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">specimen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span>
        <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">HDD</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;S[a]ve plots, [s]pecimen name, [q]uit, &lt;return&gt; to continue</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">HDD</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="n">locname</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                            <span class="n">filename</span> <span class="o">+=</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

                <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">locname</span><span class="p">,</span> <span class="s1">&#39;site&#39;</span><span class="p">:</span> <span class="n">site</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">sample</span><span class="p">,</span> <span class="s1">&#39;specimen&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span>
                                     <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PLOT_TYPES</span><span class="p">[</span><span class="n">plot_type</span><span class="p">],</span> <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Hysteresis&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">]),</span>
                                     <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
                        <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">HDD</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
                <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">HystRecs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good bye&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_records</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">keepon</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">specimen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="s1">&#39;Enter desired specimen name (or first part there of): &#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">keepon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sids</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span>
                        <span class="n">keepon</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">tmplist</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">qq</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sids</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">specimen</span> <span class="ow">in</span> <span class="n">sids</span><span class="p">[</span><span class="n">qq</span><span class="p">]:</span>
                                <span class="n">tmplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sids</span><span class="p">[</span><span class="n">qq</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">specimen</span><span class="p">,</span> <span class="s2">&quot; not found, but this was: &quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">tmplist</span><span class="p">)</span>
                        <span class="n">specimen</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select one or try again</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sids</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specimen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;skipping this one - no hysteresis data&#39;</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span><span class="p">,</span> <span class="n">image_recs</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<div class="viewcode-block" id="vgpmap_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.vgpmap_magic">[docs]</a><span class="k">def</span> <span class="nf">vgpmap_magic</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">results_file</span><span class="o">=</span><span class="s2">&quot;sites.txt&quot;</span><span class="p">,</span> <span class="n">crd</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">sym</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">rsym</span><span class="o">=</span><span class="s2">&quot;g^&quot;</span><span class="p">,</span> <span class="n">rsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;ortho&quot;</span><span class="p">,</span>
                 <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">anti</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fancy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">image_records</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes a map of vgps and a95/dp,dm for site means in a sites table</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dir_path : str, default &quot;.&quot;</span>
<span class="sd">        input directory path</span>
<span class="sd">    results_file : str, default &quot;sites.txt&quot;</span>
<span class="sd">        name of MagIC format sites file</span>
<span class="sd">    crd : str, default &quot;&quot;</span>
<span class="sd">       coordinate system [g, t] (geographic, tilt_corrected)</span>
<span class="sd">    sym : str, default &quot;ro&quot;</span>
<span class="sd">        symbol color and shape, default red circles</span>
<span class="sd">        (see matplotlib documentation for more color/shape options)</span>
<span class="sd">    size : int, default 8</span>
<span class="sd">        symbol size</span>
<span class="sd">    rsym : str, default &quot;g^&quot;</span>
<span class="sd">        symbol for plotting reverse poles</span>
<span class="sd">        (see matplotlib documentation for more color/shape options)</span>
<span class="sd">    rsize : int, default 8</span>
<span class="sd">        symbol size for reverse poles</span>
<span class="sd">    fmt : str, default &quot;pdf&quot;</span>
<span class="sd">        format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">    res : str, default &quot;c&quot;</span>
<span class="sd">        resolution [c, l, i, h] (crude, low, intermediate, high)</span>
<span class="sd">    proj : str, default &quot;ortho&quot;</span>
<span class="sd">        ortho = orthographic</span>
<span class="sd">        lcc = lambert conformal</span>
<span class="sd">        moll = molweide</span>
<span class="sd">        merc = mercator</span>
<span class="sd">    flip : bool, default False</span>
<span class="sd">        if True, flip reverse poles to normal antipode</span>
<span class="sd">    anti : bool, default False</span>
<span class="sd">        if True, plot antipodes for each pole</span>
<span class="sd">    fancy : bool, default False</span>
<span class="sd">        if True, plot topography (not yet implemented)</span>
<span class="sd">    ell : bool, default False</span>
<span class="sd">        if True, plot ellipses</span>
<span class="sd">    ages : bool, default False</span>
<span class="sd">        if True, plot ages</span>
<span class="sd">    lat_0 : float, default 0.</span>
<span class="sd">        eyeball latitude</span>
<span class="sd">    lon_0 : float, default 0.</span>
<span class="sd">        eyeball longitude</span>
<span class="sd">    save_plots : bool, default True</span>
<span class="sd">        if True, create and save all requested plots</span>
<span class="sd">    interactive : bool, default False</span>
<span class="sd">       if True, interactively plot and display</span>
<span class="sd">        (this is best used on the command line only)</span>
<span class="sd">    image_records : bool, default False</span>
<span class="sd">        if True, return a list of created images</span>

<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    if image_records == False:</span>
<span class="sd">        type - Tuple : (True or False indicating if conversion was successful, file name(s) written)</span>
<span class="sd">    if image_records == True:</span>
<span class="sd">       Tuple : (True or False indicating if conversion was successful, output file name written, list of image recs)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coord_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="n">coord_dict</span><span class="p">[</span><span class="n">crd</span><span class="p">]</span> <span class="k">if</span> <span class="n">crd</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="n">results_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">contribution</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W - Couldn&#39;t read in data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s1">&#39;sites&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W - No sites data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">con</span><span class="o">.</span><span class="n">add_magic_table</span><span class="p">(</span><span class="s1">&#39;contribution&#39;</span><span class="p">)</span>
    <span class="n">con_id</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">get_con_id</span><span class="p">()</span>
    <span class="n">image_recs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">FIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;map&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="c1"># read in sites file</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Pars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dates</span><span class="p">,</span> <span class="n">rlats</span><span class="p">,</span> <span class="n">rlons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">site_container</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]</span>
    <span class="n">site_container</span><span class="o">.</span><span class="n">front_and_backfill</span><span class="p">([</span><span class="s1">&#39;location&#39;</span><span class="p">])</span>
    <span class="n">site_df</span> <span class="o">=</span> <span class="n">site_container</span><span class="o">.</span><span class="n">df</span>
    <span class="c1"># use records with vgp_lat and vgp_lon</span>
    <span class="k">if</span> <span class="s1">&#39;vgp_lat&#39;</span> <span class="ow">in</span> <span class="n">site_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;vgp_lon&#39;</span> <span class="ow">in</span> <span class="n">site_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span> <span class="o">=</span> <span class="n">site_df</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="n">site_df</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;nothing to plot&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="n">Results</span> <span class="o">=</span> <span class="n">site_df</span><span class="p">[</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">]</span>
    <span class="c1"># use tilt correction</span>
    <span class="k">if</span> <span class="n">coord</span> <span class="ow">and</span> <span class="s1">&#39;dir_tilt_correction&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">Results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;dir_tilt_correction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">coord</span><span class="p">]</span>
    <span class="c1"># get location name and average ages</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">):</span>
        <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">ages</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># go through rows and extract data</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">Results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">({</span><span class="mh">0x2c</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="mh">0x2212</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">}))</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">({</span><span class="mh">0x2c</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="mh">0x2212</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">}))</span>
        <span class="k">if</span> <span class="n">anti</span><span class="p">:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">180.</span>
            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mf">360.</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">flip</span><span class="p">:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">flip</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rlats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">180.</span>
                <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mi">360</span>
                <span class="n">rlons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

        <span class="n">ppars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">ell1</span><span class="p">,</span> <span class="n">ell2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;vgp_dm&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_dm&#39;</span><span class="p">]:</span>
            <span class="n">ell1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_dm&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;vgp_dp&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_dp&#39;</span><span class="p">]:</span>
            <span class="n">ell2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_dp&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;vgp_alpha95&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_alpha95&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_alpha95&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ell1</span><span class="p">,</span> <span class="n">ell2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_alpha95&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;vgp_alpha95&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ell1</span> <span class="ow">and</span> <span class="n">ell2</span><span class="p">:</span>
            <span class="n">ppars</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell1</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">isign</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">isign</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">isign</span> <span class="o">*</span> <span class="mf">90.</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell2</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">)</span>
            <span class="n">ppars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">Pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ppars</span><span class="p">)</span>

    <span class="n">location</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">Opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latmin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;latmax&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;lonmin&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;lonmax&#39;</span><span class="p">:</span> <span class="mf">360.</span><span class="p">,</span>
            <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="n">lat_0</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="n">lon_0</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="n">proj</span><span class="p">,</span> <span class="s1">&#39;sym&#39;</span><span class="p">:</span> <span class="s1">&#39;bs&#39;</span><span class="p">,</span>
            <span class="s1">&#39;symsize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;pltgrid&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">,</span> <span class="s1">&#39;boundinglat&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">}</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coasts&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rivers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span> <span class="n">fancy</span><span class="p">}</span>
    <span class="c1"># make the base map with a blue triangle at the pole</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">],</span> <span class="n">Opts</span><span class="p">)</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;pltgrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sym</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># add the lats and lons of the poles</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">Opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rlats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsym</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsize</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">color</span><span class="p">,</span> <span class="n">symbol</span> <span class="o">=</span> <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rlons</span><span class="p">,</span> <span class="n">rlats</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                              <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">rlats</span><span class="p">,</span> <span class="n">rlons</span><span class="p">,</span> <span class="n">Opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ell</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># add ellipses if desired.</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coasts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rivers&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="s1">&#39;countries&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span> <span class="n">fancy</span><span class="p">}</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;pltgrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># turn off meridian replotting</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;symsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">Opts</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g-&#39;</span>
        <span class="k">for</span> <span class="n">ppars</span> <span class="ow">in</span> <span class="n">Pars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ppars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">PTS</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_ell</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">ppars</span><span class="p">,</span> <span class="s1">&#39;g.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">elats</span><span class="p">,</span> <span class="n">elons</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">PTS</span><span class="p">:</span>
                    <span class="n">elons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">elats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># make the base map with a blue triangle at the pole</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">],</span> <span class="n">elats</span><span class="p">,</span> <span class="n">elons</span><span class="p">,</span> <span class="n">Opts</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set_env</span><span class="o">.</span><span class="n">IS_WIN</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FIG</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>  <span class="c1"># use server plot naming convention</span>
            <span class="k">if</span> <span class="n">con_id</span><span class="p">:</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MC:_&#39;</span> <span class="o">+</span> <span class="n">con_id</span> <span class="o">+</span> <span class="s1">&#39;_TY:_VGP_map.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;LO:_&#39;</span> <span class="o">+</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39;_TY:_VGP_map.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use more readable naming convention</span>
            <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_VGP_map.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="n">black</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
        <span class="n">purple</span> <span class="o">=</span> <span class="s1">&#39;#800080&#39;</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">titles</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="s1">&#39; VGP map&#39;</span>
        <span class="n">FIG</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">black</span><span class="p">,</span> <span class="n">purple</span><span class="p">)</span>
        <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot; S[a]ve to save plot, Return to quit:  &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="n">save_plots</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Good bye&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_recs</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[],</span> <span class="n">image_recs</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">version_num</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">image_records</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">image_rec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;map of VGPs&quot;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;VGP Map&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;keywords&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;software_packages&#39;</span><span class="p">:</span> <span class="n">version_num</span><span class="p">,</span>
                             <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()}</span>
                <span class="n">image_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_rec</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">files</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">image_recs</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">files</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="histplot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.histplot">[docs]</a><span class="k">def</span> <span class="nf">histplot</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">(),</span> <span class="n">outfile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes histograms for data</span>

<span class="sd">    Parameters:</span>
<span class="sd">        infile (str): default &quot;&quot;</span>
<span class="sd">            input file name</span>
<span class="sd">            format: single variable</span>
<span class="sd">        data (tuple): list-like, default ()</span>
<span class="sd">            list/array of values to plot if infile is not provided</span>
<span class="sd">        outfile (str): default &quot;&quot;</span>
<span class="sd">            name for plot, if not provided defaults to hist.FMT</span>
<span class="sd">        xlab (str): default &#39;x&#39;</span>
<span class="sd">            label for x axis</span>
<span class="sd">        binsize (int): default False</span>
<span class="sd">            desired binsize.  if not specified, an appropriate binsize will be calculated.</span>
<span class="sd">        norm (int): default 1</span>
<span class="sd">            1: norm, 0: don&#39;t norm, -1: show normed and non-normed axes</span>
<span class="sd">        fmt (str): default &quot;svg&quot;</span>
<span class="sd">            format for figures, [&quot;svg&quot;, &quot;jpg&quot;, &quot;pdf&quot;, &quot;png&quot;]</span>
<span class="sd">        save_plots (bool): default True</span>
<span class="sd">            if True, create and save all requested plots</span>
<span class="sd">        interactive (bool): default False</span>
<span class="sd">            interactively plot and display</span>
<span class="sd">            (this is best used on the command line only)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set outfile name</span>
    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;hist.&#39;</span><span class="o">+</span><span class="n">fmt</span>
    <span class="c1"># read in data from infile or use data argument</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">infile</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- No data found&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-W- Not enough data found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-W- Not enough points to plot histogram (</span><span class="si">{}</span><span class="s2"> point(s) provided, 5 required)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># if binsize not provided, calculate reasonable binsize</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">binsize</span><span class="p">:</span>
        <span class="n">binsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">3.22</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">))))</span>
    <span class="n">binsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binsize</span><span class="p">)</span>
    <span class="n">Nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;normalizing&#39;</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">D</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;not normalizing&#39;</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">D</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1">#print(&#39;trying twin&#39;)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">D</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">D</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">D</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">D</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">.1</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;N = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;hist&#39;</span><span class="p">})</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;s[a]ve to save plot, [q]uit to exit without saving  &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plot saved in &#39;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">outfile</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
        <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">add_borders</span><span class="p">({</span><span class="s1">&#39;hist&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;hist&#39;</span><span class="p">:</span> <span class="s1">&#39;Intensity Histogram&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plot saved in &#39;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="n">outfile</span><span class="p">]</span></div>


<div class="viewcode-block" id="dmag_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.dmag_magic">[docs]</a><span class="k">def</span> <span class="nf">dmag_magic</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="s2">&quot;measurements.txt&quot;</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">spec_file</span><span class="o">=</span><span class="s2">&quot;specimens.txt&quot;</span><span class="p">,</span> <span class="n">samp_file</span><span class="o">=</span><span class="s2">&quot;samples.txt&quot;</span><span class="p">,</span>
               <span class="n">site_file</span><span class="o">=</span><span class="s2">&quot;sites.txt&quot;</span><span class="p">,</span> <span class="n">loc_file</span><span class="o">=</span><span class="s2">&quot;locations.txt&quot;</span><span class="p">,</span>
               <span class="n">plot_by</span><span class="o">=</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="n">LT</span><span class="o">=</span><span class="s2">&quot;AF&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">XLP</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">n_plots</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">contribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots intensity decay curves for demagnetization experiments</span>

<span class="sd">    Parameters:</span>
<span class="sd">        in_file (str): default &quot;measurements.txt&quot;</span>
<span class="sd">        dir_path (str):</span>
<span class="sd">            output directory, default &quot;.&quot;</span>
<span class="sd">        input_dir_path (str):</span>
<span class="sd">            input file directory (if different from dir_path), default &quot;&quot;</span>
<span class="sd">        spec_file (str):</span>
<span class="sd">            input specimen file name, default &quot;specimens.txt&quot;</span>
<span class="sd">        samp_file (str):</span>
<span class="sd">            input sample file name, default &quot;samples.txt&quot;</span>
<span class="sd">        site_file (str):</span>
<span class="sd">            input site file name, default &quot;sites.txt&quot;</span>
<span class="sd">        loc_file (str):</span>
<span class="sd">            input location file name, default &quot;locations.txt&quot;</span>
<span class="sd">        plot_by (str):</span>
<span class="sd">            [spc, sam, sit, loc] (specimen, sample, site, location), default &quot;loc&quot;</span>
<span class="sd">        LT (str):</span>
<span class="sd">            lab treatment [T, AF, M], default AF</span>
<span class="sd">        norm (bool): </span>
<span class="sd">            normalize by NRM magnetization, default True</span>
<span class="sd">        XLP (str):</span>
<span class="sd">            exclude specific  lab protocols, (for example, method codes like LP-PI)</span>
<span class="sd">            default &quot;&quot;</span>
<span class="sd">        save_plots (bool): </span>
<span class="sd">            plot and save non-interactively, default True</span>
<span class="sd">        fmt (str): str</span>
<span class="sd">            [&quot;png&quot;, &quot;svg&quot;, &quot;pdf&quot;, &quot;jpg&quot;], default &quot;svg&quot;</span>
<span class="sd">        interactive (bool): default False</span>
<span class="sd">            interactively plot and display for each specimen</span>
<span class="sd">            (this is best used on the command line only)</span>
<span class="sd">        n_plots (int): default 5</span>
<span class="sd">            maximum number of plots to make</span>
<span class="sd">            if you want to make all possible plots, specify &quot;all&quot;</span>
<span class="sd">        contribution : cb.Contribution, default None</span>
<span class="sd">            if provided, use Contribution object instead of reading in</span>
<span class="sd">            data from files</span>

<span class="sd">    Returns:</span>
<span class="sd">        True or False indicating if conversion was successful, file name(s) written</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">input_dir_path</span><span class="p">:</span>
        <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">dir_path</span>
    <span class="n">input_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">)</span>

    <span class="c1"># format plot_key</span>
    <span class="n">name_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;sit&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;sam&#39;</span><span class="p">:</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;spc&#39;</span><span class="p">:</span> <span class="s1">&#39;specimen&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">plot_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plot_key</span> <span class="o">=</span> <span class="n">name_dict</span><span class="p">[</span><span class="n">plot_by</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;Unrecognized plot_by </span><span class="si">{}</span><span class="s1">, falling back to plot by location&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_by</span><span class="p">))</span>
            <span class="n">plot_key</span> <span class="o">=</span> <span class="s2">&quot;loc&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot_key</span> <span class="o">=</span> <span class="n">plot_by</span>

    <span class="c1"># figure out what kind of experiment</span>
    <span class="n">LT</span> <span class="o">=</span> <span class="s2">&quot;LT-&quot;</span> <span class="o">+</span> <span class="n">LT</span> <span class="o">+</span> <span class="s2">&quot;-Z&quot;</span>
    <span class="k">if</span> <span class="n">LT</span> <span class="o">==</span> <span class="s2">&quot;LT-T-Z&quot;</span><span class="p">:</span>
        <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_temp&#39;</span>
    <span class="k">elif</span> <span class="n">LT</span> <span class="o">==</span> <span class="s2">&quot;LT-AF-Z&quot;</span><span class="p">:</span>
        <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_ac_field&#39;</span>
    <span class="k">elif</span> <span class="n">LT</span> <span class="o">==</span> <span class="s1">&#39;LT-M-Z&#39;</span><span class="p">:</span>
        <span class="n">units</span><span class="p">,</span> <span class="n">dmag_key</span> <span class="o">=</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;treat_mw_energy&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span>

    <span class="c1"># init</span>
    <span class="n">FIG</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># plot dictionary</span>
    <span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># demag is figure 1</span>
    <span class="c1"># create or access contribution</span>
    <span class="k">if</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;specimens&quot;</span><span class="p">:</span> <span class="n">spec_file</span><span class="p">,</span> <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="n">samp_file</span><span class="p">,</span>
                  <span class="s1">&#39;sites&#39;</span><span class="p">:</span> <span class="n">site_file</span><span class="p">,</span> <span class="s1">&#39;locations&#39;</span><span class="p">:</span> <span class="n">loc_file</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pmag</span><span class="o">.</span><span class="n">resolve_file_name</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">input_dir_path</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-E- Could not find </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">in_file</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">contribution</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">Contribution</span><span class="p">(</span><span class="n">input_dir_path</span><span class="p">,</span> <span class="n">single_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">,</span>
                                       <span class="n">custom_filenames</span><span class="o">=</span><span class="n">fnames</span><span class="p">)</span>
    <span class="n">file_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="p">),</span>
          <span class="s1">&#39; records read from &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
    <span class="c1"># add plot_key into measurements table</span>
    <span class="k">if</span> <span class="n">plot_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1">#contribution.propagate_name_down(plot_key, &#39;measurements&#39;)</span>
        <span class="n">contribution</span><span class="o">.</span><span class="n">propagate_location_to_measurements</span><span class="p">()</span>
    <span class="n">data_container</span> <span class="o">=</span> <span class="n">contribution</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">file_type</span><span class="p">]</span>
    <span class="c1"># pare down to only records with useful data</span>
    <span class="c1"># grab records that have the requested code</span>
    <span class="n">data_slice</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">get_records_for_code</span><span class="p">(</span><span class="n">LT</span><span class="p">)</span>
    <span class="c1"># and don&#39;t have the offending code</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data_container</span><span class="o">.</span><span class="n">get_records_for_code</span><span class="p">(</span><span class="n">XLP</span><span class="p">,</span> <span class="n">incl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_slice</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">sli</span><span class="o">=</span><span class="n">data_slice</span><span class="p">,</span> <span class="n">strict_match</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># make sure quality is in the dataframe</span>
    <span class="k">if</span> <span class="s1">&#39;quality&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
    <span class="c1"># get intensity key and make sure intensity data is not blank</span>
    <span class="n">intlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;magn_mass&#39;</span><span class="p">]</span>
    <span class="n">IntMeths</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_name</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">intlist</span><span class="p">]</span>
    <span class="c1"># get rid of any entirely blank intensity columns</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">IntMeths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">IntMeths</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_name</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">intlist</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IntMeths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-E- No intensity headers found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># plot first intensity method found - normalized to initial value anyway - doesn&#39;t matter which used</span>
    <span class="n">int_key</span> <span class="o">=</span> <span class="n">IntMeths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">int_key</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
    <span class="c1"># make list of individual plots</span>
    <span class="c1"># by default, will be by location_name</span>
    <span class="n">plotlist</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">plotlist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">last_plot</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># iterate through and plot the data</span>
    <span class="k">if</span> <span class="n">n_plots</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plotlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_plots</span><span class="p">:</span>
            <span class="n">plotlist</span> <span class="o">=</span> <span class="n">plotlist</span><span class="p">[:</span><span class="n">n_plots</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plotlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="n">plotlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">last_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">plot_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">plot</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_plots</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s1">&#39;plotting by: &#39;</span><span class="p">,</span> <span class="n">plot_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">plot</span>
            <span class="n">spcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">spcs</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="n">spcs</span><span class="p">:</span>
                <span class="n">INTblock</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">spec_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="n">plot_data</span><span class="p">[</span><span class="s1">&#39;specimen&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">spc</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">spec_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">INTblock</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">dmag_key</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span>
                        <span class="n">rec</span><span class="p">[</span><span class="n">int_key</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">INTblock</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">plot_mag</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">],</span> <span class="n">INTblock</span><span class="p">,</span>
                                         <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">save_plots</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FIG</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">LT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
                        <span class="n">incl_dir</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if not server, include directory in output path</span>
                        <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">dir_path</span><span class="p">,</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">LT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
                        <span class="n">incl_dir</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_dir</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">interactive</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot; S[a]ve to save plot, [q]uit,  Return to continue:  &quot;</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">FIG</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">isServer</span><span class="p">:</span>
                            <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">LT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span>
                            <span class="n">incl_dir</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if not server, include directory in output path</span>
                            <span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">dir_path</span><span class="p">,</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">LT</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span>
                            <span class="n">incl_dir</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">saved</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pmagplotlib</span><span class="o">.</span><span class="n">save_plots</span><span class="p">(</span><span class="n">FIG</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">incl_directory</span><span class="o">=</span><span class="n">incl_dir</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">draw_figs</span><span class="p">(</span><span class="n">FIG</span><span class="p">)</span>
            <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">clearFIG</span><span class="p">(</span><span class="n">FIG</span><span class="p">[</span><span class="s1">&#39;demag&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">last_plot</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">saved</span></div>


<span class="n">PLOT_TYPES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eqarea&#39;</span><span class="p">:</span> <span class="s2">&quot;Equal Area Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;arai&quot;</span><span class="p">:</span> <span class="s2">&quot;ARAI plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;zijd&quot;</span><span class="p">:</span> <span class="s2">&quot;Zijderveld Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;demag&quot;</span><span class="p">:</span> <span class="s2">&quot;Demagnetization Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;deremag&quot;</span><span class="p">:</span> <span class="s2">&quot;De-Remagnetization Plot&quot;</span><span class="p">,</span> <span class="s1">&#39;hyst&#39;</span><span class="p">:</span> <span class="s1">&#39;Hysteresis Loop&#39;</span><span class="p">,</span>
              <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;Anisotropy Data Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="s2">&quot;Anisotropy Confidence Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;tcdf&quot;</span><span class="p">:</span> <span class="s2">&quot;tcdf&quot;</span><span class="p">,</span> <span class="s2">&quot;cdf_0&quot;</span><span class="p">:</span> <span class="s2">&quot;cdf_0&quot;</span><span class="p">,</span> <span class="s2">&quot;cdf_1&quot;</span><span class="p">:</span> <span class="s2">&quot;cdf_1&quot;</span><span class="p">,</span> <span class="s2">&quot;cdf_2&quot;</span><span class="p">:</span> <span class="s2">&quot;cdf_2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="s2">&quot;Day Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bcr&quot;</span><span class="p">:</span> <span class="s2">&quot;Day Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bc&quot;</span><span class="p">:</span> <span class="s2">&quot;Day Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;bcr1-bcr2&quot;</span><span class="p">:</span> <span class="s2">&quot;Day Plot&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="df_depthplot"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.df_depthplot">[docs]</a><span class="k">def</span> <span class="nf">df_depthplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">d_key</span><span class="o">=</span><span class="s1">&#39;core_depth&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes depth (or height) plots of various columns in the dataframe</span>

<span class="sd">    Parameters:</span>
<span class="sd">        df : pandas dataframe</span>
<span class="sd">        d_key (str): </span>
<span class="sd">            name of column for plotting against [&#39;core_depth&#39;,&#39;composite_depth&#39;,&#39;height&#39;]</span>
<span class="sd">        fmt (str): </span>
<span class="sd">            format of saved figure, default is &#39;png&#39;</span>
<span class="sd">        location (str): </span>
<span class="sd">            name of location</span>
<span class="sd">        save (boolean): </span>
<span class="sd">            if True, save plot to location.fmt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dir_dec&#39;</span><span class="p">,</span><span class="s1">&#39;dir_inc&#39;</span><span class="p">,</span><span class="s1">&#39;int_rel&#39;</span><span class="p">,</span><span class="s1">&#39;int_rel_ARM&#39;</span><span class="p">,</span><span class="s1">&#39;int_rel_IRM&#39;</span><span class="p">,</span><span class="s1">&#39;int_rel_chi&#39;</span><span class="p">,</span>
               <span class="s1">&#39;int_abs&#39;</span><span class="p">,</span><span class="s1">&#39;vgp_lat&#39;</span><span class="p">,</span><span class="s1">&#39;vgp_lon&#39;</span><span class="p">,</span><span class="s1">&#39;magn_moment&#39;</span><span class="p">,</span><span class="s1">&#39;magn_volume&#39;</span><span class="p">,</span><span class="s1">&#39;magn_mass&#39;</span><span class="p">,</span>
              <span class="s1">&#39;susc_chi_volume&#39;</span><span class="p">,</span><span class="s1">&#39;susc_chi_mass&#39;</span><span class="p">]</span>
    <span class="n">use_keys</span><span class="o">=</span><span class="n">plot_keys</span><span class="p">[:]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">plot_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">use_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">use_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting these columns: &#39;</span><span class="p">,</span><span class="n">use_keys</span><span class="p">)</span>
    <span class="n">cols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">use_keys</span><span class="p">)</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">11</span>
    <span class="n">width</span><span class="o">=</span><span class="n">cols</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">plt_num</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">pmagplotlib</span><span class="o">.</span><span class="n">clearFIG</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">use_keys</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span><span class="n">plt_num</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="n">d_key</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plt_num</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="o">=</span><span class="p">(</span><span class="n">d_key</span><span class="p">)</span>
        <span class="n">plt_num</span><span class="o">+=</span><span class="mi">1</span>
    <span class="c1">#plt.title(location)</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">location</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_magic"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.validate_magic">[docs]</a><span class="k">def</span> <span class="nf">validate_magic</span><span class="p">(</span><span class="n">top_dir</span><span class="p">,</span><span class="n">doi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">private_key</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">contribution_id</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    download and validate a magic contribution</span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    top_dir: str</span>
<span class="sd">        name of project</span>
<span class="sd">    doi: str</span>
<span class="sd">        DOI of paper to download</span>
<span class="sd">    contribution_id: str</span>
<span class="sd">         id of contribution</span>
<span class="sd">    private_key : str</span>
<span class="sd">         private key of contribution in private workspace</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set up directories</span>
    <span class="n">magic_dir</span><span class="o">=</span><span class="n">top_dir</span><span class="o">+</span><span class="s1">&#39;/MagIC&#39;</span>
    <span class="n">dirs</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">top_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">top_dir</span><span class="p">)</span>
    <span class="n">dirs</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">top_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;MagIC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">magic_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">doi</span><span class="p">:</span>
        <span class="n">magic_contribution</span><span class="o">=</span><span class="s1">&#39;magic_contribution.txt&#39;</span> <span class="c1"># set the file name string</span>
        <span class="n">download_magic_from_doi</span><span class="p">(</span><span class="n">doi</span><span class="p">)</span> <span class="c1"># download the contribution from MagIC</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">magic_contribution</span><span class="p">,</span> <span class="n">magic_dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">magic_contribution</span><span class="p">)</span> <span class="c1"># move the contribution to the directory</span>
        <span class="n">download_magic</span><span class="p">(</span><span class="n">magic_contribution</span><span class="p">,</span><span class="n">dir_path</span><span class="o">=</span><span class="n">magic_dir</span><span class="p">,</span><span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># unpack the file</span>
    <span class="k">elif</span> <span class="n">contribution_id</span><span class="p">:</span>
        <span class="n">magic_contribution</span><span class="o">=</span><span class="s1">&#39;magic_contribution_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span> <span class="c1"># set the file name string</span>
        <span class="n">download_magic_from_id</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">)</span> <span class="c1"># download the contribution from MagIC</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">magic_contribution</span><span class="p">,</span> <span class="n">magic_dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">magic_contribution</span><span class="p">)</span> <span class="c1"># move the contribution to the directory</span>
        <span class="n">download_magic</span><span class="p">(</span><span class="n">magic_contribution</span><span class="p">,</span><span class="n">dir_path</span><span class="o">=</span><span class="n">magic_dir</span><span class="p">,</span><span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># unpack the file</span>
        
    <span class="k">elif</span> <span class="n">private_key</span><span class="p">:</span>
        <span class="n">shared_contribution_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">contribution_id</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">private_key</span><span class="p">})</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shared_contribution_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">):</span>
            <span class="n">shared_contribution_text</span> <span class="o">=</span> <span class="n">shared_contribution_response</span><span class="o">.</span><span class="n">text</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">shared_contribution_text</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">200</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">shared_contribution_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">204</span><span class="p">):</span> <span class="c1"># bad file</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contribution ID and/or private key do not match any contributions in MagIC.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="n">shared_contribution_response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;err&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span><span class="kc">False</span>
         <span class="c1"># save and unpack downloaded data  </span>
        <span class="n">magic_contribution</span><span class="o">=</span><span class="s1">&#39;magic_contribution_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">contribution_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span>
        <span class="n">magic_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">magic_dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">magic_contribution</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;backslashreplace&quot;</span><span class="p">)</span>
        <span class="n">magic_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shared_contribution_text</span><span class="p">)</span>
        <span class="n">download_magic</span><span class="p">(</span><span class="n">magic_contribution</span><span class="p">,</span><span class="n">dir_path</span><span class="o">=</span><span class="n">magic_dir</span><span class="p">,</span><span class="n">print_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># unpack the file</span>
    <span class="n">validation</span><span class="o">=</span><span class="n">upload_magic</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">magic_dir</span><span class="p">,</span><span class="n">input_dir_path</span><span class="o">=</span><span class="n">magic_dir</span><span class="p">,</span><span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">upload_file</span><span class="o">=</span><span class="n">validation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">return</span> <span class="n">magic_dir</span><span class="p">,</span><span class="n">upload_file</span></div>


<div class="viewcode-block" id="simul_correlation_prob"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.simul_correlation_prob">[docs]</a><span class="k">def</span> <span class="nf">simul_correlation_prob</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">print_result</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function runs an algorithm from Bogue and Coe (1981; doi: 10.1029/JB086iB12p11883) </span>
<span class="sd">    for probabilistic correlation, evaluating the probability that the similarity between </span>
<span class="sd">    two paleomagnetic directions is due to simultaneous sampling of the ancient magnetic </span>
<span class="sd">    field. This can be compared with the probability that the two directions were sampled </span>
<span class="sd">    at random times with the companion function (ipmag.random_correlation_prob; to come). </span>
<span class="sd">    k1 and k2 can be estimated the kappa of the  directions, or one can use the companion </span>
<span class="sd">    function (ipmag.full_kappa; to come) as in the original publication. </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        alpha : angle between paleomagnetic directions (site means)</span>
<span class="sd">        k1 (float): kappa estimate for first direction</span>
<span class="sd">        k2 (float): kappa estimate for second direction</span>
<span class="sd">        trials (int): the number of simulations [default = 10,000]</span>
<span class="sd">        print_result (boolean): the probability value returned in a sentence [default = False]</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        float </span>
<span class="sd">            number indicating probability value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#sets initial value for counters</span>
    <span class="n">hit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">miss</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1">#trial loop</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="c1">#generates two synthetic directions, using the estimated kappas</span>
        <span class="n">lontp1</span><span class="p">,</span><span class="n">lattp1</span> <span class="o">=</span> <span class="n">ipmag</span><span class="o">.</span><span class="n">fishrot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">lontp2</span><span class="p">,</span><span class="n">lattp2</span> <span class="o">=</span> <span class="n">ipmag</span><span class="o">.</span><span class="n">fishrot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#determines the angle between the generated directions </span>
        <span class="n">angle</span><span class="o">=</span><span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="n">lontp1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lattp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">lontp2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lattp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c1">#checks if angle between synthetic directions meets or exceeds &#39;known&#39; angle from directions to be tested</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">angle</span> <span class="o">&gt;=</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="n">hit</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miss</span> <span class="o">=</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1">#calculates probability based on how often the angle between the &#39;real&#39; datasets is met or exceeded</span>
    <span class="n">simul_prob</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">hit</span> <span class="o">/</span> <span class="n">trials</span>
    
    <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The probability that directions represent simultaneous samples of the geomagnetic field is: </span><span class="si">{0:5.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">simul_prob</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">simul_prob</span></div>

<div class="viewcode-block" id="rand_correlation_prob"><a class="viewcode-back" href="../../api/api.html#pmagpy.ipmag.rand_correlation_prob">[docs]</a><span class="k">def</span> <span class="nf">rand_correlation_prob</span><span class="p">(</span><span class="n">sec_var</span><span class="p">,</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">print_result</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function does a brute force numerical simulation of the &#39;random&#39; </span>
<span class="sd">    hypothesis of Bogue + Coe (1981). Basically asks and answers the question:</span>
<span class="sd">    if we randomly sampled the ancient field, how frequently would we get two</span>
<span class="sd">    VGPs that are both this far from the time-averaged pole and this close </span>
<span class="sd">    together?  Approach is, assume VGP1 observed first, pull a random </span>
<span class="sd">    direction from Fisher distribution about mean pole with k. If it is within</span>
<span class="sd">    alpha of VGP1, hit. If not, miss. Repeat many (10,000?) times. </span>
<span class="sd">    P(Hr)1 = hit/(trials). Then, repeat this process with VGP2, getting</span>
<span class="sd">    P(Hr)2. The returned probability is the average of the two.</span>
<span class="sd">    </span>
<span class="sd">    A version of this function was written in Python by S. Bogue, translated</span>
<span class="sd">    to PmagPy functionality by A. Pivarunas</span>
<span class="sd">    </span>
<span class="sd">    Bogue, S.W., and Coe, R.S., 1981, Paleomagnetic correlation of Columbia </span>
<span class="sd">    River basalt flows using secular variation. Journal of Geophysical</span>
<span class="sd">    Research, v. 86, p. 11883-11897.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sec_var: kappa estimate of regional secular variation (probably 30 or 40)</span>
<span class="sd">    alpha: angle between paleomagnetic directions (or poles)</span>
<span class="sd">    delta1: distance of direction 1 from mean direction</span>
<span class="sd">    delta2: distance of direction 2 from mean direction</span>
<span class="sd">    trials: the number of simulations, default=10,000</span>
<span class="sd">    print_result: the probability value printed as a sentence, default=False </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    --------------------------</span>
<span class="sd">    rand_prob </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#calc probability of getting vgp within alpha of vgp1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">miss</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">dec</span><span class="p">,</span><span class="n">inc</span> <span class="o">=</span> <span class="n">ipmag</span><span class="o">.</span><span class="n">fishrot</span><span class="p">(</span><span class="n">sec_var</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">angle</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="n">hit</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miss</span> <span class="o">=</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">1</span> 

    <span class="n">prand1</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">hit</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
    <span class="c1">#print (&#39;P1(Hr): &#39;,prand1);</span>

    <span class="c1">#calc probability of getting vgp within alpha of vgp2</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">miss</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">dec</span><span class="p">,</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">ipmag</span><span class="o">.</span><span class="n">fishrot</span><span class="p">(</span><span class="n">sec_var</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">di_block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">pmag</span><span class="o">.</span><span class="n">angle</span><span class="p">([</span><span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inc</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">delta2</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">angle</span> <span class="o">&lt;=</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="n">hit</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miss</span> <span class="o">=</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">prand2</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">hit</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
    <span class="c1">#the average of the two trials is the probability of the &quot;random&quot; hypothesis</span>
    <span class="n">rand_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">prand1</span> <span class="o">+</span> <span class="n">prand2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">print_result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The probability (average of P1 and P2) that directions represent random samples of the geomagnetic field is: </span><span class="si">{0:5.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">prand1</span><span class="o">+</span><span class="n">prand2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">rand_prob</span></div>
</pre></div>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By PmagPy Contributors<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>